webpackJsonp([39],{2139:function(e,a,t){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var a={};if(null!=e)for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&(a[t]=e[t]);return a.default=e,a}function l(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0});var s=t(6),i=l(s),r=t(4),o=l(r),d=t(7),u=l(d),m=t(5),c=l(m),f=t(8),g=l(f),p=t(2),h=l(p),E=t(1),w=l(E),v=t(17),_=t(44),b=t(29),S=t(56),M=n(S),N=t(435),y=t(69),I=t(135),L=l(I),k=t(25),C=l(k),F=t(9),U=l(F),P=t(104),D=n(P),O=t(16),A=n(O),q=t(2081),G=l(q),T=t(2083),W=l(T),x=t(238),R=l(x),B=t(2085),z=l(B),H=function(a){function t(a){(0,o.default)(this,t);var n=(0,u.default)(this,(t.__proto__||(0,i.default)(t)).call(this,a));n.preSubmit=n.preSubmit.bind(n),n.submit=n.submit.bind(n),n.finishSignin=n.finishSignin.bind(n),n.handleLoginIdChange=n.handleLoginIdChange.bind(n),n.handlePasswordChange=n.handlePasswordChange.bind(n);var l="";return n.props.location.query.extra===U.default.SIGNIN_VERIFIED&&n.props.location.query.email&&(l=n.props.location.query.email),n.state={ldapEnabled:"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_config.EnableLdap,usernameSigninEnabled:"true"===e.window.mm_config.EnableSignInWithUsername,emailSigninEnabled:"true"===e.window.mm_config.EnableSignInWithEmail,samlEnabled:"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_config.EnableSaml,loginId:l,password:"",showMfa:!1,loading:!1},n}return(0,g.default)(t,a),(0,c.default)(t,null,[{key:"propTypes",get:function(){return{location:h.default.object.isRequired,params:h.default.object.isRequired}}}]),(0,c.default)(t,[{key:"componentDidMount",value:function(){document.title=e.window.mm_config.SiteName,L.default.removeGlobalItem("team"),C.default.getCurrentUser()&&M.redirectUserToDefaultTeam(),this.props.location.query.extra===U.default.SIGNIN_VERIFIED&&this.props.location.query.email&&this.refs.password.focus()}},{key:"preSubmit",value:function(a){var t=this;a.preventDefault();var n=this.refs.loginId.value;n!==this.state.loginId&&this.setState({loginId:n});var l=this.refs.password.value;if(l!==this.state.password&&this.setState({password:l}),!(n=n.trim().toLowerCase())){var s="login.no";return this.state.emailSigninEnabled&&(s+="Email"),this.state.usernameSigninEnabled&&(s+="Username"),this.state.ldapEnabled&&(s+="LdapUsername"),void this.setState({serverError:w.default.createElement(v.FormattedMessage,{id:s,values:{ldapUsername:e.window.mm_config.LdapLoginFieldName||A.localizeMessage("login.ldapUsernameLower","AD/LDAP username")}})})}if(!l)return void this.setState({serverError:w.default.createElement(v.FormattedMessage,{id:"login.noPassword",defaultMessage:"Please enter your password"})});(0,y.checkMfa)(n,function(e){e?t.setState({showMfa:!0}):t.submit(n,l,"")},function(e){t.setState({serverError:e.message})})}},{key:"submit",value:function(e,a,t){var n=this;this.setState({serverError:null,loading:!0}),(0,y.webLogin)(e,a,t,function(){var e=n.props.location.query.h,a=n.props.location.query.d,t=n.props.location.query.id;if(t||e)return void(0,N.addUserToTeamFromInvite)(a,e,t,function(e){n.finishSignin(e)},function(){n.finishSignin()});n.finishSignin()},function(a){"api.user.login.not_verified.app_error"===a.id?_.browserHistory.push("/should_verify_email?&email="+encodeURIComponent(e)):"store.sql_user.get_for_login.app_error"===a.id||"ent.ldap.do_login.user_not_registered.app_error"===a.id?n.setState({showMfa:!1,loading:!1,serverError:w.default.createElement(v.FormattedMessage,{id:"login.userNotFound",defaultMessage:"We couldn't find an account matching your login credentials."})}):"api.user.check_user_password.invalid.app_error"===a.id||"ent.ldap.do_login.invalid_password.app_error"===a.id?n.setState({showMfa:!1,loading:!1,serverError:w.default.createElement(v.FormattedMessage,{id:"login.invalidPassword",defaultMessage:"Your password is incorrect."})}):n.setState({showMfa:!1,serverError:a.message,loading:!1})})}},{key:"finishSignin",value:function(e){var a=this.props.location.query;M.loadCurrentLocale(),a.redirect_to&&a.redirect_to.match(/^\/([^\/]|$)/)?_.browserHistory.push(a.redirect_to):e?_.browserHistory.push("/"+e.name):M.redirectUserToDefaultTeam()}},{key:"handleLoginIdChange",value:function(e){this.setState({loginId:e.target.value})}},{key:"handlePasswordChange",value:function(e){this.setState({password:e.target.value})}},{key:"createCustomLogin",value:function(){if("true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand){var a=e.window.mm_config.CustomBrandText||"";return w.default.createElement("div",null,w.default.createElement("img",{src:b.Client4.getBrandImageUrl(0)}),w.default.createElement("p",{dangerouslySetInnerHTML:{__html:D.formatText(a)}}))}return null}},{key:"createLoginPlaceholder",value:function(){var a=this.state.ldapEnabled,t=this.state.usernameSigninEnabled,n=this.state.emailSigninEnabled,l=[];return n&&l.push(A.localizeMessage("login.email","Email")),t&&l.push(A.localizeMessage("login.username","Username")),a&&(e.window.mm_config.LdapLoginFieldName?l.push(e.window.mm_config.LdapLoginFieldName):l.push(A.localizeMessage("login.ldapUsername","AD/LDAP Username"))),l.length>=2?l.slice(0,l.length-1).join(", ")+A.localizeMessage("login.placeholderOr"," or ")+l[l.length-1]:1===l.length?l[0]:""}},{key:"checkSignUpEnabled",value:function(){return"true"===e.window.mm_config.EnableSignUpWithEmail||"true"===e.window.mm_config.EnableSignUpWithGitLab||"true"===e.window.mm_config.EnableSignUpWithOffice365||"true"===e.window.mm_config.EnableSignUpWithGoogle||"true"===e.window.mm_config.EnableLdap||"true"===e.window.mm_config.EnableSaml}},{key:"createLoginOptions",value:function(){var a=this.props.location.query.extra,t="";a&&(a===U.default.SIGNIN_CHANGE?t=w.default.createElement("div",{className:"alert alert-success"},w.default.createElement("i",{className:"fa fa-check"}),w.default.createElement(v.FormattedMessage,{id:"login.changed",defaultMessage:" Sign-in method changed successfully"})):a===U.default.SIGNIN_VERIFIED?t=w.default.createElement("div",{className:"alert alert-success"},w.default.createElement("i",{className:"fa fa-check"}),w.default.createElement(v.FormattedMessage,{id:"login.verified",defaultMessage:" Email Verified"})):a===U.default.SESSION_EXPIRED?t=w.default.createElement("div",{className:"alert alert-warning"},w.default.createElement("i",{className:"fa fa-exclamation-triangle"}),w.default.createElement(v.FormattedMessage,{id:"login.session_expired",defaultMessage:" Your session has expired. Please login again."})):a===U.default.PASSWORD_CHANGE&&(t=w.default.createElement("div",{className:"alert alert-success"},w.default.createElement("i",{className:"fa fa-check"}),w.default.createElement(v.FormattedMessage,{id:"login.passwordChanged",defaultMessage:" Password updated successfully"}))));var n=[],l=this.state.ldapEnabled,s="true"===e.window.mm_config.EnableSignUpWithGitLab,i="true"===e.window.mm_config.EnableSignUpWithGoogle,r="true"===e.window.mm_config.EnableSignUpWithOffice365,o=this.state.samlEnabled,d=this.state.usernameSigninEnabled,u=this.state.emailSigninEnabled;if(u||d||l){var m="";this.state.serverError&&(m=" has-error");var c=w.default.createElement(v.FormattedMessage,{id:"login.signIn",defaultMessage:"Sign in"});this.state.loading&&(c=w.default.createElement("span",null,w.default.createElement("span",{className:"fa fa-refresh icon--rotate"}),w.default.createElement(v.FormattedMessage,{id:"login.signInLoading",defaultMessage:"Signing in..."}))),n.push(w.default.createElement("form",{key:"loginBoxes",onSubmit:this.preSubmit},w.default.createElement("div",{className:"signup__email-container"},w.default.createElement(R.default,{error:this.state.serverError,margin:!0}),w.default.createElement("div",{className:"form-group"+m},w.default.createElement("input",{id:"loginId",className:"form-control",ref:"loginId",name:"loginId",value:this.state.loginId,onChange:this.handleLoginIdChange,placeholder:this.createLoginPlaceholder(),spellCheck:"false",autoCapitalize:"off"})),w.default.createElement("div",{className:"form-group"+m},w.default.createElement("input",{id:"loginPassword",type:"password",className:"form-control",ref:"password",name:"password",value:this.state.password,onChange:this.handlePasswordChange,placeholder:A.localizeMessage("login.password","Password"),spellCheck:"false"})),w.default.createElement("div",{className:"form-group"},w.default.createElement("button",{id:"loginButton",type:"submit",className:"btn btn-primary"},c)))))}return"true"===e.window.mm_config.EnableOpenServer&&this.checkSignUpEnabled()&&n.push(w.default.createElement("div",{className:"form-group",key:"signup"},w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.noAccount",defaultMessage:"Don't have an account? "}),w.default.createElement(_.Link,{id:"signup",to:"/signup_user_complete"+this.props.location.search,className:"signup-team-login"},w.default.createElement(v.FormattedMessage,{id:"login.create",defaultMessage:"Create one now"}))))),(d||u)&&n.push(w.default.createElement("div",{key:"forgotPassword",className:"form-group"},w.default.createElement(_.Link,{to:"/reset_password"},w.default.createElement(v.FormattedMessage,{id:"login.forgot",defaultMessage:"I forgot my password"})))),(u||d||l)&&(s||i||o||r)&&(n.push(w.default.createElement("div",{key:"divider",className:"or__container"},w.default.createElement(v.FormattedMessage,{id:"login.or",defaultMessage:"or"}))),n.push(w.default.createElement("h5",{key:"oauthHeader"},w.default.createElement(v.FormattedMessage,{id:"login.signInWith",defaultMessage:"Sign in with:"})))),s&&n.push(w.default.createElement("a",{className:"btn btn-custom-login gitlab",key:"gitlab",href:b.Client4.getOAuthRoute()+"/gitlab/login"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon"}),w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.gitlab",defaultMessage:"GitLab"}))))),i&&n.push(w.default.createElement("a",{className:"btn btn-custom-login google",key:"google",href:b.Client4.getOAuthRoute()+"/google/login"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon"}),w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.google",defaultMessage:"Google Apps"}))))),r&&n.push(w.default.createElement("a",{className:"btn btn-custom-login office365",key:"office365",href:b.Client4.getOAuthRoute()+"/office365/login"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon"}),w.default.createElement("span",null,w.default.createElement(v.FormattedMessage,{id:"login.office365",defaultMessage:"Office 365"}))))),o&&n.push(w.default.createElement("a",{className:"btn btn-custom-login saml",key:"saml",href:"/login/sso/saml"+this.props.location.search},w.default.createElement("span",null,w.default.createElement("span",{className:"icon fa fa-lock fa--margin-top"}),w.default.createElement("span",null,e.window.mm_config.SamlLoginButtonText)))),0===n.length&&n.push(w.default.createElement(R.default,{error:w.default.createElement(v.FormattedMessage,{id:"login.noMethods",defaultMessage:"No sign-in methods are enabled. Please contact your System Administrator."}),margin:!0})),w.default.createElement("div",null,t,n)}},{key:"render",value:function(){var a=void 0,t=void 0,n=void 0;this.state.showMfa?a=w.default.createElement(z.default,{loginId:this.state.loginId,password:this.state.password,submit:this.submit}):(a=this.createLoginOptions(),(t=this.createCustomLogin())&&(n="branded"));var l=null;return l="true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.CustomBrand&&"true"===e.window.mm_config.EnableCustomBrand?e.window.mm_config.CustomDescriptionText:w.default.createElement(v.FormattedMessage,{id:"web.root.signup_info",defaultMessage:"All team communication in one place, searchable and accessible anywhere"}),w.default.createElement("div",null,w.default.createElement(W.default,null),w.default.createElement("div",{className:"col-sm-12"},w.default.createElement("div",{className:"signup-team__container "+n},w.default.createElement("div",{className:"signup__markdown"},t),w.default.createElement("img",{className:"signup-team-logo",src:G.default}),w.default.createElement("div",{className:"signup__content"},w.default.createElement("h1",null,e.window.mm_config.SiteName),w.default.createElement("h4",{className:"color--light"},l),a))))}}]),t}(w.default.Component);a.default=H}).call(a,t(22))}});
//# sourceMappingURL=39.97f8b0187c1e2c2fdb35.js.map