{"version":3,"sources":["webpack:///37.617a3e3aa5715ed1bde4.js","webpack:///./components/mfa/components/setup.jsx"],"names":["webpackJsonp","2119","module","exports","__webpack_require__","global","_interopRequireDefault","obj","__esModule","default","Object","defineProperty","value","_getPrototypeOf","_getPrototypeOf2","_classCallCheck2","_classCallCheck3","_createClass2","_createClass3","_possibleConstructorReturn2","_possibleConstructorReturn3","_inherits2","_inherits3","_react","_react2","_reactIntl","_es","_user_actions","_user_store","_user_store2","_utils","Utils","newObj","key","prototype","hasOwnProperty","call","Setup","_React$Component","props","this","_this","__proto__","submit","bind","state","secret","qrCode","_this2","user","getCurrentUser","mfa_active","browserHistory","push","generateMfaSecret","data","setState","qr_code","err","serverError","message","e","_this3","preventDefault","code","refs","replace","length","error","localizeMessage","activateMfa","id","formClass","errorContent","createElement","className","mfaRequired","window","mm_config","EnforceMultifactorAuthentication","FormattedHTMLMessage","defaultMessage","values","siteName","SiteName","onSubmit","style","maxHeight","src","FormattedMessage","ref","placeholder","autoFocus","type","Component","defaultProps","propTypes"],"mappings":"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","file":"37.617a3e3aa5715ed1bde4.js","sourcesContent":["webpackJsonp([37],{\n\n/***/ 2119:\n/***/ (function(module, exports, __webpack_require__) {\n\n\"use strict\";\n/* WEBPACK VAR INJECTION */(function(global) {\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\n\nvar _getPrototypeOf = __webpack_require__(6);\n\nvar _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);\n\nvar _classCallCheck2 = __webpack_require__(4);\n\nvar _classCallCheck3 = _interopRequireDefault(_classCallCheck2);\n\nvar _createClass2 = __webpack_require__(5);\n\nvar _createClass3 = _interopRequireDefault(_createClass2);\n\nvar _possibleConstructorReturn2 = __webpack_require__(7);\n\nvar _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);\n\nvar _inherits2 = __webpack_require__(8);\n\nvar _inherits3 = _interopRequireDefault(_inherits2);\n\nvar _react = __webpack_require__(1);\n\nvar _react2 = _interopRequireDefault(_react);\n\nvar _reactIntl = __webpack_require__(17);\n\nvar _es = __webpack_require__(44);\n\nvar _user_actions = __webpack_require__(69);\n\nvar _user_store = __webpack_require__(25);\n\nvar _user_store2 = _interopRequireDefault(_user_store);\n\nvar _utils = __webpack_require__(16);\n\nvar Utils = _interopRequireWildcard(_utils);\n\nfunction _interopRequireWildcard(obj) { if (obj && obj.__esModule) { return obj; } else { var newObj = {}; if (obj != null) { for (var key in obj) { if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key]; } } newObj.default = obj; return newObj; } }\n\nfunction _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }\n\n// Copyright (c) 2016-present Mattermost, Inc. All Rights Reserved.\n// See License.txt for license information.\n\nvar Setup = function (_React$Component) {\n    (0, _inherits3.default)(Setup, _React$Component);\n\n    function Setup(props) {\n        (0, _classCallCheck3.default)(this, Setup);\n\n        var _this = (0, _possibleConstructorReturn3.default)(this, (Setup.__proto__ || (0, _getPrototypeOf2.default)(Setup)).call(this, props));\n\n        _this.submit = _this.submit.bind(_this);\n\n        _this.state = { secret: '', qrCode: '' };\n        return _this;\n    }\n\n    (0, _createClass3.default)(Setup, [{\n        key: 'componentDidMount',\n        value: function componentDidMount() {\n            var _this2 = this;\n\n            var user = _user_store2.default.getCurrentUser();\n            if (!user || user.mfa_active) {\n                _es.browserHistory.push('/');\n                return;\n            }\n\n            (0, _user_actions.generateMfaSecret)(function (data) {\n                return _this2.setState({ secret: data.secret, qrCode: data.qr_code });\n            }, function (err) {\n                return _this2.setState({ serverError: err.message });\n            });\n        }\n    }, {\n        key: 'submit',\n        value: function submit(e) {\n            var _this3 = this;\n\n            e.preventDefault();\n            var code = this.refs.code.value.replace(/\\s/g, '');\n            if (!code || code.length === 0) {\n                this.setState({ error: Utils.localizeMessage('mfa.setup.codeError', 'Please enter the code from Google Authenticator.') });\n                return;\n            }\n\n            this.setState({ error: null });\n\n            (0, _user_actions.activateMfa)(code, function () {\n                _es.browserHistory.push('/mfa/confirm');\n            }, function (err) {\n                if (err.id === 'ent.mfa.activate.authenticate.app_error') {\n                    _this3.setState({ error: Utils.localizeMessage('mfa.setup.badCode', 'Invalid code. If this issue persists, contact your System Administrator.') });\n                    return;\n                }\n                _this3.setState({ error: err.message });\n            });\n        }\n    }, {\n        key: 'render',\n        value: function render() {\n            var formClass = 'form-group';\n            var errorContent = void 0;\n            if (this.state.error) {\n                errorContent = _react2.default.createElement(\n                    'div',\n                    { className: 'form-group has-error' },\n                    _react2.default.createElement(\n                        'label',\n                        { className: 'control-label' },\n                        this.state.error\n                    )\n                );\n                formClass += ' has-error';\n            }\n\n            var mfaRequired = void 0;\n            if (global.window.mm_config.EnforceMultifactorAuthentication === 'true') {\n                mfaRequired = _react2.default.createElement(\n                    'p',\n                    null,\n                    _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                        id: 'mfa.setup.required',\n                        defaultMessage: '<strong>Multi-factor authentication is required on {siteName}.</strong>',\n                        values: {\n                            siteName: global.window.mm_config.SiteName\n                        }\n                    })\n                );\n            }\n\n            return _react2.default.createElement(\n                'div',\n                null,\n                _react2.default.createElement(\n                    'form',\n                    {\n                        onSubmit: this.submit,\n                        className: formClass\n                    },\n                    mfaRequired,\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                            id: 'mfa.setup.step1',\n                            defaultMessage: '<strong>Step 1: </strong>On your phone, download Google Authenticator from <a target=\\'_blank\\' href=\\'https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8\\'>iTunes</a> or <a target=\\'_blank\\' href=\\'https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en\\'>Google Play</a>'\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                            id: 'mfa.setup.step2',\n                            defaultMessage: '<strong>Step 2: </strong>Use Google Authenticator to scan this QR code, or manually type in the secret key'\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'form-group' },\n                        _react2.default.createElement(\n                            'div',\n                            { className: 'col-sm-12' },\n                            _react2.default.createElement('img', {\n                                style: { maxHeight: 170 },\n                                src: 'data:image/png;base64,' + this.state.qrCode\n                            })\n                        )\n                    ),\n                    _react2.default.createElement('br', null),\n                    _react2.default.createElement(\n                        'div',\n                        { className: 'form-group' },\n                        _react2.default.createElement(\n                            'p',\n                            { className: 'col-sm-12' },\n                            _react2.default.createElement(_reactIntl.FormattedMessage, {\n                                id: 'mfa.setup.secret',\n                                defaultMessage: 'Secret: {secret}',\n                                values: {\n                                    secret: this.state.secret\n                                }\n                            })\n                        )\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement(_reactIntl.FormattedHTMLMessage, {\n                            id: 'mfa.setup.step3',\n                            defaultMessage: '<strong>Step 3: </strong>Enter the code generated by Google Authenticator'\n                        })\n                    ),\n                    _react2.default.createElement(\n                        'p',\n                        null,\n                        _react2.default.createElement('input', {\n                            ref: 'code',\n                            className: 'form-control',\n                            placeholder: Utils.localizeMessage('mfa.setup.code', 'MFA Code'),\n                            autoFocus: true\n                        })\n                    ),\n                    errorContent,\n                    _react2.default.createElement(\n                        'button',\n                        {\n                            type: 'submit',\n                            className: 'btn btn-primary'\n                        },\n                        _react2.default.createElement(_reactIntl.FormattedMessage, {\n                            id: 'mfa.setup.save',\n                            defaultMessage: 'Save'\n                        })\n                    )\n                )\n            );\n        }\n    }]);\n    return Setup;\n}(_react2.default.Component);\n\nexports.default = Setup;\n\n\nSetup.defaultProps = {};\nSetup.propTypes = {};\n/* WEBPACK VAR INJECTION */}.call(exports, __webpack_require__(22)))\n\n/***/ })\n\n});\n\n\n// WEBPACK FOOTER //\n// 37.617a3e3aa5715ed1bde4.js","// Copyright (c) 2016-present Mattermost, Inc. All Rights Reserved.\n// See License.txt for license information.\n\nimport React from 'react';\nimport {FormattedHTMLMessage, FormattedMessage} from 'react-intl';\nimport {browserHistory} from 'react-router/es6';\n\nimport {activateMfa, generateMfaSecret} from 'actions/user_actions.jsx';\nimport UserStore from 'stores/user_store.jsx';\n\nimport * as Utils from 'utils/utils.jsx';\n\nexport default class Setup extends React.Component {\n    constructor(props) {\n        super(props);\n\n        this.submit = this.submit.bind(this);\n\n        this.state = {secret: '', qrCode: ''};\n    }\n\n    componentDidMount() {\n        const user = UserStore.getCurrentUser();\n        if (!user || user.mfa_active) {\n            browserHistory.push('/');\n            return;\n        }\n\n        generateMfaSecret(\n            (data) => this.setState({secret: data.secret, qrCode: data.qr_code}),\n            (err) => this.setState({serverError: err.message})\n        );\n    }\n\n    submit(e) {\n        e.preventDefault();\n        const code = this.refs.code.value.replace(/\\s/g, '');\n        if (!code || code.length === 0) {\n            this.setState({error: Utils.localizeMessage('mfa.setup.codeError', 'Please enter the code from Google Authenticator.')});\n            return;\n        }\n\n        this.setState({error: null});\n\n        activateMfa(\n            code,\n            () => {\n                browserHistory.push('/mfa/confirm');\n            },\n            (err) => {\n                if (err.id === 'ent.mfa.activate.authenticate.app_error') {\n                    this.setState({error: Utils.localizeMessage('mfa.setup.badCode', 'Invalid code. If this issue persists, contact your System Administrator.')});\n                    return;\n                }\n                this.setState({error: err.message});\n            }\n        );\n    }\n\n    render() {\n        let formClass = 'form-group';\n        let errorContent;\n        if (this.state.error) {\n            errorContent = <div className='form-group has-error'><label className='control-label'>{this.state.error}</label></div>;\n            formClass += ' has-error';\n        }\n\n        let mfaRequired;\n        if (global.window.mm_config.EnforceMultifactorAuthentication === 'true') {\n            mfaRequired = (\n                <p>\n                    <FormattedHTMLMessage\n                        id='mfa.setup.required'\n                        defaultMessage='<strong>Multi-factor authentication is required on {siteName}.</strong>'\n                        values={{\n                            siteName: global.window.mm_config.SiteName\n                        }}\n                    />\n                </p>\n            );\n        }\n\n        return (\n            <div>\n                <form\n                    onSubmit={this.submit}\n                    className={formClass}\n                >\n                    {mfaRequired}\n                    <p>\n                        <FormattedHTMLMessage\n                            id='mfa.setup.step1'\n                            defaultMessage=\"<strong>Step 1: </strong>On your phone, download Google Authenticator from <a target='_blank' href='https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8'>iTunes</a> or <a target='_blank' href='https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2&hl=en'>Google Play</a>\"\n                        />\n                    </p>\n                    <p>\n                        <FormattedHTMLMessage\n                            id='mfa.setup.step2'\n                            defaultMessage='<strong>Step 2: </strong>Use Google Authenticator to scan this QR code, or manually type in the secret key'\n                        />\n                    </p>\n                    <div className='form-group'>\n                        <div className='col-sm-12'>\n                            <img\n                                style={{maxHeight: 170}}\n                                src={'data:image/png;base64,' + this.state.qrCode}\n                            />\n                        </div>\n                    </div>\n                    <br/>\n                    <div className='form-group'>\n                        <p className='col-sm-12'>\n                            <FormattedMessage\n                                id='mfa.setup.secret'\n                                defaultMessage='Secret: {secret}'\n                                values={{\n                                    secret: this.state.secret\n                                }}\n                            />\n                        </p>\n                    </div>\n                    <p>\n                        <FormattedHTMLMessage\n                            id='mfa.setup.step3'\n                            defaultMessage='<strong>Step 3: </strong>Enter the code generated by Google Authenticator'\n                        />\n                    </p>\n                    <p>\n                        <input\n                            ref='code'\n                            className='form-control'\n                            placeholder={Utils.localizeMessage('mfa.setup.code', 'MFA Code')}\n                            autoFocus={true}\n                        />\n                    </p>\n                    {errorContent}\n                    <button\n                        type='submit'\n                        className='btn btn-primary'\n                    >\n                        <FormattedMessage\n                            id='mfa.setup.save'\n                            defaultMessage='Save'\n                        />\n                    </button>\n                </form>\n            </div>\n        );\n    }\n}\n\nSetup.defaultProps = {\n};\nSetup.propTypes = {\n};\n\n\n\n// WEBPACK FOOTER //\n// ./components/mfa/components/setup.jsx"],"sourceRoot":""}