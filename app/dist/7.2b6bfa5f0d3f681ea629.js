webpackJsonp([7],{2137:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function i(e){return{actions:(0,d.bindActionCreators)({viewChannel:u.viewChannel,getMyChannelMembers:u.getMyChannelMembers},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(65),c=a(2384),f=n(c);t.default=(0,l.connect)(s,i)(f.default)},2167:function(e,t,a){var n=(a(0),a(0),!0),s=!0,i={disableLog:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(n=e,e?"adapter.js logging disabled":"adapter.js logging enabled")},disableWarnings:function(e){return"boolean"!=typeof e?new Error("Argument type: "+typeof e+". Please use a boolean."):(s=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))},log:function(){if("object"==typeof window){if(n)return;"undefined"!=typeof console&&"function"==typeof console.log&&console.log.apply(console,arguments)}},deprecated:function(e,t){s&&console.warn(e+" is deprecated, please use "+t+" instead.")},extractVersion:function(e,t,a){var n=e.match(t);return n&&n.length>=a&&parseInt(n[a],10)},detectBrowser:function(e){var t=e&&e.navigator,a={};if(a.browser=null,a.version=null,void 0===e||!e.navigator)return a.browser="Not a browser.",a;if(t.mozGetUserMedia)a.browser="firefox",a.version=this.extractVersion(t.userAgent,/Firefox\/(\d+)\./,1);else if(t.webkitGetUserMedia)if(e.webkitRTCPeerConnection)a.browser="chrome",a.version=this.extractVersion(t.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!t.userAgent.match(/Version\/(\d+).(\d+)/))return a.browser="Unsupported webkit-based browser with GUM support but no WebRTC support.",a;a.browser="safari",a.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}else if(t.mediaDevices&&t.userAgent.match(/Edge\/(\d+).(\d+)$/))a.browser="edge",a.version=this.extractVersion(t.userAgent,/Edge\/(\d+).(\d+)$/,2);else{if(!t.mediaDevices||!t.userAgent.match(/AppleWebKit\/(\d+)\./))return a.browser="Not a supported browser.",a;a.browser="safari",a.version=this.extractVersion(t.userAgent,/AppleWebKit\/(\d+)\./,1)}return a}};e.exports={log:i.log,deprecated:i.deprecated,disableLog:i.disableLog,disableWarnings:i.disableWarnings,extractVersion:i.extractVersion,shimCreateObjectURL:i.shimCreateObjectURL,detectBrowser:i.detectBrowser.bind(i)}},2188:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(40),b=a(17),y=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.onHide=a.onHide.bind(a),a.copyLink=a.copyLink.bind(a),a.state={copiedLink:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"onHide",value:function(){this.setState({copiedLink:!1}),this.props.onHide()}},{key:"copyLink",value:function(){var e=this.refs.textarea;e.focus(),e.setSelectionRange(0,this.props.link.length);try{document.execCommand("copy")?this.setState({copiedLink:!0}):this.setState({copiedLink:!1})}catch(e){this.setState({copiedLink:!1})}}},{key:"render",value:function(){var e=null;this.props.helpText&&(e=v.default.createElement("p",null,this.props.helpText,v.default.createElement("br",null),v.default.createElement("br",null)));var t=null;document.queryCommandSupported("copy")&&(t=v.default.createElement("button",{"data-copy-btn":"true",type:"button",className:"btn btn-primary pull-left",onClick:this.copyLink},v.default.createElement(b.FormattedMessage,{id:"get_link.copy",defaultMessage:"Copy Link"})));var a=v.default.createElement("textarea",{className:"form-control no-resize min-height",ref:"textarea",value:this.props.link,onClick:this.copyLink,readOnly:!0}),n=null;return this.state.copiedLink&&(n=v.default.createElement("p",{className:"alert alert-success alert--confirm"},v.default.createElement("i",{className:"fa fa-check"}),v.default.createElement(b.FormattedMessage,{id:"get_link.clipboard",defaultMessage:" Link copied"}))),v.default.createElement(E.Modal,{show:this.props.show,onHide:this.onHide},v.default.createElement(E.Modal.Header,{closeButton:!0},v.default.createElement("h4",{className:"modal-title"},this.props.title)),v.default.createElement(E.Modal.Body,null,e,a),v.default.createElement(E.Modal.Footer,null,v.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.onHide},v.default.createElement(b.FormattedMessage,{id:"get_link.close",defaultMessage:"Close"})),t,n))}}]),t}(v.default.Component);t.default=y,y.propTypes={show:p.default.bool.isRequired,onHide:p.default.func.isRequired,title:p.default.string.isRequired,helpText:p.default.string,link:p.default.string.isRequired},y.defaultProps={helpText:null}},2196:function(e,t,a){function n(e,t,a){var n=d[t];if(void 0===n&&(n=i(t)),n){if(void 0===a)return e.style[n];e.style[n]=u(n,a)}}function s(e,t){for(var a in t)t.hasOwnProperty(a)&&n(e,a,t[a])}function i(e){var t=l(e),a=o(t);return d[t]=d[e]=d[a]=a,a}function r(){2===arguments.length?"string"==typeof arguments[1]?arguments[0].style.cssText=arguments[1]:s(arguments[0],arguments[1]):n(arguments[0],arguments[1],arguments[2])}var o=(a(0),a(0),a(2414)),l=a(2415),d={float:"cssFloat"},u=a(2418);e.exports=r,e.exports.set=r,e.exports.get=function(e,t){return Array.isArray(t)?t.reduce(function(t,a){return t[a]=n(e,a||""),t},{}):n(e,t||"")}},2197:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(87),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleClick=a.handleClick.bind(a),a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleClick",value:function(e,t){t.preventDefault(),this.props.updateTab(e.name),(0,p.default)(t.target).closest(".settings-modal").addClass("display--content")}},{key:"componentDidMount",value:function(){S.isFirefox()&&(0,p.default)(".settings-modal .settings-table .nav").addClass("position--top")}},{key:"render",value:function(){var e=this,t=this.props.tabs.map(function(t){var a=t.name+"_li",n="";return e.props.activeTab===t.name&&(n="active"),b.default.createElement("li",{id:t.name+"Li",key:a,className:n},b.default.createElement("button",{id:t.name+"Button",className:"cursor--pointer style--none",onClick:e.handleClick.bind(null,t)},b.default.createElement("i",{className:t.icon}),t.uiName))});return b.default.createElement("div",null,b.default.createElement("ul",{id:"tabList",className:"nav nav-pills nav-stacked"},t))}}]),t}(b.default.Component);t.default=_,_.propTypes={tabs:v.default.arrayOf(v.default.shape({name:v.default.string.isRequired,uiName:v.default.string.isRequired,icon:v.default.string.isRequired})).isRequired,activeTab:v.default.string,updateTab:v.default.func.isRequired}},2198:function(e,t,a){e.exports=a.p+"files/a4a8b617d1f6c75ad4bf17bafc2aec6a.mp3"},2199:function(e,t,a){var n=(a(0),a(0),{});n.generateIdentifier=function(){return Math.random().toString(36).substr(2,10)},n.localCName=n.generateIdentifier(),n.splitLines=function(e){return e.trim().split("\n").map(function(e){return e.trim()})},n.splitSections=function(e){return e.split("\nm=").map(function(e,t){return(t>0?"m="+e:e).trim()+"\r\n"})},n.matchPrefix=function(e,t){return n.splitLines(e).filter(function(e){return 0===e.indexOf(t)})},n.parseCandidate=function(e){var t;t=0===e.indexOf("a=candidate:")?e.substring(12).split(" "):e.substring(10).split(" ");for(var a={foundation:t[0],component:parseInt(t[1],10),protocol:t[2].toLowerCase(),priority:parseInt(t[3],10),ip:t[4],port:parseInt(t[5],10),type:t[7]},n=8;n<t.length;n+=2)switch(t[n]){case"raddr":a.relatedAddress=t[n+1];break;case"rport":a.relatedPort=parseInt(t[n+1],10);break;case"tcptype":a.tcpType=t[n+1];break;case"ufrag":a.ufrag=t[n+1],a.usernameFragment=t[n+1];break;default:a[t[n]]=t[n+1]}return a},n.writeCandidate=function(e){var t=[];t.push(e.foundation),t.push(e.component),t.push(e.protocol.toUpperCase()),t.push(e.priority),t.push(e.ip),t.push(e.port);var a=e.type;return t.push("typ"),t.push(a),"host"!==a&&e.relatedAddress&&e.relatedPort&&(t.push("raddr"),t.push(e.relatedAddress),t.push("rport"),t.push(e.relatedPort)),e.tcpType&&"tcp"===e.protocol.toLowerCase()&&(t.push("tcptype"),t.push(e.tcpType)),e.ufrag&&(t.push("ufrag"),t.push(e.ufrag)),"candidate:"+t.join(" ")},n.parseIceOptions=function(e){return e.substr(14).split(" ")},n.parseRtpMap=function(e){var t=e.substr(9).split(" "),a={payloadType:parseInt(t.shift(),10)};return t=t[0].split("/"),a.name=t[0],a.clockRate=parseInt(t[1],10),a.numChannels=3===t.length?parseInt(t[2],10):1,a},n.writeRtpMap=function(e){var t=e.payloadType;return void 0!==e.preferredPayloadType&&(t=e.preferredPayloadType),"a=rtpmap:"+t+" "+e.name+"/"+e.clockRate+(1!==e.numChannels?"/"+e.numChannels:"")+"\r\n"},n.parseExtmap=function(e){var t=e.substr(9).split(" ");return{id:parseInt(t[0],10),direction:t[0].indexOf("/")>0?t[0].split("/")[1]:"sendrecv",uri:t[1]}},n.writeExtmap=function(e){return"a=extmap:"+(e.id||e.preferredId)+(e.direction&&"sendrecv"!==e.direction?"/"+e.direction:"")+" "+e.uri+"\r\n"},n.parseFmtp=function(e){for(var t,a={},n=e.substr(e.indexOf(" ")+1).split(";"),s=0;s<n.length;s++)t=n[s].trim().split("="),a[t[0].trim()]=t[1];return a},n.writeFmtp=function(e){var t="",a=e.payloadType;if(void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.parameters&&Object.keys(e.parameters).length){var n=[];Object.keys(e.parameters).forEach(function(t){n.push(t+"="+e.parameters[t])}),t+="a=fmtp:"+a+" "+n.join(";")+"\r\n"}return t},n.parseRtcpFb=function(e){var t=e.substr(e.indexOf(" ")+1).split(" ");return{type:t.shift(),parameter:t.join(" ")}},n.writeRtcpFb=function(e){var t="",a=e.payloadType;return void 0!==e.preferredPayloadType&&(a=e.preferredPayloadType),e.rtcpFeedback&&e.rtcpFeedback.length&&e.rtcpFeedback.forEach(function(e){t+="a=rtcp-fb:"+a+" "+e.type+(e.parameter&&e.parameter.length?" "+e.parameter:"")+"\r\n"}),t},n.parseSsrcMedia=function(e){var t=e.indexOf(" "),a={ssrc:parseInt(e.substr(7,t-7),10)},n=e.indexOf(":",t);return n>-1?(a.attribute=e.substr(t+1,n-t-1),a.value=e.substr(n+1)):a.attribute=e.substr(t+1),a},n.getMid=function(e){var t=n.matchPrefix(e,"a=mid:")[0];if(t)return t.substr(6)},n.parseFingerprint=function(e){var t=e.substr(14).split(" ");return{algorithm:t[0].toLowerCase(),value:t[1]}},n.getDtlsParameters=function(e,t){return{role:"auto",fingerprints:n.matchPrefix(e+t,"a=fingerprint:").map(n.parseFingerprint)}},n.writeDtlsParameters=function(e,t){var a="a=setup:"+t+"\r\n";return e.fingerprints.forEach(function(e){a+="a=fingerprint:"+e.algorithm+" "+e.value+"\r\n"}),a},n.getIceParameters=function(e,t){var a=n.splitLines(e);return a=a.concat(n.splitLines(t)),{usernameFragment:a.filter(function(e){return 0===e.indexOf("a=ice-ufrag:")})[0].substr(12),password:a.filter(function(e){return 0===e.indexOf("a=ice-pwd:")})[0].substr(10)}},n.writeIceParameters=function(e){return"a=ice-ufrag:"+e.usernameFragment+"\r\na=ice-pwd:"+e.password+"\r\n"},n.parseRtpParameters=function(e){for(var t={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},a=n.splitLines(e),s=a[0].split(" "),i=3;i<s.length;i++){var r=s[i],o=n.matchPrefix(e,"a=rtpmap:"+r+" ")[0];if(o){var l=n.parseRtpMap(o),d=n.matchPrefix(e,"a=fmtp:"+r+" ");switch(l.parameters=d.length?n.parseFmtp(d[0]):{},l.rtcpFeedback=n.matchPrefix(e,"a=rtcp-fb:"+r+" ").map(n.parseRtcpFb),t.codecs.push(l),l.name.toUpperCase()){case"RED":case"ULPFEC":t.fecMechanisms.push(l.name.toUpperCase())}}}return n.matchPrefix(e,"a=extmap:").forEach(function(e){t.headerExtensions.push(n.parseExtmap(e))}),t},n.writeRtpDescription=function(e,t){var a="";a+="m="+e+" ",a+=t.codecs.length>0?"9":"0",a+=" UDP/TLS/RTP/SAVPF ",a+=t.codecs.map(function(e){return void 0!==e.preferredPayloadType?e.preferredPayloadType:e.payloadType}).join(" ")+"\r\n",a+="c=IN IP4 0.0.0.0\r\n",a+="a=rtcp:9 IN IP4 0.0.0.0\r\n",t.codecs.forEach(function(e){a+=n.writeRtpMap(e),a+=n.writeFmtp(e),a+=n.writeRtcpFb(e)});var s=0;return t.codecs.forEach(function(e){e.maxptime>s&&(s=e.maxptime)}),s>0&&(a+="a=maxptime:"+s+"\r\n"),a+="a=rtcp-mux\r\n",t.headerExtensions.forEach(function(e){a+=n.writeExtmap(e)}),a},n.parseRtpEncodingParameters=function(e){var t,a=[],s=n.parseRtpParameters(e),i=-1!==s.fecMechanisms.indexOf("RED"),r=-1!==s.fecMechanisms.indexOf("ULPFEC"),o=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute}),l=o.length>0&&o[0].ssrc,d=n.matchPrefix(e,"a=ssrc-group:FID").map(function(e){var t=e.split(" ");return t.shift(),t.map(function(e){return parseInt(e,10)})});d.length>0&&d[0].length>1&&d[0][0]===l&&(t=d[0][1]),s.codecs.forEach(function(e){if("RTX"===e.name.toUpperCase()&&e.parameters.apt){var n={ssrc:l,codecPayloadType:parseInt(e.parameters.apt,10),rtx:{ssrc:t}};a.push(n),i&&(n=JSON.parse(JSON.stringify(n)),n.fec={ssrc:t,mechanism:r?"red+ulpfec":"red"},a.push(n))}}),0===a.length&&l&&a.push({ssrc:l});var u=n.matchPrefix(e,"b=");return u.length&&(u=0===u[0].indexOf("b=TIAS:")?parseInt(u[0].substr(7),10):0===u[0].indexOf("b=AS:")?1e3*parseInt(u[0].substr(5),10)*.95-16e3:void 0,a.forEach(function(e){e.maxBitrate=u})),a},n.parseRtcpParameters=function(e){var t={},a=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"cname"===e.attribute})[0];a&&(t.cname=a.value,t.ssrc=a.ssrc);var s=n.matchPrefix(e,"a=rtcp-rsize");t.reducedSize=s.length>0,t.compound=0===s.length;var i=n.matchPrefix(e,"a=rtcp-mux");return t.mux=i.length>0,t},n.parseMsid=function(e){var t,a=n.matchPrefix(e,"a=msid:");if(1===a.length)return t=a[0].substr(7).split(" "),{stream:t[0],track:t[1]};var s=n.matchPrefix(e,"a=ssrc:").map(function(e){return n.parseSsrcMedia(e)}).filter(function(e){return"msid"===e.attribute});return s.length>0?(t=s[0].value.split(" "),{stream:t[0],track:t[1]}):void 0},n.generateSessionId=function(){return Math.random().toString().substr(2,21)},n.writeSessionBoilerplate=function(e,t){var a=void 0!==t?t:2;return"v=0\r\no=thisisadapterortc "+(e||n.generateSessionId())+" "+a+" IN IP4 127.0.0.1\r\ns=-\r\nt=0 0\r\n"},n.writeMediaSection=function(e,t,a,s){var i=n.writeRtpDescription(e.kind,t);if(i+=n.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=n.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var r="msid:"+s.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+r,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+n.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+n.localCName+"\r\n"),i},n.getDirection=function(e,t){for(var a=n.splitLines(e),s=0;s<a.length;s++)switch(a[s]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return a[s].substr(2)}return t?n.getDirection(t):"sendrecv"},n.getKind=function(e){return n.splitLines(e)[0].split(" ")[0].substr(2)},n.isRejected=function(e){return"0"===e.split(" ",2)[1]},n.parseMLine=function(e){var t=n.splitLines(e),a=t[0].split(" ");return{kind:a[0].substr(2),port:parseInt(a[1],10),protocol:a[2],fmt:a.slice(3).join(" ")}},e.exports=n},2384:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(76),r=s(i),o=a(77),l=s(o),d=a(6),u=s(d),c=a(4),f=s(c),m=a(5),h=s(m),p=a(7),g=s(p),v=a(8),E=s(v),b=a(0),y=s(b),S=a(2),_=s(S),M=a(1),C=s(M),w=a(44),k=a(2385),T=s(k),N=a(138),P=a(241),I=a(69),L=a(314),D=a(32),R=s(D),A=a(312),O=s(A),F=a(119),x=s(F),U=a(38),H=s(U),j=a(35),G=s(j),B=a(25),V=s(B),z=a(316),q=s(z),W=a(9),Y=s(W),K=a(87),J=n(K),X=a(16),Q=n(X),Z=a(2083),$=s(Z),ee=a(2386),te=s(ee),ae=a(2387),ne=s(ae),se=a(2388),ie=s(se),re=a(2389),oe=s(re),le=a(2390),de=s(le),ue=a(2391),ce=s(ue),fe=a(2392),me=s(fe),he=a(2393),pe=s(he),ge=a(2394),ve=s(ge),Ee=a(2401),be=s(Ee),ye=a(2402),Se=s(ye),_e=a(2404),Me=s(_e),Ce=a(2405),we=s(Ce),ke=a(2435),Te=s(ke),Ne=a(2436),Pe=s(Ne),Ie=a(2441),Le=s(Ie),De=a(2442),Re=s(De),Ae=a(2466),Oe=s(Ae),Fe=a(2467),xe=s(Fe),Ue=Y.default.TutorialSteps,He=Y.default.Preferences,je=function(e){function t(e){(0,f.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));a.onTeamChanged=a.onTeamChanged.bind(a),a.onPreferencesChanged=a.onPreferencesChanged.bind(a),a.blurTime=(new Date).getTime();var n=G.default.getCurrent();return a.state={team:n,theme:x.default.getTheme(n.id)},a}return(0,E.default)(t,e),(0,h.default)(t,[{key:"onTeamChanged",value:function(){var e=G.default.getCurrent();this.setState({team:e,theme:x.default.getTheme(e.id)})}},{key:"onPreferencesChanged",value:function(e){e&&e!==He.CATEGORY_THEME||this.setState({theme:x.default.getTheme(this.state.team.id)})}},{key:"componentWillMount",value:function(){x.default.getInt(He.TUTORIAL_STEP,V.default.getCurrentId(),999)<=Ue.INTRO_SCREENS&&w.browserHistory.push(G.default.getCurrentTeamRelativeUrl()+"/tutorial")}},{key:"componentDidMount",value:function(){var e=this;G.default.addChangeListener(this.onTeamChanged),x.default.addChangeListener(this.onPreferencesChanged),(0,P.startPeriodicStatusUpdates)(),(0,L.startPeriodicSync)(),window.isActive=!0,(0,y.default)(window).on("focus",(0,l.default)(r.default.mark(function t(){return r.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return R.default.resetCounts([R.default.getCurrentId()]),R.default.emitChange(),window.isActive=!0,t.next=5,e.props.actions.viewChannel(R.default.getCurrentId());case 5:(new Date).getTime()-e.blurTime>1e4&&e.props.actions.getMyChannelMembers(G.default.getCurrentId()).then(I.loadProfilesForSidebar);case 6:case"end":return t.stop()}},t,e)}))),(0,y.default)(window).on("blur",function(){window.isActive=!1,e.blurTime=(new Date).getTime(),V.default.getCurrentUser()&&e.props.actions.viewChannel("")}),Q.applyTheme(this.state.theme),J.isIosSafari()&&T.default.enable()}},{key:"componentDidUpdate",value:function(e,t){Q.areObjectsEqual(t.theme,this.state.theme)||Q.applyTheme(this.state.theme)}},{key:"componentWillUnmount",value:function(){G.default.removeChangeListener(this.onTeamChanged),x.default.removeChangeListener(this.onPreferencesChanged),(0,y.default)(window).off("focus"),(0,y.default)(window).off("blur"),J.isIosSafari()&&T.default.disable(),(0,P.stopPeriodicStatusUpdates)(),(0,L.stopPeriodicSync)()}},{key:"render",value:function(){var e=[];this.props.children?e=this.props.children:(e.push(this.props.navbar),e.push(this.props.team_sidebar),e.push(this.props.sidebar),e.push(C.default.createElement("div",{key:"inner-wrap",className:"inner-wrap channel__wrap"},C.default.createElement("div",{className:"row header"},C.default.createElement("div",{id:"navbar"},C.default.createElement(ve.default,null))),C.default.createElement("div",{className:"row main"},C.default.cloneElement(this.props.center,{user:this.props.user,team:this.state.team})))));var t=R.default.getByName(this.props.params.channel);if(null==t){var a=O.default.getFocusedPostId(),n=(0,N.getPost)(H.default.getState(),a);null!=n&&(t=R.default.get(n.channel_id))}return C.default.createElement("div",{className:"channel-view"},C.default.createElement($.default,null),C.default.createElement(Oe.default,null),C.default.createElement("div",{className:"container-fluid"},C.default.createElement(we.default,{channel:t}),C.default.createElement(Te.default,{teamType:this.state.team.type}),C.default.createElement(xe.default,null),e,C.default.createElement(q.default,{pluggableName:"Root"}),C.default.createElement(Re.default,null),C.default.createElement(ie.default,null),C.default.createElement(oe.default,null),C.default.createElement(de.default,null),C.default.createElement(ce.default,null),C.default.createElement(me.default,null),C.default.createElement(Le.default,null),C.default.createElement(Pe.default,null),C.default.createElement(ne.default,null),C.default.createElement(te.default,null),C.default.createElement(be.default,null),C.default.createElement(Se.default,null),C.default.createElement(pe.default,null),C.default.createElement(Me.default,{isMac:Q.isMac()})))}}]),t}(C.default.Component);je.propTypes={children:_.default.oneOfType([_.default.arrayOf(_.default.element),_.default.element]),navbar:_.default.element,sidebar:_.default.element,team_sidebar:_.default.element,center:_.default.element,params:_.default.object,user:_.default.object,actions:_.default.shape({viewChannel:_.default.func.isRequired,getMyChannelMembers:_.default.func.isRequired}).isRequired},t.default=je},2385:function(e,t,a){a(0),a(0);!function(t){var a=0,n=!1,s=function(e){for(var t=e.target;t!==document.body&&t!==document;){var n=window.getComputedStyle(t);if(!n)break;if("INPUT"===t.nodeName&&"range"===t.getAttribute("type"))return;var s=n.getPropertyValue("-webkit-overflow-scrolling"),i=n.getPropertyValue("overflow-y"),r=parseInt(n.getPropertyValue("height"),10),o="touch"===s&&("auto"===i||"scroll"===i),l=t.scrollHeight>t.offsetHeight;if(o&&l){var d=e.touches?e.touches[0].screenY:e.screenY,u=a<=d&&0===t.scrollTop,c=a>=d&&t.scrollHeight-t.scrollTop===r;return void((u||c)&&e.preventDefault())}t=t.parentNode}e.preventDefault()},i=function(e){a=e.touches?e.touches[0].screenY:e.screenY},r=function(){window.addEventListener("touchstart",i,!1),window.addEventListener("touchmove",s,!1),n=!0},o=function(){window.removeEventListener("touchstart",i,!1),window.removeEventListener("touchmove",s,!1),n=!1},l=function(){return n},d=document.createElement("div");document.documentElement.appendChild(d),d.style.WebkitOverflowScrolling="touch";var u="getComputedStyle"in window&&"touch"===window.getComputedStyle(d)["-webkit-overflow-scrolling"];document.documentElement.removeChild(d),u&&r();var c={enable:r,disable:o,isEnabled:l};void 0!==e&&e.exports&&(e.exports=c),"function"==typeof t.define?function(e){e("iNoBounce",[],function(){return c})}(t.define):t.iNoBounce=c}(this)},2386:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(1),v=n(g),E=a(40),b=a(47),y=n(b),S=a(17),_=a(73),M=a(2080),C=n(M),w=a(9),k=n(w),T=k.default.ActionTypes,N=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleDelete=a.handleDelete.bind(a),a.handleToggle=a.handleToggle.bind(a),a.handleHide=a.handleHide.bind(a),a.state={show:!1,post:null,commentCount:0,error:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){C.default.addModalListener(T.TOGGLE_DELETE_POST_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){C.default.removeModalListener(T.TOGGLE_DELETE_POST_MODAL,this.handleToggle)}},{key:"componentDidUpdate",value:function(e,t){var a=this;this.state.show&&!t.show&&setTimeout(function(){(0,p.default)(y.default.findDOMNode(a.refs.deletePostBtn)).focus()},0)}},{key:"handleDelete",value:function(){var e=this;(0,_.deletePost)(this.state.post.channel_id,this.state.post,function(){e.handleHide()},function(t){e.setState({error:t.message})})}},{key:"handleToggle",value:function(e,t){this.setState({show:e,post:t.post,commentCount:t.commentCount,error:""})}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){if(!this.state.post)return null;var e=null;this.state.error&&(e=v.default.createElement("div",{className:"form-group has-error"},v.default.createElement("label",{className:"control-label"},this.state.error)));var t="";this.state.commentCount>0&&(t=v.default.createElement(S.FormattedMessage,{id:"delete_post.warning",defaultMessage:"This post has {count, number} {count, plural, one {comment} other {comments}} on it.",values:{count:this.state.commentCount}}));var a=this.state.post.root_id?v.default.createElement(S.FormattedMessage,{id:"delete_post.comment",defaultMessage:"Comment"}):v.default.createElement(S.FormattedMessage,{id:"delete_post.post",defaultMessage:"Post"});return v.default.createElement(E.Modal,{show:this.state.show,onHide:this.handleHide},v.default.createElement(E.Modal.Header,{closeButton:!0},v.default.createElement(E.Modal.Title,null,v.default.createElement(S.FormattedMessage,{id:"delete_post.confirm",defaultMessage:"Confirm {term} Delete",values:{term:a}}))),v.default.createElement(E.Modal.Body,null,v.default.createElement(S.FormattedMessage,{id:"delete_post.question",defaultMessage:"Are you sure you want to delete this {term}?",values:{term:a}}),v.default.createElement("br",null),v.default.createElement("br",null),t,e),v.default.createElement(E.Modal.Footer,null,v.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},v.default.createElement(S.FormattedMessage,{id:"delete_post.cancel",defaultMessage:"Cancel"})),v.default.createElement("button",{ref:"deletePostBtn",type:"button",className:"btn btn-danger",onClick:this.handleDelete},v.default.createElement(S.FormattedMessage,{id:"delete_post.del",defaultMessage:"Delete"}))))}}]),t}(v.default.Component);t.default=N},2387:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(139),r=s(i),o=a(6),l=s(o),d=a(4),u=s(d),c=a(5),f=s(c),m=a(7),h=s(m),p=a(8),g=s(p),v=a(0),E=s(v),b=a(1),y=s(b),S=a(47),_=s(S),M=a(17),C=a(138),w=n(C),k=a(56),T=n(k),N=a(73),P=a(135),I=s(P),L=a(750),D=s(L),R=a(312),A=s(R),O=a(119),F=s(O),x=a(38),U=s(x),H=a(9),j=s(H),G=a(87),B=n(G),V=a(16),z=n(V),q=a(438),W=s(q),Y=a(444),K=s(Y),J=j.default.KeyCodes,X=U.default.getState,Q=function(t){function a(e){(0,u.default)(this,a);var t=(0,h.default)(this,(a.__proto__||(0,l.default)(a)).call(this,e));return t.getContainer=function(){return t.refs.editModalBody},t.toggleEmojiPicker=function(){t.setState({showEmojiPicker:!t.state.showEmojiPicker})},t.hideEmojiPicker=function(){t.setState({showEmojiPicker:!1})},t.handleEmojiClick=function(e){var a=e.name||e.aliases[0];if(a){if(""===t.state.editText)t.setState({editText:":"+a+": "});else{var n=/\s+$/.test(t.state.editText)?t.state.editText+":"+a+": ":t.state.editText+" :"+a+": ";t.setState({editText:n})}t.setState({showEmojiPicker:!1}),t.refs.editbox.focus()}},t.getEditPostControls=function(){return t.refs.editPostEmoji},t.handleEdit=t.handleEdit.bind(t),t.handleEditKeyPress=t.handleEditKeyPress.bind(t),t.handleEditPostEvent=t.handleEditPostEvent.bind(t),t.handleKeyDown=t.handleKeyDown.bind(t),t.handleChange=t.handleChange.bind(t),t.onPreferenceChange=t.onPreferenceChange.bind(t),t.onModalHidden=t.onModalHidden.bind(t),t.onModalShow=t.onModalShow.bind(t),t.onModalShown=t.onModalShown.bind(t),t.onModalHide=t.onModalHide.bind(t),t.onModalKeyDown=t.onModalKeyDown.bind(t),t.handlePostError=t.handlePostError.bind(t),t.state={editText:"",originalText:"",title:"",post_id:"",channel_id:"",comments:0,refocusId:"",ctrlSend:F.default.getBool(j.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),postError:"",showEmojiPicker:!1},t}return(0,g.default)(a,t),(0,f.default)(a,[{key:"handlePostError",value:function(e){this.state.postError!==e&&this.setState({postError:e})}},{key:"handleEdit",value:function(){var e=this,t={message:this.state.editText,id:this.state.post_id,channel_id:this.state.channel_id};if(this.state.postError)return this.setState({errorClass:"animation--highlight"}),void setTimeout(function(){e.setState({errorClass:null})},j.default.ANIMATION_TIMEOUT);if(t.message===this.state.originalText)return void(0,E.default)("#edit_post").modal("hide");if(D.default.storeMessageInHistory(t.message),0===t.message.trim().length){var a=this.state;return(0,r.default)(a,"editText"),I.default.setItem("edit_state_transfer",a),(0,E.default)("#edit_post").modal("hide"),void T.showDeletePostModal(w.getPost(X(),this.state.post_id),this.state.comments)}(0,N.updatePost)(t,function(){window.scrollTo(0,0)}),(0,E.default)("#edit_post").modal("hide")}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({editText:t})}},{key:"handleEditKeyPress",value:function(e){B.isMobile()||this.state.ctrlSend||e.which!==J.ENTER||e.shiftKey||e.altKey?this.state.ctrlSend&&e.ctrlKey&&e.which===J.ENTER&&(e.preventDefault(),_.default.findDOMNode(this.refs.editbox).blur(),this.handleEdit()):(e.preventDefault(),_.default.findDOMNode(this.refs.editbox).blur(),this.handleEdit())}},{key:"handleEditPostEvent",value:function(t){var a=w.getPost(X(),t.postId);if("true"===e.window.mm_license.IsLicensed){if(e.window.mm_config.AllowEditPost===j.default.ALLOW_EDIT_POST_NEVER)return;if(e.window.mm_config.AllowEditPost===j.default.ALLOW_EDIT_POST_TIME_LIMIT&&a.create_at+1e3*e.window.mm_config.PostEditTimeLimit<z.getTimestamp())return}this.setState({editText:t.message||"",originalText:t.message||"",title:t.title||"",post_id:t.postId||"",channel_id:t.channelId||"",comments:t.comments||0,refocusId:t.refocusId||""}),(0,E.default)(_.default.findDOMNode(this.refs.modal)).modal("show")}},{key:"handleKeyDown",value:function(e){this.state.ctrlSend&&e.keyCode===J.ENTER&&!0===e.ctrlKey&&this.handleEdit()}},{key:"onPreferenceChange",value:function(){this.setState({ctrlSend:F.default.getBool(j.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter")})}},{key:"onModalHidden",value:function(){this.setState({editText:"",originalText:"",title:"",channel_id:"",post_id:"",comments:0,refocusId:"",error:"",typing:!1})}},{key:"onModalShow",value:function(e){var t=e.relatedTarget;t&&this.setState({editText:(0,E.default)(t).attr("data-message"),originalText:(0,E.default)(t).attr("data-message"),title:(0,E.default)(t).attr("data-title"),channel_id:(0,E.default)(t).attr("data-channelid"),post_id:(0,E.default)(t).attr("data-postid"),comments:(0,E.default)(t).attr("data-comments"),refocusId:(0,E.default)(t).attr("data-refocusid"),typing:!1})}},{key:"onModalShown",value:function(){this.refs.editbox.focus(),this.refs.editbox.recalculateSize()}},{key:"onModalHide",value:function(){var e=this;this.refs.editbox.hidePreview(),""!==this.state.refocusId&&setTimeout(function(){var t=(0,E.default)(e.state.refocusId).get(0);t&&t.focus()})}},{key:"onModalKeyDown",value:function(e){e.which===j.default.KeyCodes.ESCAPE&&e.stopPropagation()}},{key:"componentDidMount",value:function(){(0,E.default)(this.refs.modal).on("hidden.bs.modal",this.onModalHidden),(0,E.default)(this.refs.modal).on("show.bs.modal",this.onModalShow),(0,E.default)(this.refs.modal).on("shown.bs.modal",this.onModalShown),(0,E.default)(this.refs.modal).on("hide.bs.modal",this.onModalHide),(0,E.default)(this.refs.modal).on("keydown",this.onModalKeyDown),A.default.addEditPostListener(this.handleEditPostEvent),F.default.addChangeListener(this.onPreferenceChange)}},{key:"componentWillUnmount",value:function(){(0,E.default)(this.refs.modal).off("hidden.bs.modal",this.onModalHidden),(0,E.default)(this.refs.modal).off("show.bs.modal",this.onModalShow),(0,E.default)(this.refs.modal).off("shown.bs.modal",this.onModalShown),(0,E.default)(this.refs.modal).off("hide.bs.modal",this.onModalHide),(0,E.default)(this.refs.modal).off("keydown",this.onModalKeyDown),A.default.removeEditPostListner(this.handleEditPostEvent),F.default.removeChangeListener(this.onPreferenceChange)}},{key:"render",value:function(){var e="edit-post-footer"+(this.state.postError?" has-error":""),t=null;if(this.state.postError){var a="post-error"+(this.state.errorClass?" "+this.state.errorClass:"");t=y.default.createElement("label",{className:a},this.state.postError)}var n=null;return"true"===window.mm_config.EnableEmojiPicker&&(n=y.default.createElement("span",{className:"emoji-picker__container"},y.default.createElement(W.default,{show:this.state.showEmojiPicker,container:this.getContainer,target:this.getEditPostControls,onHide:this.hideEmojiPicker,onEmojiClick:this.handleEmojiClick,rightOffset:50,topOffset:-20}),y.default.createElement("span",{className:"icon icon--emoji",onClick:this.toggleEmojiPicker,dangerouslySetInnerHTML:{__html:j.default.EMOJI_ICON_SVG}}))),y.default.createElement("div",{className:"modal fade edit-modal",ref:"modal",id:"edit_post",role:"dialog",tabIndex:"-1","aria-hidden":"true"},y.default.createElement("div",{className:"modal-dialog modal-push-down modal-xl"},y.default.createElement("div",{className:"modal-content"},y.default.createElement("div",{className:"modal-header"},y.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},y.default.createElement("span",{"aria-hidden":"true"},"Ã—")),y.default.createElement("h4",{className:"modal-title"},y.default.createElement(M.FormattedMessage,{id:"edit_post.edit",defaultMessage:"Edit {title}",values:{title:this.state.title}}))),y.default.createElement("div",{ref:"editModalBody",className:"edit-modal-body modal-body"},y.default.createElement(K.default,{onChange:this.handleChange,onKeyPress:this.handleEditKeyPress,onKeyDown:this.handleKeyDown,handlePostError:this.handlePostError,value:this.state.editText,channelId:this.state.channel_id,emojiEnabled:"true"===window.mm_config.EnableEmojiPicker,createMessage:z.localizeMessage("edit_post.editPost","Edit the post..."),supportsCommands:!1,suggestionListStyle:"bottom",id:"edit_textbox",ref:"editbox"}),y.default.createElement("span",{ref:"editPostEmoji",className:"edit-post__actions"},n),y.default.createElement("div",{className:e},t)),y.default.createElement("div",{className:"modal-footer"},y.default.createElement("button",{type:"button",className:"btn btn-default","data-dismiss":"modal"},y.default.createElement(M.FormattedMessage,{id:"edit_post.cancel",defaultMessage:"Cancel"})),y.default.createElement("button",{type:"button",className:"btn btn-primary",onClick:this.handleEdit},y.default.createElement(M.FormattedMessage,{id:"edit_post.save",defaultMessage:"Save"}))))))}}]),a}(y.default.Component);t.default=Q}).call(t,a(22))},2388:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(739),v=n(g),E=a(2080),b=n(E),y=a(35),S=n(y),_=a(9),M=n(_),C=a(16),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(C),k=a(2188),T=n(k),N=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.hide=a.hide.bind(a),a.shouldComponentUpdate=v.default.shouldComponentUpdate.bind(a),a.state={show:!1,post:{}},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addModalListener(M.default.ActionTypes.TOGGLE_GET_POST_LINK_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(M.default.ActionTypes.TOGGLE_GET_POST_LINK_MODAL,this.handleToggle)}},{key:"handleToggle",value:function(e,t){this.setState({show:e,post:t.post})}},{key:"hide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return p.default.createElement(T.default,{show:this.state.show,onHide:this.hide,title:w.localizeMessage("get_post_link_modal.title","Copy Permalink"),helpText:w.localizeMessage("get_post_link_modal.help","The link below allows authorized users to see your post."),link:S.default.getCurrentTeamUrl()+"/pl/"+this.state.post.id})}}]),t}(p.default.Component);t.default=N},2389:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(739),v=n(g),E=a(773),b=a(2080),y=n(b),S=a(9),_=n(S),M=a(16),C=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(M),w=a(2188),k=n(w),T=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handlePublicLink=a.handlePublicLink.bind(a),a.handleToggle=a.handleToggle.bind(a),a.hide=a.hide.bind(a),a.shouldComponentUpdate=v.default.shouldComponentUpdate.bind(a),a.state={show:!1,fileId:"",link:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){y.default.addModalListener(_.default.ActionTypes.TOGGLE_GET_PUBLIC_LINK_MODAL,this.handleToggle)}},{key:"componentDidUpdate",value:function(e,t){this.state.show&&!t.show&&(0,E.getPublicLink)(this.state.fileId,this.handlePublicLink)}},{key:"componentWillUnmount",value:function(){y.default.removeModalListener(_.default.ActionTypes.TOGGLE_GET_PUBLIC_LINK_MODAL,this.handleToggle)}},{key:"handlePublicLink",value:function(e){this.setState({link:e})}},{key:"handleToggle",value:function(e,t){this.setState({show:e,fileId:t.fileId,link:""})}},{key:"hide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return p.default.createElement(k.default,{show:this.state.show,onHide:this.hide,title:C.localizeMessage("get_public_link_modal.title","Copy Public Link"),helpText:C.localizeMessage("get_public_link_modal.help","The link below allows anyone to see this file without being registered on this server."),link:this.state.link})}}]),t}(p.default.Component);t.default=T},2390:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(739),v=n(g),E=a(2080),b=n(E),y=a(35),S=n(y),_=a(9),M=n(_),C=a(16),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(C),k=a(2188),T=n(k),N=function(t){function a(e){(0,o.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.handleToggle=t.handleToggle.bind(t),t.shouldComponentUpdate=v.default.shouldComponentUpdate.bind(t),t.state={show:!1},t}return(0,m.default)(a,t),(0,d.default)(a,[{key:"componentDidMount",value:function(){b.default.addModalListener(M.default.ActionTypes.TOGGLE_GET_TEAM_INVITE_LINK_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(M.default.ActionTypes.TOGGLE_GET_TEAM_INVITE_LINK_MODAL,this.handleToggle)}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"render",value:function(){var t=this,a=void 0;return a="true"===e.window.mm_config.EnableUserCreation?w.localizeMessage("get_team_invite_link_modal.help","Send teammates the link below for them to sign-up to this team site. The Team Invite Link can be shared with multiple teammates as it does not change unless it's regenerated in Team Settings by a Team Admin."):w.localizeMessage("get_team_invite_link_modal.helpDisabled","User creation has been disabled for your team. Please ask your team administrator for details."),p.default.createElement(T.default,{show:this.state.show,onHide:function(){return t.setState({show:!1})},title:w.localizeMessage("get_team_invite_link_modal.title","Team Invite Link"),helpText:a,link:S.default.getCurrentInviteLink()})}}]),a}(p.default.Component);t.default=N}).call(t,a(22))},2391:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(1),g=s(p),v=a(40),E=a(47),b=s(E),y=a(17),S=a(56),_=n(S),M=a(435),C=a(32),w=s(C),k=a(2080),T=s(k),N=a(35),P=s(N),I=a(25),L=s(I),D=a(9),R=s(D),A=a(16),O=n(A),F=a(311),x=s(F),U=R.default.ActionTypes,H=(0,y.defineMessages)({emailError:{id:"invite_member.emailError",defaultMessage:"Please enter a valid email address"},firstname:{id:"invite_member.firstname",defaultMessage:"First name"},lastname:{id:"invite_member.lastname",defaultMessage:"Last name"},modalTitle:{id:"invite_member.modalTitle",defaultMessage:"Discard Invitations?"},modalMessage:{id:"invite_member.modalMessage",defaultMessage:"You have unsent invitations, are you sure you want to discard them?"},modalButton:{id:"invite_member.modalButton",defaultMessage:"Yes, Discard"}}),j=function(t){function a(t){(0,l.default)(this,a);var n=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,t));n.teamChange=n.teamChange.bind(n),n.handleToggle=n.handleToggle.bind(n),n.handleSubmit=n.handleSubmit.bind(n),n.handleHide=n.handleHide.bind(n),n.addInviteFields=n.addInviteFields.bind(n),n.clearFields=n.clearFields.bind(n),n.removeInviteFields=n.removeInviteFields.bind(n),n.showGetTeamInviteLinkModal=n.showGetTeamInviteLinkModal.bind(n),n.handleKeyDown=n.handleKeyDown.bind(n);var s=P.default.getCurrent();return n.state={show:!1,inviteIds:[0],idCount:0,emailErrors:{},firstNameErrors:{},lastNameErrors:{},emailEnabled:"true"===e.window.mm_config.SendEmailNotifications,userCreationEnabled:"true"===e.window.mm_config.EnableUserCreation,showConfirmModal:!1,isSendingEmails:!1,teamType:s?s.type:null},n}return(0,h.default)(a,t),(0,u.default)(a,[{key:"teamChange",value:function(){var e=P.default.getCurrent(),t=e?e.type:null;this.setState({teamType:t})}},{key:"componentDidMount",value:function(){T.default.addModalListener(U.TOGGLE_INVITE_MEMBER_MODAL,this.handleToggle),P.default.addChangeListener(this.teamChange)}},{key:"componentWillUnmount",value:function(){T.default.removeModalListener(U.TOGGLE_INVITE_MEMBER_MODAL,this.handleToggle),P.default.removeChangeListener(this.teamChange)}},{key:"handleToggle",value:function(e){this.setState({show:e,serverError:null})}},{key:"handleSubmit",value:function(){var e=this;if(this.state.emailEnabled){for(var t=this.state.inviteIds,a=t.length,n=[],s=this.state.emailErrors,i=this.state.firstNameErrors,r=this.state.lastNameErrors,o=!0,l=0;l<a;l++){var d={},u=t[l];d.email=b.default.findDOMNode(this.refs["email"+u]).value.trim(),d.firstName=b.default.findDOMNode(this.refs["first_name"+u]).value.trim(),d.lastName=b.default.findDOMNode(this.refs["last_name"+u]).value.trim(),""===d.email&&0!==u||(d.email&&O.isEmail(d.email)?s[u]="":(s[u]=this.props.intl.formatMessage(H.emailError),o=!1),n.push(d))}if(this.setState({emailErrors:s,firstNameErrors:i,lastNameErrors:r}),o&&0!==n.length){var c={};c.invites=n,this.setState({isSendingEmails:!0}),(0,M.inviteMembers)(c,function(){e.handleHide(!1),e.setState({isSendingEmails:!1})},function(t){"api.team.invite_members.already.app_error"===t.id?(s[t.detailed_error]=t.message,e.setState({emailErrors:s})):e.setState({serverError:t.message}),e.setState({isSendingEmails:!1})})}}}},{key:"handleHide",value:function(e){if(e){for(var t=!1,a=0;a<this.state.inviteIds.length;a++){var n=this.state.inviteIds[a];if(""!==b.default.findDOMNode(this.refs["email"+n]).value.trim()){t=!0;break}}if(t)return void this.setState({showConfirmModal:!0})}this.clearFields(),this.setState({show:!1,showConfirmModal:!1})}},{key:"addInviteFields",value:function(){var e=this.state.idCount+1,t=this.state.inviteIds;t.push(e),this.setState({inviteIds:t,idCount:e})}},{key:"clearFields",value:function(){for(var e=this.state.inviteIds,t=0;t<e.length;t++){var a=e[t];b.default.findDOMNode(this.refs["email"+a]).value="",b.default.findDOMNode(this.refs["first_name"+a]).value="",b.default.findDOMNode(this.refs["last_name"+a]).value=""}this.setState({inviteIds:[0],idCount:0,emailErrors:{},firstNameErrors:{},lastNameErrors:{}})}},{key:"removeInviteFields",value:function(e){var t=this.state.idCount,a=this.state.inviteIds,n=a.indexOf(e);n>-1&&a.splice(n,1),a.length||a.push(++t),this.setState({inviteIds:a,idCount:t})}},{key:"showGetTeamInviteLinkModal",value:function(){this.handleHide(!1),_.showGetTeamInviteLinkModal()}},{key:"handleKeyDown",value:function(e){e.keyCode===R.default.KeyCodes.ENTER&&(e.preventDefault(),this.handleSubmit())}},{key:"render",value:function(){var e=this,t=L.default.getCurrentUser(),a=this.props.intl.formatMessage;if(null!=t&&null!=this.state.teamType){for(var n=[],s=this.state.inviteIds,i=0;i<s.length;i++){var r=s[i],o=null;this.state.emailErrors[r]&&(o=g.default.createElement("label",{className:"control-label"},this.state.emailErrors[r]));var l=null;this.state.firstNameErrors[r]&&(l=g.default.createElement("label",{className:"control-label"},this.state.firstNameErrors[r]));var d=null;this.state.lastNameErrors[r]&&(d=g.default.createElement("label",{className:"control-label"},this.state.lastNameErrors[r]));var u=null;r&&(u=g.default.createElement("div",null,g.default.createElement("button",{type:"button",className:"btn btn-link remove__member",onClick:this.removeInviteFields.bind(this,r)},g.default.createElement("span",{className:"fa fa-trash"}))));var c="form-group invite";o&&(c+=" has-error");var f=null,m="form-group";l&&(m+=" has-error");var h="form-group";d&&(h+=" has-error"),f=g.default.createElement("div",{className:"row row--invite"},g.default.createElement("div",{className:"col-sm-6"},g.default.createElement("div",{className:m},g.default.createElement("input",{onKeyDown:this.handleKeyDown,type:"text",className:"form-control",ref:"first_name"+r,placeholder:a(H.firstname),maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),l)),g.default.createElement("div",{className:"col-sm-6"},g.default.createElement("div",{className:h},g.default.createElement("input",{onKeyDown:this.handleKeyDown,type:"text",className:"form-control",ref:"last_name"+r,placeholder:a(H.lastname),maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),d))),n[r]=g.default.createElement("div",{key:"key"+r},u,g.default.createElement("div",{className:c},g.default.createElement("input",{onKeyUp:this.displayNameKeyUp,onKeyDown:this.handleKeyDown,type:"text",ref:"email"+r,className:"form-control",placeholder:"email@domain.com",maxLength:"64",disabled:!this.state.emailEnabled||!this.state.userCreationEnabled,spellCheck:"false"}),o),f)}var p=null;this.state.serverError&&(p=g.default.createElement("div",{className:"form-group has-error"},g.default.createElement("label",{className:"control-label"},this.state.serverError)));var E=null,b=null,S="";if(w.default.getByName(R.default.DEFAULT_CHANNEL)&&(S=w.default.getByName(R.default.DEFAULT_CHANNEL).display_name),this.state.emailEnabled&&this.state.userCreationEnabled){E=g.default.createElement("div",null,p,g.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.addInviteFields},g.default.createElement(y.FormattedMessage,{id:"invite_member.addAnother",defaultMessage:"Add another"})),g.default.createElement("br",null),g.default.createElement("br",null),g.default.createElement("span",null,g.default.createElement(y.FormattedHTMLMessage,{id:"invite_member.autoJoin",defaultMessage:"People invited automatically join the <strong>{channel}</strong> channel.",values:{channel:S}})));var _=g.default.createElement(y.FormattedMessage,{id:"invite_member.send",defaultMessage:"Send Invitation"});this.state.isSendingEmails?_=g.default.createElement("span",null,g.default.createElement("i",{className:"fa fa-spinner fa-spin"}),g.default.createElement(y.FormattedMessage,{id:"invite_member.sending",defaultMessage:" Sending"})):this.state.inviteIds.length>1&&(_=g.default.createElement(y.FormattedMessage,{id:"invite_member.send2",defaultMessage:"Send Invitations"})),b=g.default.createElement("button",{onClick:this.handleSubmit,type:"button",className:"btn btn-primary",disabled:this.state.isSendingEmails},_)}else if(this.state.userCreationEnabled){var M=null;if(t&&"O"===this.state.teamType){var C=g.default.createElement("button",{className:"color--link style--none",onClick:this.showGetTeamInviteLinkModal},g.default.createElement(y.FormattedMessage,{id:"invite_member.inviteLink",defaultMessage:"Team Invite Link"}));M=g.default.createElement("p",null,g.default.createElement(y.FormattedMessage,{id:"invite_member.teamInviteLink",defaultMessage:"You can also invite people using the {link}.",values:{link:C}}))}E=g.default.createElement("div",null,g.default.createElement("p",null,g.default.createElement(y.FormattedMessage,{id:"invite_member.content",defaultMessage:"Email is currently disabled for your team, and email invitations cannot be sent. Contact your System Administrator to enable email and email invitations."})),M)}else E=g.default.createElement("div",null,g.default.createElement("p",null,g.default.createElement(y.FormattedMessage,{id:"invite_member.disabled",defaultMessage:"User creation has been disabled for your team. Please ask your Team Administrator for details."})));return g.default.createElement("div",null,g.default.createElement(v.Modal,{dialogClassName:"modal-invite-member",show:this.state.show,onHide:this.handleHide.bind(this,!0),enforceFocus:!this.state.showConfirmModal,backdrop:!this.state.isSendingEmails||"static"},g.default.createElement(v.Modal.Header,{closeButton:!this.state.isSendingEmails},g.default.createElement(v.Modal.Title,null,g.default.createElement(y.FormattedMessage,{id:"invite_member.newMember",defaultMessage:"Send Email Invite"}))),g.default.createElement(v.Modal.Body,{ref:"modalBody"},g.default.createElement("form",{role:"form"},n),E),g.default.createElement(v.Modal.Footer,null,g.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide.bind(this,!0),disabled:this.state.isSendingEmails},g.default.createElement(y.FormattedMessage,{id:"invite_member.cancel",defaultMessage:"Cancel"})),b)),g.default.createElement(x.default,{title:a(H.modalTitle),message:a(H.modalMessage),confirmButtonText:a(H.modalButton),show:this.state.showConfirmModal,onConfirm:this.handleHide.bind(this,!1),onCancel:function(){return e.setState({showConfirmModal:!1})}}))}return null}}]),a}(g.default.Component);j.propTypes={intl:y.intlShape.isRequired},t.default=(0,y.injectIntl)(j)}).call(t,a(22))},2392:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(40),v=a(17),E=a(56),b=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(E),y=a(2080),S=n(y),_=a(25),M=n(_),C=a(436),w=n(C),k=a(9),T=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleHide=a.handleHide.bind(a),a.handleKeyPress=a.handleKeyPress.bind(a),a.state={show:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){S.default.addModalListener(k.ActionTypes.TOGGLE_LEAVE_TEAM_MODAL,this.handleToggle),document.addEventListener("keypress",this.handleKeyPress)}},{key:"componentWillUnmount",value:function(){S.default.removeModalListener(k.ActionTypes.TOGGLE_LEAVE_TEAM_MODAL,this.handleToggle),document.removeEventListener("keypress",this.handleKeyPress)}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&this.state.show&&this.handleSubmit(e)}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"handleSubmit",value:function(e){if(this.setState({show:!1}),w.default.isBusy())return w.default.emitChanged({action:k.WebrtcActionTypes.IN_PROGRESS}),void e.preventDefault();b.emitLeaveTeam(),b.toggleSideBarRightMenuAction()}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){return null!=M.default.getCurrentUser()?p.default.createElement(g.Modal,{className:"modal-confirm",show:this.state.show,onHide:this.handleHide},p.default.createElement(g.Modal.Header,{closeButton:!1},p.default.createElement(g.Modal.Title,null,p.default.createElement(v.FormattedMessage,{id:"leave_team_modal.title",defaultMessage:"Leave the team?"}))),p.default.createElement(g.Modal.Body,null,p.default.createElement(v.FormattedMessage,{id:"leave_team_modal.desc",defaultMessage:"You will be removed from all public and private channels.  If the team is private you will not be able to rejoin the team.  Are you sure?"})),p.default.createElement(g.Modal.Footer,null,p.default.createElement("button",{type:"button",className:"btn btn-default",onClick:this.handleHide},p.default.createElement(v.FormattedMessage,{id:"leave_team_modal.no",defaultMessage:"No"})),p.default.createElement("button",{type:"button",className:"btn btn-danger",onClick:this.handleSubmit},p.default.createElement(v.FormattedMessage,{id:"leave_team_modal.yes",defaultMessage:"Yes"})))):null}}]),t}(p.default.Component);T.propTypes={intl:v.intlShape.isRequired},t.default=(0,v.injectIntl)(T)},2393:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(17),v=a(79),E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(v),b=a(2080),y=n(b),S=a(9),_=n(S),M=a(311),C=n(M),w=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleToggle=a.handleToggle.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleHide=a.handleHide.bind(a),a.handleKeyPress=a.handleKeyPress.bind(a),a.state={show:!1,channel:null},a.mounted=!1,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,y.default.addModalListener(_.default.ActionTypes.TOGGLE_LEAVE_PRIVATE_CHANNEL_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,y.default.removeModalListener(_.default.ActionTypes.TOGGLE_LEAVE_PRIVATE_CHANNEL_MODAL,this.handleToggle)}},{key:"handleKeyPress",value:function(e){"Enter"===e.key&&this.state.show&&this.handleSubmit()}},{key:"handleSubmit",value:function(){var e=this.state.channel.id;this.setState({show:!1,channel:null}),E.leaveChannel(e)}},{key:"handleToggle",value:function(e){this.setState({channel:e,show:null!==e})}},{key:"handleHide",value:function(){this.setState({show:!1})}},{key:"render",value:function(){var e="",t="";this.state.channel&&(e=p.default.createElement(g.FormattedMessage,{id:"leave_private_channel_modal.title",defaultMessage:"Leave Private Channel {channel}",values:{channel:p.default.createElement("b",null,this.state.channel.display_name)}}),t=p.default.createElement(g.FormattedMessage,{id:"leave_private_channel_modal.message",defaultMessage:"Are you sure you wish to leave the private channel {channel}? You must be re-invited in order to re-join this channel in the future.",values:{channel:p.default.createElement("b",null,this.state.channel.display_name)}}));var a=p.default.createElement(g.FormattedMessage,{id:"leave_private_channel_modal.leave",defaultMessage:"Yes, leave channel"});return p.default.createElement(C.default,{show:this.state.show,title:e,message:t,confirmButtonClass:"btn btn-danger",confirmButtonText:a,onConfirm:this.handleSubmit,onCancel:this.handleHide})}}]),t}(p.default.Component);w.propTypes={intl:g.intlShape.isRequired},t.default=(0,g.injectIntl)(w)},2394:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(0),g=s(p),v=a(2),E=s(v),b=a(1),y=s(b),S=a(17),_=a(44),M=a(449),C=s(M),w=a(774),k=s(w),T=a(79),N=n(T),P=a(56),I=n(P),L=a(73),D=a(34),R=s(D),A=a(32),O=s(A),F=a(2080),x=s(F),U=a(119),H=s(U),j=a(313),G=s(j),B=a(35),V=s(B),z=a(25),q=s(z),W=a(121),Y=n(W),K=a(9),J=a(16),X=n(J),Q=a(775),Z=s(Q),$=a(318),ee=s($),te=a(451),ae=s(te),ne=a(778),se=s(ne),ie=a(780),re=s(ie),oe=a(2395),le=s(oe),de=a(2396),ue=s(de),ce=a(781),fe=s(ce),me=a(440),he=s(me),pe=a(441),ge=s(pe),ve=a(2400),Ee=s(ve),be=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));a.toggleFavorite=function(e){e.preventDefault(),a.state.isFavorite?N.unmarkFavorite(a.state.channel.id):N.markFavorite(a.state.channel.id)},a.onChange=a.onChange.bind(a),a.handleLeave=a.handleLeave.bind(a),a.showSearch=a.showSearch.bind(a),a.showEditChannelHeaderModal=a.showEditChannelHeaderModal.bind(a),a.hideEditChannelHeaderModal=a.hideEditChannelHeaderModal.bind(a),a.showChannelPurposeModal=a.showChannelPurposeModal.bind(a),a.hideChannelPurposeModal=a.hideChannelPurposeModal.bind(a),a.showRenameChannelModal=a.showRenameChannelModal.bind(a),a.hideRenameChannelModal=a.hideRenameChannelModal.bind(a),a.isStateValid=a.isStateValid.bind(a),a.createCollapseButtons=a.createCollapseButtons.bind(a),a.createDropdown=a.createDropdown.bind(a),a.showMembersModal=a.showMembersModal.bind(a),a.hideMembersModal=a.hideMembersModal.bind(a),a.toggleQuickSwitchModal=a.toggleQuickSwitchModal.bind(a),a.hideQuickSwitchModal=a.hideQuickSwitchModal.bind(a),a.handleQuickSwitchKeyPress=a.handleQuickSwitchKeyPress.bind(a),a.openDirectMessageModal=a.openDirectMessageModal.bind(a),a.getPinnedPosts=a.getPinnedPosts.bind(a);var n=a.getStateFromStores();return n.showEditChannelPurposeModal=!1,n.showEditChannelHeaderModal=!1,n.showMembersModal=!1,n.showRenameChannelModal=!1,n.showQuickSwitchModal=!1,n.quickSwitchMode="channel",a.state=n,a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"getStateFromStores",value:function(){var e=O.default.getCurrent();return{channel:e,member:O.default.getCurrentMember(),users:[],userCount:O.default.getCurrentStats().member_count,currentUser:q.default.getCurrentUser(),isFavorite:e&&Y.isFavoriteChannel(e)}}},{key:"isStateValid",value:function(){return this.state.channel&&this.state.member&&this.state.users&&this.state.currentUser}},{key:"componentDidMount",value:function(){O.default.addChangeListener(this.onChange),O.default.addStatsChangeListener(this.onChange),q.default.addStatusesChangeListener(this.onChange),q.default.addChangeListener(this.onChange),H.default.addChangeListener(this.onChange),x.default.addModalListener(K.ActionTypes.TOGGLE_QUICK_SWITCH_MODAL,this.toggleQuickSwitchModal),x.default.addModalListener(K.ActionTypes.TOGGLE_CHANNEL_HEADER_UPDATE_MODAL,this.showEditChannelHeaderModal),x.default.addModalListener(K.ActionTypes.TOGGLE_CHANNEL_PURPOSE_UPDATE_MODAL,this.showChannelPurposeModal),x.default.addModalListener(K.ActionTypes.TOGGLE_CHANNEL_NAME_UPDATE_MODAL,this.showRenameChannelModal),(0,g.default)(".inner-wrap").click(this.hideSidebars),document.addEventListener("keydown",this.handleQuickSwitchKeyPress)}},{key:"componentWillUnmount",value:function(){O.default.removeChangeListener(this.onChange),O.default.removeStatsChangeListener(this.onChange),q.default.removeStatusesChangeListener(this.onChange),q.default.removeChangeListener(this.onChange),H.default.removeChangeListener(this.onChange),x.default.removeModalListener(K.ActionTypes.TOGGLE_QUICK_SWITCH_MODAL,this.toggleQuickSwitchModal),x.default.addModalListener(K.ActionTypes.TOGGLE_CHANNEL_HEADER_UPDATE_MODAL,this.hideEditChannelHeaderModal),x.default.addModalListener(K.ActionTypes.TOGGLE_CHANNEL_PURPOSE_UPDATE_MODAL,this.hideChannelPurposeModal),x.default.addModalListener(K.ActionTypes.TOGGLE_CHANNEL_NAME_UPDATE_MODAL,this.hideRenameChannelModal),document.removeEventListener("keydown",this.handleQuickSwitchKeyPress)}},{key:"handleSubmit",value:function(e){e.preventDefault()}},{key:"handleLeave",value:function(){this.state.channel.type===K.Constants.PRIVATE_CHANNEL?I.showLeavePrivateChannelModal(this.state.channel):N.leaveChannel(this.state.channel.id)}},{key:"hideSidebars",value:function(e){(0,g.default)(window).outerWidth()<=768&&(R.default.handleServerAction({type:K.ActionTypes.RECEIVED_SEARCH,results:null}),R.default.handleServerAction({type:K.ActionTypes.RECEIVED_POST_SELECTED,postId:null,channelId:null}),"navbar-toggle"!==e.target.className&&"icon-bar"!==e.target.className&&((0,g.default)(".app__body .inner-wrap").removeClass("move--right move--left move--left-small"),(0,g.default)(".app__body .sidebar--left").removeClass("move--right"),(0,g.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,g.default)(".app__body .sidebar--right").removeClass("move--left"),(0,g.default)(".app__body .sidebar--menu").removeClass("move--left")))}},{key:"toggleLeftSidebar",value:function(){(0,g.default)(".app__body .inner-wrap").toggleClass("move--right"),(0,g.default)(".app__body .sidebar--left").toggleClass("move--right"),(0,g.default)(".multi-teams .team-sidebar").toggleClass("move--right")}},{key:"toggleRightSidebar",value:function(){(0,g.default)(".app__body .inner-wrap").toggleClass("move--left-small"),(0,g.default)(".app__body .sidebar--menu").toggleClass("move--left")}},{key:"showSearch",value:function(){R.default.handleServerAction({type:K.ActionTypes.SHOW_SEARCH})}},{key:"onChange",value:function(){this.setState(this.getStateFromStores())}},{key:"showEditChannelHeaderModal",value:function(){this.setState({showEditChannelHeaderModal:!0})}},{key:"hideEditChannelHeaderModal",value:function(){this.setState({showEditChannelHeaderModal:!1})}},{key:"showChannelPurposeModal",value:function(){this.setState({showEditChannelPurposeModal:!0})}},{key:"hideChannelPurposeModal",value:function(){this.setState({showEditChannelPurposeModal:!1})}},{key:"showRenameChannelModal",value:function(){this.setState({showRenameChannelModal:!0})}},{key:"hideRenameChannelModal",value:function(){this.setState({showRenameChannelModal:!1})}},{key:"showMembersModal",value:function(e){e.preventDefault(),this.setState({showMembersModal:!0})}},{key:"hideMembersModal",value:function(){this.setState({showMembersModal:!1})}},{key:"handleQuickSwitchKeyPress",value:function(e){X.cmdOrCtrlPressed(e)&&!e.shiftKey&&e.keyCode===K.Constants.KeyCodes.K&&(e.altKey||(e.preventDefault(),this.toggleQuickSwitchModal("channel")))}},{key:"toggleQuickSwitchModal",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"channel";this.state.showQuickSwitchModal?this.setState({showQuickSwitchModal:!1,quickSwitchMode:"channel"}):this.setState({showQuickSwitchModal:!0,quickSwitchMode:e})}},{key:"hideQuickSwitchModal",value:function(){this.setState({showQuickSwitchModal:!1,quickSwitchMode:"channel"})}},{key:"openDirectMessageModal",value:function(){R.default.handleViewAction({type:K.ActionTypes.TOGGLE_DM_MODAL,value:!0,channelId:this.state.channel.id})}},{key:"getPinnedPosts",value:function(e){e.preventDefault(),G.default.isPinnedPosts?I.toggleSideBarAction(!1):(0,L.getPinnedPosts)(this.state.channel.id)}},{key:"createDropdown",value:function(e,t,a,n,s,i,r){var o=this;if(e){var l=void 0,d=void 0,u=void 0,c=void 0,f=void 0,m=void 0,h=void 0,p=void 0,g=void 0,v=void 0;i?f=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showEditChannelHeaderModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.channelHeader",defaultMessage:"Set Channel Header..."}))):r?(f=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showEditChannelHeaderModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.channelHeader",defaultMessage:"Set Channel Header..."}))),h=y.default.createElement("li",{role:"presentation"},y.default.createElement(ge.default,{role:"menuitem",dialogType:se.default,dialogProps:{channel:e,channelMember:this.state.member,currentUser:this.state.currentUser}},y.default.createElement(S.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"}))),u=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.openDirectMessageModal},y.default.createElement(S.FormattedMessage,{id:"navbar.addMembers",defaultMessage:"Add Members"})))):(l=y.default.createElement("li",{role:"presentation"},y.default.createElement(ge.default,{role:"menuitem",dialogType:Z.default,dialogProps:{channel:e}},y.default.createElement(S.FormattedMessage,{id:"navbar.viewInfo",defaultMessage:"View Info"}))),d=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.getPinnedPosts},y.default.createElement(S.FormattedMessage,{id:"navbar.viewPinnedPosts",defaultMessage:"View Pinned Posts"}))),O.default.isDefault(e)?c=y.default.createElement("li",{key:"view_members",role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showMembersModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.viewMembers",defaultMessage:"View Members"}))):(u=y.default.createElement("li",{role:"presentation"},y.default.createElement(ge.default,{ref:"channelInviteModalButton",role:"menuitem",dialogType:ee.default,dialogProps:{channel:e,currentUser:this.state.currentUser}},y.default.createElement(S.FormattedMessage,{id:"navbar.addMembers",defaultMessage:"Add Members"}))),c=Y.canManageMembers(e,s,n,a)?y.default.createElement("li",{key:"manage_members",role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showMembersModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.manageMembers",defaultMessage:"Manage Members"}))):y.default.createElement("li",{key:"view_members",role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showMembersModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.viewMembers",defaultMessage:"View Members"})))),h=y.default.createElement("li",{role:"presentation"},y.default.createElement(ge.default,{role:"menuitem",dialogType:se.default,dialogProps:{channel:e,channelMember:this.state.member,currentUser:this.state.currentUser}},y.default.createElement(S.FormattedMessage,{id:"navbar.preferences",defaultMessage:"Notification Preferences"}))),Y.showManagementOptions(e,s,n,a)&&(f=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showEditChannelHeaderModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.setHeader",defaultMessage:"Edit Channel Header"}))),m=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showChannelPurposeModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.setPurpose",defaultMessage:"Edit Channel Purpose"}))),p=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.showRenameChannelModal},y.default.createElement(S.FormattedMessage,{id:"channel_header.rename",defaultMessage:"Rename Channel"})))),Y.showDeleteOptionForCurrentUser(e,s,n,a)&&(g=y.default.createElement("li",{role:"presentation"},y.default.createElement(ge.default,{role:"menuitem",dialogType:re.default,dialogProps:{channel:e}},y.default.createElement(S.FormattedMessage,{id:"channel_header.delete",defaultMessage:"Delete Channel"})))),O.default.isDefault(e)||(v=y.default.createElement("li",{role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.handleLeave},y.default.createElement(S.FormattedMessage,{id:"channel_header.leave",defaultMessage:"Leave Channel"})))));var E=y.default.createElement("li",{key:"toggle_favorite",role:"presentation"},y.default.createElement("a",{role:"menuitem",href:"#",onClick:this.toggleFavorite},this.state.isFavorite?y.default.createElement(S.FormattedMessage,{id:"channelHeader.removeFromFavorites",defaultMessage:"Remove from Favorites"}):y.default.createElement(S.FormattedMessage,{id:"channelHeader.addToFavorites",defaultMessage:"Add to Favorites"})));return y.default.createElement("div",{className:"navbar-brand"},y.default.createElement("div",{className:"dropdown"},y.default.createElement("a",{href:"#",className:"dropdown-toggle theme",type:"button","data-toggle":"dropdown","aria-expanded":"true"},y.default.createElement("span",{className:"heading"},y.default.createElement(he.default,{status:this.getTeammateStatus()}),t," "),y.default.createElement("span",{className:"fa fa-angle-down header-dropdown__icon"})),y.default.createElement("ul",{className:"dropdown-menu",role:"menu"},l,d,h,u,c,f,m,p,g,v,E,y.default.createElement("div",{className:"close visible-xs-block",onClick:function(){return o.refs.headerOverlay.hide()}},"Ã—"))))}return y.default.createElement("div",{className:"navbar-brand"},y.default.createElement(_.Link,{to:V.default.getCurrentTeamUrl()+"/channels/town-square",className:"heading"},t))}},{key:"createCollapseButtons",value:function(e){var t=[],a=K.Constants.MENU_ICON_SVG;return null==e?t.push(y.default.createElement("button",{key:"navbar-toggle-collapse",type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#navbar-collapse-1"},y.default.createElement("span",{className:"sr-only"},y.default.createElement(S.FormattedMessage,{id:"navbar.toggle1",defaultMessage:"Toggle sidebar"})),y.default.createElement("span",{className:"icon-bar"}),y.default.createElement("span",{className:"icon-bar"}),y.default.createElement("span",{className:"icon-bar"}))):(t.push(y.default.createElement("button",{key:"navbar-toggle-sidebar",type:"button",className:"navbar-toggle","data-toggle":"collapse","data-target":"#sidebar-nav",onClick:this.toggleLeftSidebar},y.default.createElement("span",{className:"sr-only"},y.default.createElement(S.FormattedMessage,{id:"navbar.toggle2",defaultMessage:"Toggle sidebar"})),y.default.createElement("span",{className:"icon icon__menu icon--sidebarHeaderTextColor",dangerouslySetInnerHTML:{__html:a},"aria-hidden":"true"}),y.default.createElement(le.default,null))),t.push(y.default.createElement("button",{key:"navbar-toggle-menu",type:"button",className:"navbar-toggle navbar-right__icon menu-toggle pull-right","data-toggle":"collapse","data-target":"#sidebar-nav",onClick:this.toggleRightSidebar},y.default.createElement("span",{dangerouslySetInnerHTML:{__html:K.Constants.MENU_ICON}})))),t}},{key:"getTeammateStatus",value:function(){if("D"===this.state.channel.type){var e=this.state.currentUser.id,t=this.state.users.find(function(t){return t.id!==e});if(t)return q.default.getStatus(t.id)}return null}},{key:"render",value:function(){var e=this;if(!this.isStateValid())return null;var t=this.state.currentUser.id,a=this.state.channel,n=this.props.teamDisplayName,s=V.default.isTeamAdminForCurrentTeam(),i=q.default.isSystemAdminForCurrentUser(),r=!1,o=!1,l=!1,d=null,u=null,c=null,f=null,m=null;if(a){if(r=O.default.isChannelAdminForCurrentChannel(),n=a.display_name,a.type===K.Constants.DM_CHANNEL){o=!0;var h=X.getUserIdFromChannelName(a);n=X.displayUsername(h)}else a.type===K.Constants.GM_CHANNEL&&(l=!0);this.state.showEditChannelHeaderModal&&(d=y.default.createElement(C.default,{onHide:function(){return e.setState({showEditChannelHeaderModal:!1})},channel:a})),this.state.showEditChannelPurposeModal&&(u=y.default.createElement(k.default,{onModalDismissed:this.hideChannelPurposeModal,channel:a})),c=y.default.createElement(fe.default,{show:this.state.showRenameChannelModal,onHide:this.hideRenameChannelModal,channel:a}),this.state.showMembersModal&&(f=y.default.createElement(ae.default,{show:!0,onModalDismissed:this.hideMembersModal,showInviteModal:function(){return e.refs.channelInviteModalButton.show()},channel:a,isAdmin:s||i})),m=y.default.createElement(ue.default,{show:this.state.showQuickSwitchModal,onHide:this.hideQuickSwitchModal,initialMode:this.state.quickSwitchMode})}var p=this.createCollapseButtons(t),g=K.Constants.SEARCH_ICON_SVG,v=y.default.createElement("button",{type:"button",className:"navbar-toggle navbar-right__icon navbar-search pull-right",onClick:this.showSearch},y.default.createElement("span",{className:"icon icon__search",dangerouslySetInnerHTML:{__html:g},"aria-hidden":"true"})),E=this.createDropdown(a,n,i,s,r,o,l);return y.default.createElement("div",null,y.default.createElement("nav",{className:"navbar navbar-default navbar-fixed-top",role:"navigation"},y.default.createElement("div",{className:"container-fluid theme"},y.default.createElement("div",{className:"navbar-header"},p,v,y.default.createElement(Ee.default,{ref:"headerOverlay",channel:a,showEditChannelHeaderModal:this.showEditChannelHeaderModal}),E))),d,u,c,f,m)}}]),t}(y.default.Component);t.default=be,be.defaultProps={teamDisplayName:""},be.propTypes={teamDisplayName:E.default.string}},2395:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(32),v=n(g),E=a(35),b=n(E),y=a(121),S=a(16),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(S),M=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.onListenerChange=a.onListenerChange.bind(a),a.state=(0,y.getCountsStateFromStores)(),a.mounted=!1,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){this.mounted=!0,v.default.addChangeListener(this.onListenerChange),b.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,v.default.removeChangeListener(this.onListenerChange),b.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){if(this.mounted){var e=(0,y.getCountsStateFromStores)();_.areObjectsEqual(e,this.state)||this.setState(e)}}},{key:"render",value:function(){return this.state.mentionCount?p.default.createElement("span",{className:"badge badge-notify"},this.state.mentionCount):this.state.messageCount?p.default.createElement("span",{className:"badge badge-notify"},"â€¢"):null}}]),t}(p.default.Component);t.default=M},2396:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,r.default)({},t,{showTeamSwitcher:!1})}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),r=n(i),o=a(31),l=a(2397),d=n(l);t.default=(0,o.connect)(s)(d.default)},2397:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(2),g=s(p),v=a(1),E=s(v),b=a(40),y=a(17),S=a(44),_=a(136),M=a(79),C=a(38),w=s(C),k=a(9),T=s(k),N=a(16),P=n(N),I=a(87),L=n(I),D=a(445),R=s(D),A=a(446),O=s(A),F=a(2398),x=s(F),U=a(2399),H=s(U),j=w.default.getState,G=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));return a.onChange=a.onChange.bind(a),a.onShow=a.onShow.bind(a),a.onHide=a.onHide.bind(a),a.onExited=a.onExited.bind(a),a.handleKeyDown=a.handleKeyDown.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.switchToChannel=a.switchToChannel.bind(a),a.switchMode=a.switchMode.bind(a),a.focusTextbox=a.focusTextbox.bind(a),a.enableChannelProvider=a.enableChannelProvider.bind(a),a.enableTeamProvider=a.enableTeamProvider.bind(a),a.channelProviders=[new x.default],a.teamProviders=[new H.default],a.state={text:"",mode:e.initialMode},a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidUpdate",value:function(e){this.props.show&&!e.show&&this.focusTextbox()}},{key:"componentWillReceiveProps",value:function(e){!this.props.show&&e.show&&this.setState({mode:e.initialMode,text:""})}},{key:"focusTextbox",value:function(){if(null!=this.refs.switchbox){var e=this.refs.switchbox.getTextbox();e.focus(),P.placeCaretAtEnd(e)}}},{key:"onShow",value:function(){this.setState({text:""})}},{key:"onHide",value:function(){this.setState({text:""}),this.props.onHide()}},{key:"onExited",value:function(){L.isMobile()||setTimeout(function(){document.querySelector("#post_textbox").focus()})}},{key:"onChange",value:function(e){this.setState({text:e.target.value})}},{key:"handleKeyDown",value:function(e){e.keyCode===T.default.KeyCodes.TAB&&(e.preventDefault(),this.switchMode())}},{key:"handleSubmit",value:function(e){var t=this,a=null;if(e)if("channel"===this.state.mode){var n=e.channel;n.type===T.default.DM_CHANNEL?(0,M.openDirectChannelToUser)(n.id,function(e){a=e,t.switchToChannel(a)},function(){a=null,t.switchToChannel(a)}):n.type===T.default.GM_CHANNEL?(a=(0,_.getChannel)(j(),n.id),this.switchToChannel(a)):this.switchToChannel(n)}else S.browserHistory.push("/"+e.name),this.onHide()}},{key:"switchToChannel",value:function(e){null!=e&&((0,M.goToChannel)(e),this.onHide())}},{key:"enableChannelProvider",value:function(){this.channelProviders[0].disableDispatches=!1,this.teamProviders[0].disableDispatches=!0}},{key:"enableTeamProvider",value:function(){this.teamProviders[0].disableDispatches=!1,this.channelProviders[0].disableDispatches=!0}},{key:"switchMode",value:function(){"channel"===this.state.mode&&this.props.showTeamSwitcher?(this.enableTeamProvider(),this.setState({mode:"team"})):"team"===this.state.mode&&(this.enableChannelProvider(),this.setState({mode:"channel"}))}},{key:"render",value:function(){var e=this,t=this.channelProviders,a=void 0,n=!0,s="quick_switch_modal.channelsShortcut.windows",i="CTRL+K";P.isMac()&&(s="quick_switch_modal.channelsShortcut.mac",i="CMD+K");var r="quick_switch_modal.teamsShortcut.windows",o="CTRL+ALT+K";if(P.isMac()&&(r="quick_switch_modal.teamsShortcut.mac",o="CMD+ALT+K"),this.props.showTeamSwitcher){var l="",d="";"team"===this.state.mode?(t=this.teamProviders,n=!1,d="active"):l="active",a=E.default.createElement("div",{className:"nav nav-tabs"},E.default.createElement("li",{className:l},E.default.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),e.enableChannelProvider(),e.setState({mode:"channel"}),e.focusTextbox()}},E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.channels",defaultMessage:"Channels"}),E.default.createElement("span",{className:"small"},E.default.createElement(y.FormattedMessage,{id:s,defaultMessage:i})))),E.default.createElement("li",{className:d},E.default.createElement("a",{href:"#",onClick:function(t){t.preventDefault(),e.enableTeamProvider(),e.setState({mode:"team"}),e.focusTextbox()}},E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.teams",defaultMessage:"Teams"}),E.default.createElement("span",{className:"small"},E.default.createElement(y.FormattedMessage,{id:r,defaultMessage:o})))))}var u=void 0;return u=P.isMobile()?E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.help_mobile",defaultMessage:"Type to find a channel."}):this.props.showTeamSwitcher?E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.help",defaultMessage:"Start typing then use TAB to toggle channels/teams, â†‘â†“ to browse, â†µ to select, and ESC to dismiss."}):E.default.createElement(y.FormattedMessage,{id:"quick_switch_modal.help_no_team",defaultMessage:"Type to find a channel. Use â†‘â†“ to browse, â†µ to select, ESC to dismiss."}),E.default.createElement(b.Modal,{dialogClassName:"channel-switch-modal modal--overflow",ref:"modal",show:this.props.show,onHide:this.onHide,onExited:this.onExited},E.default.createElement(b.Modal.Header,{closeButton:!0}),E.default.createElement(b.Modal.Body,null,a,E.default.createElement("div",{className:"modal__hint"},u),E.default.createElement(R.default,{ref:"switchbox",className:"form-control focused",type:"input",onChange:this.onChange,value:this.state.text,onKeyDown:this.handleKeyDown,onItemSelected:this.handleSubmit,listComponent:O.default,maxLength:"64",providers:t,listStyle:"bottom",completeOnTab:!1,renderDividers:n})))}}]),t}(E.default.PureComponent);G.propTypes={initialMode:g.default.string.isRequired,show:g.default.bool.isRequired,onHide:g.default.func.isRequired,showTeamSwitcher:g.default.bool},G.defaultProps={initialMode:"channel"},t.default=G},2398:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){if(e.type===U.Constants.MENTION_CHANNELS&&t.type===U.Constants.MENTION_MORE_CHANNELS)return-1;if(t.type===U.Constants.MENTION_CHANNELS&&e.type===U.Constants.MENTION_MORE_CHANNELS)return 1;var a=e.channel,n=t.channel,s=(0,x.getChannelDisplayName)(a).toLowerCase(),i=(0,x.getChannelDisplayName)(n).toLowerCase();a.type===U.Constants.DM_CHANNEL&&(s=s.substring(1)),n.type===U.Constants.DM_CHANNEL&&(i=i.substring(1));var r=s.startsWith(Y),o=i.startsWith(Y);return r&&o?(0,x.sortChannelsByDisplayName)(a,n):r||o?r?-1:1:(0,x.sortChannelsByDisplayName)(a,n)}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),r=n(i),o=a(48),l=n(o),d=a(76),u=n(d),c=a(77),f=n(c),m=a(41),h=n(m),p=a(6),g=n(p),v=a(4),E=n(v),b=a(5),y=n(b),S=a(7),_=n(S),M=a(8),C=n(M),w=a(1),k=n(w),T=a(29),N=a(26),P=a(136),I=a(64),L=a(120),D=a(50),R=a(34),A=n(R),O=a(38),F=n(O),x=a(121),U=a(9),H=a(16),j=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(H),G=a(239),B=n(G),V=a(182),z=n(V),q=F.default.getState,W=function(e){function t(){return(0,E.default)(this,t),(0,_.default)(this,(t.__proto__||(0,g.default)(t)).apply(this,arguments))}return(0,C.default)(t,e),(0,y.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isSelection,n=t.channel,s=U.Constants.GLOBE_ICON_SVG,i=U.Constants.LOCK_ICON_SVG,r="mentions__name";a&&(r+=" suggestion--selected");var o=n.display_name,l=null;return n.type===U.Constants.OPEN_CHANNEL?l=k.default.createElement("span",{className:"icon icon__globe icon--body",dangerouslySetInnerHTML:{__html:s}}):n.type===U.Constants.PRIVATE_CHANNEL?l=k.default.createElement("span",{className:"icon icon__lock icon--body",dangerouslySetInnerHTML:{__html:i}}):n.type===U.Constants.GM_CHANNEL?(o=(0,x.getChannelDisplayName)(n),l=k.default.createElement("div",{className:"status status--group"},"G")):l=k.default.createElement("div",{className:"pull-left"},k.default.createElement("img",{className:"mention__image",src:j.imageURLForUser(n)})),k.default.createElement("div",{onClick:this.handleClick,className:r},l,o)}}]),t}(z.default),Y="",K=function(t){function a(){return(0,E.default)(this,a),(0,_.default)(this,(a.__proto__||(0,g.default)(a)).apply(this,arguments))}return(0,C.default)(a,t),(0,y.default)(a,[{key:"handlePretextChanged",value:function(e,t){if(t){Y=t,this.startNewRequest(e,t);var a=(0,P.getChannelsInCurrentTeam)(q()).concat((0,P.getGroupChannels)(q())),n=(0,h.default)([],(0,D.searchProfiles)(q(),t,!0));return this.formatChannelsAndDispatch(t,e,a,n,!0),this.fetchUsersAndChannels(t,e),!0}return!1}},{key:"fetchUsersAndChannels",value:function(){function t(e,t){return a.apply(this,arguments)}var a=(0,f.default)(u.default.mark(function t(a,n){var s,i,r,o,l,d,c;return u.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return s="","team"===e.window.mm_config.RestrictDirectMessage&&(s=F.default.getState().entities.teams.currentTeamId),i=T.Client4.autocompleteUsers(a,s,""),r=T.Client4.searchChannels((0,L.getCurrentTeamId)(q()),a),o=[],l=[],t.prev=6,t.next=9,i;case 9:return o=t.sent,t.next=12,r;case 12:l=t.sent,t.next=18;break;case 15:t.prev=15,t.t0=t.catch(6),A.default.handleServerAction({type:U.ActionTypes.RECEIVED_ERROR,err:t.t0});case 18:if(!this.shouldCancelDispatch(a)){t.next=20;break}return t.abrupt("return");case 20:d=(0,h.default)([],(0,D.searchProfiles)(q(),a,!0),o.users),c=(0,P.getChannelsInCurrentTeam)(q()).concat((0,P.getGroupChannels)(q())).concat(l),this.formatChannelsAndDispatch(a,n,c,d);case 23:case"end":return t.stop()}},t,this,[[6,15]])}));return t}()},{key:"formatChannelsAndDispatch",value:function(e,t,a,n){var i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=[],d=(0,P.getMyChannelMemberships)(q());if(!this.shouldCancelDispatch(e)){var u=(0,D.getCurrentUserId)(q()),c={},f=!0,m=!1,p=void 0;try{for(var g,v=(0,l.default)((0,r.default)(a));!(f=(g=v.next()).done);f=!0){var E=g.value,b=a[E];if(!c[b.id]){var y=d[b.id];if(-1!==b.display_name.toLowerCase().indexOf(e.toLowerCase())){var S=(0,h.default)({},b),_={channel:S,name:S.name};if(S.type===U.Constants.GM_CHANNEL){S.name=(0,x.getChannelDisplayName)(S),_.name=S.name;if((0,I.getBool)(q(),N.Preferences.CATEGORY_GROUP_CHANNEL_SHOW,S.id,!1))_.type=U.Constants.MENTION_CHANNELS;else if(_.type=U.Constants.MENTION_MORE_CHANNELS,i)continue}else if(y)_.type=U.Constants.MENTION_CHANNELS;else if(_.type=U.Constants.MENTION_MORE_CHANNELS,i||!S.display_name.toLowerCase().startsWith(e))continue;c[b.id]=!0,o.push(_)}}}}catch(e){m=!0,p=e}finally{try{!f&&v.return&&v.return()}finally{if(m)throw p}}for(var M=0;M<n.length;M++){var C=n[M];if(!c[C.id]){var w=(0,I.getBool)(q(),N.Preferences.CATEGORY_DIRECT_CHANNEL_SHOW,C.id,!1),k="@"+C.username+" ";if(C.id!==u){(C.first_name||C.last_name)&&C.nickname?k+="- "+j.getFullName(C)+" ("+C.nickname+")":C.nickname?k+="- ("+C.nickname+")":(C.first_name||C.last_name)&&(k+="- "+j.getFullName(C));var T={channel:{display_name:k,name:C.username,id:C.id,update_at:C.update_at,type:U.Constants.DM_CHANNEL,last_picture_update:C.last_picture_update||0},name:C.username};if(w)T.type=U.Constants.MENTION_CHANNELS;else if(T.type=U.Constants.MENTION_MORE_CHANNELS,i)continue;c[C.id]=!0,o.push(T)}}}var L=o.sort(s).map(function(e){return e.channel.name});i&&o.push({type:U.Constants.MENTION_MORE_CHANNELS,loading:!0}),setTimeout(function(){A.default.handleServerAction({type:U.ActionTypes.SUGGESTION_RECEIVED_SUGGESTIONS,id:t,matchedPretext:e,terms:L,items:o,component:W})},0)}}}]),a}(B.default);t.default=K}).call(t,a(22))},2399:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a=e.display_name.toLowerCase(),n=t.display_name.toLowerCase(),s=a.startsWith(D),i=n.startsWith(D);if(s&&i){var r=_.default.getLocale();return a!==n?a.localeCompare(n,r,{numeric:!0}):e.name.localeCompare(t.name,r,{numeric:!0})}return s?-1:1}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=n(i),o=a(4),l=n(o),d=a(5),u=n(d),c=a(7),f=n(c),m=a(8),h=n(m),p=a(1),g=n(p),v=a(120),E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(v),b=a(34),y=n(b),S=a(211),_=n(S),M=a(38),C=n(M),w=a(9),k=a(239),T=n(k),N=a(182),P=n(N),I=C.default.getState,L=function(e){function t(){return(0,l.default)(this,t),(0,f.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,u.default)(t,[{key:"render",value:function(){var e=this.props,t=e.item,a=e.isSelection,n="mentions__name";return a&&(n+=" suggestion--selected"),g.default.createElement("div",{onClick:this.handleClick,className:n},g.default.createElement("div",{className:"status"},g.default.createElement("i",{className:"fa fa-group"})),t.display_name)}}]),t}(P.default),D="",R=function(e){function t(){return(0,l.default)(this,t),(0,f.default)(this,(t.__proto__||(0,r.default)(t)).apply(this,arguments))}return(0,h.default)(t,e),(0,u.default)(t,[{key:"handlePretextChanged",value:function(e,t){if(t){D=t,this.startNewRequest(e,t);var a=E.getMyTeams(I()),n=a.filter(function(e){return-1!==e.display_name.toLowerCase().indexOf(t)||-1!==e.name.indexOf(t)}),i=n.sort(s).map(function(e){return e.name});return setTimeout(function(){y.default.handleServerAction({type:w.ActionTypes.SUGGESTION_RECEIVED_SUGGESTIONS,id:e,matchedPretext:t,terms:i,items:n,component:L})},0),!0}return!1}}]),t}(T.default);t.default=R},2400:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(40),b=a(17),y=a(9),S=n(y),_=a(782),M=n(_),C=function(e){function t(){var e,a,n,s;(0,o.default)(this,t);for(var r=arguments.length,l=Array(r),d=0;d<r;d++)l[d]=arguments[d];return a=n=(0,c.default)(this,(e=t.__proto__||(0,i.default)(t)).call.apply(e,[this].concat(l))),n.showEditChannelHeaderModal=function(){n.refs.headerOverlay.hide(),n.props.showEditChannelHeaderModal()},n.hide=function(){n.refs.headerOverlay.hide()},s=a,(0,c.default)(n,s)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=null;if(this.props.channel)if(this.props.channel.header)e=v.default.createElement(M.default,{message:this.props.channel.header,options:{singleline:!0,mentionHighlight:!1}});else{var t=v.default.createElement("a",{href:"#",onClick:this.showEditChannelHeaderModal},v.default.createElement(b.FormattedMessage,{id:"navbar.click",defaultMessage:"Click here"}));e=v.default.createElement("div",null,v.default.createElement(b.FormattedMessage,{id:"navbar.noHeader",defaultMessage:"No channel header yet.{newline}{link} to add one.",values:{newline:v.default.createElement("br",null),link:t}}))}var a=v.default.createElement(E.Popover,{bsStyle:"info",placement:"bottom",id:"header-popover"},e,v.default.createElement("div",{className:"close visible-xs-block",onClick:this.hide},"Ã—"));return v.default.createElement(E.OverlayTrigger,{ref:"headerOverlay",trigger:"click",placement:"bottom",overlay:a,className:"description",rootClose:!0},v.default.createElement("div",{className:"navbar-toggle navbar-right__icon navbar-info-button pull-right"},v.default.createElement("span",{className:"icon icon__info",dangerouslySetInnerHTML:{__html:S.default.INFO_ICON_SVG},"aria-hidden":"true"})))}}]),t}(v.default.PureComponent);C.propTypes={channel:p.default.object,showEditChannelHeaderModal:p.default.func.isRequired},t.default=C},2401:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(1),v=n(g),E=a(47),b=n(E),y=a(17),S=a(44),_=a(135),M=n(_),C=a(32),w=n(C),k=a(35),T=n(k),N=a(25),P=n(N),I=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleShow=a.handleShow.bind(a),a.handleClose=a.handleClose.bind(a),a.state={channelName:"",remover:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleShow",value:function(){var e={};M.default.getItem("channel-removed-state")&&(e=M.default.getItem("channel-removed-state"),M.default.removeItem("channel-removed-state"));var t=w.default.getByName("town-square");setTimeout(function(){S.browserHistory.push(T.default.getCurrentTeamRelativeUrl()+"/channels/"+t.name)},1),this.setState(e)}},{key:"handleClose",value:function(){this.setState({channelName:"",remover:""})}},{key:"componentDidMount",value:function(){(0,p.default)(b.default.findDOMNode(this)).on("show.bs.modal",this.handleShow),(0,p.default)(b.default.findDOMNode(this)).on("hidden.bs.modal",this.handleClose)}},{key:"componentWillUnmount",value:function(){(0,p.default)(b.default.findDOMNode(this)).off("show.bs.modal",this.handleShow),(0,p.default)(b.default.findDOMNode(this)).off("hidden.bs.modal",this.handleClose)}},{key:"render",value:function(){var e=P.default.getCurrentUser(),t=v.default.createElement(y.FormattedMessage,{id:"removed_channel.channelName",defaultMessage:"the channel"});this.state.channelName&&(t=this.state.channelName);var a=v.default.createElement(y.FormattedMessage,{id:"removed_channel.someone",defaultMessage:"Someone"});return this.state.remover&&(a=this.state.remover),null!=e?v.default.createElement("div",{className:"modal fade",ref:"modal",id:"removed_from_channel",tabIndex:"-1",role:"dialog","aria-hidden":"true"},v.default.createElement("div",{className:"modal-dialog"},v.default.createElement("div",{className:"modal-content"},v.default.createElement("div",{className:"modal-header"},v.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},v.default.createElement("span",{"aria-hidden":"true"},"Ã—")),v.default.createElement("h4",{className:"modal-title"},v.default.createElement(y.FormattedMessage,{id:"removed_channel.from",defaultMessage:"Removed from "}),v.default.createElement("span",{className:"name"},t))),v.default.createElement("div",{className:"modal-body"},v.default.createElement("p",null,v.default.createElement(y.FormattedMessage,{id:"removed_channel.remover",defaultMessage:"{remover} removed you from {channel}",values:{remover:a,channel:t}}))),v.default.createElement("div",{className:"modal-footer"},v.default.createElement("button",{type:"button",className:"btn btn-primary","data-dismiss":"modal"},v.default.createElement(y.FormattedMessage,{id:"removed_channel.okay",defaultMessage:"Okay"})))))):v.default.createElement("div",null)}}]),t}(v.default.Component);t.default=I},2402:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a=e.entities.users.currentUserId;return(0,o.default)({},t,{autoResetPref:(0,m.get)(e,f.Preferences.CATEGORY_AUTO_RESET_MANUAL_STATUS,a,"")})}function i(e){return{actions:(0,d.bindActionCreators)({autoResetStatus:h.autoResetStatus,setStatus:c.setStatus,savePreferences:u.savePreferences},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(210),c=a(61),f=a(26),m=a(64),h=a(69),p=a(2403),g=n(p);t.default=(0,l.connect)(s,i)(g.default)},2403:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(19),i=n(s),r=a(6),o=n(r),l=a(4),d=n(l),u=a(5),c=n(u),f=a(7),m=n(f),h=a(8),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(17),S=a(26),_=a(16),M=a(311),C=n(M),w=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.onConfirm=function(e){a.setState({show:!1});var t=(0,i.default)({},a.state.currentUserStatus);if(t.status="online",a.props.actions.setStatus(t),e){var n={category:S.Preferences.CATEGORY_AUTO_RESET_MANUAL_STATUS,user_id:t.user_id,name:t.user_id,value:"true"};a.props.actions.savePreferences(n.user_id,[n])}},a.onCancel=function(e){if(a.setState({show:!1}),e){var t=(0,i.default)({},a.state.currentUserStatus),n={category:S.Preferences.CATEGORY_AUTO_RESET_MANUAL_STATUS,user_id:t.user_id,name:t.user_id,value:"false"};a.props.actions.savePreferences(n.user_id,[n])}},a.state={show:!1,currentUserStatus:{}},a}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentDidMount",value:function(){var e=this;this.props.actions.autoResetStatus().then(function(t){var a=t.manual,n=""===e.props.autoResetPref;e.setState({currentUserStatus:t,show:Boolean(a&&n)})})}},{key:"render",value:function(){var e=(0,_.toTitleCase)(this.state.currentUserStatus.status||""),t=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.title",defaultMessage:'Your status is set to "{status}"',values:{status:e}}),a=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.message",defaultMessage:'Would you like to switch your status to "Online"?'}),n=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.button",defaultMessage:'Yes, set my status to "Online"'}),s=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.cancel",defaultMessage:'No, keep it as "{status}"',values:{status:e}}),i=b.default.createElement(y.FormattedMessage,{id:"modal.manaul_status.ask",defaultMessage:"Do not ask me again"});return b.default.createElement(C.default,{show:this.state.show,title:t,message:a,confirmButtonText:n,onConfirm:this.onConfirm,cancelButtonText:s,onCancel:this.onCancel,showCheckbox:!0,checkboxText:i})}}]),t}(b.default.PureComponent);w.propTypes={autoResetPref:v.default.string,actions:v.default.shape({autoResetStatus:v.default.func.isRequired,setStatus:v.default.func.isRequired,savePreferences:v.default.func.isRequired}).isRequired},t.default=w},2404:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){if(!e)return null;var t=e.split("\t"),a=y.default.createElement("span",null,t[0]),n=null;return t.length>1&&(n=t[1].split("|").map(function(e){return y.default.createElement("span",{className:"shortcut-key",key:e},e)})),y.default.createElement("div",{className:"shortcut-line"},a,n)}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),r=n(i),o=a(6),l=n(o),d=a(4),u=n(d),c=a(5),f=n(c),m=a(7),h=n(m),p=a(8),g=n(p),v=a(2),E=n(v),b=a(1),y=n(b),S=a(40),_=a(17),M=a(2080),C=n(M),w=a(9),k=n(w),T=(0,_.defineMessages)({mainHeader:{default:{id:"shortcuts.header",defaultMessage:"Keyboard Shortcuts\tCtrl|/"},mac:{id:"shortcuts.header.mac",defaultMessage:"Keyboard Shortcuts\tâŒ˜|/"}},navHeader:{id:"shortcuts.nav.header",defaultMessage:"Navigation"},navPrev:{default:{id:"shortcuts.nav.prev",defaultMessage:"Previous channel:\tAlt|Up"},mac:{id:"shortcuts.nav.prev.mac",defaultMessage:"Previous channel:\tâŒ¥|Up"}},navNext:{default:{id:"shortcuts.nav.next",defaultMessage:"Next channel:\tAlt|Down"},mac:{id:"shortcuts.nav.next.mac",defaultMessage:"Next channel:\tâŒ¥|Down"}},navUnreadPrev:{default:{id:"shortcuts.nav.unread_prev",defaultMessage:"Previous unread channel:\tAlt|Shift|Up"},mac:{id:"shortcuts.nav.unread_prev.mac",defaultMessage:"Previous unread channel:\tâŒ¥|Shift|Up"}},navUnreadNext:{default:{id:"shortcuts.nav.unread_next",defaultMessage:"Next unread channel:\tAlt|Shift|Down"},mac:{id:"shortcuts.nav.unread_next.mac",defaultMessage:"Next unread channel:\tâŒ¥|Shift|Down"}},navSwitcher:{default:{id:"shortcuts.nav.switcher",defaultMessage:"Quick channel switcher:\tCtrl|K"},mac:{id:"shortcuts.nav.switcher.mac",defaultMessage:"Quick channel switcher:\tâŒ˜|K"}},navDMMenu:{default:{id:"shortcuts.nav.direct_messages_menu",defaultMessage:"Direct messages menu:\tCtrl|Shift|K"},mac:{id:"shortcuts.nav.direct_messages_menu.mac",defaultMessage:"Direct messages menu:\tâŒ˜|Shift|K"}},navSettings:{default:{id:"shortcuts.nav.settings",defaultMessage:"Account settings:\tCtrl|Shift|A"},mac:{id:"shortcuts.nav.settings.mac",defaultMessage:"Account settings:\tâŒ˜|Shift|A"}},navMentions:{default:{id:"shortcuts.nav.recent_mentions",defaultMessage:"Recent mentions:\tCtrl|Shift|M"},mac:{id:"shortcuts.nav.recent_mentions.mac",defaultMessage:"Recent mentions:\tâŒ˜|Shift|M"}},msgHeader:{id:"shortcuts.msgs.header",defaultMessage:"Messages"},msgInputHeader:{id:"shortcuts.msgs.input.header",defaultMessage:"Works inside an empty input field"},msgEdit:{id:"shortcuts.msgs.edit",defaultMessage:"Edit last message in channel:\tUp"},msgReply:{id:"shortcuts.msgs.reply",defaultMessage:"Reply to last message in channel:\tShift|Up"},msgReprintPrev:{default:{id:"shortcuts.msgs.reprint_prev",defaultMessage:"Reprint previous message:\tCtrl|Up"},mac:{id:"shortcuts.msgs.reprint_prev.mac",defaultMessage:"Reprint previous message:\tâŒ˜|Up"}},msgReprintNext:{default:{id:"shortcuts.msgs.reprint_next",defaultMessage:"Reprint next message:\tCtrl|Down"},mac:{id:"shortcuts.msgs.reprint_next.mac",defaultMessage:"Reprint next message:\tâŒ˜|Down"}},msgCompHeader:{id:"shortcuts.msgs.comp.header",defaultMessage:"Autocomplete"},msgCompUsername:{id:"shortcuts.msgs.comp.username",defaultMessage:"Username:\t@|[a-z]|Tab"},msgCompChannel:{id:"shortcuts.msgs.comp.channel",defaultMessage:"Channel:\t~|[a-z]|Tab"},msgCompEmoji:{id:"shortcuts.msgs.comp.emoji",defaultMessage:"Emoji:\t:|[a-z]|Tab"},filesHeader:{id:"shortcuts.files.header",defaultMessage:"Files"},filesUpload:{default:{id:"shortcuts.files.upload",defaultMessage:"Upload files:\tCtrl|U"},mac:{id:"shortcuts.files.upload.mac",defaultMessage:"Upload files:\tâŒ˜|U"}},browserHeader:{id:"shortcuts.browser.header",defaultMessage:"Built-in Browser Commands"},browserChannelPrev:{default:{id:"shortcuts.browser.channel_prev",defaultMessage:"Back in history:\tAlt|Left"},mac:{id:"shortcuts.browser.channel_prev.mac",defaultMessage:"Back in history:\tâŒ˜|["}},browserChannelNext:{default:{id:"shortcuts.browser.channel_next",defaultMessage:"Forward in history:\tAlt|Right"},mac:{id:"shortcuts.browser.channel_next.mac",defaultMessage:"Forward in history:\tâŒ˜|]"}},browserFontIncrease:{default:{id:"shortcuts.browser.font_increase",defaultMessage:"Zoom in:\tCtrl|+"},mac:{id:"shortcuts.browser.font_increase.mac",defaultMessage:"Zoom in:\tâŒ˜|+"}},browserFontDecrease:{default:{id:"shortcuts.browser.font_decrease",defaultMessage:"Zoom out:\tCtrl|-"},mac:{id:"shortcuts.browser.font_decrease.mac",defaultMessage:"Zoom out:\tâŒ˜|-"}},browserInputHeader:{id:"shortcuts.browser.input.header",defaultMessage:"Works inside an input field"},browserHighlightPrev:{id:"shortcuts.browser.highlight_prev",defaultMessage:"Highlight text to the previous line:\tShift|Up"},browserHighlightNext:{id:"shortcuts.browser.highlight_next",defaultMessage:"Highlight text to the next line:\tShift|Down"},browserNewline:{id:"shortcuts.browser.newline",defaultMessage:"Create a new line:\tShift|Enter"},info:{id:"shortcuts.info",defaultMessage:"Begin a message with / for a list of all the commands at your disposal."}}),N=function(e){function t(e){(0,u.default)(this,t);var a=(0,h.default)(this,(t.__proto__||(0,l.default)(t)).call(this,e));return a.handleToggle=function(e){a.setState({show:e})},a.handleHide=function(){a.setState({show:!1})},a.state={show:!1},a}return(0,g.default)(t,e),(0,f.default)(t,[{key:"componentDidMount",value:function(){C.default.addModalListener(k.default.ActionTypes.TOGGLE_SHORTCUTS_MODAL,this.handleToggle)}},{key:"componentWillUnmount",value:function(){C.default.removeModalListener(k.default.ActionTypes.TOGGLE_SHORTCUTS_MODAL,this.handleToggle)}},{key:"getShortcuts",value:function(){var e=this.props.isMac,t={};return(0,r.default)(T).forEach(function(a){e&&T[a].mac?t[a]=T[a].mac:!e&&T[a].default?t[a]=T[a].default:t[a]=T[a]}),t}},{key:"render",value:function(){var e=this.getShortcuts(),t=this.props.intl.formatMessage;return y.default.createElement(S.Modal,{dialogClassName:"shortcuts-modal",show:this.state.show,onHide:this.handleHide,onExited:this.handleHide},y.default.createElement("div",{className:"shortcuts-content"},y.default.createElement(S.Modal.Header,{closeButton:!0},y.default.createElement(S.Modal.Title,null,y.default.createElement("strong",null,s(t(e.mainHeader))))),y.default.createElement(S.Modal.Body,{ref:"modalBody"},y.default.createElement("div",{className:"row"},y.default.createElement("div",{className:"col-sm-4"},y.default.createElement("div",{className:"section"},y.default.createElement("div",null,y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.navHeader))),s(t(e.navPrev)),s(t(e.navNext)),s(t(e.navUnreadPrev)),s(t(e.navUnreadNext)),s(t(e.navSwitcher)),s(t(e.navDMMenu)),s(t(e.navSettings)),s(t(e.navMentions))))),y.default.createElement("div",{className:"col-sm-4"},y.default.createElement("div",{className:"section"},y.default.createElement("div",null,y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.msgHeader))),y.default.createElement("span",null,y.default.createElement("strong",null,t(e.msgInputHeader))),y.default.createElement("div",{className:"subsection"},s(t(e.msgEdit)),s(t(e.msgReply)),s(t(e.msgReprintPrev)),s(t(e.msgReprintNext))),y.default.createElement("span",null,y.default.createElement("strong",null,t(e.msgCompHeader))),y.default.createElement("div",{className:"subsection"},s(t(e.msgCompUsername)),s(t(e.msgCompChannel)),s(t(e.msgCompEmoji)))))),y.default.createElement("div",{className:"col-sm-4"},y.default.createElement("div",{className:"section"},y.default.createElement("div",null,y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.filesHeader))),s(t(e.filesUpload))),y.default.createElement("div",{className:"section--lower"},y.default.createElement("h4",{className:"section-title"},y.default.createElement("strong",null,t(e.browserHeader))),s(t(e.browserChannelPrev)),s(t(e.browserChannelNext)),s(t(e.browserFontIncrease)),s(t(e.browserFontDecrease)),y.default.createElement("span",null,y.default.createElement("strong",null,t(e.browserInputHeader))),y.default.createElement("div",{className:"subsection"},s(t(e.browserHighlightPrev)),s(t(e.browserHighlightNext)),s(t(e.browserNewline))))))),y.default.createElement("div",{className:"info__label"},t(e.info)))))}}]),t}(y.default.PureComponent);N.propTypes={intl:_.intlShape.isRequired,isMac:E.default.bool.isRequired},t.default=(0,_.injectIntl)(N)},2405:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,r.default)({},t,{postRightVisible:Boolean(e.views.rhs.selectedPostId),fromSearch:e.views.rhs.fromSearch,fromFlaggedPosts:e.views.rhs.fromFlaggedPosts,fromPinnedPosts:e.views.rhs.fromPinnedPosts})}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),r=n(i),o=a(31),l=a(2406),d=n(l);t.default=(0,o.connect)(s)(d.default)},2406:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(237),S=a(56),_=a(73),M=a(312),C=n(M),w=a(119),k=n(w),T=a(313),N=n(T),P=a(25),I=n(P),L=a(436),D=n(L),R=a(9),A=n(R),O=a(16),F=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(O),x=a(2095),U=n(x),H=a(2407),j=n(H),G=a(753),B=n(G),V=a(2432),z=n(V),q=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.plScrolledToBottom=!0,a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onPostPinnedChange=a.onPostPinnedChange.bind(a),a.onSearchChange=a.onSearchChange.bind(a),a.onUserChange=a.onUserChange.bind(a),a.onShowSearch=a.onShowSearch.bind(a),a.onShrink=a.onShrink.bind(a),a.toggleSize=a.toggleSize.bind(a),a.doStrangeThings=a.doStrangeThings.bind(a),a.state={searchVisible:null!==N.default.getSearchResults(),isMentionSearch:N.default.getIsMentionSearch(),isFlaggedPosts:N.default.getIsFlaggedPosts(),isPinnedPosts:N.default.getIsPinnedPosts(),expanded:!1,fromSearch:!1,currentUser:I.default.getCurrentUser(),useMilitaryTime:k.default.getBool(A.default.Preferences.CATEGORY_DISPLAY_SETTINGS,A.default.Preferences.USE_MILITARY_TIME,!1)},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){N.default.addSearchChangeListener(this.onSearchChange),C.default.addPostPinnedChangeListener(this.onPostPinnedChange),N.default.addShowSearchListener(this.onShowSearch),I.default.addChangeListener(this.onUserChange),k.default.addChangeListener(this.onPreferenceChange),this.doStrangeThings()}},{key:"componentWillUnmount",value:function(){N.default.removeSearchChangeListener(this.onSearchChange),C.default.removePostPinnedChangeListener(this.onPostPinnedChange),N.default.removeShowSearchListener(this.onShowSearch),I.default.removeChangeListener(this.onUserChange),k.default.removeChangeListener(this.onPreferenceChange)}},{key:"shouldComponentUpdate",value:function(e,t){return!F.areObjectsEqual(t,this.state)||this.props.postRightVisible!==e.postRightVisible}},{key:"componentWillUpdate",value:function(e,t){var a=this.state.searchVisible||this.props.postRightVisible,n=t.searchVisible||e.postRightVisible;!a&&n&&(0,y.trackEvent)("ui","ui_rhs_opened"),!a&&n&&this.setState({expanded:!1})}},{key:"doStrangeThings",value:function(){return(0,p.default)(".app__body .inner-wrap").removeClass(".move--right"),(0,p.default)(".app__body .inner-wrap").addClass("move--left"),(0,p.default)(".app__body .sidebar--left").removeClass("move--right"),(0,p.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,p.default)(".app__body .sidebar--right").addClass("move--left"),this.state.searchVisible||this.props.postRightVisible?null:((0,p.default)(".app__body .inner-wrap").removeClass("move--left").removeClass("move--right"),(0,p.default)(".app__body .sidebar--right").removeClass("move--left"),b.default.createElement("div",null))}},{key:"componentDidUpdate",value:function(e,t){var a=this.state.searchVisible||this.props.postRightVisible;D.default.emitRhsChanged(a),this.doStrangeThings();var n=t.searchVisible||e.postRightVisible;a&&!n&&setTimeout(function(){return(0,S.postListScrollChange)()},0)}},{key:"onPreferenceChange",value:function(){this.state.isFlaggedPosts&&(0,_.getFlaggedPosts)(),this.setState({useMilitaryTime:k.default.getBool(A.default.Preferences.CATEGORY_DISPLAY_SETTINGS,A.default.Preferences.USE_MILITARY_TIME,!1)})}},{key:"onPostPinnedChange",value:function(){this.props.channel&&this.state.isPinnedPosts&&(0,_.getPinnedPosts)(this.props.channel.id)}},{key:"onShrink",value:function(){this.setState({expanded:!1})}},{key:"onSearchChange",value:function(){this.setState({searchVisible:null!==N.default.getSearchResults()||N.default.isLoading(),isMentionSearch:N.default.getIsMentionSearch(),isFlaggedPosts:N.default.getIsFlaggedPosts(),isPinnedPosts:N.default.getIsPinnedPosts()})}},{key:"onUserChange",value:function(){this.setState({currentUser:I.default.getCurrentUser()})}},{key:"onShowSearch",value:function(){this.state.searchVisible||this.setState({searchVisible:!0})}},{key:"toggleSize",value:function(){this.setState({expanded:!this.state.expanded})}},{key:"render",value:function(){var e=null,t="";this.state.expanded&&(t="sidebar--right--expanded");var a=I.default.getCurrentId(),n=null;a&&(n=b.default.createElement(B.default,{isFocus:this.state.searchVisible&&F.isMobile()}));var s=this.props.channel,i="";return s&&(i=s.type===A.default.DM_CHANNEL||s.type===A.default.GM_CHANNEL?F.localizeMessage("rhs_root.direct","Direct Message"):s.display_name),this.state.searchVisible?e=b.default.createElement("div",{className:"sidebar--right__content"},b.default.createElement("div",{className:"search-bar__container channel-header alt"},n),b.default.createElement(z.default,{isMentionSearch:this.state.isMentionSearch,isFlaggedPosts:this.state.isFlaggedPosts,isPinnedPosts:this.state.isPinnedPosts,useMilitaryTime:this.state.useMilitaryTime,toggleSize:this.toggleSize,shrink:this.onShrink,channelDisplayName:i})):this.props.postRightVisible&&(e=b.default.createElement("div",{className:"post-right__container"},b.default.createElement(U.default,{overlayType:"right"}),b.default.createElement("div",{className:"search-bar__container channel-header alt"},n),b.default.createElement(j.default,{fromFlaggedPosts:this.props.fromFlaggedPosts,fromSearch:this.props.fromSearch,fromPinnedPosts:this.props.fromPinnedPosts,isWebrtc:D.default.isBusy(),isMentionSearch:this.state.isMentionSearch,currentUser:this.state.currentUser,useMilitaryTime:this.state.useMilitaryTime,toggleSize:this.toggleSize,shrink:this.onShrink}))),e||(t=""),b.default.createElement("div",{className:"sidebar--right "+t,id:"sidebar-right"},b.default.createElement("div",{onClick:this.onShrink,className:"sidebar--right__bg"}),b.default.createElement("div",{className:"sidebar-right-container"},e))}}]),t}(b.default.Component);q.propTypes={channel:v.default.object,postRightVisible:v.default.bool,fromSearch:v.default.string,fromFlaggedPosts:v.default.bool,fromPinnedPosts:v.default.bool},t.default=q},2407:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(){var e=(0,u.makeGetPostsForThread)();return function(t,a){var n=(0,h.getSelectedPost)(t),s=[];return n&&(s=e(t,{rootId:n.id,channelId:n.channel_id})),(0,o.default)({},a,{selected:n,posts:s,previewCollapsed:(0,c.get)(t,m.Preferences.CATEGORY_DISPLAY_SETTINGS,m.Preferences.COLLAPSE_DISPLAY,"false"),previewEnabled:(0,c.getBool)(t,m.Preferences.CATEGORY_DISPLAY_SETTINGS,m.Preferences.LINK_PREVIEW_DISPLAY,!0)})}}function i(e){return{actions:(0,d.bindActionCreators)({removePost:f.removePost},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(138),c=a(64),f=a(106),m=a(9),h=a(2408),p=a(2409),g=n(p);t.default=(0,l.connect)(s,i)(g.default)},2408:function(e,t,a){"use strict";function n(e){return e.views.rhs.selectedPostId}function s(e){return e.views.rhs.selectedPostChannelId}function i(e){return e.entities.posts.posts[e.views.rhs.selectedPostId]}Object.defineProperty(t,"__esModule",{value:!0}),t.getSelectedPost=void 0,t.getSelectedPostId=n;var r=a(88),o=a(50),l=a(9),d=a(16);t.getSelectedPost=(0,r.createSelector)(n,i,s,o.getCurrentUserId,function(e,t,a,n){return t||{id:e,exists:!1,type:l.PostTypes.FAKE_PARENT_DELETED,message:(0,d.localizeMessage)("rhs_thread.rootPostDeletedMessage.body","Part of this thread has been deleted due to a data retention policy. You can no longer reply to this thread."),channel_id:a,user_id:n}})},2409:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){return N.default.createElement("div",(0,_.default)({},e,{className:"scrollbar--view"}))}function i(e){return N.default.createElement("div",(0,_.default)({},e,{className:"scrollbar--horizontal"}))}function r(e){return N.default.createElement("div",(0,_.default)({},e,{className:"scrollbar--vertical"}))}Object.defineProperty(t,"__esModule",{value:!0});var o=a(41),l=n(o),d=a(155),u=n(d),c=a(6),f=n(c),m=a(4),h=n(m),p=a(5),g=n(p),v=a(7),E=n(v),b=a(8),y=n(b),S=a(19),_=n(S);t.renderView=s,t.renderThumbHorizontal=i,t.renderThumbVertical=r;var M=a(0),C=n(M),w=a(2),k=n(w),T=a(1),N=n(T),P=a(2410),I=n(P),L=a(119),D=n(L),R=a(25),A=n(R),O=a(436),F=n(O),x=a(9),U=n(x),H=a(319),j=n(H),G=a(16),B=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(G),V=a(2426),z=n(V),q=a(2428),W=n(q),Y=a(787),K=n(Y),J=a(2429),X=n(J),Q=a(2430),Z=n(Q),$=a(2431),ee=n($),te=U.default.Preferences,ae=function(e){function t(e){(0,h.default)(this,t);var a=(0,E.default)(this,(t.__proto__||(0,f.default)(t)).call(this,e));a.getSidebarBody=function(){return a.refs.sidebarbody},a.mounted=!1,a.onUserChange=a.onUserChange.bind(a),a.forceUpdateInfo=a.forceUpdateInfo.bind(a),a.onPreferenceChange=a.onPreferenceChange.bind(a),a.onStatusChange=a.onStatusChange.bind(a),a.onBusy=a.onBusy.bind(a),a.handleResize=a.handleResize.bind(a),a.handleScroll=a.handleScroll.bind(a),a.handleScrollStop=a.handleScrollStop.bind(a),a.scrollStopAction=new j.default(a.handleScrollStop);var n=(new Date).getTime(),s={};return s.windowWidth=B.windowWidth(),s.windowHeight=B.windowHeight(),s.profiles=JSON.parse((0,u.default)(A.default.getProfiles())),s.compactDisplay=D.default.get(te.CATEGORY_DISPLAY_SETTINGS,te.MESSAGE_DISPLAY,te.MESSAGE_DISPLAY_DEFAULT)===te.MESSAGE_DISPLAY_COMPACT,s.flaggedPosts=D.default.getCategory(U.default.Preferences.CATEGORY_FLAGGED_POST),s.statuses=(0,l.default)({},A.default.getStatuses()),s.previewsCollapsed=D.default.get(te.CATEGORY_DISPLAY_SETTINGS,te.COLLAPSE_DISPLAY,"false"),s.isBusy=F.default.isBusy(),a.state=(0,_.default)({},s,{isScrolling:!1,topRhsPostCreateAt:0,openTime:n}),a}return(0,y.default)(t,e),(0,g.default)(t,[{key:"componentDidMount",value:function(){D.default.addChangeListener(this.onPreferenceChange),A.default.addChangeListener(this.onUserChange),A.default.addStatusesChangeListener(this.onStatusChange),F.default.addBusyListener(this.onBusy),this.scrollToBottom(),window.addEventListener("resize",this.handleResize),this.mounted=!0}},{key:"componentWillUnmount",value:function(){D.default.removeChangeListener(this.onPreferenceChange),A.default.removeChangeListener(this.onUserChange),A.default.removeStatusesChangeListener(this.onStatusChange),F.default.removeBusyListener(this.onBusy),window.removeEventListener("resize",this.handleResize),this.mounted=!1}},{key:"componentDidUpdate",value:function(e){var t=e.posts||[],a=this.props.posts||[];if(!(t.length>=a.length)){a[a.length-1].user_id===A.default.getCurrentId()&&this.scrollToBottom()}}},{key:"shouldComponentUpdate",value:function(e,t){return!B.areObjectsEqual(t.statuses,this.state.statuses)||(!B.areObjectsEqual(t.postsArray,this.props.posts)||(!B.areObjectsEqual(t.selected,this.props.selected)||(t.compactDisplay!==this.state.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(t.previewsCollapsed!==this.state.previewsCollapsed||(e.previewEnabled!==this.props.previewEnabled||(!B.areObjectsEqual(t.flaggedPosts,this.state.flaggedPosts)||(!B.areObjectsEqual(t.profiles,this.state.profiles)||(!B.areObjectsEqual(e.currentUser,this.props.currentUser)||(t.isBusy!==this.state.isBusy||(t.isScrolling!==this.state.isScrolling||(t.topRhsPostCreateAt!==this.state.topRhsPostCreateAt||e.previewCollapsed!==this.props.previewCollapsed))))))))))))}},{key:"forceUpdateInfo",value:function(){if(this.state.postList)for(var e in this.state.postList.posts)this.refs[e]&&this.refs[e].forceUpdate()}},{key:"handleResize",value:function(){this.setState({windowWidth:B.windowWidth(),windowHeight:B.windowHeight()})}},{key:"componentWillReceiveProps",value:function(e){this.props.selected&&e.selected&&this.props.selected.id!==e.selected.id&&this.setState({openTime:(new Date).getTime()})}},{key:"onPreferenceChange",value:function(e){var t="";e===te.CATEGORY_DISPLAY_SETTINGS&&(t="_"+B.generateId()),this.setState({compactDisplay:D.default.get(te.CATEGORY_DISPLAY_SETTINGS,te.MESSAGE_DISPLAY,te.MESSAGE_DISPLAY_DEFAULT)===te.MESSAGE_DISPLAY_COMPACT,flaggedPosts:D.default.getCategory(U.default.Preferences.CATEGORY_FLAGGED_POST),previewsCollapsed:D.default.get(te.CATEGORY_DISPLAY_SETTINGS,te.COLLAPSE_DISPLAY,"false")+t}),this.forceUpdateInfo()}},{key:"onStatusChange",value:function(){this.setState({statuses:(0,l.default)({},A.default.getStatuses())})}},{key:"onBusy",value:function(e){this.setState({isBusy:e})}},{key:"filterPosts",value:function(e,t,a){var n=[];return e.forEach(function(e){"system_ephemeral"===e.type&&e.create_at<a||e.root_id===t.id&&n.unshift(e)}),n}},{key:"onUserChange",value:function(){var e=JSON.parse((0,u.default)(A.default.getProfiles()));this.setState({profiles:e})}},{key:"scrollToBottom",value:function(){(0,C.default)(".post-right__scroll")[0]&&(0,C.default)(".post-right__scroll").parent().scrollTop((0,C.default)(".post-right__scroll")[0].scrollHeight)}},{key:"updateFloatingTimestamp",value:function(){if(B.isMobile()&&this.props.posts){for(var e=this.refs.rhspostlist.childNodes,t=this.refs.rhspostlist.getBoundingClientRect(),a=0,n=0;n<e.length;n++)if(e[n].offsetTop+t.top-100>0){a=this.props.posts[n].create_at;break}a!==this.state.topRhsPostCreateAt&&this.setState({topRhsPostCreateAt:a})}}},{key:"handleScroll",value:function(){this.updateFloatingTimestamp(),this.state.isScrolling||this.setState({isScrolling:!0}),this.scrollStopAction.fireAfter(U.default.SCROLL_DELAY)}},{key:"handleScrollStop",value:function(){this.setState({isScrolling:!1})}},{key:"render",value:function(){if(null==this.props.posts||null==this.props.selected)return N.default.createElement("div",null);var e=this.filterPosts(this.props.posts,this.props.selected,this.state.openTime),t=this.props.selected,a=this.state.profiles||{},n=void 0;n=A.default.getCurrentId()===t.user_id?this.props.currentUser:a[t.user_id];var o=!1;this.state.flaggedPosts&&(o=null!=this.state.flaggedPosts.get(t.id));var l="offline";this.state.statuses&&(l=this.state.statuses[t.user_id]||"offline");var d=t.create_at;d||(d=this.props.posts[0].create_at);for(var u=B.getDateForUnixTicks(d),c=u,f=[],m=e.length,h=0;h<m;h++){var p=e[h],g=void 0;g=A.default.getCurrentId()===p.user_id?A.default.getCurrentUser():a[p.user_id];var v=!1;this.state.flaggedPosts&&(v=null!=this.state.flaggedPosts.get(p.id));var E="offline";this.state.statuses&&g&&g.id&&(E=this.state.statuses[g.id]||"offline");var b=B.getDateForUnixTicks(p.create_at);b.toDateString()!==c.toDateString()&&(c=b,f.push(N.default.createElement(W.default,{date:b})));var y=p.id?p.id:p.pending_post_id,S=m-h-1;f.push(N.default.createElement("div",{key:y+"commentKey"},N.default.createElement(X.default,{ref:p.id,post:p,lastPostCount:S>=0&&S<U.default.TEST_ID_COUNT?S:-1,user:g,currentUser:this.props.currentUser,compactDisplay:this.state.compactDisplay,useMilitaryTime:this.props.useMilitaryTime,isFlagged:v,status:E,isBusy:this.state.isBusy,removePost:this.props.actions.removePost,previewCollapsed:this.props.previewCollapsed})))}var _=void 0;return t.type!==U.default.PostTypes.FAKE_PARENT_DELETED&&(_=N.default.createElement("div",{className:"post-create__container"},N.default.createElement(z.default,{channelId:t.channel_id,rootId:t.id,latestPostId:m>0?e[m-1].id:t.id,getSidebarBody:this.getSidebarBody}))),N.default.createElement("div",{className:"sidebar-right__body",ref:"sidebarbody"},N.default.createElement(K.default,{isScrolling:this.state.isScrolling,isMobile:B.isMobile(),createAt:this.state.topRhsPostCreateAt,isRhsPost:!0}),N.default.createElement(Z.default,{fromFlaggedPosts:this.props.fromFlaggedPosts,fromSearch:this.props.fromSearch,fromPinnedPosts:this.props.fromPinnedPosts,isWebrtc:this.props.isWebrtc,isMentionSearch:this.props.isMentionSearch,toggleSize:this.props.toggleSize,shrink:this.props.shrink}),N.default.createElement(I.default,{autoHide:!0,autoHideTimeout:500,autoHideDuration:500,renderThumbHorizontal:i,renderThumbVertical:r,renderView:s,onScroll:this.handleScroll},N.default.createElement("div",{className:"post-right__scroll"},N.default.createElement(W.default,{date:u}),N.default.createElement(ee.default,{ref:t.id,post:t,commentCount:m,user:n,currentUser:this.props.currentUser,compactDisplay:this.state.compactDisplay,useMilitaryTime:this.props.useMilitaryTime,isFlagged:o,status:l,previewCollapsed:this.state.previewsCollapsed,previewEnabled:this.props.previewEnabled,isBusy:this.state.isBusy}),N.default.createElement("div",{ref:"rhspostlist",className:"post-right-comments-container"},f),_)))}}]),t}(N.default.Component);ae.propTypes={posts:k.default.arrayOf(k.default.object).isRequired,selected:k.default.object.isRequired,fromSearch:k.default.string,fromFlaggedPosts:k.default.bool,fromPinnedPosts:k.default.bool,isWebrtc:k.default.bool,isMentionSearch:k.default.bool,currentUser:k.default.object.isRequired,useMilitaryTime:k.default.bool.isRequired,toggleSize:k.default.func,shrink:k.default.func,previewCollapsed:k.default.string.isRequired,previewEnabled:k.default.bool.isRequired,actions:k.default.shape({removePost:k.default.func.isRequired}).isRequired},ae.defaultProps={fromSearch:"",isMentionSearch:!1},t.default=ae},2410:function(e,t,a){a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.Scrollbars=void 0;var n=a(2411),s=function(e){return e&&e.__esModule?e:{default:e}}(n);t.default=s.default,t.Scrollbars=s.default},2411:function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},d=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),u=a(2412),c=n(u),f=a(2196),m=n(f),h=a(1),p=a(2),g=n(p),v=a(2419),E=n(v),b=a(2420),y=n(b),S=a(2421),_=n(S),M=a(2422),C=n(M),w=a(2423),k=n(w),T=a(2424),N=a(2425),P=function(e){function t(e){var a;i(this,t);for(var n=arguments.length,s=Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];var l=r(this,(a=t.__proto__||Object.getPrototypeOf(t)).call.apply(a,[this,e].concat(s)));return l.getScrollLeft=l.getScrollLeft.bind(l),l.getScrollTop=l.getScrollTop.bind(l),l.getScrollWidth=l.getScrollWidth.bind(l),l.getScrollHeight=l.getScrollHeight.bind(l),l.getClientWidth=l.getClientWidth.bind(l),l.getClientHeight=l.getClientHeight.bind(l),l.getValues=l.getValues.bind(l),l.getThumbHorizontalWidth=l.getThumbHorizontalWidth.bind(l),l.getThumbVerticalHeight=l.getThumbVerticalHeight.bind(l),l.getScrollLeftForOffset=l.getScrollLeftForOffset.bind(l),l.getScrollTopForOffset=l.getScrollTopForOffset.bind(l),l.scrollLeft=l.scrollLeft.bind(l),l.scrollTop=l.scrollTop.bind(l),l.scrollToLeft=l.scrollToLeft.bind(l),l.scrollToTop=l.scrollToTop.bind(l),l.scrollToRight=l.scrollToRight.bind(l),l.scrollToBottom=l.scrollToBottom.bind(l),l.handleTrackMouseEnter=l.handleTrackMouseEnter.bind(l),l.handleTrackMouseLeave=l.handleTrackMouseLeave.bind(l),l.handleHorizontalTrackMouseDown=l.handleHorizontalTrackMouseDown.bind(l),l.handleVerticalTrackMouseDown=l.handleVerticalTrackMouseDown.bind(l),l.handleHorizontalThumbMouseDown=l.handleHorizontalThumbMouseDown.bind(l),l.handleVerticalThumbMouseDown=l.handleVerticalThumbMouseDown.bind(l),l.handleWindowResize=l.handleWindowResize.bind(l),l.handleScroll=l.handleScroll.bind(l),l.handleDrag=l.handleDrag.bind(l),l.handleDragEnd=l.handleDragEnd.bind(l),l.state={didMountUniversal:!1},l}return o(t,e),d(t,[{key:"componentDidMount",value:function(){this.addListeners(),this.update(),this.componentDidMountUniversal()}},{key:"componentDidMountUniversal",value:function(){this.props.universal&&this.setState({didMountUniversal:!0})}},{key:"componentDidUpdate",value:function(){this.update()}},{key:"componentWillUnmount",value:function(){this.removeListeners(),(0,u.cancel)(this.requestFrame),clearTimeout(this.hideTracksTimeout),clearInterval(this.detectScrollingInterval)}},{key:"getScrollLeft",value:function(){return this.view.scrollLeft}},{key:"getScrollTop",value:function(){return this.view.scrollTop}},{key:"getScrollWidth",value:function(){return this.view.scrollWidth}},{key:"getScrollHeight",value:function(){return this.view.scrollHeight}},{key:"getClientWidth",value:function(){return this.view.clientWidth}},{key:"getClientHeight",value:function(){return this.view.clientHeight}},{key:"getValues",value:function(){var e=this.view,t=e.scrollLeft,a=e.scrollTop,n=e.scrollWidth,s=e.scrollHeight,i=e.clientWidth,r=e.clientHeight;return{left:t/(n-i)||0,top:a/(s-r)||0,scrollLeft:t,scrollTop:a,scrollWidth:n,scrollHeight:s,clientWidth:i,clientHeight:r}}},{key:"getThumbHorizontalWidth",value:function(){var e=this.props,t=e.thumbSize,a=e.thumbMinSize,n=this.view,s=n.scrollWidth,i=n.clientWidth,r=(0,C.default)(this.trackHorizontal),o=Math.ceil(i/s*r);return r===o?0:t||Math.max(o,a)}},{key:"getThumbVerticalHeight",value:function(){var e=this.props,t=e.thumbSize,a=e.thumbMinSize,n=this.view,s=n.scrollHeight,i=n.clientHeight,r=(0,k.default)(this.trackVertical),o=Math.ceil(i/s*r);return r===o?0:t||Math.max(o,a)}},{key:"getScrollLeftForOffset",value:function(e){var t=this.view,a=t.scrollWidth,n=t.clientWidth;return e/((0,C.default)(this.trackHorizontal)-this.getThumbHorizontalWidth())*(a-n)}},{key:"getScrollTopForOffset",value:function(e){var t=this.view,a=t.scrollHeight,n=t.clientHeight;return e/((0,k.default)(this.trackVertical)-this.getThumbVerticalHeight())*(a-n)}},{key:"scrollLeft",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.view.scrollLeft=e}},{key:"scrollTop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this.view.scrollTop=e}},{key:"scrollToLeft",value:function(){this.view.scrollLeft=0}},{key:"scrollToTop",value:function(){this.view.scrollTop=0}},{key:"scrollToRight",value:function(){this.view.scrollLeft=this.view.scrollWidth}},{key:"scrollToBottom",value:function(){this.view.scrollTop=this.view.scrollHeight}},{key:"addListeners",value:function(){if("undefined"!=typeof document){var e=this.view,t=this.trackHorizontal,a=this.trackVertical,n=this.thumbHorizontal,s=this.thumbVertical;e.addEventListener("scroll",this.handleScroll),(0,y.default)()&&(t.addEventListener("mouseenter",this.handleTrackMouseEnter),t.addEventListener("mouseleave",this.handleTrackMouseLeave),t.addEventListener("mousedown",this.handleHorizontalTrackMouseDown),a.addEventListener("mouseenter",this.handleTrackMouseEnter),a.addEventListener("mouseleave",this.handleTrackMouseLeave),a.addEventListener("mousedown",this.handleVerticalTrackMouseDown),n.addEventListener("mousedown",this.handleHorizontalThumbMouseDown),s.addEventListener("mousedown",this.handleVerticalThumbMouseDown),window.addEventListener("resize",this.handleWindowResize))}}},{key:"removeListeners",value:function(){if("undefined"!=typeof document){var e=this.view,t=this.trackHorizontal,a=this.trackVertical,n=this.thumbHorizontal,s=this.thumbVertical;e.removeEventListener("scroll",this.handleScroll),(0,y.default)()&&(t.removeEventListener("mouseenter",this.handleTrackMouseEnter),t.removeEventListener("mouseleave",this.handleTrackMouseLeave),t.removeEventListener("mousedown",this.handleHorizontalTrackMouseDown),a.removeEventListener("mouseenter",this.handleTrackMouseEnter),a.removeEventListener("mouseleave",this.handleTrackMouseLeave),a.removeEventListener("mousedown",this.handleVerticalTrackMouseDown),n.removeEventListener("mousedown",this.handleHorizontalThumbMouseDown),s.removeEventListener("mousedown",this.handleVerticalThumbMouseDown),window.removeEventListener("resize",this.handleWindowResize),this.teardownDragging())}}},{key:"handleScroll",value:function(e){var t=this,a=this.props,n=a.onScroll,s=a.onScrollFrame;n&&n(e),this.update(function(e){var a=e.scrollLeft,n=e.scrollTop;t.viewScrollLeft=a,t.viewScrollTop=n,s&&s(e)}),this.detectScrolling()}},{key:"handleScrollStart",value:function(){var e=this.props.onScrollStart;e&&e(),this.handleScrollStartAutoHide()}},{key:"handleScrollStartAutoHide",value:function(){this.props.autoHide&&this.showTracks()}},{key:"handleScrollStop",value:function(){var e=this.props.onScrollStop;e&&e(),this.handleScrollStopAutoHide()}},{key:"handleScrollStopAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"handleWindowResize",value:function(){this.update()}},{key:"handleHorizontalTrackMouseDown",value:function(e){e.preventDefault();var t=e.target,a=e.clientX,n=t.getBoundingClientRect(),s=n.left,i=this.getThumbHorizontalWidth(),r=Math.abs(s-a)-i/2;this.view.scrollLeft=this.getScrollLeftForOffset(r)}},{key:"handleVerticalTrackMouseDown",value:function(e){e.preventDefault();var t=e.target,a=e.clientY,n=t.getBoundingClientRect(),s=n.top,i=this.getThumbVerticalHeight(),r=Math.abs(s-a)-i/2;this.view.scrollTop=this.getScrollTopForOffset(r)}},{key:"handleHorizontalThumbMouseDown",value:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,a=e.clientX,n=t.offsetWidth,s=t.getBoundingClientRect(),i=s.left;this.prevPageX=n-(a-i)}},{key:"handleVerticalThumbMouseDown",value:function(e){e.preventDefault(),this.handleDragStart(e);var t=e.target,a=e.clientY,n=t.offsetHeight,s=t.getBoundingClientRect(),i=s.top;this.prevPageY=n-(a-i)}},{key:"setupDragging",value:function(){(0,m.default)(document.body,T.disableSelectStyle),document.addEventListener("mousemove",this.handleDrag),document.addEventListener("mouseup",this.handleDragEnd),document.onselectstart=_.default}},{key:"teardownDragging",value:function(){(0,m.default)(document.body,T.disableSelectStyleReset),document.removeEventListener("mousemove",this.handleDrag),document.removeEventListener("mouseup",this.handleDragEnd),document.onselectstart=void 0}},{key:"handleDragStart",value:function(e){this.dragging=!0,e.stopImmediatePropagation(),this.setupDragging()}},{key:"handleDrag",value:function(e){if(this.prevPageX){var t=e.clientX,a=this.trackHorizontal.getBoundingClientRect(),n=a.left,s=this.getThumbHorizontalWidth(),i=s-this.prevPageX,r=-n+t-i;this.view.scrollLeft=this.getScrollLeftForOffset(r)}if(this.prevPageY){var o=e.clientY,l=this.trackVertical.getBoundingClientRect(),d=l.top,u=this.getThumbVerticalHeight(),c=u-this.prevPageY,f=-d+o-c;this.view.scrollTop=this.getScrollTopForOffset(f)}return!1}},{key:"handleDragEnd",value:function(){this.dragging=!1,this.prevPageX=this.prevPageY=0,this.teardownDragging(),this.handleDragEndAutoHide()}},{key:"handleDragEndAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"handleTrackMouseEnter",value:function(){this.trackMouseOver=!0,this.handleTrackMouseEnterAutoHide()}},{key:"handleTrackMouseEnterAutoHide",value:function(){this.props.autoHide&&this.showTracks()}},{key:"handleTrackMouseLeave",value:function(){this.trackMouseOver=!1,this.handleTrackMouseLeaveAutoHide()}},{key:"handleTrackMouseLeaveAutoHide",value:function(){this.props.autoHide&&this.hideTracks()}},{key:"showTracks",value:function(){clearTimeout(this.hideTracksTimeout),(0,m.default)(this.trackHorizontal,{opacity:1}),(0,m.default)(this.trackVertical,{opacity:1})}},{key:"hideTracks",value:function(){var e=this;if(!this.dragging&&!this.scrolling&&!this.trackMouseOver){var t=this.props.autoHideTimeout;clearTimeout(this.hideTracksTimeout),this.hideTracksTimeout=setTimeout(function(){(0,m.default)(e.trackHorizontal,{opacity:0}),(0,m.default)(e.trackVertical,{opacity:0})},t)}}},{key:"detectScrolling",value:function(){var e=this;this.scrolling||(this.scrolling=!0,this.handleScrollStart(),this.detectScrollingInterval=setInterval(function(){e.lastViewScrollLeft===e.viewScrollLeft&&e.lastViewScrollTop===e.viewScrollTop&&(clearInterval(e.detectScrollingInterval),e.scrolling=!1,e.handleScrollStop()),e.lastViewScrollLeft=e.viewScrollLeft,e.lastViewScrollTop=e.viewScrollTop},100))}},{key:"raf",value:function(e){var t=this;this.requestFrame&&c.default.cancel(this.requestFrame),this.requestFrame=(0,c.default)(function(){t.requestFrame=void 0,e()})}},{key:"update",value:function(e){var t=this;this.raf(function(){return t._update(e)})}},{key:"_update",value:function(e){var t=this.props,a=t.onUpdate,n=t.hideTracksWhenNotNeeded,s=this.getValues();if((0,y.default)()){var i=s.scrollLeft,r=s.clientWidth,o=s.scrollWidth,l=(0,C.default)(this.trackHorizontal),d=this.getThumbHorizontalWidth(),u=i/(o-r)*(l-d),c={width:d,transform:"translateX("+u+"px)"},f=s.scrollTop,h=s.clientHeight,p=s.scrollHeight,g=(0,k.default)(this.trackVertical),v=this.getThumbVerticalHeight(),E=f/(p-h)*(g-v),b={height:v,transform:"translateY("+E+"px)"};if(n){var S={visibility:o>r?"visible":"hidden"},_={visibility:p>h?"visible":"hidden"};(0,m.default)(this.trackHorizontal,S),(0,m.default)(this.trackVertical,_)}(0,m.default)(this.thumbHorizontal,c),(0,m.default)(this.thumbVertical,b)}a&&a(s),"function"==typeof e&&e(s)}},{key:"render",value:function(){var e=this,t=(0,y.default)(),a=this.props,n=(a.onScroll,a.onScrollFrame,a.onScrollStart,a.onScrollStop,a.onUpdate,a.renderView),i=a.renderTrackHorizontal,r=a.renderTrackVertical,o=a.renderThumbHorizontal,d=a.renderThumbVertical,u=a.tagName,c=(a.hideTracksWhenNotNeeded,a.autoHide),f=(a.autoHideTimeout,a.autoHideDuration),m=(a.thumbSize,a.thumbMinSize,a.universal),p=a.autoHeight,g=a.autoHeightMin,v=a.autoHeightMax,b=a.style,S=a.children,_=s(a,["onScroll","onScrollFrame","onScrollStart","onScrollStop","onUpdate","renderView","renderTrackHorizontal","renderTrackVertical","renderThumbHorizontal","renderThumbVertical","tagName","hideTracksWhenNotNeeded","autoHide","autoHideTimeout","autoHideDuration","thumbSize","thumbMinSize","universal","autoHeight","autoHeightMin","autoHeightMax","style","children"]),M=this.state.didMountUniversal,C=l({},T.containerStyleDefault,p&&l({},T.containerStyleAutoHeight,{minHeight:g,maxHeight:v}),b),w=l({},T.viewStyleDefault,{marginRight:t?-t:0,marginBottom:t?-t:0},p&&l({},T.viewStyleAutoHeight,{minHeight:(0,E.default)(g)?"calc("+g+" + "+t+"px)":g+t,maxHeight:(0,E.default)(v)?"calc("+v+" + "+t+"px)":v+t}),p&&m&&!M&&{minHeight:g,maxHeight:v},m&&!M&&T.viewStyleUniversalInitial),k={transition:"opacity "+f+"ms",opacity:0},N=l({},T.trackHorizontalStyleDefault,c&&k,(!t||m&&!M)&&{display:"none"}),P=l({},T.trackVerticalStyleDefault,c&&k,(!t||m&&!M)&&{display:"none"});return(0,h.createElement)(u,l({},_,{style:C,ref:function(t){e.container=t}}),[(0,h.cloneElement)(n({style:w}),{key:"view",ref:function(t){e.view=t}},S),(0,h.cloneElement)(i({style:N}),{key:"trackHorizontal",ref:function(t){e.trackHorizontal=t}},(0,h.cloneElement)(o({style:T.thumbHorizontalStyleDefault}),{ref:function(t){e.thumbHorizontal=t}})),(0,h.cloneElement)(r({style:P}),{key:"trackVertical",ref:function(t){e.trackVertical=t}},(0,h.cloneElement)(d({style:T.thumbVerticalStyleDefault}),{ref:function(t){e.thumbVertical=t}}))])}}]),t}(h.Component);t.default=P,P.propTypes={onScroll:g.default.func,onScrollFrame:g.default.func,onScrollStart:g.default.func,onScrollStop:g.default.func,onUpdate:g.default.func,renderView:g.default.func,renderTrackHorizontal:g.default.func,renderTrackVertical:g.default.func,renderThumbHorizontal:g.default.func,renderThumbVertical:g.default.func,tagName:g.default.string,thumbSize:g.default.number,thumbMinSize:g.default.number,hideTracksWhenNotNeeded:g.default.bool,autoHide:g.default.bool,autoHideTimeout:g.default.number,autoHideDuration:g.default.number,autoHeight:g.default.bool,autoHeightMin:g.default.oneOfType([g.default.number,g.default.string]),autoHeightMax:g.default.oneOfType([g.default.number,g.default.string]),universal:g.default.bool,style:g.default.object,children:g.default.node},P.defaultProps={renderView:N.renderViewDefault,renderTrackHorizontal:N.renderTrackHorizontalDefault,renderTrackVertical:N.renderTrackVerticalDefault,renderThumbHorizontal:N.renderThumbHorizontalDefault,renderThumbVertical:N.renderThumbVerticalDefault,tagName:"div",thumbMinSize:30,hideTracksWhenNotNeeded:!1,autoHide:!1,autoHideTimeout:1e3,autoHideDuration:200,autoHeight:!1,autoHeightMin:0,autoHeightMax:200,universal:!1}},2412:function(e,t,a){(function(t){for(var n=(a(0),a(0),a(2413)),s="undefined"==typeof window?t:window,i=["moz","webkit"],r="AnimationFrame",o=s["request"+r],l=s["cancel"+r]||s["cancelRequest"+r],d=0;!o&&d<i.length;d++)o=s[i[d]+"Request"+r],l=s[i[d]+"Cancel"+r]||s[i[d]+"CancelRequest"+r];if(!o||!l){var u=0,c=0,f=[];o=function(e){if(0===f.length){var t=n(),a=Math.max(0,1e3/60-(t-u));u=a+t,setTimeout(function(){var e=f.slice(0);f.length=0;for(var t=0;t<e.length;t++)if(!e[t].cancelled)try{e[t].callback(u)}catch(e){setTimeout(function(){throw e},0)}},Math.round(a))}return f.push({handle:++c,callback:e,cancelled:!1}),c},l=function(e){for(var t=0;t<f.length;t++)f[t].handle===e&&(f[t].cancelled=!0)}}e.exports=function(e){return o.call(s,e)},e.exports.cancel=function(){l.apply(s,arguments)},e.exports.polyfill=function(){s.requestAnimationFrame=o,s.cancelAnimationFrame=l}}).call(t,a(22))},2413:function(e,t,a){(function(t){a(0),a(0);(function(){var a,n,s;"undefined"!=typeof performance&&null!==performance&&performance.now?e.exports=function(){return performance.now()}:void 0!==t&&null!==t&&t.hrtime?(e.exports=function(){return(a()-s)/1e6},n=t.hrtime,a=function(){var e;return e=n(),1e9*e[0]+e[1]},s=a()):Date.now?(e.exports=function(){return Date.now()-s},s=Date.now()):(e.exports=function(){return(new Date).getTime()-s},s=(new Date).getTime())}).call(this)}).call(t,a(105))},2414:function(e,t,a){var n=(a(0),a(0),null),s=["Webkit","Moz","O","ms"];e.exports=function(e){n||(n=document.createElement("div"));var t=n.style;if(e in t)return e;for(var a=e.charAt(0).toUpperCase()+e.slice(1),i=s.length;i>=0;i--){var r=s[i]+a;if(r in t)return r}return!1}},2415:function(e,t,a){function n(e){return s(e).replace(/\s(\w)/g,function(e,t){return t.toUpperCase()})}var s=(a(0),a(0),a(2416));e.exports=n},2416:function(e,t,a){function n(e){return s(e).replace(/[\W_]+(.|$)/g,function(e,t){return t?" "+t:""}).trim()}var s=(a(0),a(0),a(2417));e.exports=n},2417:function(e,t,a){function n(e){return r.test(e)?e.toLowerCase():o.test(e)?(s(e)||e).toLowerCase():l.test(e)?i(e).toLowerCase():e.toLowerCase()}function s(e){return e.replace(d,function(e,t){return t?" "+t:""})}function i(e){return e.replace(u,function(e,t,a){return t+" "+a.toLowerCase().split("").join(" ")})}a(0),a(0);e.exports=n;var r=/\s/,o=/(_|-|\.|:)/,l=/([a-z][A-Z]|[A-Z][a-z])/,d=/[\W_]+(.|$)/g,u=/(.)([A-Z]+)/g},2418:function(e,t,a){var n=(a(0),a(0),{animationIterationCount:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridColumn:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,stopOpacity:!0,strokeDashoffset:!0,strokeOpacity:!0,strokeWidth:!0});e.exports=function(e,t){return"number"!=typeof t||n[e]?t:t+"px"}},2419:function(e,t,a){function n(e){return"string"==typeof e}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2420:function(e,t,a){function n(){if(!1!==r)return r;if("undefined"!=typeof document){var e=document.createElement("div");(0,i.default)(e,{width:100,height:100,position:"absolute",top:-9999,overflow:"scroll",MsOverflowStyle:"scrollbar"}),document.body.appendChild(e),r=e.offsetWidth-e.clientWidth,document.body.removeChild(e)}else r=0;return r||0}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n;var s=a(2196),i=function(e){return e&&e.__esModule?e:{default:e}}(s),r=!1},2421:function(e,t,a){function n(){return!1}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2422:function(e,t,a){function n(e){var t=e.clientWidth,a=getComputedStyle(e),n=a.paddingLeft,s=a.paddingRight;return t-parseFloat(n)-parseFloat(s)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2423:function(e,t,a){function n(e){var t=e.clientHeight,a=getComputedStyle(e),n=a.paddingTop,s=a.paddingBottom;return t-parseFloat(n)-parseFloat(s)}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0}),t.default=n},2424:function(e,t,a){a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});t.containerStyleDefault={position:"relative",overflow:"hidden",width:"100%",height:"100%"},t.containerStyleAutoHeight={height:"auto"},t.viewStyleDefault={position:"absolute",top:0,left:0,right:0,bottom:0,overflow:"scroll",WebkitOverflowScrolling:"touch"},t.viewStyleAutoHeight={position:"relative",top:void 0,left:void 0,right:void 0,bottom:void 0},t.viewStyleUniversalInitial={overflow:"hidden",marginRight:0,marginBottom:0},t.trackHorizontalStyleDefault={position:"absolute",height:6},t.trackVerticalStyleDefault={position:"absolute",width:6},t.thumbHorizontalStyleDefault={position:"relative",display:"block",height:"100%"},t.thumbVerticalStyleDefault={position:"relative",display:"block",width:"100%"},t.disableSelectStyle={userSelect:"none"},t.disableSelectStyleReset={userSelect:""}},2425:function(e,t,a){function n(e,t){var a={};for(var n in e)t.indexOf(n)>=0||Object.prototype.hasOwnProperty.call(e,n)&&(a[n]=e[n]);return a}function s(e){return c.default.createElement("div",e)}function i(e){var t=e.style,a=n(e,["style"]),s=d({},t,{right:2,bottom:2,left:2,borderRadius:3});return c.default.createElement("div",d({style:s},a))}function r(e){var t=e.style,a=n(e,["style"]),s=d({},t,{right:2,bottom:2,top:2,borderRadius:3});return c.default.createElement("div",d({style:s},a))}function o(e){var t=e.style,a=n(e,["style"]),s=d({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return c.default.createElement("div",d({style:s},a))}function l(e){var t=e.style,a=n(e,["style"]),s=d({},t,{cursor:"pointer",borderRadius:"inherit",backgroundColor:"rgba(0,0,0,.2)"});return c.default.createElement("div",d({style:s},a))}a(0),a(0);Object.defineProperty(t,"__esModule",{value:!0});var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e};t.renderViewDefault=s,t.renderTrackHorizontalDefault=i,t.renderTrackVerticalDefault=r,t.renderThumbHorizontalDefault=o,t.renderThumbVerticalDefault=l;var u=a(1),c=function(e){return e&&e.__esModule?e:{default:e}}(u)},2426:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a=e.requests.posts.createPost.error||{};return(0,r.default)({},t,{createPostErrorId:a.server_error_id})}Object.defineProperty(t,"__esModule",{value:!0});var i=a(19),r=n(i),o=a(31),l=a(2427),d=n(l);t.default=(0,o.connect)(s)(d.default)},2427:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(0),g=s(p),v=a(2),E=s(v),b=a(1),y=s(b),S=a(47),_=s(S),M=a(17),C=a(79),w=n(C),k=a(56),T=n(k),N=a(73),P=n(N),I=a(34),L=s(I),D=a(137),R=s(D),A=a(750),O=s(A),F=a(312),x=s(F),U=a(119),H=s(U),j=a(35),G=s(j),B=a(25),V=s(B),z=a(9),q=s(z),W=a(87),Y=n(W),K=a(16),J=n(K),X=a(2096),Q=a(438),Z=s(Q),$=a(783),ee=s($),te=a(784),ae=s(te),ne=a(785),se=s(ne),ie=a(786),re=s(ie),oe=a(444),le=s(oe),de=q.default.ActionTypes,ue=q.default.KeyCodes,ce=function(e){function t(e){(0,l.default)(this,t);var a=(0,f.default)(this,(t.__proto__||(0,r.default)(t)).call(this,e));fe.call(a),a.lastTime=0,x.default.clearCommentDraftUploads(),O.default.resetHistoryIndex("comment");var n=x.default.getCommentDraft(a.props.rootId),s=a.handleEnableAddButton(n.message,n.fileInfos);return a.state={message:n.message,uploadsInProgress:n.uploadsInProgress,fileInfos:n.fileInfos,submitting:!1,ctrlSend:H.default.getBool(q.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter"),showPostDeletedModal:!1,enableAddButton:s,showEmojiPicker:!1},a.lastBlurAt=0,a}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){H.default.addChangeListener(this.onPreferenceChange),this.focusTextbox()}},{key:"componentWillUnmount",value:function(){H.default.removeChangeListener(this.onPreferenceChange)}},{key:"componentDidUpdate",value:function(e,t){t.uploadsInProgress<this.state.uploadsInProgress&&(0,g.default)(".post-right__scroll").scrollTop((0,g.default)(".post-right__scroll")[0].scrollHeight),e.rootId!==this.props.rootId&&this.focusTextbox()}},{key:"componentWillReceiveProps",value:function(e){if(e.rootId!==this.props.rootId){var t=x.default.getCommentDraft(e.rootId),a=this.handleEnableAddButton(t.message,t.fileInfos);this.setState({message:t.message,uploadsInProgress:t.uploadsInProgress,fileInfos:t.fileInfos,enableAddButton:a})}"api.post.create_post.root_id.app_error"===e.createPostErrorId&&e.createPostErrorId!==this.props.createPostErrorId&&this.showPostDeletedModal()}},{key:"render",value:function(){var e=null;this.state.serverError&&(e=y.default.createElement("div",{className:"form-group has-error"},y.default.createElement("label",{className:"control-label"},this.state.serverError)));var t=null;if(this.state.postError){var a="post-error"+(this.state.errorClass?" "+this.state.errorClass:"");t=y.default.createElement("label",{className:a},this.state.postError)}var n=null;(this.state.fileInfos.length>0||this.state.uploadsInProgress.length>0)&&(n=y.default.createElement(ee.default,{fileInfos:this.state.fileInfos,onRemove:this.removePreview,uploadsInProgress:this.state.uploadsInProgress,ref:"preview"}));var s=null;this.state.uploadsInProgress.length>0&&(s=y.default.createElement("span",{className:"pull-right post-right-comments-upload-in-progress"},1===this.state.uploadsInProgress.length?y.default.createElement(M.FormattedMessage,{id:"create_comment.file",defaultMessage:"File uploading"}):y.default.createElement(M.FormattedMessage,{id:"create_comment.files",defaultMessage:"Files uploading"})));var i="btn btn-primary comment-btn pull-right";this.state.enableAddButton||(i+=" disabled");var r=y.default.createElement(ae.default,{ref:"fileUpload",getFileCount:this.getFileCount,getTarget:this.getFileUploadTarget,onFileUploadChange:this.handleFileUploadChange,onUploadStart:this.handleUploadStart,onFileUpload:this.handleFileUploadComplete,onUploadError:this.handleUploadError,postType:"comment",channelId:this.props.channelId}),o=null;return"true"===window.mm_config.EnableEmojiPicker&&(o=y.default.createElement("span",{className:"emoji-picker__container"},y.default.createElement(Z.default,{show:this.state.showEmojiPicker,container:this.props.getSidebarBody,target:this.getCreateCommentControls,onHide:this.hideEmojiPicker,onEmojiClick:this.handleEmojiClick,rightOffset:15,topOffset:55}),y.default.createElement("span",{className:"icon icon--emoji emoji-rhs "+(this.state.showEmojiPicker?"active":""),dangerouslySetInnerHTML:{__html:q.default.EMOJI_ICON_SVG},onClick:this.toggleEmojiPicker}))),y.default.createElement("form",{onSubmit:this.handleSubmit},y.default.createElement("div",{className:"post-create"},y.default.createElement("div",{id:this.props.rootId,className:"post-create-body comment-create-body"},y.default.createElement("div",{className:"post-body__cell"},y.default.createElement(le.default,{onChange:this.handleChange,onKeyPress:this.commentMsgKeyPress,onKeyDown:this.handleKeyDown,handlePostError:this.handlePostError,value:this.state.message,onBlur:this.handleBlur,createMessage:J.localizeMessage("create_comment.addComment","Add a comment..."),emojiEnabled:"true"===window.mm_config.EnableEmojiPicker,initialText:"",channelId:this.props.channelId,isRHS:!0,popoverMentionKeyClick:!0,id:"reply_textbox",ref:"textbox"}),y.default.createElement("span",{ref:"createCommentControls",className:"post-body__actions"},r,o))),y.default.createElement(se.default,{channelId:this.props.channelId,parentId:this.props.rootId}),y.default.createElement("div",{className:"post-create-footer"},y.default.createElement("input",{type:"button",className:i,value:J.localizeMessage("create_comment.comment","Add Comment"),onClick:this.handleSubmit}),s,t,n,e)),y.default.createElement(re.default,{show:this.state.showPostDeletedModal,onHide:this.hidePostDeletedModal}))}}]),t}(y.default.Component);ce.propTypes={channelId:E.default.string.isRequired,rootId:E.default.string.isRequired,latestPostId:E.default.string,getSidebarBody:E.default.func,createPostErrorId:E.default.string};var fe=function(){var e=this;this.toggleEmojiPicker=function(){e.setState({showEmojiPicker:!e.state.showEmojiPicker})},this.hideEmojiPicker=function(){e.setState({showEmojiPicker:!1})},this.handleEmojiClick=function(t){var a=t.name||t.aliases[0];if(a){if(""===e.state.message)e.setState({message:":"+a+": "});else{var n=void 0;n=/\s+$/.test(e.state.message)?e.state.message+":"+a+": ":e.state.message+" :"+a+": ",e.setState({message:n})}e.setState({showEmojiPicker:!1}),e.focusTextbox()}},this.onPreferenceChange=function(){e.setState({ctrlSend:H.default.getBool(q.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter")})},this.handlePostError=function(t){e.setState({postError:t})},this.handleSubmit=function(t){if(t.preventDefault(),!(e.state.uploadsInProgress.length>0||e.state.submitting)){var a=e.state.message;if(e.state.postError)return e.setState({errorClass:"animation--highlight"}),void setTimeout(function(){e.setState({errorClass:null})},q.default.ANIMATION_TIMEOUT);if(O.default.storeMessageInHistory(a),0!==a.trim().length||0!==e.state.fileInfos.length){var n=X.REACTION_PATTERN.exec(a);n&&R.default.has(n[2])?e.handleSubmitReaction(n):0===a.indexOf("/")?e.handleSubmitCommand(a):e.handleSubmitPost(a),e.setState({message:"",submitting:!1,postError:null,fileInfos:[],serverError:null,enableAddButton:!1});var s=Date.now()-e.lastBlurAt<150;e.focusTextbox(s)}}},this.handleSubmitCommand=function(t){x.default.storeCommentDraft(e.props.rootId,null),e.setState({message:"",postError:null,fileInfos:[],enableAddButton:!1});var a={};a.channel_id=e.props.channelId,a.team_id=G.default.getCurrentId(),a.root_id=e.props.rootId,a.parent_id=e.props.rootId,w.executeCommand(t,a,function(){e.setState({submitting:!1})},function(a){if(a.sendMessage)e.handleSubmitPost(t);else{var n={};n.serverError=a.message,n.submitting=!1,e.setState(n)}})},this.handleSubmitPost=function(t){var a=V.default.getCurrentId(),n=J.getTimestamp(),s={};s.file_ids=[],s.message=t,s.channel_id=e.props.channelId,s.root_id=e.props.rootId,s.parent_id=e.props.rootId,s.pending_post_id=a+":"+n,s.user_id=a,s.create_at=n,T.emitUserCommentedEvent(s),P.createPost(s,e.state.fileInfos),e.setState({message:"",submitting:!1,postError:null,fileInfos:[],serverError:null,enableAddButton:!1});var i=Date.now()-e.state.lastBlurAt<150;e.focusTextbox(i)},this.handleSubmitReaction=function(t){var a=t[1],n=t[2],s=e.props.latestPostId;"+"===a?P.addReaction(e.props.channelId,s,n):"-"===a&&P.removeReaction(e.props.channelId,s,n),x.default.storeCommentDraft(e.props.rootId,null)},this.commentMsgKeyPress=function(t){!Y.isMobile()&&(e.state.ctrlSend&&t.ctrlKey||!e.state.ctrlSend)&&(t.which!==ue.ENTER||t.shiftKey||t.altKey||(t.preventDefault(),_.default.findDOMNode(e.refs.textbox).blur(),e.handleSubmit(t))),T.emitLocalUserTypingEvent(e.props.channelId,e.props.rootId)},this.handleChange=function(t){var a=t.target.value,n=x.default.getCommentDraft(e.props.rootId);n.message=a,x.default.storeCommentDraft(e.props.rootId,n),(0,g.default)(".post-right__scroll").parent().scrollTop((0,g.default)(".post-right__scroll")[0].scrollHeight);var s=e.handleEnableAddButton(a,e.state.fileInfos);e.setState({message:a,enableAddButton:s})},this.handleKeyDown=function(t){if(e.state.ctrlSend&&t.keyCode===ue.ENTER&&!0===t.ctrlKey)return void e.commentMsgKeyPress(t);if(!(t.ctrlKey||t.metaKey||t.altKey||t.shiftKey||t.keyCode!==ue.UP||""!==e.state.message)){t.preventDefault();var a=x.default.getCurrentUsersLatestPost(e.props.channelId,e.props.rootId);if(!a)return;L.default.handleViewAction({type:de.RECEIVED_EDIT_POST,refocusId:"#reply_textbox",title:J.localizeMessage("create_comment.commentTitle","Comment"),message:a.message,postId:a.id,channelId:a.channel_id,comments:x.default.getCommentCount(a)})}if((t.ctrlKey||t.metaKey)&&!t.altKey&&!t.shiftKey&&(t.keyCode===q.default.KeyCodes.UP||t.keyCode===q.default.KeyCodes.DOWN)){var n=O.default.nextMessageInHistory(t.keyCode,e.state.message,"comment");null!==n&&(t.preventDefault(),e.setState({message:n,enableAddButton:!0}))}},this.handleFileUploadChange=function(){e.focusTextbox()},this.handleUploadStart=function(t){var a=x.default.getCommentDraft(e.props.rootId);a.uploadsInProgress=a.uploadsInProgress.concat(t),x.default.storeCommentDraft(e.props.rootId,a),e.setState({uploadsInProgress:a.uploadsInProgress}),e.focusTextbox()},this.handleFileUploadComplete=function(t,a){for(var n=x.default.getCommentDraft(e.props.rootId),s=0;s<a.length;s++){var i=n.uploadsInProgress.indexOf(a[s]);-1!==i&&n.uploadsInProgress.splice(i,1)}n.fileInfos=n.fileInfos.concat(t),x.default.storeCommentDraft(e.props.rootId,n),void 0!==e.refs.preview&&e.refs.preview&&e.refs.preview.refs.container.scrollIntoView();var r=e.handleEnableAddButton(n.message,n.fileInfos);e.setState({uploadsInProgress:n.uploadsInProgress,fileInfos:n.fileInfos,enableAddButton:r})},this.handleUploadError=function(t,a){if(-1===a)e.setState({serverError:t});else{var n=x.default.getCommentDraft(e.props.rootId),s=n.uploadsInProgress.indexOf(a);-1!==s&&n.uploadsInProgress.splice(s,1),x.default.storeCommentDraft(e.props.rootId,n),e.setState({uploadsInProgress:n.uploadsInProgress,serverError:t})}},this.removePreview=function(t){var a=e.state.fileInfos,n=e.state.uploadsInProgress;e.handleUploadError(null);var s=a.findIndex(function(e){return e.id===t});-1===s?-1!==(s=n.indexOf(t))&&(n.splice(s,1),e.refs.fileUpload.getWrappedInstance().cancelUpload(t)):a.splice(s,1);var i=x.default.getCommentDraft(e.props.rootId);i.fileInfos=a,i.uploadsInProgress=n,x.default.storeCommentDraft(e.props.rootId,i),e.setState({fileInfos:a,uploadsInProgress:n}),e.handleFileUploadChange()},this.getFileCount=function(){return e.state.fileInfos.length+e.state.uploadsInProgress.length},this.getFileUploadTarget=function(){return e.refs.textbox},this.getCreateCommentControls=function(){return e.refs.createCommentControls},this.focusTextbox=function(){!(arguments.length>0&&void 0!==arguments[0]&&arguments[0])&&Y.isMobile()||e.refs.textbox.focus()},this.showPostDeletedModal=function(){e.setState({showPostDeletedModal:!0})},this.hidePostDeletedModal=function(){e.setState({showPostDeletedModal:!1})},this.handleBlur=function(){e.lastBlurAt=Date.now()},this.handleEnableAddButton=function(e,t){return 0!==e.trim().length||0!==t.length}};t.default=ce},2428:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(17),b=function(e){function t(){return(0,o.default)(this,t),(0,c.default)(this,(t.__proto__||(0,i.default)(t)).apply(this,arguments))}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){return v.default.createElement("div",{className:"date-separator"},v.default.createElement("hr",{className:"separator__hr"}),v.default.createElement("div",{className:"separator__text"},v.default.createElement(E.FormattedDate,{value:this.props.date,weekday:"short",month:"short",day:"2-digit",year:"numeric"})))}}]),t}(v.default.PureComponent);b.propTypes={date:p.default.instanceOf(Date)},t.default=b},2429:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(2),g=s(p),v=a(1),E=s(v),b=a(17),y=a(44),S=a(73),_=a(35),M=s(_),C=a(9),w=s(C),k=a(94),T=n(k),N=a(16),P=n(N),I=a(743),L=s(I),D=a(438),R=s(D),A=a(744),O=s(A),F=a(788),x=s(F),U=a(751),H=s(U),j=a(745),G=s(j),B=a(746),V=s(B),z=a(752),q=s(z),W=a(181),Y=s(W),K=a(442),J=s(K),X=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.toggleEmojiPicker=function(){var e=!t.state.showEmojiPicker;t.setState({showEmojiPicker:e,dropdownOpened:e})},t.getClassName=function(e,a){var n="post post--thread";return t.props.currentUser.id===e.user_id&&(n+=" current--user"),a&&(n+=" post--system"),t.props.compactDisplay&&(n+=" post--compact"),e.is_pinned&&(n+=" post--pinned"),t.state.dropdownOpened&&(n+=" post--hovered"),n},t.removePost=t.removePost.bind(t),t.reactEmojiClick=t.reactEmojiClick.bind(t),t.handleDropdownOpened=t.handleDropdownOpened.bind(t),t.state={currentTeamDisplayName:M.default.getCurrent().name,width:"",height:"",showEmojiPicker:!1,dropdownOpened:!1},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){P.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){P.updateWindowDimensions(e)})}},{key:"removePost",value:function(){this.props.removePost(this.props.post)}},{key:"createRemovePostButton",value:function(){return E.default.createElement("button",{className:"post__remove theme color--link style--none",type:"button",onClick:this.removePost},"Ã—")}},{key:"shouldComponentUpdate",value:function(e,t){return e.status!==this.props.status||(e.isBusy!==this.props.isBusy||(e.compactDisplay!==this.props.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.isFlagged!==this.props.isFlagged||(!P.areObjectsEqual(e.post,this.props.post)||(!P.areObjectsEqual(e.currentUser,this.props.currentUser)||(this.state.showEmojiPicker!==t.showEmojiPicker||(e.lastPostCount!==this.props.lastPostCount||(this.state.dropdownOpened!==t.dropdownOpened||this.props.previewCollapsed!==e.previewCollapsed)))))))))}},{key:"timeTag",value:function(e,t){var a=P.getDateForUnixTicks(e.create_at);return E.default.createElement("time",{className:"post__time",dateTime:a.toISOString(),title:a},a.toLocaleString("en",t))}},{key:"renderTimeTag",value:function(e,t){return P.isMobile()?this.timeTag(e,t):E.default.createElement(y.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e,t))}},{key:"reactEmojiClick",value:function(e){this.setState({showEmojiPicker:!1});var t=e.name||e.aliases[0];(0,S.addReaction)(this.props.post.channel_id,this.props.post.id,t),(0,S.emitEmojiPosted)(t),this.handleDropdownOpened(!1)}},{key:"handleDropdownOpened",value:function(e){this.setState({dropdownOpened:e})}},{key:"render",value:function(){var t=this,a=this.props.post,n=w.default.MATTERMOST_ICON_SVG,s=-1;this.props.lastPostCount>=0&&this.props.lastPostCount<w.default.TEST_ID_COUNT&&(s=this.props.lastPostCount);var i=P.isPostEphemeral(a),r=T.isSystemMessage(a),o=this.props.status;a.props&&"true"===a.props.from_webhook&&(o=null);var l=void 0,d=E.default.createElement(J.default,{user:this.props.user,status:o,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}),u=void 0;a.props&&a.props.from_webhook?(d=a.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride?E.default.createElement(J.default,{user:this.props.user,overwriteName:a.props.override_username,disablePopover:!0}):E.default.createElement(J.default,{user:this.props.user,disablePopover:!0}),l=E.default.createElement("div",{className:"col col__name bot-indicator"},"BOT")):r&&(d=E.default.createElement(J.default,{user:{},overwriteName:E.default.createElement(b.FormattedMessage,{id:"post_info.system",defaultMessage:"System"}),overwriteImage:w.default.SYSTEM_MESSAGE_PROFILE_IMAGE,disablePopover:!0}),u=E.default.createElement("span",{className:"post__visibility"},E.default.createElement(b.FormattedMessage,{id:"post_info.message.visible",defaultMessage:"(Only visible to you)"})));var c=void 0,f="";a.failed&&(f+=" post-failed",c=E.default.createElement(x.default,{post:this.props.post})),T.isEdited(this.props.post)&&(f+=" post--edited");var m=E.default.createElement(Y.default,{src:T.getProfilePicSrcForPost(a,this.props.user),status:o,width:"36",height:"36",user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0});a.props&&a.props.from_webhook&&(m=E.default.createElement(Y.default,{src:T.getProfilePicSrcForPost(a,this.props.user),width:"36",height:"36"})),r&&(m=E.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:n}})),this.props.compactDisplay&&(m=a.props&&a.props.from_webhook?E.default.createElement(Y.default,{src:""}):E.default.createElement(Y.default,{src:"",status:o,user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}));var h=E.default.createElement("div",{className:"post__img"},m),p=null;a.file_ids&&a.file_ids.length>0&&(p=E.default.createElement(O.default,{post:a,compactDisplay:this.props.compactDisplay}));var g=void 0;i||a.failed||r||"true"!==window.mm_config.EnableEmojiPicker||(g=E.default.createElement("span",null,E.default.createElement(R.default,{show:this.state.showEmojiPicker,onHide:this.toggleEmojiPicker,target:function(){return t.refs.dotMenu},onEmojiClick:this.reactEmojiClick,rightOffset:15,spaceRequiredAbove:342,spaceRequiredBelow:342}),E.default.createElement("button",{className:"reacticon__container reaction color--link style--none",onClick:this.toggleEmojiPicker,ref:"rhs_reacticon_"+a.id},E.default.createElement("span",{className:"icon icon--emoji",dangerouslySetInnerHTML:{__html:w.default.EMOJI_ICON_SVG}}))));var v=void 0;if(i)v=E.default.createElement("div",{className:"col col__remove"},this.createRemovePostButton());else if(!r){var y=E.default.createElement(L.default,{idPrefix:w.default.RHS,idCount:s,post:this.props.post,isFlagged:this.props.isFlagged,handleDropdownOpened:this.handleDropdownOpened});v=E.default.createElement("div",{ref:"dotMenu",className:"col col__reply"},y,g)}var S=void 0;a.is_pinned&&(S=E.default.createElement("span",{className:"post__pinned-badge"},E.default.createElement(b.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"})));var _={hour:"2-digit",minute:"2-digit",hour12:!this.props.useMilitaryTime};return E.default.createElement("div",{ref:"post_body_"+a.id,className:this.getClassName(a,r)},E.default.createElement("div",{className:"post__content"},h,E.default.createElement("div",null,E.default.createElement("div",{className:"post__header"},E.default.createElement("div",{className:"col col__name"},E.default.createElement("strong",null,d)),l,E.default.createElement("div",{className:"col"},this.renderTimeTag(a,_),S,E.default.createElement(G.default,{idPrefix:"rhsCommentFlag",idCount:s,postId:a.id,isFlagged:this.props.isFlagged,isEphemeral:i}),u),v),E.default.createElement("div",{className:"post__body"},E.default.createElement("div",{className:f},c,E.default.createElement(H.default,{post:a,previewCollapsed:this.props.previewCollapsed},E.default.createElement(V.default,{post:a,isRHS:!0,hasMention:!0}))),p,E.default.createElement(q.default,{post:a})))))}}]),a}(E.default.Component);X.propTypes={post:g.default.object,lastPostCount:g.default.number,user:g.default.object.isRequired,currentUser:g.default.object.isRequired,compactDisplay:g.default.bool,useMilitaryTime:g.default.bool.isRequired,isFlagged:g.default.bool,status:g.default.string,isBusy:g.default.bool,removePost:g.default.func.isRequired,previewCollapsed:g.default.string.isRequired},t.default=X}).call(t,a(22))},2430:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(40),b=a(17),y=a(56),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(73),M=a(9),C=n(M),w=a(34),k=n(w),T=C.default.ActionTypes,N=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleClose=a.handleClose.bind(a),a.toggleSize=a.toggleSize.bind(a),a.handleBack=a.handleBack.bind(a),a.state={},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleClose",value:function(e){e.preventDefault(),S.emitCloseRightHandSide(),this.props.shrink()}},{key:"toggleSize",value:function(e){e.preventDefault(),this.props.toggleSize()}},{key:"handleBack",value:function(e){e.preventDefault(),this.props.fromSearch||this.props.isWebrtc?(k.default.handleServerAction({type:T.RECEIVED_SEARCH_TERM,term:this.props.fromSearch,do_search:!0,is_mention_search:this.props.isMentionSearch}),k.default.handleServerAction({type:T.RECEIVED_POST_SELECTED,postId:null,channelId:null})):this.props.fromFlaggedPosts?(0,_.getFlaggedPosts)():this.props.fromPinnedPosts&&(0,_.getPinnedPosts)()}},{key:"render",value:function(){var e=void 0,t=v.default.createElement(E.Tooltip,{id:"closeSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.closeSidebarTooltip",defaultMessage:"Close Sidebar"})),a=void 0;this.props.fromSearch?a=v.default.createElement(E.Tooltip,{id:"backToResultsTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.backToResultsTooltip",defaultMessage:"Back to Search Results"})):this.props.fromFlaggedPosts?a=v.default.createElement(E.Tooltip,{id:"backToResultsTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.backToFlaggedTooltip",defaultMessage:"Back to Flagged Posts"})):this.props.isWebrtc?a=v.default.createElement(E.Tooltip,{id:"backToResultsTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.backToCallTooltip",defaultMessage:"Back to Call"})):this.props.fromPinnedPosts&&(a=v.default.createElement(E.Tooltip,{id:"backToResultsTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.backToPinnedTooltip",defaultMessage:"Back to Pinned Posts"})));var n=v.default.createElement(E.Tooltip,{id:"expandSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.expandSidebarTooltip",defaultMessage:"Expand Sidebar"})),s=v.default.createElement(E.Tooltip,{id:"shrinkSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.shrinkSidebarTooltip",defaultMessage:"Shrink Sidebar"}));return(this.props.fromSearch||this.props.fromFlaggedPosts||this.props.isWebrtc||this.props.fromPinnedPosts)&&(e=v.default.createElement("a",{href:"#",onClick:this.handleBack,className:"sidebar--right__back"},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:C.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},v.default.createElement("i",{className:"fa fa-angle-left"})))),v.default.createElement("div",{className:"sidebar--right__header"},v.default.createElement("span",{className:"sidebar--right__title"},e,v.default.createElement(b.FormattedMessage,{id:"rhs_header.details",defaultMessage:"Message Details"})),v.default.createElement("div",{className:"pull-right"},v.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.toggleSize},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:C.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},v.default.createElement("i",{className:"fa fa-expand"})),v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:C.default.OVERLAY_TIME_DELAY,placement:"top",overlay:s},v.default.createElement("i",{className:"fa fa-compress"}))),v.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",onClick:this.handleClose},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:C.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},v.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(v.default.Component);t.default=N,N.defaultProps={isMentionSearch:!1,fromSearch:""},N.propTypes={isMentionSearch:p.default.bool,isWebrtc:p.default.bool,fromSearch:p.default.string,fromFlaggedPosts:p.default.bool,fromPinnedPosts:p.default.bool,toggleSize:p.default.func,shrink:p.default.func}},2431:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(2),g=s(p),v=a(1),E=s(v),b=a(17),y=a(44),S=a(73),_=a(25),M=s(_),C=a(32),w=s(C),k=a(35),T=s(k),N=a(9),P=s(N),I=a(94),L=n(I),D=a(16),R=n(D),A=a(743),O=s(A),F=a(438),x=s(F),U=a(744),H=s(U),j=a(751),G=s(j),B=a(745),V=s(B),z=a(746),q=s(z),W=a(752),Y=s(W),K=a(181),J=s(K),X=a(442),Q=s(X),Z=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.toggleEmojiPicker=function(){var e=!t.state.showEmojiPicker;t.setState({showEmojiPicker:e,dropdownOpened:e})},t.getClassName=function(e,a){var n="post post--root post--thread";return M.default.getCurrentId()===e.user_id&&(n+=" current--user"),a&&(n+=" post--system"),t.props.compactDisplay&&(n+=" post--compact"),e.is_pinned&&(n+=" post--pinned"),t.state.dropdownOpened&&(n+=" post--hovered"),n},t.reactEmojiClick=t.reactEmojiClick.bind(t),t.handleDropdownOpened=t.handleDropdownOpened.bind(t),t.state={currentTeamDisplayName:T.default.getCurrent().name,width:"",height:"",showEmojiPicker:!1,testStateObj:!0,dropdownOpened:!1},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){R.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){R.updateWindowDimensions(e)})}},{key:"shouldComponentUpdate",value:function(e,t){return e.status!==this.props.status||(e.isBusy!==this.props.isBusy||(e.compactDisplay!==this.props.compactDisplay||(e.useMilitaryTime!==this.props.useMilitaryTime||(e.isFlagged!==this.props.isFlagged||(e.previewCollapsed!==this.props.previewCollapsed||(e.previewEnabled!==this.props.previewEnabled||(!R.areObjectsEqual(e.post,this.props.post)||(!R.areObjectsEqual(e.user,this.props.user)||(!R.areObjectsEqual(e.currentUser,this.props.currentUser)||(this.state.showEmojiPicker!==t.showEmojiPicker||this.state.dropdownOpened!==t.dropdownOpened))))))))))}},{key:"timeTag",value:function(e,t){var a=R.getDateForUnixTicks(e.create_at);return E.default.createElement("time",{className:"post__time",dateTime:a.toISOString(),title:a},a.toLocaleString("en",t))}},{key:"renderTimeTag",value:function(e,t){return e.type===P.default.PostTypes.FAKE_PARENT_DELETED?null:R.isMobile()?this.timeTag(e,t):E.default.createElement(y.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e,t))}},{key:"reactEmojiClick",value:function(e){this.setState({showEmojiPicker:!1});var t=e.name||e.aliases[0];(0,S.addReaction)(this.props.post.channel_id,this.props.post.id,t),(0,S.emitEmojiPosted)(t),this.handleDropdownOpened(!1)}},{key:"handleDropdownOpened",value:function(e){this.setState({dropdownOpened:e})}},{key:"render",value:function(){var t,a=this,n=this.props.post,s=this.props.user,i=P.default.MATTERMOST_ICON_SVG,r=w.default.get(n.channel_id),o=R.isPostEphemeral(n),l=L.isSystemMessage(n);r&&(t="D"===r.type?E.default.createElement(b.FormattedMessage,{id:"rhs_root.direct",defaultMessage:"Direct Message"}):r.display_name);var d=void 0;o||n.failed||l||"true"!==window.mm_config.EnableEmojiPicker||(d=E.default.createElement("span",null,E.default.createElement(x.default,{show:this.state.showEmojiPicker,onHide:this.toggleEmojiPicker,target:function(){return a.refs.dotMenu},onEmojiClick:this.reactEmojiClick,rightOffset:15,spaceRequiredAbove:342,spaceRequiredBelow:342}),E.default.createElement("button",{className:"reacticon__container reaction color--link style--none",onClick:this.toggleEmojiPicker,ref:"rhs_root_reacticon"},E.default.createElement("span",{className:"icon icon--emoji",dangerouslySetInnerHTML:{__html:P.default.EMOJI_ICON_SVG}}))));var u=null;n.file_ids&&n.file_ids.length>0&&(u=E.default.createElement(H.default,{post:n,compactDisplay:this.props.compactDisplay}));var c=void 0,f=void 0;l?c=E.default.createElement(Q.default,{user:{},overwriteName:E.default.createElement(b.FormattedMessage,{id:"post_info.system",defaultMessage:"System"}),overwriteImage:P.default.SYSTEM_MESSAGE_PROFILE_IMAGE,disablePopover:!0}):n.props&&n.props.from_webhook?(c=n.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride?E.default.createElement(Q.default,{user:s,overwriteName:n.props.override_username,disablePopover:!0}):E.default.createElement(Q.default,{user:s,disablePopover:!0}),f=E.default.createElement("div",{className:"col col__name bot-indicator"},"BOT")):c=E.default.createElement(Q.default,{user:s,status:this.props.status,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0});var m=this.props.status;n.props&&"true"===n.props.from_webhook&&(m=null);var h=void 0;h=l?E.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:i}}):n.props&&n.props.from_webhook?E.default.createElement(J.default,{src:L.getProfilePicSrcForPost(n,s),width:"36",height:"36"}):E.default.createElement(J.default,{src:L.getProfilePicSrcForPost(n,s),status:m,width:"36",height:"36",user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}),this.props.compactDisplay&&(h=n.props&&n.props.from_webhook?E.default.createElement(J.default,{src:""}):E.default.createElement(J.default,{src:"",status:m,user:this.props.user,isBusy:this.props.isBusy,isRHS:!0,hasMention:!0}));var p="";L.isEdited(this.props.post)&&(p+=" post--edited");var g=E.default.createElement("div",{className:"post__img"},h),v=void 0;n.is_pinned&&(v=E.default.createElement("span",{className:"post__pinned-badge"},E.default.createElement(b.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"})));var y={hour:"2-digit",minute:"2-digit",hour12:!this.props.useMilitaryTime},S=E.default.createElement(O.default,{idPrefix:P.default.RHS_ROOT,post:this.props.post,isFlagged:this.props.isFlagged,handleDropdownOpened:this.handleDropdownOpened,commentCount:this.props.commentCount}),_=void 0;this.props.post.type!==P.default.PostTypes.FAKE_PARENT_DELETED&&(_=E.default.createElement("div",{ref:"dotMenu",className:"col col__reply"},S,d));var M=void 0;return this.props.post.type!==P.default.PostTypes.FAKE_PARENT_DELETED&&(M=E.default.createElement(V.default,{idPrefix:"rhsRootPostFlag",postId:n.id,isFlagged:this.props.isFlagged})),E.default.createElement("div",{id:"thread--root",className:this.getClassName(n,l)},E.default.createElement("div",{className:"post-right-channel__name"},t),E.default.createElement("div",{className:"post__content"},g,E.default.createElement("div",null,E.default.createElement("div",{className:"post__header"},E.default.createElement("div",{className:"col__name"},c),f,E.default.createElement("div",{className:"col"},this.renderTimeTag(n,y),v,M),_),E.default.createElement("div",{className:"post__body"},E.default.createElement("div",{className:p},E.default.createElement(G.default,{post:n,previewCollapsed:this.props.previewCollapsed,previewEnabled:this.props.previewEnabled},E.default.createElement(q.default,{post:n,isRHS:!0,hasMention:!0}))),u,E.default.createElement(Y.default,{post:n})))))}}]),a}(E.default.Component);Z.propTypes={post:g.default.object.isRequired,user:g.default.object.isRequired,currentUser:g.default.object.isRequired,compactDisplay:g.default.bool,useMilitaryTime:g.default.bool.isRequired,commentCount:g.default.number.isRequired,isFlagged:g.default.bool,status:g.default.string,previewCollapsed:g.default.string,previewEnabled:g.default.bool,isBusy:g.default.bool},Z.defaultProps={commentCount:0},t.default=Z}).call(t,a(22))},2432:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function s(){var e=JSON.parse((0,_.default)(O.default.getSearchResults())),t=new y.default;if(e&&e.order){var a=e.order.map(function(t){return e.posts[t].channel_id}),n=!0,s=!1,i=void 0;try{for(var r,o=(0,E.default)(a);!(n=(r=o.next()).done);n=!0){var l=r.value;t.has(l)||t.set(l,L.default.get(l))}}catch(e){s=!0,i=e}finally{try{!n&&o.return&&o.return()}finally{if(s)throw i}}}return{results:e,channels:t,searchTerm:O.default.getSearchTerm(),flaggedPosts:R.default.getCategory(G.default.Preferences.CATEGORY_FLAGGED_POST),loading:O.default.isLoading()}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(41),r=n(i),o=a(6),l=n(o),d=a(4),u=n(d),c=a(5),f=n(c),m=a(7),h=n(m),p=a(8),g=n(p),v=a(48),E=n(v),b=a(156),y=n(b),S=a(155),_=n(S),M=a(0),C=n(M),w=a(2),k=n(w),T=a(1),N=n(T),P=a(17),I=a(32),L=n(I),D=a(119),R=n(D),A=a(313),O=n(A),F=a(25),x=n(F),U=a(436),H=n(U),j=a(9),G=n(j),B=a(16),V=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(B),z=a(2433),q=n(z),W=a(2434),Y=n(W),K=G.default.Preferences,J=function(t){function a(e){(0,u.default)(this,a);var t=(0,h.default)(this,(a.__proto__||(0,l.default)(a)).call(this,e));t.mounted=!1,t.onChange=t.onChange.bind(t),t.onUserChange=t.onUserChange.bind(t),t.onPreferenceChange=t.onPreferenceChange.bind(t),t.onBusy=t.onBusy.bind(t),t.resize=t.resize.bind(t),t.onPreferenceChange=t.onPreferenceChange.bind(t),t.onStatusChange=t.onStatusChange.bind(t),t.handleResize=t.handleResize.bind(t);var n=s();return n.windowWidth=V.windowWidth(),n.windowHeight=V.windowHeight(),n.profiles=JSON.parse((0,_.default)(x.default.getProfiles())),n.compactDisplay=R.default.get(K.CATEGORY_DISPLAY_SETTINGS,K.MESSAGE_DISPLAY,K.MESSAGE_DISPLAY_DEFAULT)===K.MESSAGE_DISPLAY_COMPACT,n.isBusy=H.default.isBusy(),n.statuses=(0,r.default)({},x.default.getStatuses()),t.state=n,t}return(0,g.default)(a,t),(0,f.default)(a,[{key:"componentDidMount",value:function(){this.mounted=!0,O.default.addSearchTermChangeListener(this.onSearchTermChange),O.default.addSearchChangeListener(this.onChange),L.default.addChangeListener(this.onChange),R.default.addChangeListener(this.onPreferenceChange),x.default.addChangeListener(this.onUserChange),x.default.addStatusesChangeListener(this.onStatusChange),R.default.addChangeListener(this.onPreferenceChange),H.default.addBusyListener(this.onBusy),this.resize(),window.addEventListener("resize",this.handleResize),V.isMobile()||(0,C.default)(".sidebar--right .search-items-container").perfectScrollbar()}},{key:"shouldComponentUpdate",value:function(e,t){return!V.areObjectsEqual(t.statuses,this.state.statuses)||(!V.areObjectsEqual(this.props,e)||(!V.areObjectsEqual(this.state,t)||(t.compactDisplay!==this.state.compactDisplay||t.isBusy!==this.state.isBusy)))}},{key:"componentWillUnmount",value:function(){this.mounted=!1,O.default.removeSearchTermChangeListener(this.onSearchTermChange),O.default.removeSearchChangeListener(this.onChange),L.default.removeChangeListener(this.onChange),R.default.removeChangeListener(this.onPreferenceChange),x.default.removeChangeListener(this.onUserChange),x.default.removeStatusesChangeListener(this.onStatusChange),R.default.removeChangeListener(this.onPreferenceChange),H.default.removeBusyListener(this.onBusy),window.removeEventListener("resize",this.handleResize)}},{key:"componentDidUpdate",value:function(e,t){this.state.searchTerm!==t.searchTerm&&this.resize()}},{key:"handleResize",value:function(){this.setState({windowWidth:V.windowWidth(),windowHeight:V.windowHeight()})}},{key:"onPreferenceChange",value:function(){this.setState({compactDisplay:R.default.get(K.CATEGORY_DISPLAY_SETTINGS,K.MESSAGE_DISPLAY,K.MESSAGE_DISPLAY_DEFAULT)===K.MESSAGE_DISPLAY_COMPACT,flaggedPosts:R.default.getCategory(G.default.Preferences.CATEGORY_FLAGGED_POST)})}},{key:"onSearchTermChange",value:function(e){this.mounted&&e&&this.setState({loading:!0})}},{key:"onChange",value:function(){this.mounted&&this.setState(s())}},{key:"onUserChange",value:function(){this.setState({profiles:JSON.parse((0,_.default)(x.default.getProfiles()))})}},{key:"onBusy",value:function(e){this.setState({isBusy:e})}},{key:"onStatusChange",value:function(){this.setState({statuses:(0,r.default)({},x.default.getStatuses())})}},{key:"resize",value:function(){(0,C.default)("#search-items-container").scrollTop(0)}},{key:"render",value:function(){var t=this.state.results,a=!t||!t.order||!t.order.length,n=this.state.searchTerm,s=this.state.profiles||{},i=G.default.FLAG_ICON_SVG,r=null;if(this.state.loading)r=N.default.createElement("div",{className:"sidebar--right__subheader"},N.default.createElement("div",{className:"sidebar--right__loading"},N.default.createElement("i",{className:"fa fa-spinner fa-spin"}),N.default.createElement(P.FormattedMessage,{id:"search_header.loading",defaultMessage:"Searching..."})));else if(this.props.isFlaggedPosts&&a){var o=[N.default.createElement("li",{key:"pin1"},N.default.createElement(P.FormattedMessage,{id:"search_results.usageFlag1",defaultMessage:"You haven't flagged any messages yet."})),N.default.createElement("li",{key:"pin2"},N.default.createElement(P.FormattedMessage,{id:"search_results.usageFlag2",defaultMessage:"You can add a flag to messages and comments by clicking the "}),N.default.createElement("span",{className:"usage__icon",dangerouslySetInnerHTML:{__html:i}}),N.default.createElement(P.FormattedMessage,{id:"search_results.usageFlag3",defaultMessage:" icon next to the timestamp."})),N.default.createElement("li",{key:"pin3"},N.default.createElement(P.FormattedMessage,{id:"search_results.usageFlag4",defaultMessage:"Flags are a way to mark messages for follow up. Your flags are personal, and cannot be seen by other users."}))];"true"===e.window.mm_config.DataRetentionEnableMessageDeletion&&o.push(N.default.createElement("li",null,N.default.createElement(P.FormattedMessage,{id:"search_results.usage.dataRetention",defaultMessage:"Only messages posted in the last {days} days are returned. Contact your System Administrator for more detail.",values:{days:e.window.mm_config.DataRetentionMessageRetentionDays}}))),r=N.default.createElement("div",{className:"sidebar--right__subheader"},N.default.createElement("ul",null,o))}else if(this.props.isPinnedPosts&&a){var l=[N.default.createElement("li",{key:"pin1"},N.default.createElement(P.FormattedMessage,{id:"search_results.usagePin1",defaultMessage:"There are no pinned messages yet."})),N.default.createElement("li",{key:"pin2"},N.default.createElement(P.FormattedMessage,{id:"search_results.usagePin2",defaultMessage:"All members of this channel can pin important or useful messages."})),N.default.createElement("li",{key:"pin3"},N.default.createElement(P.FormattedMessage,{id:"search_results.usagePin3",defaultMessage:"Pinned messages are visible to all channel members."})),N.default.createElement("li",{key:"pin4"},N.default.createElement(P.FormattedMessage,{id:"search_results.usagePin4",defaultMessage:'To pin a message: Go to the message that you want to pin and click [...] > "Pin to channel".'}))];"true"===e.window.mm_config.DataRetentionEnableMessageDeletion&&l.push(N.default.createElement("li",null,N.default.createElement(P.FormattedMessage,{id:"search_results.usage.dataRetention",defaultMessage:"Only messages posted in the last {days} days are returned. Contact your System Administrator for more detail.",values:{days:e.window.mm_config.DataRetentionMessageRetentionDays}}))),r=N.default.createElement("div",{className:"sidebar--right__subheader"},N.default.createElement("ul",null,l))}else if(!n&&a){var d=[N.default.createElement("li",{key:"quotes"},N.default.createElement(P.FormattedMessage,{id:"search_results.usage.phrasesSuggestion",defaultMessage:"Use {quotationMarks} to search for phrases",values:{quotationMarks:N.default.createElement("b",null,N.default.createElement(P.FormattedMessage,{id:"search_results.usage.phrasesSuggestion.quotationMarks",defaultMessage:'"quotation marks"'}))}})),N.default.createElement("li",{key:"fromIn"},N.default.createElement(P.FormattedMessage,{id:"search_results.usage.fromInSuggestion",defaultMessage:"Use {fromUser} to find posts from specific users and {inChannel} to find posts in specific channels",values:{fromUser:N.default.createElement("b",null,N.default.createElement(P.FormattedMessage,{id:"search_results.usage.fromInSuggestion.fromUser",defaultMessage:"from:"})),inChannel:N.default.createElement("b",null,N.default.createElement(P.FormattedMessage,{id:"search_results.usage.fromInSuggestion.inChannel",defaultMessage:"in:"}))}}))];r=N.default.createElement("div",{className:"sidebar--right__subheader"},N.default.createElement("ul",null,d))}else if(a){var u=[N.default.createElement("li",{key:"partialPhrase"},N.default.createElement(P.FormattedMessage,{id:"search_results.noResults.partialPhraseSuggestion",defaultMessage:'If you\'re searching a partial phrase (ex. searching "rea", looking for "reach" or "reaction"), append a * to your search term.'})),N.default.createElement("li",{key:"stopWords"},N.default.createElement(P.FormattedMessage,{id:"search_results.noResults.stopWordsSuggestion",defaultMessage:'Two letter searches and common words like "this", "a" and "is" won\'t appear in search results due to the excessive results returned.'}))];"true"===e.window.mm_config.DataRetentionEnableMessageDeletion&&u.push(N.default.createElement("li",null,N.default.createElement(P.FormattedMessage,{id:"search_results.usage.dataRetention",defaultMessage:"Only messages posted in the last {days} days are returned. Contact your System Administrator for more detail.",values:{days:e.window.mm_config.DataRetentionMessageRetentionDays}}))),r=N.default.createElement("div",{className:"sidebar--right__subheader"},N.default.createElement("h4",null,N.default.createElement(P.FormattedMessage,{id:"search_results.noResults",defaultMessage:"No results found. Try again?"})),N.default.createElement("ul",null,u))}else r=t.order.map(function(e,a,i){var r=t.posts[e],o=void 0;o=x.default.getCurrentId()===r.user_id?x.default.getCurrentUser():s[r.user_id];var l="offline";this.state.statuses&&(l=this.state.statuses[r.user_id]||"offline");var d=!1;this.state.flaggedPosts&&(d=null!=this.state.flaggedPosts.get(r.id));var u=i.length-a-1;return N.default.createElement(Y.default,{key:r.id,channel:this.state.channels.get(r.channel_id),compactDisplay:this.state.compactDisplay,post:r,lastPostCount:u>=0&&u<G.default.TEST_ID_COUNT?u:-1,user:o,term:n,isMentionSearch:this.props.isMentionSearch,isFlaggedSearch:this.props.isFlaggedPosts,useMilitaryTime:this.props.useMilitaryTime,shrink:this.props.shrink,isFlagged:d,isBusy:this.state.isBusy,status:l})},this);return N.default.createElement("div",{className:"sidebar-right__body"},N.default.createElement(q.default,{isMentionSearch:this.props.isMentionSearch,toggleSize:this.props.toggleSize,shrink:this.props.shrink,isFlaggedPosts:this.props.isFlaggedPosts,isPinnedPosts:this.props.isPinnedPosts,channelDisplayName:this.props.channelDisplayName,isLoading:this.state.loading}),N.default.createElement("div",{id:"search-items-container",className:"search-items-container"},r))}}]),a}(N.default.Component);t.default=J,J.propTypes={isMentionSearch:k.default.bool,useMilitaryTime:k.default.bool.isRequired,toggleSize:k.default.func,shrink:k.default.func,isFlaggedPosts:k.default.bool,isPinnedPosts:k.default.bool,channelDisplayName:k.default.string.isRequired}}).call(t,a(22))},2433:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(40),b=a(17),y=a(56),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(9),M=n(_),C=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleClose=a.handleClose.bind(a),a.toggleSize=a.toggleSize.bind(a),a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"handleClose",value:function(e){e.preventDefault(),S.toggleSideBarAction(!1),this.props.shrink()}},{key:"toggleSize",value:function(e){e.preventDefault(),this.props.toggleSize()}},{key:"render",value:function(){var e=v.default.createElement(b.FormattedMessage,{id:"search_header.results",defaultMessage:"Search Results"}),t=v.default.createElement(E.Tooltip,{id:"closeSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.closeSidebarTooltip",defaultMessage:"Close Sidebar"})),a=v.default.createElement(E.Tooltip,{id:"expandSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.expandSidebarTooltip",defaultMessage:"Expand Sidebar"})),n=v.default.createElement(E.Tooltip,{id:"shrinkSidebarTooltip"},v.default.createElement(b.FormattedMessage,{id:"rhs_header.shrinkSidebarTooltip",defaultMessage:"Shrink Sidebar"}));return this.props.isMentionSearch?e=v.default.createElement(b.FormattedMessage,{id:"search_header.title2",defaultMessage:"Recent Mentions"}):this.props.isFlaggedPosts?e=v.default.createElement(b.FormattedMessage,{id:"search_header.title3",defaultMessage:"Flagged Posts"}):this.props.isPinnedPosts&&(e=v.default.createElement(b.FormattedMessage,{id:"search_header.title4",defaultMessage:"Pinned posts in {channelDisplayName}",values:{channelDisplayName:this.props.channelDisplayName}})),v.default.createElement("div",{className:"sidebar--right__header"},v.default.createElement("span",{className:"sidebar--right__title"},e),v.default.createElement("div",{className:"pull-right"},v.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:this.toggleSize},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},v.default.createElement("i",{className:"fa fa-expand"})),v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},v.default.createElement("i",{className:"fa fa-compress"}))),v.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",title:"Close",onClick:this.handleClose},v.default.createElement(E.OverlayTrigger,{trigger:["hover","focus"],delayShow:M.default.OVERLAY_TIME_DELAY,placement:"top",overlay:t},v.default.createElement("i",{className:"fa fa-sign-out"})))))}}]),t}(v.default.Component);t.default=C,C.propTypes={isMentionSearch:p.default.bool,toggleSize:p.default.func,shrink:p.default.func,isFlaggedPosts:p.default.bool,isPinnedPosts:p.default.bool,channelDisplayName:p.default.string.isRequired,isLoading:p.default.bool.isRequired}},2434:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(2),g=s(p),v=a(1),E=s(v),b=a(17),y=a(44),S=a(56),_=n(S),M=a(746),C=s(M),w=a(744),k=s(w),T=a(789),N=s(T),P=a(743),I=s(P),L=a(745),D=s(L),R=a(35),A=s(R),O=a(9),F=s(O),x=a(94),U=n(x),H=a(16),j=n(H),G=a(181),B=s(G),V=a(442),z=s(V),q=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.handleDropdownOpened=function(e){t.setState({dropdownOpened:e})},t.getClassName=function(){var e="post post--thread";return t.props.compactDisplay&&(e+=" post--compact"),t.state.dropdownOpened&&(e+=" post--hovered"),e},t.handleFocusRHSClick=t.handleFocusRHSClick.bind(t),t.handleJumpClick=t.handleJumpClick.bind(t),t.handleDropdownOpened=t.handleDropdownOpened.bind(t),t.shrinkSidebar=t.shrinkSidebar.bind(t),t.state={currentTeamDisplayName:A.default.getCurrent().name,width:"",height:"",dropdownOpened:!1},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"shouldComponentUpdate",value:function(e,t){return!j.areObjectsEqual(t.post,this.props.post)||(e.isFlagged!==this.props.isFlagged||t.dropdownOpened!==this.state.dropdownOpened)}},{key:"componentDidMount",value:function(){var e=this;window.addEventListener("resize",function(){j.updateWindowDimensions(e)})}},{key:"componentWillUnmount",value:function(){var e=this;window.removeEventListener("resize",function(){j.updateWindowDimensions(e)})}},{key:"shrinkSidebar",value:function(){var e=this;setTimeout(function(){e.props.shrink()})}},{key:"handleFocusRHSClick",value:function(e){e.preventDefault(),_.emitPostFocusRightHandSideFromSearch(this.props.post,this.props.isMentionSearch)}},{key:"handleJumpClick",value:function(){j.isMobile()&&_.toggleSideBarAction(!1),this.shrinkSidebar(),y.browserHistory.push(A.default.getCurrentTeamRelativeUrl()+"/pl/"+this.props.post.id)}},{key:"timeTag",value:function(e){var t=j.getDateForUnixTicks(e.create_at);return E.default.createElement("time",{className:"search-item-time",dateTime:t.toISOString(),title:t},E.default.createElement(b.FormattedDate,{value:e.create_at,hour12:!this.props.useMilitaryTime,hour:"2-digit",minute:"2-digit"}))}},{key:"renderTimeTag",value:function(e){return j.isMobile()?this.timeTag(e):E.default.createElement(y.Link,{to:"/"+this.state.currentTeamDisplayName+"/pl/"+e.id,target:"_blank",className:"post__permalink"},this.timeTag(e))}},{key:"render",value:function(){var t=null,a=this.props.channel,n=this.props.user||{},s=this.props.post,i=-1;this.props.lastPostCount>=0&&this.props.lastPostCount<F.default.TEST_ID_COUNT&&(i=this.props.lastPostCount),a&&(t=a.display_name,"D"===a.type&&(t=E.default.createElement(b.FormattedMessage,{id:"search_item.direct",defaultMessage:"Direct Message (with {username})",values:{username:j.displayUsernameForUser(j.getDirectTeammate(a.id))}})));var r=void 0,o=!1;s.props&&s.props.from_webhook&&s.props.override_username&&"true"===e.window.mm_config.EnablePostUsernameOverride&&(r=s.props.override_username,o=!0);var l=void 0;s.props&&s.props.from_webhook&&(l=E.default.createElement("div",{className:"bot-indicator"},F.default.BOT_NAME));var d=E.default.createElement(B.default,{src:U.getProfilePicSrcForPost(s,n),user:this.props.user,status:this.props.status,isBusy:this.props.isBusy}),u=E.default.createElement("div",{className:"post__img"},d),c="";U.isEdited(this.props.post)&&(c+=" post--edited");var f=null;s.file_ids&&s.file_ids.length>0&&(f=E.default.createElement(k.default,{post:s,compactDisplay:this.props.compactDisplay}));var m=void 0,h=void 0,p=void 0;s.state===F.default.POST_DELETED?m=E.default.createElement("p",null,E.default.createElement(b.FormattedMessage,{id:"post_body.deleted",defaultMessage:"(message deleted)"})):(h=E.default.createElement(D.default,{idPrefix:"searchPostFlag",idCount:i,postId:s.id,isFlagged:this.props.isFlagged}),p=E.default.createElement("div",{className:"col__controls"},E.default.createElement(I.default,{idPrefix:F.default.SEARCH_POST,idCount:i,post:s,isFlagged:this.props.isFlagged,handleDropdownOpened:this.handleDropdownOpened}),E.default.createElement(N.default,{idPrefix:"searchCommentIcon",idCount:i,handleCommentClick:this.handleFocusRHSClick,searchStyle:"search-item__comment"}),E.default.createElement("a",{onClick:this.handleJumpClick,className:"search-item__jump"},E.default.createElement(b.FormattedMessage,{id:"search_item.jump",defaultMessage:"Jump"}))),m=E.default.createElement(C.default,{post:s,options:{searchTerm:this.props.term,mentionHighlight:this.props.isMentionSearch}}));var g=void 0;return s.is_pinned&&(g=E.default.createElement("span",{className:"post__pinned-badge"},E.default.createElement(b.FormattedMessage,{id:"post_info.pinned",defaultMessage:"Pinned"}))),E.default.createElement("div",{className:"search-item__container"},E.default.createElement("div",{className:"date-separator"},E.default.createElement("hr",{className:"separator__hr"}),E.default.createElement("div",{className:"separator__text"},E.default.createElement(b.FormattedDate,{value:s.create_at,day:"numeric",month:"long",year:"numeric"}))),E.default.createElement("div",{className:this.getClassName()},E.default.createElement("div",{className:"search-channel__name"},t),E.default.createElement("div",{className:"post__content"},u,E.default.createElement("div",null,E.default.createElement("div",{className:"post__header"},E.default.createElement("div",{className:"col col__name"},E.default.createElement("strong",null,E.default.createElement(z.default,{user:n,overwriteName:r,disablePopover:o,status:this.props.status,isBusy:this.props.isBusy}))),l,E.default.createElement("div",{className:"col"},this.renderTimeTag(s),g,h),p),E.default.createElement("div",{className:"search-item-snippet post__body"},E.default.createElement("div",{className:c},m,f))))))}}]),a}(E.default.Component);t.default=q,q.propTypes={post:g.default.object,lastPostCount:g.default.number,user:g.default.object,channel:g.default.object,compactDisplay:g.default.bool,isMentionSearch:g.default.bool,isFlaggedSearch:g.default.bool,term:g.default.string,useMilitaryTime:g.default.bool.isRequired,shrink:g.default.func,isFlagged:g.default.bool,isBusy:g.default.bool,status:g.default.string}}).call(t,a(22))},2435:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(2),g=s(p),v=a(1),E=s(v),b=a(17),y=a(44),S=a(56),_=n(S),M=a(73),C=a(119),w=s(C),k=a(313),T=s(k),N=a(35),P=s(N),I=a(25),L=s(I),D=a(436),R=s(D),A=a(9),O=a(78),F=a(87),x=n(F),U=a(16),H=n(U),j=a(2090),G=s(j),B=a(2097),V=s(B),z=a(742),q=a(754),W=s(q),Y=a(441),K=s(Y),J=A.Constants.Preferences,X=A.Constants.TutorialSteps,Q=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));t.onChange=t.onChange.bind(t),t.handleClick=t.handleClick.bind(t),t.handleAboutModal=t.handleAboutModal.bind(t),t.showAddUsersToTeamModal=t.showAddUsersToTeamModal.bind(t),t.hideAddUsersToTeamModal=t.hideAddUsersToTeamModal.bind(t),t.searchMentions=t.searchMentions.bind(t),t.aboutModalDismissed=t.aboutModalDismissed.bind(t),t.getFlagged=t.getFlagged.bind(t);var n=t.getStateFromStores();return n.showAboutModal=!1,n.showAddUsersToTeamModal=!1,t.state=n,t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"handleClick",value:function(e){R.default.isBusy()&&(R.default.emitChanged({action:A.WebrtcActionTypes.IN_PROGRESS}),e.preventDefault())}},{key:"handleAboutModal",value:function(){this.setState({showAboutModal:!0})}},{key:"aboutModalDismissed",value:function(){this.setState({showAboutModal:!1})}},{key:"showAddUsersToTeamModal",value:function(e){e.preventDefault(),this.setState({showAddUsersToTeamModal:!0,showDropdown:!1})}},{key:"hideAddUsersToTeamModal",value:function(){this.setState({showAddUsersToTeamModal:!1})}},{key:"getFlagged",value:function(e){e.preventDefault(),(0,M.getFlaggedPosts)(),this.closeRightSidebar()}},{key:"componentDidMount",value:function(){P.default.addChangeListener(this.onChange),w.default.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){P.default.removeChangeListener(this.onChange),w.default.removeChangeListener(this.onChange)}},{key:"getStateFromStores",value:function(){var e=w.default.getInt(J.TUTORIAL_STEP,L.default.getCurrentId(),999);return{currentUser:L.default.getCurrentUser(),teamMembers:P.default.getMyTeamMembers(),teamListings:P.default.getTeamListings(),showTutorialTip:e===X.MENU_POPOVER&&H.isMobile()}}},{key:"onChange",value:function(){this.setState(this.getStateFromStores())}},{key:"searchMentions",value:function(e){e.preventDefault();var t=this.state.currentUser;T.default.isMentionSearch?_.toggleSideBarAction(!1):(this.closeRightSidebar(),_.emitSearchMentionsEvent(t))}},{key:"closeLeftSidebar",value:function(){H.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.remove("move--right"),document.querySelector(".app__body .sidebar--left").classList.remove("move--right")})}},{key:"openRightSidebar",value:function(){H.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.add("move--left-small"),document.querySelector(".app__body .sidebar--menu").classList.add("move--left")})}},{key:"closeRightSidebar",value:function(){H.isMobile()&&setTimeout(function(){document.querySelector(".app__body .inner-wrap").classList.remove("move--left-small"),document.querySelector(".app__body .sidebar--menu").classList.remove("move--left")})}},{key:"render",value:function(){var t=L.default.getCurrentUser(),a=void 0,n=void 0,s=void 0,i=void 0,r=void 0,o=void 0,l=void 0,d=!1,u=!1,c=null;if(null!=t){d=P.default.isTeamAdminForCurrentTeam()||L.default.isSystemAdminForCurrentUser(),u=L.default.isSystemAdminForCurrentUser(),n=E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:_.showInviteMemberModal},E.default.createElement("i",{className:"icon fa fa-user-plus"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.inviteNew",defaultMessage:"Send Email Invite"}))),s=E.default.createElement("li",null,E.default.createElement("a",{id:"addUsersToTeam",href:"#",onClick:this.showAddUsersToTeamModal},E.default.createElement("i",{className:"icon fa fa-user-plus"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.addMemberToTeam",defaultMessage:"Add Members to Team"}))),this.props.teamType===A.Constants.OPEN_TEAM&&"true"===e.mm_config.EnableUserCreation&&(a=E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:_.showGetTeamInviteLinkModal},E.default.createElement("i",{className:"icon fa fa-link"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.teamLink",defaultMessage:"Get Team Invite Link"})))),"true"===e.window.mm_license.IsLicensed&&(e.window.mm_config.RestrictTeamInvite!==A.Constants.PERMISSIONS_SYSTEM_ADMIN||u?e.window.mm_config.RestrictTeamInvite!==A.Constants.PERMISSIONS_TEAM_ADMIN||d||(a=null,n=null,s=null):(a=null,n=null,s=null));var f=!1,m=this.state.teamMembers.reduce(function(e,t){return e[t.team_id]=!0,e},{});for(var h in this.state.teamListings)if(this.state.teamListings.hasOwnProperty(h)&&!m[h]){f=!0;break}f&&(l=E.default.createElement("li",{key:"joinTeam_li"},E.default.createElement(y.Link,{to:"/select_team"},E.default.createElement("i",{className:"icon fa fa-plus-square"}),E.default.createElement(b.FormattedMessage,{id:"navbar_dropdown.join",defaultMessage:"Join Another Team"})))),("true"===e.window.mm_config.EnableTeamCreation||u)&&(c=E.default.createElement("li",{key:"newTeam_li"},E.default.createElement(y.Link,{id:"createTeam",key:"newTeam_a",to:"/create_team",onClick:this.handleClick},E.default.createElement("i",{className:"icon fa fa-plus-square"}),E.default.createElement(b.FormattedMessage,{id:"navbar_dropdown.create",defaultMessage:"Create a New Team"}))))}r=E.default.createElement("li",null,E.default.createElement(K.default,{dialogType:W.default},E.default.createElement("i",{className:"icon fa fa-users"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.viewMembers",defaultMessage:"View Members"})));var p=E.default.createElement("li",{key:"leaveTeam_li"},E.default.createElement("a",{id:"leaveTeam",href:"#",onClick:_.showLeaveTeamModal},E.default.createElement("span",{className:"icon",dangerouslySetInnerHTML:{__html:A.Constants.LEAVE_TEAM_SVG}}),E.default.createElement(b.FormattedMessage,{id:"navbar_dropdown.leave",defaultMessage:"Leave Team"})));d&&(i=E.default.createElement("li",null,E.default.createElement("a",{href:"#","data-toggle":"modal","data-target":"#team_settings"},E.default.createElement("i",{className:"icon fa fa-globe"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.teamSettings",defaultMessage:"Team Settings"}))),r=E.default.createElement("li",null,E.default.createElement(K.default,{dialogType:W.default,dialogProps:{isAdmin:d}},E.default.createElement("i",{className:"icon fa fa-users"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.manageMembers",defaultMessage:"Manage Members"})))),u&&!H.isMobile()&&(o=E.default.createElement("li",null,E.default.createElement(y.Link,{to:"/admin_console",onClick:this.handleClick},E.default.createElement("i",{className:"icon fa fa-wrench"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.console",defaultMessage:"System Console"}))));var g="";null!=e.window.mm_config.SiteName&&(g=e.window.mm_config.SiteName);var v=g;this.props.teamDisplayName&&(v=this.props.teamDisplayName);var S=null;e.window.mm_config.HelpLink&&(S=E.default.createElement("li",null,E.default.createElement(y.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.HelpLink},E.default.createElement("i",{className:"icon fa fa-question"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.help",defaultMessage:"Help"}))));var M=null;e.window.mm_config.ReportAProblemLink&&(M=E.default.createElement("li",null,E.default.createElement(y.Link,{target:"_blank",rel:"noopener noreferrer",to:e.window.mm_config.ReportAProblemLink},E.default.createElement("i",{className:"icon fa fa-phone"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.report",defaultMessage:"Report a Problem"}))));var C=null;this.state.showTutorialTip&&(C=(0,z.createMenuTip)(function(e){return e.preventDefault()},!0),this.closeLeftSidebar(),this.openRightSidebar());var w=null;e.window.mm_config.AppDownloadLink&&!x.isMobileApp()&&(w=E.default.createElement("li",null,E.default.createElement(y.Link,{target:"_blank",rel:"noopener noreferrer",to:(0,O.useSafeUrl)(e.window.mm_config.AppDownloadLink)},E.default.createElement("i",{className:"icon fa fa-mobile"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.nativeApps",defaultMessage:"Download Apps"}))));var k=void 0;this.state.showAddUsersToTeamModal&&(k=E.default.createElement(V.default,{onModalDismissed:this.hideAddUsersToTeamModal}));var T=null;(i||r||l||c||p)&&(T=E.default.createElement("li",{className:"divider"}));var N=null;return o&&(N=E.default.createElement("li",{className:"divider"})),E.default.createElement("div",{className:"sidebar--menu",id:"sidebar-menu"},E.default.createElement("div",{className:"team__header theme"},E.default.createElement(y.Link,{className:"team__name",to:"/channels/town-square"},v)),E.default.createElement("div",{className:"nav-pills__container"},C,E.default.createElement("ul",{className:"nav nav-pills nav-stacked"},E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:this.searchMentions},E.default.createElement("i",{className:"icon mentions"},"@"),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.recentMentions",defaultMessage:"Recent Mentions"}))),E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:this.getFlagged},E.default.createElement("i",{className:"icon fa fa-flag"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.flagged",defaultMessage:"Flagged Posts"}))),E.default.createElement("li",{className:"divider"}),E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:function(){return _.showAccountSettingsModal()}},E.default.createElement("i",{className:"icon fa fa-cog"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.accountSettings",defaultMessage:"Account Settings"}))),E.default.createElement("li",{className:"divider"}),n,a,s,T,i,r,c,l,p,N,o,E.default.createElement("li",{className:"divider"}),S,M,w,E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:this.handleAboutModal},E.default.createElement("i",{className:"icon fa fa-info"}),E.default.createElement(b.FormattedMessage,{id:"navbar_dropdown.about",defaultMessage:"About Mattermost"}))),E.default.createElement("li",{className:"divider"}),E.default.createElement("li",null,E.default.createElement("a",{href:"#",onClick:function(){return _.emitUserLoggedOutEvent()}},E.default.createElement("i",{className:"icon fa fa-sign-out"}),E.default.createElement(b.FormattedMessage,{id:"sidebar_right_menu.logout",defaultMessage:"Logout"}))))),E.default.createElement(G.default,{show:this.state.showAboutModal,onModalDismissed:this.aboutModalDismissed}),k)}}]),a}(E.default.Component);t.default=Q,Q.propTypes={teamType:g.default.string,teamDisplayName:g.default.string}}).call(t,a(22))},2436:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(1),v=n(g),E=a(47),b=n(E),y=a(17),S=a(16),_=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(S),M=a(2197),C=n(M),w=a(2437),k=n(w),T=(0,y.defineMessages)({generalTab:{id:"team_settings_modal.generalTab",defaultMessage:"General"},importTab:{id:"team_settings_modal.importTab",defaultMessage:"Import"}}),N=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.updateTab=a.updateTab.bind(a),a.updateSection=a.updateSection.bind(a),a.state={activeTab:"general",activeSection:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){var e=(0,p.default)(b.default.findDOMNode(this.refs.modal));e.on("click",".modal-back",function(){(0,p.default)(this).closest(".modal-dialog").removeClass("display--content"),(0,p.default)(this).closest(".modal-dialog").find(".settings-table .nav li.active").removeClass("active")}),e.on("click",".modal-header .close",function(){setTimeout(function(){(0,p.default)(".modal-dialog.display--content").removeClass("display--content")},500)}),_.isMobile()||(0,p.default)(".settings-modal .settings-content").perfectScrollbar()}},{key:"updateTab",value:function(e){this.setState({activeTab:e,activeSection:""}),_.isMobile()||(0,p.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update")}},{key:"updateSection",value:function(e){(0,p.default)(".section-max").length&&(0,p.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update"),this.setState({activeSection:e})}},{key:"render",value:function(){var e=this.props.intl.formatMessage,t=[];return t.push({name:"general",uiName:e(T.generalTab),icon:"icon fa fa-cog"}),t.push({name:"import",uiName:e(T.importTab),icon:"icon fa fa-upload"}),v.default.createElement("div",{className:"modal fade",ref:"modal",id:"team_settings",role:"dialog",tabIndex:"-1","aria-hidden":"true"},v.default.createElement("div",{className:"modal-dialog settings-modal"},v.default.createElement("div",{className:"modal-content"},v.default.createElement("div",{className:"modal-header"},v.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},v.default.createElement("span",{"aria-hidden":"true"},"Ã—")),v.default.createElement("h4",{className:"modal-title",ref:"title"},v.default.createElement(y.FormattedMessage,{id:"team_settings_modal.title",defaultMessage:"Team Settings"}))),v.default.createElement("div",{className:"modal-body settings-modal__body"},v.default.createElement("div",{className:"settings-table"},v.default.createElement("div",{className:"settings-links"},v.default.createElement(C.default,{tabs:t,activeTab:this.state.activeTab,updateTab:this.updateTab})),v.default.createElement("div",{className:"settings-content minimize-settings"},v.default.createElement(k.default,{activeTab:this.state.activeTab,activeSection:this.state.activeSection,updateSection:this.updateSection})))))))}}]),t}(v.default.Component);N.propTypes={intl:y.intlShape.isRequired},t.default=(0,y.injectIntl)(N)},2437:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(35),b=n(E),y=a(16),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(2438),M=n(_),C=a(2439),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.onChange=a.onChange.bind(a),a.state={team:b.default.getCurrent()},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){b.default.removeChangeListener(this.onChange)}},{key:"onChange",value:function(){var e=b.default.getCurrent();S.areObjectsEqual(this.state.team,e)||this.setState({team:e})}},{key:"render",value:function(){if(!this.state.team)return null;var e;switch(this.props.activeTab){case"general":e=v.default.createElement("div",null,v.default.createElement(M.default,{team:this.state.team,activeSection:this.props.activeSection,updateSection:this.props.updateSection}));break;case"import":e=v.default.createElement("div",null,v.default.createElement(w.default,{team:this.state.team,activeSection:this.props.activeSection,updateSection:this.props.updateSection}));break;default:e=v.default.createElement("div",null)}return e}}]),t}(v.default.Component);t.default=k,k.defaultProps={activeTab:"",activeSection:""},k.propTypes={activeTab:p.default.string.isRequired,activeSection:p.default.string.isRequired,updateSection:p.default.func.isRequired}},2438:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(19),i=n(s),r=a(6),o=n(r),l=a(4),d=n(l),u=a(5),c=n(u),f=a(7),m=n(f),h=a(8),p=n(h),g=a(0),v=n(g),E=a(2),b=n(E),y=a(1),S=n(y),_=a(17),M=a(435),C=a(9),w=n(C),k=a(16),T=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(k),N=a(736),P=n(N),I=a(737),L=n(I),D=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.updateSection=a.updateSection.bind(a),a.handleNameSubmit=a.handleNameSubmit.bind(a),a.handleInviteIdSubmit=a.handleInviteIdSubmit.bind(a),a.handleOpenInviteSubmit=a.handleOpenInviteSubmit.bind(a),a.handleDescriptionSubmit=a.handleDescriptionSubmit.bind(a),a.handleClose=a.handleClose.bind(a),a.onUpdateNameSection=a.onUpdateNameSection.bind(a),a.updateName=a.updateName.bind(a),a.updateDescription=a.updateDescription.bind(a),a.onUpdateDescriptionSection=a.onUpdateDescriptionSection.bind(a),a.onUpdateInviteIdSection=a.onUpdateInviteIdSection.bind(a),a.updateInviteId=a.updateInviteId.bind(a),a.onUpdateOpenInviteSection=a.onUpdateOpenInviteSection.bind(a),a.handleOpenInviteRadio=a.handleOpenInviteRadio.bind(a),a.handleGenerateInviteId=a.handleGenerateInviteId.bind(a),a.state=a.setupInitialState(e),a}return(0,p.default)(t,e),(0,c.default)(t,[{key:"updateSection",value:function(e){(0,v.default)(".section-max").length&&(0,v.default)(".settings-modal .modal-body").scrollTop(0).perfectScrollbar("update"),this.setState(this.setupInitialState(this.props)),this.props.updateSection(e)}},{key:"setupInitialState",value:function(e){var t=e.team;return{name:t.display_name,invite_id:t.invite_id,allow_open_invite:t.allow_open_invite,description:t.description,serverError:"",clientError:""}}},{key:"componentWillReceiveProps",value:function(e){this.setState({name:e.team.display_name,description:e.team.description,invite_id:e.team.invite_id,allow_open_invite:e.team.allow_open_invite})}},{key:"handleGenerateInviteId",value:function(e){e.preventDefault();for(var t="",a=0;a<32;a++)t+=Math.floor(16*Math.random()).toString(16);this.setState({invite_id:t})}},{key:"handleOpenInviteRadio",value:function(e){this.setState({allow_open_invite:e})}},{key:"handleOpenInviteSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=(0,i.default)({},this.props.team);n.allow_open_invite=this.state.allow_open_invite,(0,M.updateTeam)(n,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}},{key:"handleNameSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.name.trim()?a.clientError="":(a.clientError=T.localizeMessage("general_tab.required","This field is required"),n=!1),this.setState(a),n){var s=(0,i.default)({},this.props.team);s.display_name=this.state.name,(0,M.updateTeam)(s,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"handleInviteIdSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.invite_id.trim()?a.clientError="":(a.clientError=T.localizeMessage("general_tab.required","This field is required"),n=!1),this.setState(a),n){var s=(0,i.default)({},this.props.team);s.invite_id=this.state.invite_id,(0,M.updateTeam)(s,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"handleClose",value:function(){this.updateSection("")}},{key:"handleDescriptionSubmit",value:function(e){var t=this;e.preventDefault();var a={serverError:"",clientError:""},n=!0;if(this.state.description.trim()===this.props.team.description?(a.clientError=T.localizeMessage("general_tab.chooseDescription","Please choose a new description for your team"),n=!1):a.clientError="",this.setState(a),n){var s=(0,i.default)({},this.props.team);s.description=this.state.description,(0,M.updateTeam)(s,function(){t.updateSection("")},function(e){a.serverError=e.message,t.setState(a)})}}},{key:"componentDidMount",value:function(){(0,v.default)("#team_settings").on("hidden.bs.modal",this.handleClose)}},{key:"componentWillUnmount",value:function(){(0,v.default)("#team_settings").off("hidden.bs.modal",this.handleClose)}},{key:"onUpdateNameSection",value:function(e){e.preventDefault(),"name"===this.props.activeSection?this.updateSection(""):this.updateSection("name")}},{key:"onUpdateDescriptionSection",value:function(e){e.preventDefault(),"description"===this.props.activeSection?this.updateSection(""):this.updateSection("description")}},{key:"onUpdateInviteIdSection",value:function(e){e.preventDefault(),"invite_id"===this.props.activeSection?this.updateSection(""):this.updateSection("invite_id")}},{key:"onUpdateOpenInviteSection",value:function(e){e.preventDefault(),"open_invite"===this.props.activeSection?this.updateSection(""):this.updateSection("open_invite")}},{key:"updateName",value:function(e){this.setState({name:e.target.value})}},{key:"updateDescription",value:function(e){this.setState({description:e.target.value})}},{key:"updateInviteId",value:function(e){this.setState({invite_id:e.target.value})}},{key:"render",value:function(){var e=null,t=null;this.state.clientError&&(e=this.state.clientError),this.state.serverError&&(t=this.state.serverError);var a=void 0;if("open_invite"===this.props.activeSection){var n=[S.default.createElement("div",{key:"userOpenInviteOptions"},S.default.createElement("div",{className:"radio"},S.default.createElement("label",null,S.default.createElement("input",{id:"teamOpenInvite",name:"userOpenInviteOptions",type:"radio",defaultChecked:this.state.allow_open_invite,onChange:this.handleOpenInviteRadio.bind(this,!0)}),S.default.createElement(_.FormattedMessage,{id:"general_tab.yes",defaultMessage:"Yes"})),S.default.createElement("br",null)),S.default.createElement("div",{className:"radio"},S.default.createElement("label",null,S.default.createElement("input",{id:"teamOpenInviteNo",name:"userOpenInviteOptions",type:"radio",defaultChecked:!this.state.allow_open_invite,onChange:this.handleOpenInviteRadio.bind(this,!1)}),S.default.createElement(_.FormattedMessage,{id:"general_tab.no",defaultMessage:"No"})),S.default.createElement("br",null)),S.default.createElement("div",null,S.default.createElement("br",null),S.default.createElement(_.FormattedMessage,{id:"general_tab.openInviteDesc",defaultMessage:"When allowed, a link to this team will be included on the landing page allowing anyone with an account to join this team."})))];a=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.openInviteTitle","Allow any user with an account on this server to join this team"),inputs:n,submit:this.handleOpenInviteSubmit,server_error:t,updateSection:this.onUpdateOpenInviteSection})}else{var s="";s=!0===this.state.allow_open_invite?T.localizeMessage("general_tab.yes","Yes"):T.localizeMessage("general_tab.no","No"),a=S.default.createElement(L.default,{title:T.localizeMessage("general_tab.openInviteTitle","Allow any user with an account on this server to join this team"),describe:s,updateSection:this.onUpdateOpenInviteSection})}var i=void 0;if("invite_id"===this.props.activeSection){var r=[];r.push(S.default.createElement("div",{key:"teamInviteSetting"},S.default.createElement("div",{className:"row"},S.default.createElement("label",{className:"col-sm-5 control-label visible-xs-block"}),S.default.createElement("div",{className:"col-sm-12"},S.default.createElement("input",{id:"teamInviteId",className:"form-control",type:"text",onChange:this.updateInviteId,value:this.state.invite_id,maxLength:"32"}),S.default.createElement("div",{className:"padding-top x2"},S.default.createElement("button",{id:"teamInviteIdRegenerate",className:"color--link style--none",onClick:this.handleGenerateInviteId},S.default.createElement(_.FormattedMessage,{id:"general_tab.regenerate",defaultMessage:"Regenerate"}))))),S.default.createElement("div",{className:"setting-list__hint"},S.default.createElement(_.FormattedMessage,{id:"general_tab.codeLongDesc",defaultMessage:"The Invite Code is used as part of the URL in the team invitation link created by {getTeamInviteLink} in the main menu. Regenerating creates a new team invitation link and invalidates the previous link.",values:{getTeamInviteLink:S.default.createElement("strong",null,S.default.createElement(_.FormattedMessage,{id:"general_tab.getTeamInviteLink",defaultMessage:"Get Team Invite Link"}))}})))),i=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.codeTitle","Invite Code"),inputs:r,submit:this.handleInviteIdSubmit,server_error:t,client_error:e,updateSection:this.onUpdateInviteIdSection})}else i=S.default.createElement(L.default,{title:T.localizeMessage("general_tab.codeTitle","Invite Code"),describe:T.localizeMessage("general_tab.codeDesc","Click 'Edit' to regenerate Invite Code."),updateSection:this.onUpdateInviteIdSection});var o=void 0;if("name"===this.props.activeSection){var l=[],d=S.default.createElement(_.FormattedMessage,{id:"general_tab.teamName",defaultMessage:"Team Name"});T.isMobile()&&(d=""),l.push(S.default.createElement("div",{key:"teamNameSetting",className:"form-group"},S.default.createElement("label",{className:"col-sm-5 control-label"},d),S.default.createElement("div",{className:"col-sm-7"},S.default.createElement("input",{id:"teamName",className:"form-control",type:"text",maxLength:w.default.MAX_TEAMNAME_LENGTH.toString(),onChange:this.updateName,value:this.state.name}))));var u=S.default.createElement("span",null,T.localizeMessage("general_tab.teamNameInfo","Set the name of the team as it appears on your sign-in screen and at the top of the left-hand sidebar."));o=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.teamName","Team Name"),inputs:l,submit:this.handleNameSubmit,server_error:t,client_error:e,updateSection:this.onUpdateNameSection,extraInfo:u})}else{var c=this.state.name;o=S.default.createElement(L.default,{title:T.localizeMessage("general_tab.teamName","Team Name"),describe:c,updateSection:this.onUpdateNameSection})}var f=void 0;if("description"===this.props.activeSection){var m=[],h=S.default.createElement(_.FormattedMessage,{id:"general_tab.teamDescription",defaultMessage:"Team Description"});T.isMobile()&&(h=""),m.push(S.default.createElement("div",{key:"teamDescriptionSetting",className:"form-group"},S.default.createElement("label",{className:"col-sm-5 control-label"},h),S.default.createElement("div",{className:"col-sm-7"},S.default.createElement("input",{id:"teamDescription",className:"form-control",type:"text",maxLength:w.default.MAX_TEAMDESCRIPTION_LENGTH.toString(),onChange:this.updateDescription,value:this.state.description}))));var p=S.default.createElement("span",null,T.localizeMessage("general_tab.teamDescriptionInfo","Team description provides additional information to help users select the right team. Maximum of 50 characters."));f=S.default.createElement(P.default,{title:T.localizeMessage("general_tab.teamDescription","Team Description"),inputs:m,submit:this.handleDescriptionSubmit,server_error:t,client_error:e,updateSection:this.onUpdateDescriptionSection,extraInfo:p})}else{var g="";g=this.state.description?this.state.description:S.default.createElement(_.FormattedMessage,{id:"general_tab.emptyDescription",defaultMessage:"Click 'Edit' to add a team description."}),f=S.default.createElement(L.default,{title:T.localizeMessage("general_tab.teamDescription","Team Description"),describe:g,updateSection:this.onUpdateDescriptionSection})}return S.default.createElement("div",null,S.default.createElement("div",{className:"modal-header"},S.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},S.default.createElement("span",{"aria-hidden":"true"},"Ã—")),S.default.createElement("h4",{className:"modal-title",ref:"title"},S.default.createElement("div",{className:"modal-back"},S.default.createElement("i",{className:"fa fa-angle-left"})),S.default.createElement(_.FormattedMessage,{id:"general_tab.title",defaultMessage:"General Settings"}))),S.default.createElement("div",{ref:"wrapper",className:"user-settings"},S.default.createElement("h3",{className:"tab-header"},S.default.createElement(_.FormattedMessage,{id:"general_tab.title",defaultMessage:"General Settings"})),S.default.createElement("div",{className:"divider-dark first"}),o,S.default.createElement("div",{className:"divider-light"}),f,S.default.createElement("div",{className:"divider-light"}),a,S.default.createElement("div",{className:"divider-light"}),i,S.default.createElement("div",{className:"divider-dark"})))}}]),t}(S.default.Component);D.propTypes={updateSection:b.default.func.isRequired,team:b.default.object.isRequired,activeSection:b.default.string.isRequired},t.default=D},2439:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(17),v=a(16),E=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(v),b=a(2440),y=n(b),S=(0,g.defineMessages)({importSlack:{id:"team_import_tab.importSlack",defaultMessage:"Import from Slack (Beta)"}}),_=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.onImportFailure=a.onImportFailure.bind(a),a.onImportSuccess=a.onImportSuccess.bind(a),a.doImportSlack=a.doImportSlack.bind(a),a.state={status:"ready",link:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"onImportFailure",value:function(){this.setState({status:"fail"})}},{key:"onImportSuccess",value:function(e){this.setState({status:"done",link:"data:application/octet-stream;charset=utf-8,"+encodeURIComponent(atob(e.results))})}},{key:"doImportSlack",value:function(e){this.setState({status:"in-progress",link:""}),E.importSlack(e,this.onImportSuccess,this.onImportFailure)}},{key:"render",value:function(){var e,t=this.props.intl.formatMessage,a=p.default.createElement("a",{href:"https://docs.mattermost.com/administration/migrating.html#migrating-from-slack",target:"_blank",rel:"noopener noreferrer"},p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpDocsLink",defaultMessage:"documentation"})),n=p.default.createElement("strong",null,p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpExportInstructions",defaultMessage:"Slack > Team Settings > Import/Export Data > Export > Start Export"})),s=p.default.createElement("a",{href:"https://github.com/grundleborg/slack-advanced-exporter",target:"_blank",rel:"noopener noreferrer"},p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpExporterLink",defaultMessage:"Slack Advanced Exporter"})),i=p.default.createElement("div",null,p.default.createElement("p",null,p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpLine1",defaultMessage:"Slack import to Mattermost supports importing of messages in your Slack team's public channels."})),p.default.createElement("p",null,p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpLine2",defaultMessage:"To import a team from Slack, go to {exportInstructions}. See {uploadDocsLink} to learn more.",values:{exportInstructions:n,uploadDocsLink:a}})),p.default.createElement("p",null,p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importHelpLine3",defaultMessage:"To import posts with attached files, see {slackAdvancedExporterLink} for details.",values:{slackAdvancedExporterLink:s}}))),r=p.default.createElement(y.default,{title:t(S.importSlack),submit:this.doImportSlack,helpText:i,fileTypesAccepted:".zip"});switch(this.state.status){case"ready":e="";break;case"in-progress":e=p.default.createElement("p",{className:"confirm-import alert alert-warning"},p.default.createElement("i",{className:"fa fa-spinner fa-pulse"}),p.default.createElement(g.FormattedMessage,{id:"team_import_tab.importing",defaultMessage:" Importing..."}));break;case"done":e=p.default.createElement("p",{className:"confirm-import alert alert-success"},p.default.createElement("i",{className:"fa fa-check"}),p.default.createElement(g.FormattedMessage,{id:"team_import_tab.successful",defaultMessage:" Import successful: "}),p.default.createElement("a",{href:this.state.link,download:"MattermostImportSummary.txt"},p.default.createElement(g.FormattedMessage,{id:"team_import_tab.summary",defaultMessage:"View Summary"})));break;case"fail":e=p.default.createElement("p",{className:"confirm-import alert alert-warning"},p.default.createElement("i",{className:"fa fa-warning"}),p.default.createElement(g.FormattedMessage,{id:"team_import_tab.failure",defaultMessage:" Import failure: "}),p.default.createElement("a",{href:this.state.link,download:"MattermostImportSummary.txt"},p.default.createElement(g.FormattedMessage,{id:"team_import_tab.summary",defaultMessage:"View Summary"})))}return p.default.createElement("div",null,p.default.createElement("div",{className:"modal-header"},p.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":"Close"},p.default.createElement("span",{"aria-hidden":"true"},"Ã—")),p.default.createElement("h4",{className:"modal-title",ref:"title"},p.default.createElement("div",{className:"modal-back"},p.default.createElement("i",{className:"fa fa-angle-left"})),p.default.createElement(g.FormattedMessage,{id:"team_import_tab.import",defaultMessage:"Import"}))),p.default.createElement("div",{ref:"wrapper",className:"user-settings"},p.default.createElement("h3",{className:"tab-header"},p.default.createElement(g.FormattedMessage,{id:"team_import_tab.import",defaultMessage:"Import"})),p.default.createElement("div",{className:"divider-dark first"}),r,p.default.createElement("div",{className:"divider-dark"}),e))}}]),t}(p.default.Component);_.propTypes={intl:g.intlShape.isRequired},t.default=(0,g.injectIntl)(_)},2440:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(47),S=n(y),_=a(17),M=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.doFileSelect=a.doFileSelect.bind(a),a.doSubmit=a.doSubmit.bind(a),a.state={clientError:a.props.clientError,serverError:a.props.serverError,filename:""},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentWillReceiveProps",value:function(){this.setState({clientError:this.props.clientError,serverError:this.props.serverError})}},{key:"doFileSelect",value:function(e){e.preventDefault();var t=(0,p.default)(e.target).val();"fakepath"===t.substring(3,11)&&(t=t.substring(12)),this.setState({clientError:"",serverError:"",filename:t})}},{key:"doSubmit",value:function(e){e.preventDefault();var t=S.default.findDOMNode(this.refs.uploadinput);t.files&&t.files[0]?this.props.submit(t.files[0]):this.setState({clientError:!0})}},{key:"render",value:function(){var e=null;this.state.clientError&&(e=b.default.createElement("div",{className:"file-status"},b.default.createElement(_.FormattedMessage,{id:"setting_upload.noFile",defaultMessage:"No file selected."})));var t=null;this.state.serverError&&(t=b.default.createElement("div",{className:"file-status"},this.state.serverError));var a=null,n="btn btn-sm btn-primary disabled";return this.state.filename&&(a=b.default.createElement("div",{className:"file-status file-name"},this.state.filename),n="btn btn-sm btn-primary"),b.default.createElement("ul",{className:"section-max"},b.default.createElement("li",{className:"col-sm-12 section-title"},this.props.title),b.default.createElement("li",{className:"col-sm-offset-3 col-sm-9"},this.props.helpText),b.default.createElement("li",{className:"col-sm-offset-3 col-sm-9"},b.default.createElement("ul",{className:"setting-list"},b.default.createElement("li",{className:"setting-list-item"},b.default.createElement("span",{className:"btn btn-sm btn-primary btn-file sel-btn"},b.default.createElement(_.FormattedMessage,{id:"setting_upload.select",defaultMessage:"Select file"}),b.default.createElement("input",{ref:"uploadinput",accept:this.props.fileTypesAccepted,type:"file",onChange:this.doFileSelect})),b.default.createElement("a",{className:n,onClick:this.doSubmit},b.default.createElement(_.FormattedMessage,{id:"setting_upload.import",defaultMessage:"Import"})),a,t,e))))}}]),t}(b.default.Component);t.default=M,M.propTypes={title:v.default.string.isRequired,submit:v.default.func.isRequired,fileTypesAccepted:v.default.string.isRequired,clientError:v.default.string,serverError:v.default.string,helpText:v.default.object}},2441:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(40),v=a(17),E=a(2080),b=n(E),y=a(9),S=n(y),_=S.default.ActionTypes,M=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.updateShow=a.updateShow.bind(a),a.handleSubmit=a.handleSubmit.bind(a),a.handleChange=a.handleChange.bind(a),a.state={value:"",inputError:"",show:!1,callback:null},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addModalListener(_.TOGGLE_IMPORT_THEME_MODAL,this.updateShow)}},{key:"componentWillUnmount",value:function(){b.default.removeModalListener(_.TOGGLE_IMPORT_THEME_MODAL,this.updateShow)}},{key:"updateShow",value:function(e,t){this.setState({show:e,callback:t.callback})}},{key:"handleSubmit",value:function(e){e.preventDefault();var t=this.state.value;if(!this.isInputValid(t))return void this.setState({inputError:p.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.submitError",defaultMessage:"Invalid format, please try copying and pasting in again."})});var a=t.split(","),n={type:"custom"};n.sidebarBg=a[0],n.sidebarText=a[5],n.sidebarUnreadText=a[5],n.sidebarTextHoverBg=a[4],n.sidebarTextActiveBorder=a[2],n.sidebarTextActiveColor=a[3],n.sidebarHeaderBg=a[1],n.sidebarHeaderTextColor=a[5],n.onlineIndicator=a[6],n.awayIndicator="#E0B333",n.mentionBj=a[7],n.mentionColor="#ffffff",n.centerChannelBg="#ffffff",n.centerChannelColor="#333333",n.newMessageSeparator="#F80",n.linkColor="#2389d7",n.buttonBg="#26a970",n.buttonColor="#ffffff",n.mentionHighlightBg="#fff2bb",n.mentionHighlightLink="#2f81b7",n.codeTheme="github",this.state.callback(n),this.setState({show:!1,callback:null})}},{key:"isInputValid",value:function(e){if(0===e.length)return!1;if(-1!==e.indexOf(" "))return!1;if(e.length>0&&-1===e.indexOf(","))return!1;if(e.length>0){var t=e.split(",");if(8!==t.length)return!1;for(var a=0;a<t.length;a++){if(7!==t[a].length&&4!==t[a].length)return!1;if("#"!==t[a].charAt(0))return!1}}return!0}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({value:t}),this.isInputValid(t)?this.setState({inputError:null}):this.setState({inputError:p.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.submitError",defaultMessage:"Invalid format, please try copying and pasting in again."})})}},{key:"render",value:function(){var e=this;return p.default.createElement("span",null,p.default.createElement(g.Modal,{show:this.state.show,onHide:function(){return e.setState({show:!1})}},p.default.createElement(g.Modal.Header,{closeButton:!0},p.default.createElement(g.Modal.Title,null,p.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.importHeader",defaultMessage:"Import Slack Theme"}))),p.default.createElement("form",{role:"form",className:"form-horizontal"},p.default.createElement(g.Modal.Body,null,p.default.createElement("p",null,p.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.importBody",defaultMessage:'To import a theme, go to a Slack team and look for "Preferences -> Sidebar Theme". Open the custom theme option, copy the theme color values and paste them here:'})),p.default.createElement("div",{className:"form-group less"},p.default.createElement("div",{className:"col-sm-12"},p.default.createElement("input",{id:"themeVector",type:"text",className:"form-control",value:this.state.value,onChange:this.handleChange}),p.default.createElement("div",{className:"input__help"},this.state.inputError)))),p.default.createElement(g.Modal.Footer,null,p.default.createElement("button",{id:"cancelButton",type:"button",className:"btn btn-default",onClick:function(){return e.setState({show:!1})}},p.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.cancel",defaultMessage:"Cancel"})),p.default.createElement("button",{id:"submitButton",onClick:this.handleSubmit,type:"submit",className:"btn btn-primary",tabIndex:"3"},p.default.createElement(v.FormattedMessage,{id:"user.settings.import_theme.submit",defaultMessage:"Submit"}))))))}}]),t}(p.default.Component);t.default=M},2442:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(1),v=n(g),E=a(40),b=a(47),y=n(b),S=a(17),_=a(2080),M=n(_),C=a(25),w=n(C),k=a(9),T=n(k),N=a(16),P=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(N),I=a(311),L=n(I),D=a(2197),R=n(D),A=a(2443),O=n(A),F=(0,S.defineMessages)({general:{id:"user.settings.modal.general",defaultMessage:"General"},security:{id:"user.settings.modal.security",defaultMessage:"Security"},notifications:{id:"user.settings.modal.notifications",defaultMessage:"Notifications"},display:{id:"user.settings.modal.display",defaultMessage:"Display"},advanced:{id:"user.settings.modal.advanced",defaultMessage:"Advanced"},confirmTitle:{id:"user.settings.modal.confirmTitle",defaultMessage:"Discard Changes?"},confirmMsg:{id:"user.settings.modal.confirmMsg",defaultMessage:"You have unsaved changes, are you sure you want to discard them?"},confirmBtns:{id:"user.settings.modal.confirmBtns",defaultMessage:"Yes, Discard"}}),x=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.handleHide=a.handleHide.bind(a),a.handleHidden=a.handleHidden.bind(a),a.handleCollapse=a.handleCollapse.bind(a),a.handleConfirm=a.handleConfirm.bind(a),a.handleCancelConfirmation=a.handleCancelConfirmation.bind(a),a.handleToggle=a.handleToggle.bind(a),a.handleKeyDown=a.handleKeyDown.bind(a),a.closeModal=a.closeModal.bind(a),a.collapseModal=a.collapseModal.bind(a),a.updateTab=a.updateTab.bind(a),a.updateSection=a.updateSection.bind(a),a.onUserChanged=a.onUserChanged.bind(a),a.state={active_tab:"general",active_section:"",showConfirmModal:!1,enforceFocus:!0,currentUser:w.default.getCurrentUser(),show:!1},a.requireConfirm=!1,a.mounted=!1,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"onUserChanged",value:function(){this.mounted&&this.setState({currentUser:w.default.getCurrentUser()})}},{key:"componentDidMount",value:function(){this.mounted=!0,w.default.addChangeListener(this.onUserChanged),M.default.addModalListener(T.default.ActionTypes.TOGGLE_ACCOUNT_SETTINGS_MODAL,this.handleToggle),document.addEventListener("keydown",this.handleKeyDown)}},{key:"componentWillUnmount",value:function(){this.mounted=!1,M.default.removeModalListener(T.default.ActionTypes.TOGGLE_ACCOUNT_SETTINGS_MODAL,this.handleToggle),document.removeEventListener("keydown",this.handleKeyDown)}},{key:"componentDidUpdate",value:function(){w.default.removeChangeListener(this.onUserChanged),P.isMobile()||(0,p.default)(".settings-content .minimize-settings").perfectScrollbar("update")}},{key:"handleKeyDown",value:function(e){P.cmdOrCtrlPressed(e)&&e.shiftKey&&e.keyCode===T.default.KeyCodes.A&&this.setState({show:!this.state.show})}},{key:"handleToggle",value:function(e){this.setState({show:e})}},{key:"handleHide",value:function(){var e=this;if(this.requireConfirm)return this.afterConfirm=function(){return e.handleHide()},void this.showConfirmModal();this.setState({show:!1})}},{key:"handleHidden",value:function(){this.setState({active_tab:"general",active_section:""})}},{key:"handleCollapse",value:function(){(0,p.default)(y.default.findDOMNode(this.refs.modalBody)).closest(".modal-dialog").removeClass("display--content"),this.setState({active_tab:"",active_section:""})}},{key:"handleConfirm",value:function(){this.setState({showConfirmModal:!1,enforceFocus:!0}),this.requireConfirm=!1,this.afterConfirm&&(this.afterConfirm(),this.afterConfirm=null)}},{key:"handleCancelConfirmation",value:function(){this.setState({showConfirmModal:!1,enforceFocus:!0}),this.afterConfirm=null}},{key:"showConfirmModal",value:function(e){this.setState({showConfirmModal:!0,enforceFocus:!1}),e&&(this.afterConfirm=e)}},{key:"closeModal",value:function(){this.requireConfirm?this.showConfirmModal(this.closeModal):this.handleHide()}},{key:"collapseModal",value:function(){this.requireConfirm?this.showConfirmModal(this.collapseModal):this.handleCollapse()}},{key:"updateTab",value:function(e,t){var a=this;!t&&this.requireConfirm?this.showConfirmModal(function(){return a.updateTab(e,!0)}):this.setState({active_tab:e,active_section:""})}},{key:"updateSection",value:function(e,t){var a=this;!t&&this.requireConfirm?this.showConfirmModal(function(){return a.updateSection(e,!0)}):this.setState({active_section:e})}},{key:"render",value:function(){var e=this,t=this.props.intl.formatMessage;if(null==this.state.currentUser)return v.default.createElement("div",null);var a=[];return a.push({name:"general",uiName:t(F.general),icon:"icon fa fa-gear"}),a.push({name:"security",uiName:t(F.security),icon:"icon fa fa-lock"}),a.push({name:"notifications",uiName:t(F.notifications),icon:"icon fa fa-exclamation-circle"}),a.push({name:"display",uiName:t(F.display),icon:"icon fa fa-eye"}),a.push({name:"advanced",uiName:t(F.advanced),icon:"icon fa fa-list-alt"}),v.default.createElement(E.Modal,{id:"accountSettingsModal",dialogClassName:"settings-modal",show:this.state.show,onHide:this.handleHide,onExited:this.handleHidden,enforceFocus:this.state.enforceFocus},v.default.createElement(E.Modal.Header,{id:"accountSettingsHeader",closeButton:!0},v.default.createElement(E.Modal.Title,{id:"accountSettingsTitle"},v.default.createElement(S.FormattedMessage,{id:"user.settings.modal.title",defaultMessage:"Account Settings"}))),v.default.createElement(E.Modal.Body,{ref:"modalBody"},v.default.createElement("div",{className:"settings-table"},v.default.createElement("div",{className:"settings-links"},v.default.createElement(R.default,{tabs:a,activeTab:this.state.active_tab,updateTab:this.updateTab})),v.default.createElement("div",{className:"settings-content minimize-settings"},v.default.createElement(O.default,{ref:"userSettings",activeTab:this.state.active_tab,activeSection:this.state.active_section,updateSection:this.updateSection,updateTab:this.updateTab,closeModal:this.closeModal,collapseModal:this.collapseModal,setEnforceFocus:function(t){return e.setState({enforceFocus:t})},setRequireConfirm:function(t){e.requireConfirm=t}})))),v.default.createElement(L.default,{title:t(F.confirmTitle),message:t(F.confirmMsg),confirmButtonText:t(F.confirmBtns),show:this.state.showConfirmModal,onConfirm:this.handleConfirm,onCancel:this.handleCancelConfirmation}))}}]),t}(v.default.Component);x.propTypes={intl:S.intlShape.isRequired},t.default=(0,S.injectIntl)(x)},2443:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(25),b=n(E),y=a(16),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(2444),M=n(_),C=a(2445),w=n(C),k=a(2453),T=n(k),N=a(2457),P=n(N),I=a(2460),L=n(I),D=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.onListenerChange=a.onListenerChange.bind(a),a.state={user:b.default.getCurrentUser()},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){b.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){b.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){var e=b.default.getCurrentUser();S.areObjectsEqual(this.state.user,e)||this.setState({user:e})}},{key:"render",value:function(){return"general"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(T.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"security"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(L.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setEnforceFocus:this.props.setEnforceFocus})):"notifications"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(P.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):"display"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(w.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal,setEnforceFocus:this.props.setEnforceFocus,setRequireConfirm:this.props.setRequireConfirm})):"advanced"===this.props.activeTab?v.default.createElement("div",null,v.default.createElement(M.default,{user:this.state.user,activeSection:this.props.activeSection,updateSection:this.props.updateSection,updateTab:this.props.updateTab,closeModal:this.props.closeModal,collapseModal:this.props.collapseModal})):v.default.createElement("div",null)}}]),t}(v.default.Component);t.default=D,D.propTypes={activeTab:p.default.string,activeSection:p.default.string,updateSection:p.default.func,updateTab:p.default.func,closeModal:p.default.func.isRequired,collapseModal:p.default.func.isRequired,setEnforceFocus:p.default.func.isRequired,setRequireConfirm:p.default.func.isRequired}},2444:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(183),i=n(s),r=a(48),o=n(r),l=a(59),d=n(l),u=a(6),c=n(u),f=a(4),m=n(f),h=a(5),p=n(h),g=a(7),v=n(g),E=a(8),b=n(E),y=a(2),S=n(y),_=a(1),M=n(_),C=a(17),w=a(69),k=a(119),T=n(k),N=a(25),P=n(N),I=a(9),L=n(I),D=a(16),R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(D),A=a(736),O=n(A),F=a(737),x=n(F),U=L.default.PRE_RELEASE_FEATURES,H=function(t){function a(e){(0,m.default)(this,a);var t=(0,v.default)(this,(a.__proto__||(0,c.default)(a)).call(this,e));return t.getStateFromStores=t.getStateFromStores.bind(t),t.updateSection=t.updateSection.bind(t),t.updateSetting=t.updateSetting.bind(t),t.toggleFeature=t.toggleFeature.bind(t),t.saveEnabledFeatures=t.saveEnabledFeatures.bind(t),t.renderFormattingSection=t.renderFormattingSection.bind(t),t.renderJoinLeaveSection=t.renderJoinLeaveSection.bind(t),t.state=t.getStateFromStores(),t}return(0,b.default)(a,t),(0,p.default)(a,[{key:"getStateFromStores",value:function(){var t=(0,d.default)(U),a=T.default.getCategory(L.default.Preferences.CATEGORY_ADVANCED_SETTINGS),n={send_on_ctrl_enter:T.default.get(L.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"send_on_ctrl_enter","false"),formatting:T.default.get(L.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"formatting","true"),join_leave:T.default.get(L.default.Preferences.CATEGORY_ADVANCED_SETTINGS,"join_leave","true")};"true"===e.mm_config.EnableWebrtc||(t=t.filter(function(e){return"WEBRTC_PREVIEW"!==e}));var s=0,r=!0,l=!1,u=void 0;try{for(var c,f=(0,o.default)(a);!(r=(c=f.next()).done);r=!0){var m=(0,i.default)(c.value,2),h=m[0],p=m[1],g=!0,v=!1,E=void 0;try{for(var b,y=(0,o.default)(t);!(g=(b=y.next()).done);g=!0){var S=b.value,_=U[S];h===L.default.FeatureTogglePrefix+_.label&&(n[h]=p,"true"===p&&(s+=1))}}catch(e){v=!0,E=e}finally{try{!g&&y.return&&y.return()}finally{if(v)throw E}}}}catch(e){l=!0,u=e}finally{try{!r&&f.return&&f.return()}finally{if(l)throw u}}return{preReleaseFeatures:U,settings:n,preReleaseFeaturesKeys:t,enabledFeatures:s,isSaving:!1}}},{key:"updateSetting",value:function(e,t){var a=this.state.settings;a[e]=t,this.setState(a)}},{key:"toggleFeature",value:function(e,t){var a=this,n=this.state.settings;n[L.default.FeatureTogglePrefix+e]=String(t);var s=0;(0,d.default)(this.state.settings).forEach(function(e){0===e.lastIndexOf(L.default.FeatureTogglePrefix)&&"true"===a.state.settings[e]&&s++}),this.setState({settings:n,enabledFeatures:s})}},{key:"saveEnabledFeatures",value:function(){var e=[];(0,d.default)(this.state.settings).forEach(function(t){0===t.lastIndexOf(L.default.FeatureTogglePrefix)&&e.push(t)}),this.handleSubmit(e)}},{key:"handleSubmit",value:function(e){var t=this,a=[],n=P.default.getCurrentId();(Array.isArray(e)?e:[e]).forEach(function(e){a.push({user_id:n,category:L.default.Preferences.CATEGORY_ADVANCED_SETTINGS,name:e,value:t.state.settings[e]})}),this.setState({isSaving:!0}),(0,w.savePreferences)(a,function(){t.updateSection("")})}},{key:"updateSection",value:function(e){e||this.setState(this.getStateFromStores()),this.setState({isSaving:!1}),this.props.updateSection(e)}},{key:"renderOnOffLabel",value:function(e){return"false"===e?M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"}):M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})}},{key:"renderFormattingSection",value:function(){var e=this;return"formatting"===this.props.activeSection?M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),inputs:[M.default.createElement("div",{key:"formattingSetting"},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"postFormattingOn",type:"radio",name:"formatting",checked:"false"!==this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","true")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"postFormattingOff",type:"radio",name:"formatting",checked:"false"===this.state.settings.formatting,onChange:this.updateSetting.bind(this,"formatting","false")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.formattingDesc",defaultMessage:"If enabled, posts will be formatted to create links, show emoji, style the text, and add line breaks. By default, this setting is enabled. Changing this setting requires the page to be refreshed."})))],submit:function(){return e.handleSubmit("formatting")},saving:this.state.isSaving,server_error:this.state.serverError,updateSection:function(t){e.updateSection(""),t.preventDefault()}}):M.default.createElement(x.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.formattingTitle",defaultMessage:"Enable Post Formatting"}),describe:this.renderOnOffLabel(this.state.settings.formatting),updateSection:function(){return e.props.updateSection("formatting")}})}},{key:"renderJoinLeaveSection",value:function(){var e=this;return"true"===window.mm_config.BuildEnterpriseReady&&window.mm_license&&"true"===window.mm_license.IsLicensed?"join_leave"===this.props.activeSection?M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),inputs:[M.default.createElement("div",{key:"joinLeaveSetting"},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"joinLeaveOn",type:"radio",name:"join_leave",checked:"false"!==this.state.settings.join_leave,onChange:this.updateSetting.bind(this,"join_leave","true")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"joinLeaveOff",type:"radio",name:"join_leave",checked:"false"===this.state.settings.join_leave,onChange:this.updateSetting.bind(this,"join_leave","false")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.joinLeaveDesc",defaultMessage:'When "On", System Messages saying a user has joined or left a channel will be visible. When "Off", the System Messages about joining or leaving a channel will be hidden. A message will still show up when you are added to a channel, so you can receive a notification.'})))],submit:function(){return e.handleSubmit("join_leave")},saving:this.state.isSaving,server_error:this.state.serverError,updateSection:function(t){e.updateSection(""),t.preventDefault()}}):M.default.createElement(x.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.joinLeaveTitle",defaultMessage:"Enable Join/Leave Messages"}),describe:this.renderOnOffLabel(this.state.settings.join_leave),updateSection:function(){return e.props.updateSection("join_leave")}}):null}},{key:"renderFeatureLabel",value:function(e){switch(e){case"MARKDOWN_PREVIEW":return M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.markdown_preview",defaultMessage:"Show markdown preview option in message input box"});case"WEBRTC_PREVIEW":return M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.webrtc_preview",defaultMessage:"Enable the ability to make and receive one-on-one WebRTC calls"});default:return null}}},{key:"render",value:function(){var e=this,t=this.state.serverError||null,a=void 0;if("advancedCtrlSend"===this.props.activeSection){var n=["true"===this.state.settings.send_on_ctrl_enter,"false"===this.state.settings.send_on_ctrl_enter],s=[M.default.createElement("div",{key:"ctrlSendSetting"},M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"ctrlSendOn",type:"radio",name:"sendOnCtrlEnter",checked:n[0],onChange:this.updateSetting.bind(this,"send_on_ctrl_enter","true")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.on",defaultMessage:"On"})),M.default.createElement("br",null)),M.default.createElement("div",{className:"radio"},M.default.createElement("label",null,M.default.createElement("input",{id:"ctrlSendOff",type:"radio",name:"sendOnCtrlEnter",checked:n[1],onChange:this.updateSetting.bind(this,"send_on_ctrl_enter","false")}),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.off",defaultMessage:"Off"})),M.default.createElement("br",null)),M.default.createElement("div",null,M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.sendDesc",defaultMessage:"If enabled ENTER inserts a new line and CTRL+ENTER submits the message."})))];a=M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.sendTitle",defaultMessage:"Send messages on CTRL+ENTER"}),inputs:s,submit:function(){return e.handleSubmit("send_on_ctrl_enter")},saving:this.state.isSaving,server_error:t,updateSection:function(t){e.updateSection(""),t.preventDefault()}})}else a=M.default.createElement(x.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.sendTitle",defaultMessage:"Send messages on CTRL+ENTER"}),describe:this.renderOnOffLabel(this.state.settings.send_on_ctrl_enter),updateSection:function(){return e.props.updateSection("advancedCtrlSend")}});var i=this.renderFormattingSection(),r=null;i&&(r=M.default.createElement("div",{className:"divider-light"}));var o=this.renderJoinLeaveSection(),l=null;o&&(l=M.default.createElement("div",{className:"divider-light"}));var d=void 0,u=void 0;if(this.state.preReleaseFeaturesKeys.length>0)if(u=M.default.createElement("div",{className:"divider-light"}),"advancedPreviewFeatures"===this.props.activeSection){var c=[];this.state.preReleaseFeaturesKeys.forEach(function(t){var a=e.state.preReleaseFeatures[t];c.push(M.default.createElement("div",{key:"advancedPreviewFeatures_"+a.label},M.default.createElement("div",{className:"checkbox"},M.default.createElement("label",null,M.default.createElement("input",{id:"advancedPreviewFeatures"+a.label,type:"checkbox",checked:"true"===e.state.settings[L.default.FeatureTogglePrefix+a.label],onChange:function(t){e.toggleFeature(a.label,t.target.checked)}}),e.renderFeatureLabel(t)))))}),c.push(M.default.createElement("div",{key:"advancedPreviewFeatures_helptext"},M.default.createElement("br",null),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.preReleaseDesc",defaultMessage:"Check any pre-released features you'd like to preview.  You may also need to refresh the page before the setting will take effect."}))),d=M.default.createElement(O.default,{title:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.preReleaseTitle",defaultMessage:"Preview pre-release features"}),inputs:c,submit:this.saveEnabledFeatures,saving:this.state.isSaving,server_error:t,updateSection:function(t){e.updateSection(""),t.preventDefault()}})}else d=M.default.createElement(x.default,{title:R.localizeMessage("user.settings.advance.preReleaseTitle","Preview pre-release features"),describe:M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.enabledFeatures",defaultMessage:"{count, number} {count, plural, one {Feature} other {Features}} Enabled",values:{count:this.state.enabledFeatures}}),updateSection:function(){return e.props.updateSection("advancedPreviewFeatures")}});return M.default.createElement("div",null,M.default.createElement("div",{className:"modal-header"},M.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},M.default.createElement("span",{"aria-hidden":"true"},"Ã—")),M.default.createElement("h4",{className:"modal-title",ref:"title"},M.default.createElement("div",{className:"modal-back"},M.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"}))),M.default.createElement("div",{className:"user-settings"},M.default.createElement("h3",{className:"tab-header"},M.default.createElement(C.FormattedMessage,{id:"user.settings.advance.title",defaultMessage:"Advanced Settings"})),M.default.createElement("div",{className:"divider-dark first"}),a,r,i,l,o,u,d,M.default.createElement("div",{className:"divider-dark"})))}}]),a}(M.default.Component);t.default=H,H.propTypes={user:S.default.object,updateSection:S.default.func,updateTab:S.default.func,activeSection:S.default.string,closeModal:S.default.func.isRequired,collapseModal:S.default.func.isRequired}}).call(t,a(22))},2445:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}function i(){return{militaryTime:w.default.get(B.CATEGORY_DISPLAY_SETTINGS,"use_military_time","false"),channelDisplayMode:w.default.get(B.CATEGORY_DISPLAY_SETTINGS,B.CHANNEL_DISPLAY_MODE,B.CHANNEL_DISPLAY_MODE_DEFAULT),messageDisplay:w.default.get(B.CATEGORY_DISPLAY_SETTINGS,B.MESSAGE_DISPLAY,B.MESSAGE_DISPLAY_DEFAULT),collapseDisplay:w.default.get(B.CATEGORY_DISPLAY_SETTINGS,B.COLLAPSE_DISPLAY,B.COLLAPSE_DISPLAY_DEFAULT),linkPreviewDisplay:w.default.get(B.CATEGORY_DISPLAY_SETTINGS,B.LINK_PREVIEW_DISPLAY,B.LINK_PREVIEW_DISPLAY_DEFAULT)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=s(r),l=a(6),d=s(l),u=a(4),c=s(u),f=a(5),m=s(f),h=a(7),p=s(h),g=a(8),v=s(g),E=a(2),b=s(E),y=a(1),S=s(y),_=a(17),M=a(69),C=a(119),w=s(C),k=a(25),T=s(k),N=a(9),P=s(N),I=a(16),L=n(I),D=a(439),R=n(D),A=a(736),O=s(A),F=a(737),x=s(F),U=a(2446),H=s(U),j=a(2447),G=s(j),B=P.default.Preferences,V=function(t){function a(e){(0,c.default)(this,a);var t=(0,p.default)(this,(a.__proto__||(0,d.default)(a)).call(this,e));return t.handleSubmit=t.handleSubmit.bind(t),t.handleClockRadio=t.handleClockRadio.bind(t),t.updateSection=t.updateSection.bind(t),t.updateState=t.updateState.bind(t),t.state=i(),t.setState({isSaving:!1}),t}return(0,v.default)(a,t),(0,m.default)(a,[{key:"handleSubmit",value:function(){var e=this,t=T.default.getCurrentId(),a={user_id:t,category:B.CATEGORY_DISPLAY_SETTINGS,name:"use_military_time",value:this.state.militaryTime},n={user_id:t,category:B.CATEGORY_DISPLAY_SETTINGS,name:B.CHANNEL_DISPLAY_MODE,value:this.state.channelDisplayMode},s={user_id:t,category:B.CATEGORY_DISPLAY_SETTINGS,name:B.MESSAGE_DISPLAY,value:this.state.messageDisplay},i={user_id:t,category:B.CATEGORY_DISPLAY_SETTINGS,name:B.COLLAPSE_DISPLAY,value:this.state.collapseDisplay},r={user_id:t,category:B.CATEGORY_DISPLAY_SETTINGS,name:B.LINK_PREVIEW_DISPLAY,value:this.state.linkPreviewDisplay};this.setState({isSaving:!0}),(0,M.savePreferences)([a,n,s,i,r],function(){e.updateSection("")})}},{key:"handleClockRadio",value:function(e){this.setState({militaryTime:e})}},{key:"handleChannelDisplayModeRadio",value:function(e){this.setState({channelDisplayMode:e})}},{key:"handlemessageDisplayRadio",value:function(e){this.setState({messageDisplay:e})}},{key:"handleCollapseRadio",value:function(e){this.setState({collapseDisplay:e})}},{key:"handleLinkPreviewRadio",value:function(e){this.setState({linkPreviewDisplay:e})}},{key:"handleOnChange",value:function(e){this.setState((0,o.default)({},e))}},{key:"updateSection",value:function(e){this.updateState(),this.props.updateSection(e)}},{key:"updateState",value:function(){var e=i();L.areObjectsEqual(e,this.state)||this.setState(e),this.setState({isSaving:!1})}},{key:"createSection",value:function(e){var t=this,a=e.section,n=e.display,s=e.value,i=e.title,r=e.firstOption,o=e.secondOption,l=e.description,d=S.default.createElement(_.FormattedMessage,{id:r.radionButtonText.id,defaultMessage:r.radionButtonText.message}),u=void 0,c=void 0;r.radionButtonText.moreId&&(u=": ",c=S.default.createElement("span",{className:"font-weight--normal"},S.default.createElement(_.FormattedMessage,{id:r.radionButtonText.moreId,defaultMessage:r.radionButtonText.moreMessage})));var f=void 0;o.radionButtonText.moreId&&(f=S.default.createElement("span",{className:"font-weight--normal"},S.default.createElement(_.FormattedMessage,{id:o.radionButtonText.moreId,defaultMessage:o.radionButtonText.moreMessage})));var m=S.default.createElement(_.FormattedMessage,{id:o.radionButtonText.id,defaultMessage:o.radionButtonText.message}),h=S.default.createElement(_.FormattedMessage,{id:i.id,defaultMessage:i.message}),p=S.default.createElement(_.FormattedMessage,{id:l.id,defaultMessage:l.message});if(this.props.activeSection===a){var g=[!1,!1];s===r.value?g[0]=!0:g[1]=!0;var v=function(e){t.updateSection(""),e.preventDefault()},E=a+"Format",b=a+"UserDisplay",y={};y[n]=r.value;var M={};M[n]=o.value;var C=[S.default.createElement("div",{key:b},S.default.createElement("div",{className:"radio"},S.default.createElement("label",null,S.default.createElement("input",{id:E+"A",type:"radio",name:E,checked:g[0],onChange:function(){return t.handleOnChange(y)}}),d,u,c),S.default.createElement("br",null)),S.default.createElement("div",{className:"radio"},S.default.createElement("label",null,S.default.createElement("input",{id:E+"B",type:"radio",name:E,checked:g[1],onChange:function(){return t.handleOnChange(M)}}),m,u,f),S.default.createElement("br",null)),S.default.createElement("div",null,S.default.createElement("br",null),p))];return S.default.createElement(O.default,{title:h,inputs:C,submit:this.handleSubmit,saving:this.state.isSaving,server_error:this.state.serverError,updateSection:v})}var w=void 0;w=s===r.value?d:m;var k=function(){t.props.updateSection(a)};return S.default.createElement(x.default,{title:h,describe:w,updateSection:k})}},{key:"render",value:function(){var t=this,a=this.createSection({section:"collapse",display:"collapseDisplay",value:this.state.collapseDisplay,defaultDisplay:"false",title:{id:"user.settings.display.collapseDisplay",message:"Default appearance of image link previews"},firstOption:{value:"false",radionButtonText:{id:"user.settings.display.collapseOn",message:"On"}},secondOption:{value:"true",radionButtonText:{id:"user.settings.display.collapseOff",message:"Off"}},description:{id:"user.settings.display.collapseDesc",message:"Set whether previews of image links show as expanded or collapsed by default. This setting can also be controlled using the slash commands /expand and /collapse."}}),n="true"===e.window.mm_config.EnableLinkPreviews,s=null,i=null;n&&(s=this.createSection({section:"linkpreview",display:"linkPreviewDisplay",value:this.state.linkPreviewDisplay,defaultDisplay:"true",title:{id:"user.settings.display.linkPreviewDisplay",message:"Website Link Previews"},firstOption:{value:"true",radionButtonText:{id:"user.settings.display.linkPreviewOn",message:"On"}},secondOption:{value:"false",radionButtonText:{id:"user.settings.display.linkPreviewOff",message:"Off"}},description:{id:"user.settings.display.linkPreviewDesc",message:"When available, the first web link in a message will show a preview of the website content below the message."}}),i=S.default.createElement("div",{className:"divider-dark"}));var r=this.createSection({section:"clock",display:"militaryTime",value:this.state.militaryTime,defaultDisplay:"false",title:{id:"user.settings.display.clockDisplay",message:"Clock Display"},firstOption:{value:"false",radionButtonText:{id:"user.settings.display.normalClock",message:"12-hour clock (example: 4:00 PM)"}},secondOption:{value:"true",radionButtonText:{id:"user.settings.display.militaryClock",message:"24-hour clock (example: 16:00)"}},description:{id:"user.settings.display.preferTime",message:"Select how you prefer time displayed."}}),o=this.createSection({section:B.MESSAGE_DISPLAY,display:"messageDisplay",value:this.state.messageDisplay,defaultDisplay:B.MESSAGE_DISPLAY_CLEAN,title:{id:"user.settings.display.messageDisplayTitle",message:"Message Display"},firstOption:{value:B.MESSAGE_DISPLAY_CLEAN,radionButtonText:{id:"user.settings.display.messageDisplayClean",message:"Standard",moreId:"user.settings.display.messageDisplayCleanDes",moreMessage:"Easy to scan and read."}},secondOption:{value:B.MESSAGE_DISPLAY_COMPACT,radionButtonText:{id:"user.settings.display.messageDisplayCompact",message:"Compact",moreId:"user.settings.display.messageDisplayCompactDes",moreMessage:"Fit as many messages on the screen as we can."}},description:{id:"user.settings.display.messageDisplayDescription",message:"Select how messages in a channel should be displayed."}}),l=this.createSection({section:B.CHANNEL_DISPLAY_MODE,display:"channelDisplayMode",value:this.state.channelDisplayMode,defaultDisplay:B.CHANNEL_DISPLAY_MODE_FULL_SCREEN,title:{id:"user.settings.display.channelDisplayTitle",message:"Channel Display Mode"},firstOption:{value:B.CHANNEL_DISPLAY_MODE_FULL_SCREEN,radionButtonText:{id:"user.settings.display.fullScreen",message:"Full width"}},secondOption:{value:B.CHANNEL_DISPLAY_MODE_CENTERED,radionButtonText:{id:"user.settings.display.fixedWidthCentered",message:"Fixed width, centered"}},description:{id:"user.settings.display.channeldisplaymode",message:"Select the width of the center channel."}}),d=void 0,u=this.props.user.locale;if("languages"===this.props.activeSection)R.isLanguageAvailable(u)||(u=e.window.mm_config.DefaultClientLocale),d=S.default.createElement(H.default,{user:this.props.user,locale:u,updateSection:function(e){t.updateSection(""),e.preventDefault()}});else{var c=void 0;c=R.isLanguageAvailable(u)?R.getLanguageInfo(u).name:R.getLanguageInfo(e.window.mm_config.DefaultClientLocale).name,d=S.default.createElement(x.default,{title:S.default.createElement(_.FormattedMessage,{id:"user.settings.display.language",defaultMessage:"Language"}),width:"medium",describe:c,updateSection:function(){t.updateSection("languages")}})}var f=void 0;return"false"!==e.mm_config.EnableThemeSelection&&(f=S.default.createElement(G.default,{selected:"theme"===this.props.activeSection,updateSection:this.updateSection,setRequireConfirm:this.props.setRequireConfirm,setEnforceFocus:this.props.setEnforceFocus})),S.default.createElement("div",{id:"displaySettings"},S.default.createElement("div",{className:"modal-header"},S.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal","aria-label":"Close",onClick:this.props.closeModal},S.default.createElement("span",{"aria-hidden":"true"},"Ã—")),S.default.createElement("h4",{className:"modal-title",ref:"title"},S.default.createElement("div",{className:"modal-back"},S.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),S.default.createElement(_.FormattedMessage,{id:"user.settings.display.title",defaultMessage:"Display Settings"}))),S.default.createElement("div",{className:"user-settings"},S.default.createElement("h3",{id:"displaySettingsTitle",className:"tab-header"},S.default.createElement(_.FormattedMessage,{id:"user.settings.display.title",defaultMessage:"Display Settings"})),S.default.createElement("div",{className:"divider-dark first"}),f,S.default.createElement("div",{className:"divider-dark"}),r,i,s,S.default.createElement("div",{className:"divider-dark"}),a,S.default.createElement("div",{className:"divider-dark"}),o,S.default.createElement("div",{className:"divider-dark"}),l,S.default.createElement("div",{className:"divider-dark"}),d))}}]),a}(S.default.Component);t.default=V,V.propTypes={user:b.default.object,updateSection:b.default.func,updateTab:b.default.func,activeSection:b.default.string,closeModal:b.default.func.isRequired,collapseModal:b.default.func.isRequired,setRequireConfirm:b.default.func.isRequired,setEnforceFocus:b.default.func.isRequired}}).call(t,a(22))},2446:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),r=s(i),o=a(19),l=s(o),d=a(6),u=s(d),c=a(4),f=s(c),m=a(5),h=s(m),p=a(7),g=s(p),v=a(8),E=s(v),b=a(2),y=s(b),S=a(1),_=s(S),M=a(17),C=a(56),w=n(C),k=a(69),T=a(9),N=s(T),P=a(439),I=n(P),L=a(736),D=s(L),R=function(e){function t(e){(0,f.default)(this,t);var a=(0,g.default)(this,(t.__proto__||(0,u.default)(t)).call(this,e));return a.setLanguage=a.setLanguage.bind(a),a.changeLanguage=a.changeLanguage.bind(a),a.submitUser=a.submitUser.bind(a),a.state={locale:e.locale,isSaving:!1},a}return(0,E.default)(t,e),(0,h.default)(t,[{key:"setLanguage",value:function(e){this.setState({locale:e.target.value})}},{key:"changeLanguage",value:function(e){e.preventDefault(),this.submitUser((0,l.default)({},this.props.user,{locale:this.state.locale}))}},{key:"submitUser",value:function(e){var t=this;this.setState({isSaving:!0}),(0,k.updateUser)(e,N.default.UserUpdateEvents.LANGUAGE,function(){w.newLocalizationSelected(e.locale),t.setState({isSaving:!1})},function(e){var a=void 0;a=e.message?e.message:e,t.setState({serverError:a,isSaving:!1})})}},{key:"render",value:function(){var e=void 0;this.state.serverError&&(e=_.default.createElement("label",{className:"has-error"},this.state.serverError));var t=[],a=I.getLanguages();(0,r.default)(a).map(function(e){return{value:a[e].value,name:a[e].name,order:a[e].order}}).sort(function(e,t){return e.order-t.order}).forEach(function(e){t.push(_.default.createElement("option",{key:e.value,value:e.value},e.name))});var n=_.default.createElement("div",{key:"changeLanguage"},_.default.createElement("br",null),_.default.createElement("label",{className:"control-label"},_.default.createElement(M.FormattedMessage,{id:"user.settings.languages.change",defaultMessage:"Change interface language"})),_.default.createElement("div",{className:"padding-top"},_.default.createElement("select",{id:"displayLanguage",ref:"language",className:"form-control",value:this.state.locale,onChange:this.setLanguage},t),e),_.default.createElement("div",null,_.default.createElement("br",null),_.default.createElement(M.FormattedHTMLMessage,{id:"user.settings.languages.promote",defaultMessage:'Select which language Mattermost displays in the user interface.<br /><br />Would like to help with translations? Join the <a href="http://translate.mattermost.com/" target="_blank">Mattermost Translation Server</a> to contribute.'})));return _.default.createElement(D.default,{title:_.default.createElement(M.FormattedMessage,{id:"user.settings.display.language",defaultMessage:"Language"}),width:"medium",submit:this.changeLanguage,saving:this.state.isSaving,inputs:[n],updateSection:this.props.updateSection})}}]),t}(_.default.Component);t.default=R,R.propTypes={user:y.default.object.isRequired,locale:y.default.string.isRequired,updateSection:y.default.func.isRequired}},2447:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(59),r=s(i),o=a(41),l=s(o),d=a(6),u=s(d),c=a(4),f=s(c),m=a(5),h=s(m),p=a(7),g=s(p),v=a(8),E=s(v),b=a(0),y=s(b),S=a(2),_=s(S),M=a(1),C=s(M),w=a(47),k=s(w),T=a(17),N=a(69),P=n(N),I=a(119),L=s(I),D=a(35),R=s(D),A=a(25),O=s(A),F=a(9),x=a(16),U=n(x),H=a(34),j=s(H),G=a(736),B=s(G),V=a(737),z=s(V),q=a(2448),W=s(q),Y=a(2452),K=s(Y),J=function(t){function a(e){(0,f.default)(this,a);var t=(0,g.default)(this,(a.__proto__||(0,u.default)(a)).call(this,e));return t.onChange=t.onChange.bind(t),t.submitTheme=t.submitTheme.bind(t),t.updateTheme=t.updateTheme.bind(t),t.resetFields=t.resetFields.bind(t),t.handleImportModal=t.handleImportModal.bind(t),t.state=t.getStateFromStores(),t.setState({isSaving:!1}),t.originalTheme=(0,l.default)({},t.state.theme),t}return(0,E.default)(a,t),(0,h.default)(a,[{key:"componentDidMount",value:function(){O.default.addChangeListener(this.onChange),this.props.selected&&(0,y.default)(k.default.findDOMNode(this.refs[this.state.theme])).addClass("active-border")}},{key:"componentDidUpdate",value:function(){this.props.selected&&((0,y.default)(".color-btn").removeClass("active-border"),(0,y.default)(k.default.findDOMNode(this.refs[this.state.theme])).addClass("active-border"))}},{key:"componentWillReceiveProps",value:function(e){this.props.selected&&!e.selected&&this.resetFields()}},{key:"componentWillUnmount",value:function(){if(O.default.removeChangeListener(this.onChange),this.props.selected){var e=this.getStateFromStores();U.applyTheme(e.theme)}}},{key:"getStateFromStores",value:function(){var t=R.default.getCurrentId(),a=L.default.getTheme(t);a.codeTheme||(a.codeTheme=F.Constants.DEFAULT_CODE_THEME);var n=!1,s=!0;return"true"===e.window.mm_license.IsLicensed&&"true"===e.window.mm_license.LDAP&&(n=(0,r.default)(R.default.getAll()).length>1,s=L.default.getCategory(F.Preferences.CATEGORY_THEME).size<=1),{teamId:R.default.getCurrentId(),theme:a,type:a.type||"premade",showAllTeamsCheckbox:n,applyToAllTeams:s}}},{key:"onChange",value:function(){var e=this.getStateFromStores();U.areObjectsEqual(this.state,e)||this.setState(e),this.props.setEnforceFocus(!0)}},{key:"scrollToTop",value:function(){(0,y.default)(".ps-container.modal-body").scrollTop(0)}},{key:"submitTheme",value:function(e){var t=this;e.preventDefault();var a=this.state.applyToAllTeams?"":this.state.teamId;this.setState({isSaving:!0}),P.saveTheme(a,this.state.theme,function(){t.props.setRequireConfirm(!1),t.originalTheme=(0,l.default)({},t.state.theme),t.scrollToTop(),t.props.updateSection(""),t.setState({isSaving:!1})})}},{key:"updateTheme",value:function(e){var t=this.state.theme.length===e.length;if(!t)for(var a in e)if(e.hasOwnProperty(a)&&this.state.theme[a]!==e[a]){t=!0;break}this.props.setRequireConfirm(t),this.setState({theme:e}),U.applyTheme(e)}},{key:"updateType",value:function(e){this.setState({type:e})}},{key:"resetFields",value:function(){var e=this.getStateFromStores();e.serverError=null,this.setState(e),this.scrollToTop(),U.applyTheme(e.theme),this.props.setRequireConfirm(!1)}},{key:"handleImportModal",value:function(){j.default.handleViewAction({type:F.ActionTypes.TOGGLE_IMPORT_THEME_MODAL,value:!0,callback:this.updateTheme}),this.props.setEnforceFocus(!1)}},{key:"render",value:function(){var t,a=this;this.state.serverError&&(t=this.state.serverError);var n="custom"===this.state.type,s="false"!==e.mm_config.AllowCustomThemes,i=void 0,r=void 0;n&&s?i=C.default.createElement("div",{key:"customThemeChooser"},C.default.createElement(W.default,{theme:this.state.theme,updateTheme:this.updateTheme})):r=C.default.createElement("div",{key:"premadeThemeChooser"},C.default.createElement("br",null),C.default.createElement(K.default,{theme:this.state.theme,updateTheme:this.updateTheme}));var o=void 0;if(this.props.selected){var l=[];s&&l.push(C.default.createElement("div",{className:"radio",key:"premadeThemeColorLabel"},C.default.createElement("label",null,C.default.createElement("input",{id:"standardThemes",type:"radio",name:"theme",checked:!n,onChange:this.updateType.bind(this,"premade")}),C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.themeColors",defaultMessage:"Theme Colors"})),C.default.createElement("br",null))),l.push(r),s&&(l.push(C.default.createElement("div",{className:"radio",key:"customThemeColorLabel"},C.default.createElement("label",null,C.default.createElement("input",{id:"customThemes",type:"radio",name:"theme",checked:n,onChange:this.updateType.bind(this,"custom")}),C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.customTheme",defaultMessage:"Custom Theme"})))),l.push(i),l.push(C.default.createElement("div",{key:"otherThemes"},C.default.createElement("br",null),C.default.createElement("a",{id:"otherThemes",href:"http://docs.mattermost.com/help/settings/theme-colors.html#custom-theme-examples",target:"_blank",rel:"noopener noreferrer"},C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.otherThemes",defaultMessage:"See other themes"})))),l.push(C.default.createElement("div",{key:"importSlackThemeButton",className:"padding-top"},C.default.createElement("a",{id:"slackImportTheme",className:"theme",onClick:this.handleImportModal},C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.import",defaultMessage:"Import theme colors from Slack"})))));var d=null;this.state.showAllTeamsCheckbox&&(d=C.default.createElement("div",{className:"checkbox user-settings__submit-checkbox"},C.default.createElement("label",null,C.default.createElement("input",{id:"applyThemeToAllTeams",type:"checkbox",checked:this.state.applyToAllTeams,onChange:function(e){return a.setState({applyToAllTeams:e.target.checked})}}),C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.applyToAllTeams",defaultMessage:"Apply new theme to all my teams"})))),o=C.default.createElement(B.default,{inputs:l,submitExtra:d,submit:this.submitTheme,saving:this.state.isSaving,server_error:t,width:"full",updateSection:function(e){a.props.updateSection(""),e.preventDefault()}})}else o=C.default.createElement(z.default,{title:C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.title",defaultMessage:"Theme"}),describe:C.default.createElement(T.FormattedMessage,{id:"user.settings.display.theme.describe",defaultMessage:"Open to manage your theme"}),updateSection:function(){a.props.updateSection("theme")}});return o}}]),a}(C.default.Component);t.default=J,J.propTypes={selected:_.default.bool.isRequired,updateSection:_.default.func.isRequired,setRequireConfirm:_.default.func.isRequired,setEnforceFocus:_.default.func.isRequired}}).call(t,a(22))},2448:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(41),i=n(s),r=a(155),o=n(r),l=a(207),d=n(l),u=a(19),c=n(u),f=a(6),m=n(f),h=a(4),p=n(h),g=a(5),v=n(g),E=a(7),b=n(E),y=a(8),S=n(y),_=a(0),M=n(_),C=a(2),w=n(C),k=a(1),T=n(k),N=a(40),P=a(17);a(2449);var I=a(9),L=n(I),D=a(87),R=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(D),A=a(2450),O=n(A),F=(0,P.defineMessages)({sidebarBg:{id:"user.settings.custom_theme.sidebarBg",defaultMessage:"Sidebar BG"},sidebarText:{id:"user.settings.custom_theme.sidebarText",defaultMessage:"Sidebar Text"},sidebarHeaderBg:{id:"user.settings.custom_theme.sidebarHeaderBg",defaultMessage:"Sidebar Header BG"},sidebarHeaderTextColor:{id:"user.settings.custom_theme.sidebarHeaderTextColor",defaultMessage:"Sidebar Header Text"},sidebarUnreadText:{id:"user.settings.custom_theme.sidebarUnreadText",defaultMessage:"Sidebar Unread Text"},sidebarTextHoverBg:{id:"user.settings.custom_theme.sidebarTextHoverBg",defaultMessage:"Sidebar Text Hover BG"},sidebarTextActiveBorder:{id:"user.settings.custom_theme.sidebarTextActiveBorder",defaultMessage:"Sidebar Text Active Border"},sidebarTextActiveColor:{id:"user.settings.custom_theme.sidebarTextActiveColor",defaultMessage:"Sidebar Text Active Color"},onlineIndicator:{id:"user.settings.custom_theme.onlineIndicator",defaultMessage:"Online Indicator"},awayIndicator:{id:"user.settings.custom_theme.awayIndicator",defaultMessage:"Away Indicator"},mentionBj:{id:"user.settings.custom_theme.mentionBj",defaultMessage:"Mention Jewel BG"},mentionColor:{id:"user.settings.custom_theme.mentionColor",defaultMessage:"Mention Jewel Text"},centerChannelBg:{id:"user.settings.custom_theme.centerChannelBg",defaultMessage:"Center Channel BG"},centerChannelColor:{id:"user.settings.custom_theme.centerChannelColor",defaultMessage:"Center Channel Text"},newMessageSeparator:{id:"user.settings.custom_theme.newMessageSeparator",defaultMessage:"New Message Separator"},linkColor:{id:"user.settings.custom_theme.linkColor",defaultMessage:"Link Color"},buttonBg:{id:"user.settings.custom_theme.buttonBg",defaultMessage:"Button BG"},buttonColor:{id:"user.settings.custom_theme.buttonColor",defaultMessage:"Button Text"},errorTextColor:{id:"user.settings.custom_theme.errorTextColor",defaultMessage:"Error Text Color"},mentionHighlightBg:{id:"user.settings.custom_theme.mentionHighlightBg",defaultMessage:"Mention Highlight BG"},mentionHighlightLink:{id:"user.settings.custom_theme.mentionHighlightLink",defaultMessage:"Mention Highlight Link"},codeTheme:{id:"user.settings.custom_theme.codeTheme",defaultMessage:"Code Theme"}}),x=function(e){function t(e){(0,p.default)(this,t);var a=(0,b.default)(this,(t.__proto__||(0,m.default)(t)).call(this,e));a.handleColorChange=function(e,t){var n=a.props,s=n.updateTheme,i=n.theme;i[e]!==t&&s((0,c.default)({},i,(0,d.default)({type:"custom"},e,t)))},a.pasteBoxChange=function(e){var t="";if(t=window.clipboardData&&window.clipboardData.getData?window.clipboardData.getData("Text"):e.clipboardData.getData("Text"),0!==t.length){var n=void 0;try{n=JSON.parse(t)}catch(e){return}a.setState({copyTheme:(0,o.default)(n)}),n.type="custom",a.props.updateTheme(n)}},a.onChangeHandle=function(e){e.stopPropagation()},a.toggleSidebarStyles=function(e){e.preventDefault(),(0,M.default)(a.refs.sidebarStylesHeader).toggleClass("open"),a.toggleSection(a.refs.sidebarStyles)},a.toggleCenterChannelStyles=function(e){e.preventDefault(),(0,M.default)(a.refs.centerChannelStylesHeader).toggleClass("open"),a.toggleSection(a.refs.centerChannelStyles)},a.toggleLinkAndButtonStyles=function(e){e.preventDefault(),(0,M.default)(a.refs.linkAndButtonStylesHeader).toggleClass("open"),a.toggleSection(a.refs.linkAndButtonStyles)},a.onCodeThemeChange=function(e){var t=a.props.theme;t.codeTheme=e.target.value,a.props.updateTheme(t)},a.selectTheme=a.selectTheme.bind(a);var n=(0,i.default)({},a.props.theme);return delete n.type,delete n.image,a.state={copyTheme:(0,o.default)(n)},a}return(0,S.default)(t,e),(0,v.default)(t,[{key:"componentDidMount",value:function(){(0,M.default)(".group--code").on("change",this.onCodeThemeChange)}},{key:"componentWillUnmount",value:function(){(0,M.default)(".group--code").off("change",this.onCodeThemeChange)}},{key:"selectTheme",value:function(){var e=this.refs.textarea;e.focus(),e.setSelectionRange(0,this.state.copyTheme.length)}},{key:"toggleSection",value:function(e){R.isIos()?(0,M.default)(e).toggleClass("open"):(0,M.default)(e).slideToggle()}},{key:"render",value:function(){var e=this,t=this.props.intl.formatMessage,a=this.props.theme,n=[],s=[],i=[];L.default.THEME_ELEMENTS.forEach(function(r,o){if("codeTheme"===r.id){var l=[],d="";r.themes.forEach(function(e,t){e.id===a[r.id]&&(d=e.iconURL),l.push(T.default.createElement("option",{key:"code-theme-key"+t,value:e.id},e.uiName))});var u=T.default.createElement(N.Popover,{bsStyle:"info",id:"code-popover",className:"code-popover"},T.default.createElement("img",{width:"200",src:d}));s.push(T.default.createElement("div",{className:"col-sm-6 form-group",key:"custom-theme-key"+o},T.default.createElement("label",{className:"custom-label"},t(F[r.id])),T.default.createElement("div",{className:"input-group theme-group group--code dropdown",id:r.id},T.default.createElement("select",{className:"form-control",type:"text",defaultValue:a[r.id]},l),T.default.createElement(N.OverlayTrigger,{trigger:["hover","focus"],placement:"top",overlay:u,ref:"headerOverlay"},T.default.createElement("span",{className:"input-group-addon"},T.default.createElement("img",{src:d}))))))}else"centerChannelElements"===r.group?s.push(T.default.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+o},T.default.createElement(O.default,{id:r.id,label:t(F[r.id]),color:a[r.id],onChange:e.handleColorChange}))):"sidebarElements"===r.group?n.push(T.default.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+o},T.default.createElement(O.default,{id:r.id,label:t(F[r.id]),color:a[r.id],onChange:e.handleColorChange}))):i.push(T.default.createElement("div",{className:"col-sm-6 form-group element",key:"custom-theme-key"+o},T.default.createElement(O.default,{id:r.id,label:t(F[r.id]),color:a[r.id],onChange:e.handleColorChange})))});var r=T.default.createElement("div",{className:"col-sm-12"},T.default.createElement("label",{className:"custom-label"},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.copyPaste",defaultMessage:"Copy and paste to share theme colors:"})),T.default.createElement("textarea",{ref:"textarea",className:"form-control",value:this.state.copyTheme,onPaste:this.pasteBoxChange,onChange:this.onChangeHandle,onClick:this.selectTheme}));return T.default.createElement("div",{className:"appearance-section padding-top"},T.default.createElement("div",{className:"theme-elements row"},T.default.createElement("div",{ref:"sidebarStylesHeader",className:"theme-elements__header",onClick:this.toggleSidebarStyles},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.sidebarTitle",defaultMessage:"Sidebar Styles"}),T.default.createElement("div",{className:"header__icon"},T.default.createElement("i",{className:"fa fa-plus"}),T.default.createElement("i",{className:"fa fa-minus"}))),T.default.createElement("div",{ref:"sidebarStyles",className:"theme-elements__body"},n)),T.default.createElement("div",{className:"theme-elements row"},T.default.createElement("div",{ref:"centerChannelStylesHeader",className:"theme-elements__header",onClick:this.toggleCenterChannelStyles},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.centerChannelTitle",defaultMessage:"Center Channel Styles"}),T.default.createElement("div",{className:"header__icon"},T.default.createElement("i",{className:"fa fa-plus"}),T.default.createElement("i",{className:"fa fa-minus"}))),T.default.createElement("div",{ref:"centerChannelStyles",className:"theme-elements__body"},s)),T.default.createElement("div",{className:"theme-elements row form-group"},T.default.createElement("div",{ref:"linkAndButtonStylesHeader",className:"theme-elements__header",onClick:this.toggleLinkAndButtonStyles},T.default.createElement(P.FormattedMessage,{id:"user.settings.custom_theme.linkButtonTitle",defaultMessage:"Link and Button Styles"}),T.default.createElement("div",{className:"header__icon"},T.default.createElement("i",{className:"fa fa-plus"}),T.default.createElement("i",{className:"fa fa-minus"}))),T.default.createElement("div",{ref:"linkAndButtonStyles",className:"theme-elements__body"},i)),T.default.createElement("div",{className:"row"},r))}}]),t}(T.default.Component);x.propTypes={intl:P.intlShape.isRequired,theme:w.default.object.isRequired,updateTheme:w.default.func.isRequired},t.default=(0,P.injectIntl)(x)},2449:function(e,t,a){var n,s;a(0),a(0);!function(i,r){n=[a(0)],void 0!==(s=function(e){return r(e)}.apply(t,n))&&(e.exports=s)}(0,function(e){"use strict";var t=function(a,n,s,i,r){this.fallbackValue=s?s&&void 0!==s.h?s:this.value={h:0,s:0,b:0,a:1}:null,this.fallbackFormat=i||"rgba",this.hexNumberSignPrefix=!0===r,this.value=this.fallbackValue,this.origFormat=null,this.predefinedColors=n||{},this.colors=e.extend({},t.webColors,this.predefinedColors),a&&(void 0!==a.h?this.value=a:this.setColor(String(a))),this.value||(this.value={h:0,s:0,b:0,a:1})};t.webColors={aliceblue:"f0f8ff",antiquewhite:"faebd7",aqua:"00ffff",aquamarine:"7fffd4",azure:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"000000",blanchedalmond:"ffebcd",blue:"0000ff",blueviolet:"8a2be2",brown:"a52a2a",burlywood:"deb887",cadetblue:"5f9ea0",chartreuse:"7fff00",chocolate:"d2691e",coral:"ff7f50",cornflowerblue:"6495ed",cornsilk:"fff8dc",crimson:"dc143c",cyan:"00ffff",darkblue:"00008b",darkcyan:"008b8b",darkgoldenrod:"b8860b",darkgray:"a9a9a9",darkgreen:"006400",darkkhaki:"bdb76b",darkmagenta:"8b008b",darkolivegreen:"556b2f",darkorange:"ff8c00",darkorchid:"9932cc",darkred:"8b0000",darksalmon:"e9967a",darkseagreen:"8fbc8f",darkslateblue:"483d8b",darkslategray:"2f4f4f",darkturquoise:"00ced1",darkviolet:"9400d3",deeppink:"ff1493",deepskyblue:"00bfff",dimgray:"696969",dodgerblue:"1e90ff",firebrick:"b22222",floralwhite:"fffaf0",forestgreen:"228b22",fuchsia:"ff00ff",gainsboro:"dcdcdc",ghostwhite:"f8f8ff",gold:"ffd700",goldenrod:"daa520",gray:"808080",green:"008000",greenyellow:"adff2f",honeydew:"f0fff0",hotpink:"ff69b4",indianred:"cd5c5c",indigo:"4b0082",ivory:"fffff0",khaki:"f0e68c",lavender:"e6e6fa",lavenderblush:"fff0f5",lawngreen:"7cfc00",lemonchiffon:"fffacd",lightblue:"add8e6",lightcoral:"f08080",lightcyan:"e0ffff",lightgoldenrodyellow:"fafad2",lightgrey:"d3d3d3",lightgreen:"90ee90",lightpink:"ffb6c1",lightsalmon:"ffa07a",lightseagreen:"20b2aa",lightskyblue:"87cefa",lightslategray:"778899",lightsteelblue:"b0c4de",lightyellow:"ffffe0",lime:"00ff00",limegreen:"32cd32",linen:"faf0e6",magenta:"ff00ff",maroon:"800000",mediumaquamarine:"66cdaa",mediumblue:"0000cd",mediumorchid:"ba55d3",mediumpurple:"9370d8",mediumseagreen:"3cb371",mediumslateblue:"7b68ee",mediumspringgreen:"00fa9a",mediumturquoise:"48d1cc",mediumvioletred:"c71585",midnightblue:"191970",mintcream:"f5fffa",mistyrose:"ffe4e1",moccasin:"ffe4b5",navajowhite:"ffdead",navy:"000080",oldlace:"fdf5e6",olive:"808000",olivedrab:"6b8e23",orange:"ffa500",orangered:"ff4500",orchid:"da70d6",palegoldenrod:"eee8aa",palegreen:"98fb98",paleturquoise:"afeeee",palevioletred:"d87093",papayawhip:"ffefd5",peachpuff:"ffdab9",peru:"cd853f",pink:"ffc0cb",plum:"dda0dd",powderblue:"b0e0e6",purple:"800080",red:"ff0000",rosybrown:"bc8f8f",royalblue:"4169e1",saddlebrown:"8b4513",salmon:"fa8072",sandybrown:"f4a460",seagreen:"2e8b57",seashell:"fff5ee",sienna:"a0522d",silver:"c0c0c0",skyblue:"87ceeb",slateblue:"6a5acd",slategray:"708090",snow:"fffafa",springgreen:"00ff7f",steelblue:"4682b4",tan:"d2b48c",teal:"008080",thistle:"d8bfd8",tomato:"ff6347",turquoise:"40e0d0",violet:"ee82ee",wheat:"f5deb3",white:"ffffff",whitesmoke:"f5f5f5",yellow:"ffff00",yellowgreen:"9acd32",transparent:"transparent"},t.prototype={constructor:t,colors:{},predefinedColors:{},getValue:function(){return this.value},setValue:function(e){this.value=e},_sanitizeNumber:function(e){return"number"==typeof e?e:isNaN(e)||null===e||""===e||void 0===e?1:""===e?0:void 0!==e.toLowerCase?(e.match(/^\./)&&(e="0"+e),Math.ceil(100*parseFloat(e))/100):1},isTransparent:function(e){return!(!e||!("string"==typeof e||e instanceof String))&&("transparent"===(e=e.toLowerCase().trim())||e.match(/#?00000000/)||e.match(/(rgba|hsla)\(0,0,0,0?\.?0\)/))},rgbaIsTransparent:function(e){return 0===e.r&&0===e.g&&0===e.b&&0===e.a},setColor:function(e){if(e=e.toLowerCase().trim()){if(this.isTransparent(e))return this.value={h:0,s:0,b:0,a:0},!0;var t=this.parse(e);t?(this.value=this.value={h:t.h,s:t.s,b:t.b,a:t.a},this.origFormat||(this.origFormat=t.format)):this.fallbackValue&&(this.value=this.fallbackValue)}return!1},setHue:function(e){this.value.h=1-e},setSaturation:function(e){this.value.s=e},setBrightness:function(e){this.value.b=1-e},setAlpha:function(e){this.value.a=Math.round(parseInt(100*(1-e),10)/100*100)/100},toRGB:function(e,t,a,n){0===arguments.length&&(e=this.value.h,t=this.value.s,a=this.value.b,n=this.value.a),e*=360;var s,i,r,o,l;return e=e%360/60,l=a*t,o=l*(1-Math.abs(e%2-1)),s=i=r=a-l,e=~~e,s+=[l,o,0,0,o,l][e],i+=[o,l,l,o,0,0][e],r+=[0,0,o,l,l,o][e],{r:Math.round(255*s),g:Math.round(255*i),b:Math.round(255*r),a:n}},toHex:function(e,t,a,n,s){arguments.length<=1&&(t=this.value.h,a=this.value.s,n=this.value.b,s=this.value.a);var i="#",r=this.toRGB(t,a,n,s);return this.rgbaIsTransparent(r)?"transparent":(e||(i=this.hexNumberSignPrefix?"#":""),i+((1<<24)+(parseInt(r.r)<<16)+(parseInt(r.g)<<8)+parseInt(r.b)).toString(16).slice(1))},toHSL:function(e,t,a,n){0===arguments.length&&(e=this.value.h,t=this.value.s,a=this.value.b,n=this.value.a);var s=e,i=(2-t)*a,r=t*a;return r/=i>0&&i<=1?i:2-i,i/=2,r>1&&(r=1),{h:isNaN(s)?0:s,s:isNaN(r)?0:r,l:isNaN(i)?0:i,a:isNaN(n)?0:n}},toAlias:function(e,t,a,n){var s,i=0===arguments.length?this.toHex(!0):this.toHex(!0,e,t,a,n),r="alias"===this.origFormat?i:this.toString(!1,this.origFormat);for(var o in this.colors)if((s=this.colors[o].toLowerCase().trim())===i||s===r)return o;return!1},RGBtoHSB:function(e,t,a,n){e/=255,t/=255,a/=255;var s,i,r,o;return r=Math.max(e,t,a),o=r-Math.min(e,t,a),s=0===o?null:r===e?(t-a)/o:r===t?(a-e)/o+2:(e-t)/o+4,s=(s+360)%6*60/360,i=0===o?0:o/r,{h:this._sanitizeNumber(s),s:i,b:r,a:this._sanitizeNumber(n)}},HueToRGB:function(e,t,a){return a<0?a+=1:a>1&&(a-=1),6*a<1?e+(t-e)*a*6:2*a<1?t:3*a<2?e+(t-e)*(2/3-a)*6:e},HSLtoRGB:function(e,t,a,n){t<0&&(t=0);var s;s=a<=.5?a*(1+t):a+t-a*t;var i=2*a-s,r=e+1/3,o=e,l=e-1/3;return[Math.round(255*this.HueToRGB(i,s,r)),Math.round(255*this.HueToRGB(i,s,o)),Math.round(255*this.HueToRGB(i,s,l)),this._sanitizeNumber(n)]},parse:function(t){if(0===arguments.length)return!1;var a,n,s=this,i=!1,r=void 0!==this.colors[t];return r&&(t=this.colors[t].toLowerCase().trim()),e.each(this.stringParsers,function(e,o){var l=o.re.exec(t);return!(a=l&&o.parse.apply(s,[l]))||(i={},n=r?"alias":o.format?o.format:s.getValidFallbackFormat(),i=n.match(/hsla?/)?s.RGBtoHSB.apply(s,s.HSLtoRGB.apply(s,a)):s.RGBtoHSB.apply(s,a),i instanceof Object&&(i.format=n),!1)}),i},getValidFallbackFormat:function(){var e=["rgba","rgb","hex","hsla","hsl"];return this.origFormat&&-1!==e.indexOf(this.origFormat)?this.origFormat:this.fallbackFormat&&-1!==e.indexOf(this.fallbackFormat)?this.fallbackFormat:"rgba"},toString:function(e,a,n){a=a||this.origFormat||this.fallbackFormat,n=n||!1;var s=!1;switch(a){case"rgb":return s=this.toRGB(),this.rgbaIsTransparent(s)?"transparent":"rgb("+s.r+","+s.g+","+s.b+")";case"rgba":return s=this.toRGB(),"rgba("+s.r+","+s.g+","+s.b+","+s.a+")";case"hsl":return s=this.toHSL(),"hsl("+Math.round(360*s.h)+","+Math.round(100*s.s)+"%,"+Math.round(100*s.l)+"%)";case"hsla":return s=this.toHSL(),"hsla("+Math.round(360*s.h)+","+Math.round(100*s.s)+"%,"+Math.round(100*s.l)+"%,"+s.a+")";case"hex":return this.toHex(e);case"alias":return s=this.toAlias(),!1===s?this.toString(e,this.getValidFallbackFormat()):n&&!(s in t.webColors)&&s in this.predefinedColors?this.predefinedColors[s]:s;default:return s}},stringParsers:[{re:/rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*?\)/,format:"rgb",parse:function(e){return[e[1],e[2],e[3],1]}},{re:/rgb\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"rgb",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],1]}},{re:/rgba\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[e[1],e[2],e[3],e[4]]}},{re:/rgba\(\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"rgba",parse:function(e){return[2.55*e[1],2.55*e[2],2.55*e[3],e[4]]}},{re:/hsl\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*?\)/,format:"hsl",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/hsla\(\s*(\d*(?:\.\d+)?)\s*,\s*(\d*(?:\.\d+)?)\%\s*,\s*(\d*(?:\.\d+)?)\%\s*(?:,\s*(\d*(?:\.\d+)?)\s*)?\)/,format:"hsla",parse:function(e){return[e[1]/360,e[2]/100,e[3]/100,e[4]]}},{re:/#?([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,format:"hex",parse:function(e){return[parseInt(e[1],16),parseInt(e[2],16),parseInt(e[3],16),1]}},{re:/#?([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,format:"hex",parse:function(e){return[parseInt(e[1]+e[1],16),parseInt(e[2]+e[2],16),parseInt(e[3]+e[3],16),1]}}],colorNameToHex:function(e){return void 0!==this.colors[e.toLowerCase()]&&this.colors[e.toLowerCase()]}};var a={horizontal:!1,inline:!1,color:!1,format:!1,input:"input",container:!1,component:".add-on, .input-group-addon",fallbackColor:!1,fallbackFormat:"hex",hexNumberSignPrefix:!0,sliders:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"},alpha:{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"}},slidersHorz:{saturation:{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setBrightness"},hue:{maxLeft:100,maxTop:0,callLeft:"setHue",callTop:!1},alpha:{maxLeft:100,maxTop:0,callLeft:"setAlpha",callTop:!1}},template:'<div class="colorpicker dropdown-menu"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div><div class="colorpicker-selectors"></div></div>',align:"right",customClass:null,colorSelectors:null},n=function(t,n){this.element=e(t).addClass("colorpicker-element"),this.options=e.extend(!0,{},a,this.element.data(),n),this.component=this.options.component,this.component=!1!==this.component&&this.element.find(this.component),this.component&&0===this.component.length&&(this.component=!1),this.container=!0===this.options.container?this.element:this.options.container,this.container=!1!==this.container&&e(this.container),this.input=this.element.is("input")?this.element:!!this.options.input&&this.element.find(this.options.input),this.input&&0===this.input.length&&(this.input=!1),this.color=this.createColor(!1!==this.options.color?this.options.color:this.getValue()),this.format=!1!==this.options.format?this.options.format:this.color.origFormat,!1!==this.options.color&&(this.updateInput(this.color),this.updateData(this.color)),this.disabled=!1;var s=this.picker=e(this.options.template);if(this.options.customClass&&s.addClass(this.options.customClass),this.options.inline?s.addClass("colorpicker-inline colorpicker-visible"):s.addClass("colorpicker-hidden"),this.options.horizontal&&s.addClass("colorpicker-horizontal"),-1===["rgba","hsla","alias"].indexOf(this.format)&&!1!==this.options.format&&"transparent"!==this.getValue()||s.addClass("colorpicker-with-alpha"),"right"===this.options.align&&s.addClass("colorpicker-right"),!0===this.options.inline&&s.addClass("colorpicker-no-arrow"),this.options.colorSelectors){var i=this,r=i.picker.find(".colorpicker-selectors");r.length>0&&(e.each(this.options.colorSelectors,function(t,a){var n=e("<i />").addClass("colorpicker-selectors-color").css("background-color",a).data("class",t).data("alias",t);n.on("mousedown.colorpicker touchstart.colorpicker",function(t){t.preventDefault(),i.setValue("alias"===i.format?e(this).data("alias"):e(this).css("background-color"))}),r.append(n)}),r.show().addClass("colorpicker-visible"))}s.on("mousedown.colorpicker touchstart.colorpicker",e.proxy(function(e){e.target===e.currentTarget&&e.preventDefault()},this)),s.find(".colorpicker-saturation, .colorpicker-hue, .colorpicker-alpha").on("mousedown.colorpicker touchstart.colorpicker",e.proxy(this.mousedown,this)),s.appendTo(this.container?this.container:e("body")),!1!==this.input&&(this.input.on({"keyup.colorpicker":e.proxy(this.keyup,this)}),this.input.on({"change.colorpicker":e.proxy(this.change,this)}),!1===this.component&&this.element.on({"focus.colorpicker":e.proxy(this.show,this)}),!1===this.options.inline&&this.element.on({"focusout.colorpicker":e.proxy(this.hide,this)})),!1!==this.component&&this.component.on({"click.colorpicker":e.proxy(this.show,this)}),!1===this.input&&!1===this.component&&this.element.on({"click.colorpicker":e.proxy(this.show,this)}),!1!==this.input&&!1!==this.component&&"color"===this.input.attr("type")&&this.input.on({"click.colorpicker":e.proxy(this.show,this),"focus.colorpicker":e.proxy(this.show,this)}),this.update(),e(e.proxy(function(){this.element.trigger("create")},this))};n.Color=t,n.prototype={constructor:n,destroy:function(){this.picker.remove(),this.element.removeData("colorpicker","color").off(".colorpicker"),!1!==this.input&&this.input.off(".colorpicker"),!1!==this.component&&this.component.off(".colorpicker"),this.element.removeClass("colorpicker-element"),this.element.trigger({type:"destroy"})},reposition:function(){if(!1!==this.options.inline||this.options.container)return!1;var e=this.container&&this.container[0]!==window.document.body?"position":"offset",t=this.component||this.element,a=t[e]();"right"===this.options.align&&(a.left-=this.picker.outerWidth()-t.outerWidth()),this.picker.css({top:a.top+t.outerHeight(),left:a.left})},show:function(t){this.isDisabled()||(this.picker.addClass("colorpicker-visible").removeClass("colorpicker-hidden"),this.reposition(),e(window).on("resize.colorpicker",e.proxy(this.reposition,this)),!t||this.hasInput()&&"color"!==this.input.attr("type")||t.stopPropagation&&t.preventDefault&&(t.stopPropagation(),t.preventDefault()),!this.component&&this.input||!1!==this.options.inline||e(window.document).on({"mousedown.colorpicker":e.proxy(this.hide,this)}),this.element.trigger({type:"showPicker",color:this.color}))},hide:function(t){if(void 0!==t&&t.target&&(e(t.currentTarget).parents(".colorpicker").length>0||e(t.target).parents(".colorpicker").length>0))return!1;this.picker.addClass("colorpicker-hidden").removeClass("colorpicker-visible"),e(window).off("resize.colorpicker",this.reposition),e(window.document).off({"mousedown.colorpicker":this.hide}),this.update(),this.element.trigger({type:"hidePicker",color:this.color})},updateData:function(e){return e=e||this.color.toString(!1,this.format),this.element.data("color",e),e},updateInput:function(e){return e=e||this.color.toString(!1,this.format),!1!==this.input&&(this.input.prop("value",e),this.input.trigger("change")),e},updatePicker:function(e){void 0!==e&&(this.color=this.createColor(e));var t=!1===this.options.horizontal?this.options.sliders:this.options.slidersHorz,a=this.picker.find("i");if(0!==a.length)return!1===this.options.horizontal?(t=this.options.sliders,a.eq(1).css("top",t.hue.maxTop*(1-this.color.value.h)).end().eq(2).css("top",t.alpha.maxTop*(1-this.color.value.a))):(t=this.options.slidersHorz,a.eq(1).css("left",t.hue.maxLeft*(1-this.color.value.h)).end().eq(2).css("left",t.alpha.maxLeft*(1-this.color.value.a))),a.eq(0).css({top:t.saturation.maxTop-this.color.value.b*t.saturation.maxTop,left:this.color.value.s*t.saturation.maxLeft}),this.picker.find(".colorpicker-saturation").css("backgroundColor",this.color.toHex(!0,this.color.value.h,1,1,1)),this.picker.find(".colorpicker-alpha").css("backgroundColor",this.color.toHex(!0)),this.picker.find(".colorpicker-color, .colorpicker-color div").css("backgroundColor",this.color.toString(!0,this.format)),e},updateComponent:function(e){var t;if(t=void 0!==e?this.createColor(e):this.color,!1!==this.component){var a=this.component.find("i").eq(0);a.length>0?a.css({backgroundColor:t.toString(!0,this.format)}):this.component.css({backgroundColor:t.toString(!0,this.format)})}return t.toString(!1,this.format)},update:function(e){var t;return!1===this.getValue(!1)&&!0!==e||(t=this.updateComponent(),this.updateInput(t),this.updateData(t),this.updatePicker()),t},setValue:function(e){this.color=this.createColor(e),this.update(!0),this.element.trigger({type:"changeColor",color:this.color,value:e})},createColor:function(e){return new t(e||null,this.options.colorSelectors,this.options.fallbackColor?this.options.fallbackColor:this.color,this.options.fallbackFormat,this.options.hexNumberSignPrefix)},getValue:function(e){e=void 0===e?this.options.fallbackColor:e;var t;return t=this.hasInput()?this.input.val():this.element.data("color"),void 0!==t&&""!==t&&null!==t||(t=e),t},hasInput:function(){return!1!==this.input},isDisabled:function(){return this.disabled},disable:function(){return this.hasInput()&&this.input.prop("disabled",!0),this.disabled=!0,this.element.trigger({type:"disable",color:this.color,value:this.getValue()}),!0},enable:function(){return this.hasInput()&&this.input.prop("disabled",!1),this.disabled=!1,this.element.trigger({type:"enable",color:this.color,value:this.getValue()}),!0},currentSlider:null,mousePointer:{left:0,top:0},mousedown:function(t){!t.pageX&&!t.pageY&&t.originalEvent&&t.originalEvent.touches&&(t.pageX=t.originalEvent.touches[0].pageX,t.pageY=t.originalEvent.touches[0].pageY),t.stopPropagation(),t.preventDefault();var a=e(t.target),n=a.closest("div"),s=this.options.horizontal?this.options.slidersHorz:this.options.sliders;if(!n.is(".colorpicker")){if(n.is(".colorpicker-saturation"))this.currentSlider=e.extend({},s.saturation);else if(n.is(".colorpicker-hue"))this.currentSlider=e.extend({},s.hue);else{if(!n.is(".colorpicker-alpha"))return!1;this.currentSlider=e.extend({},s.alpha)}var i=n.offset();this.currentSlider.guide=n.find("i")[0].style,this.currentSlider.left=t.pageX-i.left,this.currentSlider.top=t.pageY-i.top,this.mousePointer={left:t.pageX,top:t.pageY},e(window.document).on({"mousemove.colorpicker":e.proxy(this.mousemove,this),"touchmove.colorpicker":e.proxy(this.mousemove,this),"mouseup.colorpicker":e.proxy(this.mouseup,this),"touchend.colorpicker":e.proxy(this.mouseup,this)}).trigger("mousemove")}return!1},mousemove:function(e){!e.pageX&&!e.pageY&&e.originalEvent&&e.originalEvent.touches&&(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY),e.stopPropagation(),e.preventDefault();var t=Math.max(0,Math.min(this.currentSlider.maxLeft,this.currentSlider.left+((e.pageX||this.mousePointer.left)-this.mousePointer.left))),a=Math.max(0,Math.min(this.currentSlider.maxTop,this.currentSlider.top+((e.pageY||this.mousePointer.top)-this.mousePointer.top)));return this.currentSlider.guide.left=t+"px",this.currentSlider.guide.top=a+"px",this.currentSlider.callLeft&&this.color[this.currentSlider.callLeft].call(this.color,t/this.currentSlider.maxLeft),this.currentSlider.callTop&&this.color[this.currentSlider.callTop].call(this.color,a/this.currentSlider.maxTop),!1!==this.options.format||"setAlpha"!==this.currentSlider.callTop&&"setAlpha"!==this.currentSlider.callLeft||(1!==this.color.value.a?(this.format="rgba",this.color.origFormat="rgba"):(this.format="hex",this.color.origFormat="hex")),this.update(!0),this.element.trigger({type:"changeColor",color:this.color}),!1},mouseup:function(t){return t.stopPropagation(),t.preventDefault(),e(window.document).off({"mousemove.colorpicker":this.mousemove,"touchmove.colorpicker":this.mousemove,"mouseup.colorpicker":this.mouseup,"touchend.colorpicker":this.mouseup}),!1},change:function(e){this.keyup(e)},keyup:function(e){38===e.keyCode?(this.color.value.a<1&&(this.color.value.a=Math.round(100*(this.color.value.a+.01))/100),this.update(!0)):40===e.keyCode?(this.color.value.a>0&&(this.color.value.a=Math.round(100*(this.color.value.a-.01))/100),this.update(!0)):(this.color=this.createColor(this.input.val()),this.color.origFormat&&!1===this.options.format&&(this.format=this.color.origFormat),!1!==this.getValue(!1)&&(this.updateData(),this.updateComponent(),this.updatePicker())),this.element.trigger({type:"changeColor",color:this.color,value:this.input.val()})}},e.colorpicker=n,e.fn.colorpicker=function(t){var a=Array.prototype.slice.call(arguments,1),s=1===this.length,i=null,r=this.each(function(){var s=e(this),r=s.data("colorpicker"),o="object"==typeof t?t:{};r||(r=new n(this,o),s.data("colorpicker",r)),"string"==typeof t?e.isFunction(r[t])?i=r[t].apply(r,a):(a.length&&(r[t]=a[0]),i=r[t]):i=s});return s?i:r},e.fn.colorpicker.constructor=n})},2450:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(2),v=n(g),E=a(2451),b=n(E),y=function(e){function t(){var e,a,n,s;(0,o.default)(this,t);for(var r=arguments.length,l=Array(r),d=0;d<r;d++)l[d]=arguments[d];return a=n=(0,c.default)(this,(e=t.__proto__||(0,i.default)(t)).call.apply(e,[this].concat(l))),n.handleChange=function(e){var t=n.props,a=t.id,s=t.onChange;s&&s(a,e)},s=a,(0,c.default)(n,s)}return(0,m.default)(t,e),(0,d.default)(t,[{key:"render",value:function(){var e=this.props,t=e.label,a=e.color;return p.default.createElement("div",null,p.default.createElement("label",{className:"custom-label"},t),p.default.createElement(b.default,{color:a,onChange:this.handleChange}))}}]),t}(p.default.Component);y.propTypes={id:v.default.string.isRequired,label:v.default.string.isRequired,color:v.default.string.isRequired,onChange:v.default.func},t.default=y},2451:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(1),p=n(h),g=a(47),v=n(g),E=a(2),b=n(E),y=a(2098),S=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.checkClick=function(e){v.default.findDOMNode(a.colorPicker).contains(e.target)||a.setState({isOpened:!1})},a.togglePicker=function(){a.setState({isOpened:!a.state.isOpened})},a.handleChange=function(e){var t=e.hex,n=a.props.onChange;n&&n(t)},a.state={idOpened:!1},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidUpdate",value:function(e,t){var a=t.isOpened,n=this.state.isOpened;n!==a&&(n?document.addEventListener("click",this.checkClick):document.removeEventListener("click",this.checkClick))}},{key:"render",value:function(){var e=this,t=this.props.color,a=this.state.isOpened;return p.default.createElement("div",{className:"color-input input-group"},p.default.createElement("input",{className:"form-control",type:"text",value:t,style:{background:"#fff"},readOnly:!0}),p.default.createElement("span",{className:"input-group-addon",onClick:this.togglePicker},p.default.createElement("i",{className:"color-icon",style:{backgroundColor:t}})),a&&p.default.createElement("div",{ref:function(t){e.colorPicker=t},className:"color-popover"},p.default.createElement(y.ChromePicker,{color:t,onChange:this.handleChange})))}}]),t}(p.default.Component);S.propTypes={color:b.default.string.isRequired,onChange:b.default.func},t.default=S},2452:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(9),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=function(t){function a(e){(0,o.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.state={},t}return(0,m.default)(a,t),(0,d.default)(a,[{key:"render",value:function(){var t=this,a=this.props.theme,n=[],s=e.mm_config.AllowedThemes?e.mm_config.AllowedThemes.split(","):[],i=s.length>1||s[0]&&s[0].trim().length>0;for(var r in S.default.THEMES)if(S.default.THEMES.hasOwnProperty(r)){var o=function(){if(i&&s.indexOf(r)<0)return"continue";var e=p.default.extend(!0,{},S.default.THEMES[r]),o="";e.type===a.type&&(o="active"),n.push(b.default.createElement("div",{className:"col-xs-6 col-sm-3 premade-themes",key:"premade-theme-key"+r},b.default.createElement("div",{className:o,onClick:function(){return t.props.updateTheme(e)}},b.default.createElement("label",null,b.default.createElement("img",{className:"img-responsive",src:e.image}),b.default.createElement("div",{className:"theme-label"},M.toTitleCase(e.type))))))}();if("continue"===o)continue}return b.default.createElement("div",{className:"row appearance-section"},b.default.createElement("div",{className:"clearfix"},n))}}]),a}(b.default.Component);t.default=C,C.propTypes={theme:v.default.object.isRequired,updateTheme:v.default.func.isRequired}}).call(t,a(22))},2453:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function i(e){return{actions:(0,d.bindActionCreators)({getMe:u.getMe},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(61),c=a(2454),f=n(c);t.default=(0,l.connect)(s,i)(f.default)},2454:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(41),i=n(s),r=a(6),o=n(r),l=a(4),d=n(l),u=a(5),c=n(u),f=a(7),m=n(f),h=a(8),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(17),S=a(237),_=a(69),M=a(206),C=n(M),w=a(25),k=n(w),T=a(9),N=n(T),P=a(16),I=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(P),L=a(736),D=n(L),R=a(737),A=n(R),O=a(2455),F=n(O),x=(0,y.defineMessages)({usernameReserved:{id:"user.settings.general.usernameReserved",defaultMessage:"This username is reserved, please choose a new one."},usernameRestrictions:{id:"user.settings.general.usernameRestrictions",defaultMessage:"Username must begin with a letter, and contain between {min} to {max} lowercase characters made up of numbers, letters, and the symbols '.', '-', and '_'."},validEmail:{id:"user.settings.general.validEmail",defaultMessage:"Please enter a valid email address."},emailMatch:{id:"user.settings.general.emailMatch",defaultMessage:"The new emails you entered do not match."},checkEmail:{id:"user.settings.general.checkEmail",defaultMessage:"Check your email at {email} to verify the address."},validImage:{id:"user.settings.general.validImage",defaultMessage:"Only JPG or PNG images may be used for profile pictures"},imageTooLarge:{id:"user.settings.general.imageTooLarge",defaultMessage:"Unable to upload profile image. File is too large."},uploadImage:{id:"user.settings.general.uploadImage",defaultMessage:"Click 'Edit' to upload an image."},uploadImageMobile:{id:"user.settings.general.mobile.uploadImage",defaultMessage:"Click to upload an image."},fullName:{id:"user.settings.general.fullName",defaultMessage:"Full Name"},nickname:{id:"user.settings.general.nickname",defaultMessage:"Nickname"},username:{id:"user.settings.general.username",defaultMessage:"Username"},profilePicture:{id:"user.settings.general.profilePicture",defaultMessage:"Profile Picture"},close:{id:"user.settings.general.close",defaultMessage:"Close"},position:{id:"user.settings.general.position",defaultMessage:"Position"}}),U=function(t){function a(e){(0,d.default)(this,a);var t=(0,m.default)(this,(a.__proto__||(0,o.default)(a)).call(this,e));return t.submitActive=!1,t.submitUsername=t.submitUsername.bind(t),t.submitNickname=t.submitNickname.bind(t),t.submitName=t.submitName.bind(t),t.submitEmail=t.submitEmail.bind(t),t.submitUser=t.submitUser.bind(t),t.submitPicture=t.submitPicture.bind(t),t.submitPosition=t.submitPosition.bind(t),t.updateUsername=t.updateUsername.bind(t),t.updateFirstName=t.updateFirstName.bind(t),t.updateLastName=t.updateLastName.bind(t),t.updateNickname=t.updateNickname.bind(t),t.updateEmail=t.updateEmail.bind(t),t.updateConfirmEmail=t.updateConfirmEmail.bind(t),t.updatePicture=t.updatePicture.bind(t),t.updateSection=t.updateSection.bind(t),t.updatePosition=t.updatePosition.bind(t),t.state=t.setupInitialState(e),t}return(0,p.default)(a,t),(0,c.default)(a,[{key:"submitUsername",value:function(e){e.preventDefault();var t=(0,i.default)({},this.props.user),a=this.state.username.trim().toLowerCase(),n=this.props.intl.formatMessage,s=I.isValidUsername(a);return"Cannot use a reserved word as a username."===s?void this.setState({clientError:n(x.usernameReserved),serverError:""}):s?void this.setState({clientError:n(x.usernameRestrictions,{min:N.default.MIN_USERNAME_LENGTH,max:N.default.MAX_USERNAME_LENGTH}),serverError:""}):t.username===a?void this.updateSection(""):(t.username=a,(0,S.trackEvent)("settings","user_settings_update",{field:"username"}),void this.submitUser(t,N.default.UserUpdateEvents.USERNAME,!1))}},{key:"submitNickname",value:function(e){e.preventDefault();var t=(0,i.default)({},this.props.user),a=this.state.nickname.trim();if(t.nickname===a)return void this.updateSection("");t.nickname=a,(0,S.trackEvent)("settings","user_settings_update",{field:"username"}),this.submitUser(t,N.default.UserUpdateEvents.NICKNAME,!1)}},{key:"submitName",value:function(e){e.preventDefault();var t=(0,i.default)({},this.props.user),a=this.state.firstName.trim(),n=this.state.lastName.trim();if(t.first_name===a&&t.last_name===n)return void this.updateSection("");t.first_name=a,t.last_name=n,(0,S.trackEvent)("settings","user_settings_update",{field:"fullname"}),this.submitUser(t,N.default.UserUpdateEvents.FULLNAME,!1)}},{key:"submitEmail",value:function(e){e.preventDefault();var t=(0,i.default)({},this.props.user),a=this.state.email.trim().toLowerCase(),n=this.state.confirmEmail.trim().toLowerCase(),s=this.props.intl.formatMessage;return a!==t.email||""!==n&&n!==t.email?""!==a&&I.isEmail(a)?a!==n?void this.setState({emailError:s(x.emailMatch),clientError:"",serverError:""}):(t.email=a,(0,S.trackEvent)("settings","user_settings_update",{field:"email"}),void this.submitUser(t,N.default.UserUpdateEvents.EMAIL,!0)):void this.setState({emailError:s(x.validEmail),clientError:"",serverError:""}):void this.updateSection("")}},{key:"submitUser",value:function(t,a,n){var s=this;this.setState({sectionIsSaving:!0}),(0,_.updateUser)(t,a,function(){s.updateSection(""),s.props.actions.getMe(),"true"===e.window.mm_config.SendEmailNotifications&&"true"===e.window.mm_config.RequireEmailVerification&&n&&(C.default.storeLastError({message:s.props.intl.formatMessage(x.checkEmail,{email:t.email})}),C.default.emitChange(),s.setState({emailChangeInProgress:!0}))},function(e){var t=void 0;t=e.message?e.message:e,s.setState({serverError:t,emailError:"",clientError:"",sectionIsSaving:!1})})}},{key:"submitPicture",value:function(e){var t=this;if(e.preventDefault(),this.state.pictureFile&&this.submitActive){(0,S.trackEvent)("settings","user_settings_update",{field:"picture"});var a=this.props.intl.formatMessage,n=this.state.pictureFile;if("image/jpeg"!==n.type&&"image/png"!==n.type)return void this.setState({clientError:a(x.validImage),serverError:""});if(n.size>this.state.maxFileSize)return void this.setState({clientError:a(x.imageTooLarge),serverError:""});this.setState({loadingPicture:!0}),(0,_.uploadProfileImage)(n,function(){t.updateSection(""),t.submitActive=!1},function(e){var a=t.setupInitialState(t.props);a.serverError=e.message,t.setState(a)})}}},{key:"submitPosition",value:function(e){e.preventDefault();var t=(0,i.default)({},this.props.user),a=this.state.position.trim();if(t.position===a)return void this.updateSection("");t.position=a,(0,S.trackEvent)("settings","user_settings_update",{field:"position"}),this.submitUser(t,N.default.UserUpdateEvents.Position,!1)}},{key:"updateUsername",value:function(e){this.setState({username:e.target.value})}},{key:"updateFirstName",value:function(e){this.setState({firstName:e.target.value})}},{key:"updateLastName",value:function(e){this.setState({lastName:e.target.value})}},{key:"updateNickname",value:function(e){this.setState({nickname:e.target.value})}},{key:"updatePosition",value:function(e){this.setState({position:e.target.value})}},{key:"updateEmail",value:function(e){this.setState({email:e.target.value})}},{key:"updateConfirmEmail",value:function(e){this.setState({confirmEmail:e.target.value})}},{key:"updatePicture",value:function(e){e.target.files&&e.target.files[0]?(this.setState({pictureFile:e.target.files[0]}),this.submitActive=!0,this.setState({clientError:null})):this.setState({pictureFile:null})}},{key:"updateSection",value:function(e){var t=this.state.emailChangeInProgress;this.setState((0,i.default)({},this.setupInitialState(this.props),{emailChangeInProgress:t,clientError:"",serverError:"",emailError:"",sectionIsSaving:!1})),this.submitActive=!1,this.props.updateSection(e)}},{key:"setupInitialState",value:function(t){var a=t.user;return{username:a.username,firstName:a.first_name,lastName:a.last_name,nickname:a.nickname,position:a.position,originalEmail:a.email,email:"",confirmEmail:"",pictureFile:null,loadingPicture:!1,emailChangeInProgress:!1,maxFileSize:e.window.mm_config.MaxFileSize,sectionIsSaving:!1}}},{key:"createEmailSection",value:function(){var t=this,a=void 0;if("email"===this.props.activeSection){var n="true"===e.window.mm_config.SendEmailNotifications,s="true"===e.window.mm_config.RequireEmailVerification,i=[],r=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp1",defaultMessage:"Email is used for sign-in, notifications, and password reset. Email requires verification if changed."});if(n)if(s){if(this.state.emailChangeInProgress){var o=k.default.getCurrentUser().email;o&&(r=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp4",defaultMessage:"A verification email was sent to {email}.",values:{email:o}}))}}else r=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp3",defaultMessage:"Email is used for sign-in, notifications, and password reset."});else r=b.default.createElement("div",{className:"setting-list__hint col-sm-12 text-danger"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailHelp2",defaultMessage:"Email has been disabled by your System Administrator. No notification emails will be sent until it is enabled."}));var l=null;""===this.props.user.auth_service?(i.push(b.default.createElement("div",{key:"currentEmailSetting"},b.default.createElement("div",{className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.currentEmail",defaultMessage:"Current Email"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("label",{className:"control-label"},this.state.originalEmail))))),i.push(b.default.createElement("div",{key:"emailSetting"},b.default.createElement("div",{className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.newEmail",defaultMessage:"New Email"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"primaryEmail",className:"form-control",type:"email",onChange:this.updateEmail,value:this.state.email}))))),i.push(b.default.createElement("div",{key:"confirmEmailSetting"},b.default.createElement("div",{className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.confirmEmail",defaultMessage:"Confirm Email"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"confirmEmail",className:"form-control",type:"email",onChange:this.updateConfirmEmail,value:this.state.confirmEmail}))),r)),l=this.submitEmail):this.props.user.auth_service===N.default.GITLAB_SERVICE?i.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),r)):this.props.user.auth_service===N.default.GOOGLE_SERVICE?i.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),r)):this.props.user.auth_service===N.default.OFFICE365_SERVICE?i.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),r)):this.props.user.auth_service===N.default.LDAP_SERVICE?i.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"padding-bottom"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})))):this.props.user.auth_service===N.default.SAML_SERVICE&&i.push(b.default.createElement("div",{key:"oauthEmailInfo",className:"padding-bottom"},b.default.createElement("div",{className:"setting-list__hint col-sm-12"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emailSamlCantUpdate",defaultMessage:"Login occurs through SAML. Email cannot be updated. Email address used for notifications is {email}.",values:{email:this.state.originalEmail}})),r)),a=b.default.createElement(D.default,{title:b.default.createElement(y.FormattedMessage,{id:"user.settings.general.email",defaultMessage:"Email"}),inputs:i,submit:l,saving:this.state.sectionIsSaving,server_error:this.state.serverError,client_error:this.state.emailError,updateSection:function(e){t.updateSection(""),e.preventDefault()}})}else{var d="";if(""===this.props.user.auth_service)if(this.state.emailChangeInProgress){var u=k.default.getCurrentUser().email;d=u?b.default.createElement(y.FormattedHTMLMessage,{id:"user.settings.general.newAddress",defaultMessage:"New Address: {email}<br />Check your email to verify the above address.",values:{email:u}}):b.default.createElement(y.FormattedMessage,{id:"user.settings.general.checkEmailNoAddress",defaultMessage:"Check your email to verify your new address"})}else d=k.default.getCurrentUser().email;else this.props.user.auth_service===N.default.GITLAB_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginGitlab",defaultMessage:"Login done through GitLab ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.GOOGLE_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginGoogle",defaultMessage:"Login done through Google Apps ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.OFFICE365_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginOffice365",defaultMessage:"Login done through Office 365 ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.LDAP_SERVICE?d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginLdap",defaultMessage:"Login done through AD/LDAP ({email})",values:{email:this.state.originalEmail}}):this.props.user.auth_service===N.default.SAML_SERVICE&&(d=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.loginSaml",defaultMessage:"Login done through SAML ({email})",values:{email:this.state.originalEmail}}));a=b.default.createElement(A.default,{title:b.default.createElement(y.FormattedMessage,{id:"user.settings.general.email",defaultMessage:"Email"}),describe:d,updateSection:function(){t.updateSection("email")}})}return a}},{key:"render",value:function(){var t=this,a=this.props.user,n=this.props.intl.formatMessage,s=null;this.state.clientError&&(s=this.state.clientError);var i=null;this.state.serverError&&(i=this.state.serverError);var r=void 0,o=[];if("name"===this.props.activeSection){var l=void 0,d=null;if("ldap"===this.props.user.auth_service&&("true"===e.window.mm_config.LdapFristNameAttributeSet||"true"===e.window.mm_config.LdapLastNameAttributeSet)||this.props.user.auth_service===N.default.SAML_SERVICE&&("true"===e.window.mm_config.SamlFirstNameAttributeSet||"true"===e.window.mm_config.SamlLastNameAttributeSet))l=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."}));else{var u=function(e){e.preventDefault(),this.updateSection(""),this.props.updateTab("notifications")};o.push(b.default.createElement("div",{key:"firstNameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.firstName",defaultMessage:"First Name"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"firstName",className:"form-control",type:"text",onChange:this.updateFirstName,value:this.state.firstName})))),o.push(b.default.createElement("div",{key:"lastNameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.lastName",defaultMessage:"Last Name"})),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"lastName",className:"form-control",type:"text",onChange:this.updateLastName,value:this.state.lastName}))));var c=b.default.createElement("a",{href:"#",onClick:u.bind(this)},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.notificationsLink",defaultMessage:"Notifications"}));l=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.notificationsExtra",defaultMessage:"By default, you will receive mention notifications when someone types your first name. Go to {notify} settings to change this default.",values:{notify:c}})),d=this.submitName}r=b.default.createElement(D.default,{title:n(x.fullName),inputs:o,submit:d,saving:this.state.sectionIsSaving,server_error:i,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:l})}else{var f="";a.first_name&&a.last_name?f=a.first_name+" "+a.last_name:a.first_name?f=a.first_name:a.last_name?f=a.last_name:(f=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emptyName",defaultMessage:"Click 'Edit' to add your full name"}),I.isMobile()&&(f=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.mobile.emptyName",defaultMessage:"Click to add your full name"}))),r=b.default.createElement(A.default,{title:n(x.fullName),describe:f,updateSection:function(){t.updateSection("name")}})}var m=void 0;if("nickname"===this.props.activeSection){var h=void 0,p=null;if("ldap"===this.props.user.auth_service&&e.window.mm_config.LdapNicknameAttributeSet||this.props.user.auth_service===N.default.SAML_SERVICE&&e.window.mm_config.LdapNicknameAttributeSet)h=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so though your login provider."}));else{var g=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.nickname",defaultMessage:"Nickname"});I.isMobile()&&(g=""),o.push(b.default.createElement("div",{key:"nicknameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},g),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"nickname",className:"form-control",type:"text",onChange:this.updateNickname,value:this.state.nickname,maxLength:N.default.MAX_NICKNAME_LENGTH,autoCapitalize:"off"})))),h=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.nicknameExtra",defaultMessage:"Use Nickname for a name you might be called that is different from your first name and username. This is most often used when two or more people have similar sounding names and usernames."})),p=this.submitNickname}m=b.default.createElement(D.default,{title:n(x.nickname),inputs:o,submit:p,saving:this.state.sectionIsSaving,server_error:i,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:h})}else{var v="";a.nickname?v=a.nickname:(v=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emptyNickname",defaultMessage:"Click 'Edit' to add a nickname"}),I.isMobile()&&(v=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.mobile.emptyNickname",defaultMessage:"Click to add a nickname"}))),m=b.default.createElement(A.default,{title:n(x.nickname),describe:v,updateSection:function(){t.updateSection("nickname")}})}var E=void 0;if("username"===this.props.activeSection){var S=void 0,_=null;if(""===this.props.user.auth_service){var M=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.username",defaultMessage:"Username"});I.isMobile()&&(M=""),o.push(b.default.createElement("div",{key:"usernameSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},M),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"username",maxLength:N.default.MAX_USERNAME_LENGTH,className:"form-control",type:"text",onChange:this.updateUsername,value:this.state.username,autoCapitalize:"off"})))),S=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.usernameInfo",defaultMessage:"Pick something easy for teammates to recognize and recall."})),_=this.submitUsername}else S=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so though your login provider."}));E=b.default.createElement(D.default,{title:n(x.username),inputs:o,submit:_,saving:this.state.sectionIsSaving,server_error:i,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:S})}else E=b.default.createElement(A.default,{title:n(x.username),describe:k.default.getCurrentUser().username,updateSection:function(){t.updateSection("username")}});var C=void 0;if("position"===this.props.activeSection){var w=void 0,T=null;if("ldap"!==this.props.user.auth_service&&this.props.user.auth_service!==N.default.SAML_SERVICE||"true"!==e.window.mm_config.PositionAttributeSet){var P=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.position",defaultMessage:"Position"});I.isMobile()&&(P=""),o.push(b.default.createElement("div",{key:"positionSetting",className:"form-group"},b.default.createElement("label",{className:"col-sm-5 control-label"},P),b.default.createElement("div",{className:"col-sm-7"},b.default.createElement("input",{id:"position",className:"form-control",type:"text",onChange:this.updatePosition,value:this.state.position,maxLength:N.default.MAX_POSITION_LENGTH,autoCapitalize:"off"})))),w=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.positionExtra",defaultMessage:"Use Position for your role or job title. This will be shown in your profile popover."})),T=this.submitPosition}else w=b.default.createElement("span",null,b.default.createElement(y.FormattedMessage,{id:"user.settings.general.field_handled_externally",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so though your login provider."}));C=b.default.createElement(D.default,{title:n(x.position),inputs:o,submit:T,saving:this.state.sectionIsSaving,server_error:i,client_error:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},extraInfo:w})}else{var L="";a.position?L=a.position:(L=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.emptyPosition",defaultMessage:"Click 'Edit' to add your job title / position"}),I.isMobile()&&(L=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.mobile.emptyPosition",defaultMessage:"Click to add your job title / position"}))),C=b.default.createElement(A.default,{title:n(x.position),describe:L,updateSection:function(){t.updateSection("position")}})}var R=this.createEmailSection(),O=void 0;if("picture"===this.props.activeSection)O=b.default.createElement(F.default,{title:n(x.profilePicture),submit:this.submitPicture,src:I.imageURLForUser(a),serverError:i,clientError:s,updateSection:function(e){t.updateSection(""),e.preventDefault()},file:this.state.pictureFile,onFileChange:this.updatePicture,submitActive:this.submitActive,loadingPicture:this.state.loadingPicture});else{var U=n(x.uploadImage);I.isMobile()&&(U=n(x.uploadImageMobile)),a.last_picture_update&&(U=b.default.createElement(y.FormattedMessage,{id:"user.settings.general.imageUpdated",defaultMessage:"Image last updated {date}",values:{date:b.default.createElement(y.FormattedDate,{value:new Date(a.last_picture_update),day:"2-digit",month:"short",year:"numeric"})}})),O=b.default.createElement(A.default,{title:n(x.profilePicture),describe:U,updateSection:function(){t.updateSection("picture")}})}return b.default.createElement("div",null,b.default.createElement("div",{className:"modal-header"},b.default.createElement("button",{id:"closeUserSettings",type:"button",className:"close","data-dismiss":"modal","aria-label":n(x.close),onClick:this.props.closeModal},b.default.createElement("span",{"aria-hidden":"true"},"Ã—")),b.default.createElement("h4",{className:"modal-title",ref:"title"},b.default.createElement("div",{className:"modal-back"},b.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),b.default.createElement(y.FormattedMessage,{id:"user.settings.general.title",defaultMessage:"General Settings"}))),b.default.createElement("div",{className:"user-settings"},b.default.createElement("h3",{className:"tab-header"},b.default.createElement(y.FormattedMessage,{id:"user.settings.general.title",defaultMessage:"General Settings"})),b.default.createElement("div",{className:"divider-dark first"}),r,b.default.createElement("div",{className:"divider-light"}),E,b.default.createElement("div",{className:"divider-light"}),m,b.default.createElement("div",{className:"divider-light"}),C,b.default.createElement("div",{className:"divider-light"}),R,b.default.createElement("div",{className:"divider-light"}),O,b.default.createElement("div",{className:"divider-dark"})))}}]),a}(b.default.Component);U.propTypes={intl:y.intlShape.isRequired,user:v.default.object.isRequired,updateSection:v.default.func.isRequired,updateTab:v.default.func.isRequired,activeSection:v.default.string.isRequired,closeModal:v.default.func.isRequired,collapseModal:v.default.func.isRequired,actions:v.default.shape({getMe:v.default.func.isRequired}).isRequired},t.default=(0,y.injectIntl)(U)}).call(t,a(22))},2455:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(19),i=n(s),r=a(6),o=n(r),l=a(4),d=n(l),u=a(5),c=n(u),f=a(7),m=n(f),h=a(8),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(17),S=a(2456),_=n(S),M=a(9),C=n(M),w=a(208),k=n(w),T=a(238),N=n(T),P=function(e){function t(e){(0,d.default)(this,t);var a=(0,m.default)(this,(t.__proto__||(0,o.default)(t)).call(this,e));return a.setPicture=function(e){if(e){a.previewBlob=URL.createObjectURL(e);var t=new FileReader;t.onload=function(e){var t=a.getExifOrientation(e.target.result),n=a.getOrientationStyles(t);a.setState({image:a.previewBlob,orientationStyles:n})},t.readAsArrayBuffer(e)}},a.state={image:null},a}return(0,p.default)(t,e),(0,c.default)(t,[{key:"componentWillReceiveProps",value:function(e){e.file!==this.props.file&&(this.setState({image:null}),this.setPicture(e.file))}},{key:"componentWillUnmount",value:function(){this.previewBlob&&URL.revokeObjectURL(this.previewBlob)}},{key:"getExifOrientation",value:function(e){var t=new DataView(e);if(65496!==t.getUint16(0,!1))return-2;for(var a=t.byteLength,n=2;n<a;){var s=t.getUint16(n,!1);if(n+=2,65505===s){if(1165519206!==t.getUint32(n+=2,!1))return-1;var i=18761===t.getUint16(n+=6,!1);n+=t.getUint32(n+4,i);var r=t.getUint16(n,i);n+=2;for(var o=0;o<r;o++)if(274===t.getUint16(n+12*o,i))return t.getUint16(n+12*o+8,i)}else{if(65280!=(65280&s))break;n+=t.getUint16(n,!1)}}return-1}},{key:"getOrientationStyles",value:function(e){var t=(0,_.default)(e);return{transform:t.transform,transformOrigin:t["transform-origin"]}}},{key:"render",value:function(){var e=void 0;if(this.props.file){var t=(0,i.default)({backgroundImage:"url("+this.state.image+")"},this.state.orientationStyles);e=b.default.createElement("div",{className:"profile-img-preview",style:t})}else e=b.default.createElement("img",{ref:"image",className:"profile-img rounded",src:this.props.src});var a=void 0,n=void 0,s=!1;if(this.props.loadingPicture)a=b.default.createElement("img",{className:"spinner",src:k.default}),n=b.default.createElement("span",{className:"icon fa fa-refresh icon--rotate"}),s=!0;else{var r="btn btn-sm";this.props.submitActive?r+=" btn-primary":r+=" btn-inactive disabled",a=b.default.createElement("a",{className:r,onClick:this.props.submit},b.default.createElement(y.FormattedMessage,{id:"setting_picture.save",defaultMessage:"Save"}))}return b.default.createElement("ul",{className:"section-max form-horizontal"},b.default.createElement("li",{className:"col-xs-12 section-title"},this.props.title),b.default.createElement("li",{className:"col-xs-offset-3 col-xs-8"},b.default.createElement("ul",{className:"setting-list"},b.default.createElement("li",{className:"setting-list-item"},e),b.default.createElement("li",{className:"setting-list-item padding-top x2"},b.default.createElement(y.FormattedMessage,{id:"setting_picture.help",defaultMessage:"Upload a profile picture in BMP, JPG, JPEG or PNG format, at least {width}px in width and {height}px height.",values:{width:C.default.PROFILE_WIDTH,height:C.default.PROFILE_WIDTH}})),b.default.createElement("li",{className:"setting-list-item"},b.default.createElement("hr",null),b.default.createElement(N.default,{errors:[this.props.clientError,this.props.serverError],type:"modal"}),b.default.createElement("button",{className:"btn btn-sm btn-primary btn-file sel-btn",disabled:s},n,b.default.createElement(y.FormattedMessage,{id:"setting_picture.select",defaultMessage:"Select"}),b.default.createElement("input",{ref:"input",accept:".jpg,.png,.bmp",type:"file",onChange:this.props.onFileChange,disabled:s})),a,b.default.createElement("a",{className:"btn btn-sm theme",href:"#",onClick:this.props.updateSection},b.default.createElement(y.FormattedMessage,{id:"setting_picture.cancel",defaultMessage:"Cancel"}))))))}}]),t}(E.Component);P.propTypes={clientError:v.default.string,serverError:v.default.string,src:v.default.string,file:v.default.object,loadingPicture:v.default.bool,submitActive:v.default.bool,submit:v.default.func,title:v.default.string,onFileChange:v.default.func,updateSection:v.default.func},t.default=P},2456:function(e,t,a){function n(e){var t={},a=!1;for(var n in e){a||(a=!0);t[l[n]]=e[n]}return a?t:null}function s(e,t){return"r"===e||"ry"===e?t+"deg":"t"===e||"ty"===e?100*t+"%":void 0}function i(e){var t=[];for(var a in e){var n=l[a];t.push(n+"("+s(a,e[a])+")")}return t.length?t.join(" "):null}function r(e){var t={},a=!1;for(var n in e){a||(a=!0);var i=l[n];t[i]=i+"("+s(n,e[n])+")"}return a?t:null}function o(e){var t=String(e),a=d[t],s=i(a),o=u[t],l=n(a),c=r(a),f={};return s&&(f.transform=s),o&&(f["transform-origin"]=o),l&&(f.transforms=l),c&&(f.transformStrings=c),f}var l=(a(0),a(0),{r:"rotate",ry:"rotateY",t:"translateX",ty:"translateY"}),d={2:{ry:180},3:{r:180},4:{r:180,ry:180},5:{r:270,ry:180},6:{ty:-1,r:90},7:{ty:-1,t:-1,r:90,ry:180},8:{t:-1,r:270}},u={5:"top left",6:"bottom left",7:"bottom right",8:"top right"};e.exports=o},2457:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}function s(){var e=_.default.getCurrentUser(),t=M.NotificationLevels.DEFAULT,a="true",n="5",s="never",i="true",r=M.NotificationLevels.MENTION,o=C.default.UserStatuses.ONLINE;e.notify_props&&(e.notify_props.desktop&&(t=e.notify_props.desktop),e.notify_props.desktop_sound&&(a=e.notify_props.desktop_sound),e.notify_props.desktop_duration&&(n=e.notify_props.desktop_duration),e.notify_props.comments&&(s=e.notify_props.comments),e.notify_props.email&&(i=e.notify_props.email),e.notify_props.push&&(r=e.notify_props.push),e.notify_props.push_status&&(o=e.notify_props.push_status));var l=!1,d="",u=!1,c=!1;if(e.notify_props){if(e.notify_props.mention_keys){var f=e.notify_props.mention_keys.split(",");-1===f.indexOf(e.username)?l=!1:(l=!0,f.splice(f.indexOf(e.username),1),-1!==f.indexOf("@"+e.username)&&f.splice(f.indexOf("@"+e.username),1)),d=f.join(",")}e.notify_props.first_name&&(u="true"===e.notify_props.first_name),e.notify_props.channel&&(c="true"===e.notify_props.channel)}return{desktopActivity:t,desktopDuration:n,enableEmail:i,pushActivity:r,pushStatus:o,desktopSound:a,usernameKey:l,customKeys:d,customKeysChecked:d.length>0,firstNameKey:u,channelKey:c,notifyCommentsLevel:s,isSaving:!1}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=n(i),o=a(4),l=n(o),d=a(5),u=n(d),c=a(7),f=n(c),m=a(8),h=n(m),p=a(2),g=n(p),v=a(1),E=n(v),b=a(17),y=a(69),S=a(25),_=n(S),M=a(9),C=n(M),w=a(16),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(w),T=a(736),N=n(T),P=a(737),I=n(P),L=a(2458),D=n(L),R=a(2459),A=n(R),O=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));return t.handleSubmit=t.handleSubmit.bind(t),t.handleCancel=t.handleCancel.bind(t),t.updateSection=t.updateSection.bind(t),t.setStateValue=t.setStateValue.bind(t),t.onListenerChange=t.onListenerChange.bind(t),t.handleEmailRadio=t.handleEmailRadio.bind(t),t.updateUsernameKey=t.updateUsernameKey.bind(t),t.updateFirstNameKey=t.updateFirstNameKey.bind(t),t.updateChannelKey=t.updateChannelKey.bind(t),t.updateCustomMentionKeys=t.updateCustomMentionKeys.bind(t),t.updateState=t.updateState.bind(t),t.onCustomChange=t.onCustomChange.bind(t),t.createPushNotificationSection=t.createPushNotificationSection.bind(t),t.state=s(),t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"handleSubmit",value:function(e){var t=this,a=e.enableEmail,n=void 0===a?this.state.enableEmail:a,s={};s.user_id=this.props.user.id,s.email=n,s.desktop_sound=this.state.desktopSound,s.desktop=this.state.desktopActivity,s.desktop_duration=this.state.desktopDuration,s.push=this.state.pushActivity,s.push_status=this.state.pushStatus,s.comments=this.state.notifyCommentsLevel;var i=[];this.state.usernameKey&&i.push(this.props.user.username);var r=i.join(",");this.state.customKeys.length>0&&this.state.customKeysChecked&&(r+=","+this.state.customKeys),s.mention_keys=r,s.first_name=this.state.firstNameKey.toString(),s.channel=this.state.channelKey.toString(),this.setState({isSaving:!0}),(0,y.updateUserNotifyProps)(s,function(){t.props.updateSection("")},function(e){t.setState({serverError:e.message,isSaving:!1})})}},{key:"handleCancel",value:function(e){e.preventDefault(),this.updateState(),this.props.updateSection("")}},{key:"setStateValue",value:function(e,t){var a={};a[e]=t,this.setState(a)}},{key:"updateSection",value:function(e){this.updateState(),this.props.updateSection(e)}},{key:"updateState",value:function(){var e=s();k.areObjectsEqual(e,this.state)||this.setState(e),this.setState({isSaving:!1})}},{key:"componentDidMount",value:function(){_.default.addChangeListener(this.onListenerChange)}},{key:"componentWillUnmount",value:function(){_.default.removeChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){this.updateState()}},{key:"handleNotifyCommentsRadio",value:function(e){this.setState({notifyCommentsLevel:e}),this.refs.wrapper.focus()}},{key:"handlePushRadio",value:function(e){this.setState({pushActivity:e}),this.refs.wrapper.focus()}},{key:"handlePushStatusRadio",value:function(e){this.setState({pushStatus:e}),this.refs.wrapper.focus()}},{key:"handleEmailRadio",value:function(e){this.setState({enableEmail:e}),this.refs.wrapper.focus()}},{key:"updateUsernameKey",value:function(e){this.setState({usernameKey:e})}},{key:"updateFirstNameKey",value:function(e){this.setState({firstNameKey:e})}},{key:"updateChannelKey",value:function(e){this.setState({channelKey:e})}},{key:"updateCustomMentionKeys",value:function(){if(this.refs.customcheck.checked){var e=this.refs.custommentions.value;this.setState({customKeys:e.replace(/ /g,""),customKeysChecked:!0})}else this.setState({customKeys:"",customKeysChecked:!1})}},{key:"onCustomChange",value:function(){this.refs.customcheck.checked=!0,this.updateCustomMentionKeys()}},{key:"createPushNotificationSection",value:function(){var t=this;if("push"===this.props.activeSection){var a=[],n=null,s=null;if("true"===e.window.mm_config.SendPushNotifications){var i=[!1,!1,!1];this.state.pushActivity===M.NotificationLevels.ALL?i[0]=!0:this.state.pushActivity===M.NotificationLevels.NONE?i[2]=!0:i[1]=!0;var r=[!1,!1,!1];this.state.pushStatus===C.default.UserStatuses.ONLINE?r[0]=!0:this.state.pushStatus===C.default.UserStatuses.AWAY?r[1]=!0:r[2]=!0;var o=void 0;this.state.pushActivity!==M.NotificationLevels.NONE&&(o=E.default.createElement("div",null,E.default.createElement("hr",null),E.default.createElement("label",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.push_notification.status",defaultMessage:"Trigger push notifications when"})),E.default.createElement("br",null),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationOnline",type:"radio",name:"pushNotificationStatus",checked:r[0],onChange:this.handlePushStatusRadio.bind(this,C.default.UserStatuses.ONLINE)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.online",defaultMessage:"Online, away or offline"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationAway",type:"radio",name:"pushNotificationStatus",checked:r[1],onChange:this.handlePushStatusRadio.bind(this,C.default.UserStatuses.AWAY)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.away",defaultMessage:"Away or offline"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationOffline",type:"radio",name:"pushNotificationStatus",checked:r[2],onChange:this.handlePushStatusRadio.bind(this,C.default.UserStatuses.OFFLINE)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.offline",defaultMessage:"Offline"})))),n=E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.status_info",defaultMessage:"Notification alerts are only pushed to your mobile device when your online status matches the selection above."}))),a.push(E.default.createElement("div",{key:"userNotificationLevelOption"},E.default.createElement("label",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.send",defaultMessage:"Send mobile push notifications"})),E.default.createElement("br",null),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationAllActivity",type:"radio",name:"pushNotificationLevel",checked:i[0],onChange:this.handlePushRadio.bind(this,M.NotificationLevels.ALL)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivity",defaultMessage:"For all activity"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationMentions",type:"radio",name:"pushNotificationLevel",checked:i[1],onChange:this.handlePushRadio.bind(this,M.NotificationLevels.MENTION)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentions",defaultMessage:"For mentions and direct messages"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"pushNotificationNever",type:"radio",name:"pushNotificationLevel",checked:i[2],onChange:this.handlePushRadio.bind(this,M.NotificationLevels.NONE)}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),E.default.createElement("br",null),E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.info",defaultMessage:"Notification alerts are pushed to your mobile device when there is activity in Mattermost."})),o)),s=this.handleSubmit}else a.push(E.default.createElement("div",{key:"oauthEmailInfo",className:"padding-top"},E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.disabled_long",defaultMessage:"Push notifications for mobile devices have been disabled by your System Administrator."})));return E.default.createElement(N.default,{title:k.localizeMessage("user.settings.notifications.push","Mobile push notifications"),extraInfo:n,inputs:a,submit:s,server_error:this.state.serverError,updateSection:this.handleCancel})}var l="";l=this.state.pushActivity===M.NotificationLevels.ALL?this.state.pushStatus===C.default.UserStatuses.AWAY?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivityAway",defaultMessage:"For all activity when away or offline"}):this.state.pushStatus===C.default.UserStatuses.OFFLINE?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivityOffline",defaultMessage:"For all activity when offline"}):E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.allActivityOnline",defaultMessage:"For all activity when online, away or offline"}):this.state.pushActivity===M.NotificationLevels.NONE?E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.never",defaultMessage:"Never"}):"false"===e.window.mm_config.SendPushNotifications?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.disabled",defaultMessage:"Disabled by System Administrator"}):this.state.pushStatus===C.default.UserStatuses.AWAY?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentionsAway",defaultMessage:"For mentions and direct messages when away or offline"}):this.state.pushStatus===C.default.UserStatuses.OFFLINE?E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentionsOffline",defaultMessage:"For mentions and direct messages when offline"}):E.default.createElement(b.FormattedMessage,{id:"user.settings.push_notification.onlyMentionsOnline",defaultMessage:"For mentions and direct messages when online, away or offline"});var d=function(){t.props.updateSection("push")};return E.default.createElement(I.default,{title:k.localizeMessage("user.settings.notifications.push","Mobile push notifications"),describe:l,updateSection:d})}},{key:"render",value:function(){var e=this,t=this.state.serverError,a=this.props.user,n=void 0,s=void 0;if("keys"===this.props.activeSection){var i=[];if(a.first_name){var r=function(t){e.updateFirstNameKey(t.target.checked)};i.push(E.default.createElement("div",{key:"userNotificationFirstNameOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerFirst",type:"checkbox",checked:this.state.firstNameKey,onChange:r}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.sensitiveName",defaultMessage:'Your case sensitive first name "{first_name}"',values:{first_name:a.first_name}})))))}var o=function(t){e.updateUsernameKey(t.target.checked)};i.push(E.default.createElement("div",{key:"userNotificationUsernameOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerUsername",type:"checkbox",checked:this.state.usernameKey,onChange:o}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.sensitiveUsername",defaultMessage:'Your non-case sensitive username "{username}"',values:{username:a.username}})))));var l=function(t){e.updateChannelKey(t.target.checked)};i.push(E.default.createElement("div",{key:"userNotificationChannelOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerShouts",type:"checkbox",checked:this.state.channelKey,onChange:l}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.channelWide",defaultMessage:'Channel-wide mentions "@channel", "@all", "@here"'}))))),i.push(E.default.createElement("div",{key:"userNotificationCustomOption"},E.default.createElement("div",{className:"checkbox"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationTriggerCustom",ref:"customcheck",type:"checkbox",checked:this.state.customKeysChecked,onChange:this.updateCustomMentionKeys}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.sensitiveWords",defaultMessage:"Other non-case sensitive words, separated by commas:"}))),E.default.createElement("input",{id:"notificationTriggerCustomText",ref:"custommentions",className:"form-control mentions-input",type:"text",defaultValue:this.state.customKeys,onChange:this.onCustomChange})));var d=E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.mentionsInfo",defaultMessage:"Mentions trigger when someone sends a message that includes your username (@{username}) or any of the options selected above.",values:{username:a.username}}));n=E.default.createElement(N.default,{title:k.localizeMessage("user.settings.notifications.wordsTrigger","Words that trigger mentions"),inputs:i,submit:this.handleSubmit,saving:this.state.isSaving,server_error:t,updateSection:this.handleCancel,extraInfo:d})}else{var u=["@"+a.username];this.state.firstNameKey&&u.push(a.first_name),this.state.usernameKey&&u.push(a.username),this.state.channelKey&&(u.push("@channel"),u.push("@all"),u.push("@here")),this.state.customKeys.length>0&&(u=u.concat(this.state.customKeys.split(",")));for(var c="",f=0;f<u.length;f++)""!==u[f]&&(c+='"'+u[f]+'", ');c=c.length>0?c.substring(0,c.length-2):E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.noWords",defaultMessage:"No words configured"}),s=function(){this.props.updateSection("keys")}.bind(this),n=E.default.createElement(I.default,{title:k.localizeMessage("user.settings.notifications.wordsTrigger","Words that trigger mentions"),describe:c,updateSection:s})}var m=void 0,h=void 0;if("comments"===this.props.activeSection){var p=[!1,!1,!1];"never"===this.state.notifyCommentsLevel?p[2]=!0:"root"===this.state.notifyCommentsLevel?p[1]=!0:p[0]=!0;var g=[];g.push(E.default.createElement("div",{key:"userNotificationLevelOption"},E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationCommentsAny",type:"radio",name:"commentsNotificationLevel",checked:p[0],onChange:this.handleNotifyCommentsRadio.bind(this,"any")}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsAny",defaultMessage:"Mention any comments in a thread you participated in (This will include both mentions to your root post and any comments after you commented on a post)"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationCommentsRoot",type:"radio",name:"commentsNotificationLevel",checked:p[1],onChange:this.handleNotifyCommentsRadio.bind(this,"root")}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Mention any comments on your post"})),E.default.createElement("br",null)),E.default.createElement("div",{className:"radio"},E.default.createElement("label",null,E.default.createElement("input",{id:"notificationCommentsNever",type:"radio",name:"commentsNotificationLevel",checked:p[2],onChange:this.handleNotifyCommentsRadio.bind(this,"never")}),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsNever",defaultMessage:"No mentions for comments"})))));var v=E.default.createElement("span",null,E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsInfo",defaultMessage:"In addition to notifications for when you're mentioned, select if you would like to receive notifications on reply threads."}));m=E.default.createElement(N.default,{title:k.localizeMessage("user.settings.notifications.comments","Reply notifications"),extraInfo:v,inputs:g,submit:this.handleSubmit,saving:this.state.isSaving,server_error:t,updateSection:this.handleCancel})}else{var y="";y="never"===this.state.notifyCommentsLevel?E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsNever",defaultMessage:"Do not trigger notifications on messages in reply threads unless I'm mentioned"}):"root"===this.state.notifyCommentsLevel?E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsRoot",defaultMessage:"Trigger notifications on messages in threads that I start"}):E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.commentsAny",defaultMessage:"Trigger notifications on messages in reply threads that I start or participate in"}),h=function(){this.props.updateSection("comments")}.bind(this),m=E.default.createElement(I.default,{title:k.localizeMessage("user.settings.notifications.comments","Reply notifications"),describe:y,updateSection:h})}var S=this.createPushNotificationSection(),_="true"===this.state.enableEmail;return E.default.createElement("div",null,E.default.createElement("div",{className:"modal-header"},E.default.createElement("button",{id:"closeButton",type:"button",className:"close","data-dismiss":"modal",onClick:this.props.closeModal},E.default.createElement("span",{"aria-hidden":"true"},"Ã—")),E.default.createElement("h4",{className:"modal-title",ref:"title"},E.default.createElement("div",{className:"modal-back"},E.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.title",defaultMessage:"Notification Settings"}))),E.default.createElement("div",{ref:"wrapper",className:"user-settings"},E.default.createElement("h3",{className:"tab-header"},E.default.createElement(b.FormattedMessage,{id:"user.settings.notifications.header",defaultMessage:"Notifications"})),E.default.createElement("div",{className:"divider-dark first"}),E.default.createElement(D.default,{activity:this.state.desktopActivity,sound:this.state.desktopSound,duration:this.state.desktopDuration,updateSection:this.updateSection,setParentState:this.setStateValue,submit:this.handleSubmit,saving:this.state.isSaving,cancel:this.handleCancel,error:this.state.serverError,active:"desktop"===this.props.activeSection}),E.default.createElement("div",{className:"divider-light"}),E.default.createElement(A.default,{activeSection:this.props.activeSection,updateSection:this.props.updateSection,enableEmail:_,emailInterval:k.getEmailInterval(_),onSubmit:this.handleSubmit,onCancel:this.handleCancel,saving:this.state.isSaving,serverError:this.state.serverError}),E.default.createElement("div",{className:"divider-light"}),S,E.default.createElement("div",{className:"divider-light"}),n,E.default.createElement("div",{className:"divider-light"}),m,E.default.createElement("div",{className:"divider-dark"})))}}]),a}(E.default.Component);t.default=O,O.defaultProps={user:null,activeSection:"",activeTab:""},O.propTypes={user:g.default.object,updateSection:g.default.func,updateTab:g.default.func,activeSection:g.default.string,activeTab:g.default.string,closeModal:g.default.func.isRequired,collapseModal:g.default.func.isRequired}}).call(t,a(22))},2458:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(17),b=a(9),y=a(16),S=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(y),_=a(736),M=n(_),C=a(737),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.buildMaximizedSetting=a.buildMaximizedSetting.bind(a),a.buildMinimizedSetting=a.buildMinimizedSetting.bind(a),a.state={},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"buildMaximizedSetting",value:function(){var e=this,t=[],a=null,n=[!1,!1,!1];this.props.activity===b.NotificationLevels.MENTION?n[1]=!0:this.props.activity===b.NotificationLevels.NONE?n[2]=!0:n[0]=!0;var s=void 0,i=void 0;if(this.props.activity!==b.NotificationLevels.NONE){var r=[!1,!1];"false"===this.props.sound?r[1]=!0:r[0]=!0,s=S.hasSoundOptions()?v.default.createElement("div",null,v.default.createElement("hr",null),v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),v.default.createElement("br",null),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundOn",type:"radio",name:"notificationSounds",checked:r[0],onChange:function(){return e.props.setParentState("desktopSound","true")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.on",defaultMessage:"On"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundOff",type:"radio",name:"notificationSounds",checked:r[1],onChange:function(){return e.props.setParentState("desktopSound","false")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.off",defaultMessage:"Off"})),v.default.createElement("br",null)),v.default.createElement("br",null),v.default.createElement("span",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.sounds_info",defaultMessage:"Notification sounds are available on IE11, Safari, Chrome and Mattermost Desktop Apps."}))):v.default.createElement("div",null,v.default.createElement("hr",null),v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.sound",defaultMessage:"Notification sound"})),v.default.createElement("br",null),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.soundConfig",defaultMessage:"Please configure notification sounds in your browser settings"}));var o=[!1,!1,!1,!1];"3"===this.props.duration?o[0]=!0:"10"===this.props.duration?o[2]=!0:"0"===this.props.duration?o[3]=!0:o[1]=!0,i=v.default.createElement("div",null,v.default.createElement("hr",null),v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.duration",defaultMessage:"Notification duration"})),v.default.createElement("br",null),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDuration3",type:"radio",name:"desktopDuration",checked:o[0],onChange:function(){return e.props.setParentState("desktopDuration","3")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.seconds",defaultMessage:"{seconds} seconds",values:{seconds:"3"}})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDuration5",type:"radio",name:"desktopDuration",checked:o[1],onChange:function(){return e.props.setParentState("desktopDuration","5")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.seconds",defaultMessage:"{seconds} seconds",values:{seconds:"5"}})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDuration10",type:"radio",name:"desktopDuration",checked:o[2],onChange:function(){return e.props.setParentState("desktopDuration","10")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.seconds",defaultMessage:"{seconds} seconds",values:{seconds:"10"}}))),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"soundDurationUnlimited",type:"radio",name:"desktopDuration",checked:o[3],onChange:function(){return e.props.setParentState("desktopDuration","0")}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.unlimited",defaultMessage:"Unlimited"})))),a=v.default.createElement("span",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.durationInfo",defaultMessage:"Sets how long desktop notifications will remain on screen when using Firefox or Chrome. Desktop notifications in Edge and Safari can only stay on screen for a maximum of 5 seconds."}))}return t.push(v.default.createElement("div",{key:"userNotificationLevelOption"},v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop",defaultMessage:"Send desktop notifications"})),v.default.createElement("br",null),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"desktopNotificationAllActivity",type:"radio",name:"desktopNotificationLevel",checked:n[0],onChange:function(){return e.props.setParentState("desktopActivity",b.NotificationLevels.ALL)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.allActivity",defaultMessage:"For all activity"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"desktopNotificationMentions",type:"radio",name:"desktopNotificationLevel",checked:n[1],onChange:function(){return e.props.setParentState("desktopActivity",b.NotificationLevels.MENTION)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.onlyMentions",defaultMessage:"Only for mentions and direct messages"})),v.default.createElement("br",null)),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"desktopNotificationNever",type:"radio",name:"desktopNotificationLevel",checked:n[2],onChange:function(){return e.props.setParentState("desktopActivity",b.NotificationLevels.NONE)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.never",defaultMessage:"Never"}))),v.default.createElement("br",null),v.default.createElement("span",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.info",defaultMessage:"Desktop notifications are available on Edge, Firefox, Safari, Chrome and Mattermost Desktop Apps."})),s,i)),v.default.createElement(M.default,{title:S.localizeMessage("user.settings.notifications.desktop.title","Desktop notifications"),extraInfo:a,inputs:t,submit:this.props.submit,saving:this.props.saving,server_error:this.props.error,updateSection:this.props.cancel})}},{key:"buildMinimizedSetting",value:function(){var e="";e=this.props.activity===b.NotificationLevels.MENTION?S.hasSoundOptions()&&"false"!==this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundForever",defaultMessage:"For mentions and direct messages, with sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundTimed",defaultMessage:"For mentions and direct messages, with sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):S.hasSoundOptions()&&"false"===this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsNoSoundForever",defaultMessage:"For mentions and direct messages, without sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsNoSoundTimed",defaultMessage:"For mentions and direct messages, without sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundHiddenForever",defaultMessage:"For mentions and direct messages, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.mentionsSoundHiddenTimed",defaultMessage:"For mentions and direct messages, shown for {seconds} seconds",values:{seconds:this.props.duration}}):this.props.activity===b.NotificationLevels.NONE?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.off",defaultMessage:"Off"}):S.hasSoundOptions()&&"false"!==this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundForever",defaultMessage:"For all activity, with sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundTimed",defaultMessage:"For all activity, with sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):S.hasSoundOptions()&&"false"===this.props.sound?"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allNoSoundForever",defaultMessage:"For all activity, without sound, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allNoSoundTimed",defaultMessage:"For all activity, without sound, shown for {seconds} seconds",values:{seconds:this.props.duration}}):"0"===this.props.duration?v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundHiddenForever",defaultMessage:"For all activity, shown indefinitely"}):v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.desktop.allSoundHiddenTimed",defaultMessage:"For all activity, shown for {seconds} seconds",values:{seconds:this.props.duration}});var t=function(){this.props.updateSection("desktop")}.bind(this);return v.default.createElement(w.default,{title:S.localizeMessage("user.settings.notifications.desktop.title","Desktop notifications"),describe:e,updateSection:t})}},{key:"render",value:function(){return this.props.active?this.buildMaximizedSetting():this.buildMinimizedSetting()}}]),t}(v.default.Component);t.default=k,k.propTypes={activity:p.default.string.isRequired,sound:p.default.string.isRequired,duration:p.default.string.isRequired,updateSection:p.default.func,setParentState:p.default.func,submit:p.default.func,cancel:p.default.func,error:p.default.string,active:p.default.bool,saving:p.default.bool}},2459:function(e,t,a){"use strict";(function(e){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(2),p=n(h),g=a(1),v=n(g),E=a(17),b=a(69),y=a(9),S=a(16),_=a(736),M=n(_),C=a(737),w=n(C),k=function(t){function a(e){(0,o.default)(this,a);var t=(0,c.default)(this,(a.__proto__||(0,i.default)(a)).call(this,e));return t.handleChange=function(e,a){t.setState({enableEmail:e,emailInterval:a})},t.handleSubmit=function(){var e=t.state,a=e.enableEmail,n=e.emailInterval;t.props.enableEmail!==a||t.props.emailInterval!==n?((0,b.savePreference)(y.Preferences.CATEGORY_NOTIFICATIONS,y.Preferences.EMAIL_INTERVAL,n.toString()),t.props.onSubmit({enableEmail:a})):t.props.updateSection("")},t.handleExpand=function(){t.props.updateSection("email")},t.handleCancel=function(e){t.setState({enableEmail:t.props.enableEmail,emailInterval:t.props.emailInterval}),t.props.onCancel(e)},t.state={enableEmail:e.enableEmail,emailInterval:e.emailInterval},t}return(0,m.default)(a,t),(0,d.default)(a,[{key:"componentWillReceiveProps",value:function(e){e.enableEmail===this.props.enableEmail&&e.emailInterval===this.props.emailInterval||this.setState({enableEmail:e.enableEmail,emailInterval:e.emailInterval})}},{key:"render",value:function(){var t=this;if("true"!==e.window.mm_config.SendEmailNotifications&&"email"===this.props.activeSection){var a=[];return a.push(v.default.createElement("div",{key:"oauthEmailInfo",className:"padding-top"},v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.disabled_long",defaultMessage:"Email notifications have been disabled by your System Administrator."}))),v.default.createElement(M.default,{title:(0,S.localizeMessage)("user.settings.notifications.emailNotifications","Email notifications"),inputs:a,server_error:this.state.serverError,updateSection:this.handleCancel})}if("email"!==this.props.activeSection){var n=void 0;if("true"!==e.window.mm_config.SendEmailNotifications)n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.disabled",defaultMessage:"Disabled by System Administrator"});else if(this.props.enableEmail)switch(this.state.emailInterval){case y.Preferences.INTERVAL_IMMEDIATE:n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"});break;case y.Preferences.INTERVAL_HOUR:n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"});break;default:n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count, plural, one {minute} other {{count, number} minutes}}",values:{count:this.state.emailInterval/60}})}else n=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.never",defaultMessage:"Never"});return v.default.createElement(w.default,{title:(0,S.localizeMessage)("user.settings.notifications.emailNotifications","Email notifications"),describe:n,updateSection:this.handleExpand})}var s=null,i=null;return"true"===e.window.mm_config.EnableEmailBatching&&(s=v.default.createElement("div",null,v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationMinutes",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_FIFTEEN_MINUTES,onChange:function(){return t.handleChange("true",y.Preferences.INTERVAL_FIFTEEN_MINUTES)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyXMinutes",defaultMessage:"Every {count} minutes",values:{count:y.Preferences.INTERVAL_FIFTEEN_MINUTES/60}}))),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationHour",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_HOUR,onChange:function(){return t.handleChange("true",y.Preferences.INTERVAL_HOUR)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.everyHour",defaultMessage:"Every hour"})))),i=v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.emailBatchingInfo",defaultMessage:"Notifications received over the time period selected are combined and sent in a single email."})),v.default.createElement(M.default,{title:(0,S.localizeMessage)("user.settings.notifications.emailNotifications","Email notifications"),inputs:[v.default.createElement("div",{key:"userNotificationEmailOptions"},v.default.createElement("label",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.send",defaultMessage:"Send email notifications"})),v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationImmediately",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_IMMEDIATE,onChange:function(){return t.handleChange("true",y.Preferences.INTERVAL_IMMEDIATE)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.immediately",defaultMessage:"Immediately"}))),s,v.default.createElement("div",{className:"radio"},v.default.createElement("label",null,v.default.createElement("input",{id:"emailNotificationNever",type:"radio",name:"emailNotifications",checked:this.state.emailInterval===y.Preferences.INTERVAL_NEVER,onChange:function(){return t.handleChange("false",y.Preferences.INTERVAL_NEVER)}}),v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.email.never",defaultMessage:"Never"}))),v.default.createElement("br",null),v.default.createElement("div",null,v.default.createElement(E.FormattedMessage,{id:"user.settings.notifications.emailInfo",defaultMessage:"Email notifications are sent for mentions and direct messages when you are offline or away from {siteName} for more than 5 minutes.",values:{siteName:e.window.mm_config.SiteName}})," ",i))],submit:this.handleSubmit,saving:this.props.saving,server_error:this.props.serverError,updateSection:this.handleCancel})}}]),a}(v.default.Component);k.propTypes={activeSection:p.default.string.isRequired,updateSection:p.default.func.isRequired,enableEmail:p.default.bool.isRequired,emailInterval:p.default.number.isRequired,onSubmit:p.default.func.isRequired,onCancel:p.default.func.isRequired,serverError:p.default.string,saving:p.default.bool},t.default=k}).call(t,a(22))},2460:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){var a="true"===e.entities.general.config.EnableUserAccessTokens,n=f.hasUserAccessTokenRole(t.user.roles)||f.isSystemAdmin(t.user.roles);return(0,o.default)({},t,{userAccessTokens:e.entities.users.myUserAccessTokens,canUseAccessTokens:a&&n})}function i(e){return{actions:(0,d.bindActionCreators)({getMe:u.getMe,getUserAccessTokensForUser:u.getUserAccessTokensForUser,createUserAccessToken:u.createUserAccessToken,revokeUserAccessToken:u.revokeUserAccessToken,clearUserAccessTokens:u.clearUserAccessTokens},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(61),c=a(205),f=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(c),m=a(2461),h=n(m);t.default=(0,l.connect)(s,i)(h.default)},2461:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(310),r=s(i),o=a(76),l=s(o),d=a(77),u=s(d),c=a(41),f=s(c),m=a(6),h=s(m),p=a(4),g=s(p),v=a(5),E=s(v),b=a(7),y=s(b),S=a(8),_=s(S),M=a(2),C=s(M),w=a(1),k=s(w),T=a(17),N=a(44),P=a(205),I=n(P),L=a(237),D=a(69),R=a(119),A=s(R),O=a(9),F=s(O),x=a(87),U=a(16),H=n(U),j=a(748),G=s(j),B=a(2462),V=s(B),z=a(2464),q=s(z),W=a(311),Y=s(W),K=a(736),J=s(K),X=a(737),Q=s(X),Z=a(441),$=s(Z),ee="creating",te="created",ae="not_creating",ne=function(t){function a(t){var n=this;(0,g.default)(this,a);var s=(0,y.default)(this,(a.__proto__||(0,h.default)(a)).call(this,t));return s.submitPassword=function(e){e.preventDefault();var t=s.props.user,a=s.state.currentPassword,n=s.state.newPassword,i=s.state.confirmPassword;if(""===a)return void s.setState({passwordError:H.localizeMessage("user.settings.security.currentPasswordError","Please enter your current password."),serverError:""});var r=H.isValidPassword(n);if(""!==r)return void s.setState({passwordError:r,serverError:""});if(n!==i){var o=(0,f.default)(s.getDefaultState(),{passwordError:H.localizeMessage("user.settings.security.passwordMatchError","The new passwords you entered do not match."),serverError:""});return void s.setState(o)}s.setState({savingPassword:!0}),(0,D.updatePassword)(t.id,a,n,function(){s.props.updateSection(""),s.props.actions.getMe(),s.setState(s.getDefaultState())},function(e){var t=s.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,t.passwordError="",s.setState(t)})},s.setupMfa=function(e){e.preventDefault(),N.browserHistory.push("/mfa/setup")},s.removeMfa=function(){(0,D.deactivateMfa)(function(){if("true"===e.window.mm_license.MFA&&"true"===e.window.mm_config.EnableMultifactorAuthentication&&"true"===e.window.mm_config.EnforceMultifactorAuthentication)return void(window.location.href="/mfa/setup");s.props.updateSection(""),s.setState(s.getDefaultState())},function(e){var t=s.getDefaultState();e.message?t.serverError=e.message:t.serverError=e,s.setState(t)})},s.updateCurrentPassword=function(e){s.setState({currentPassword:e.target.value})},s.updateNewPassword=function(e){s.setState({newPassword:e.target.value})},s.updateConfirmPassword=function(e){s.setState({confirmPassword:e.target.value})},s.deauthorizeApp=function(e){e.preventDefault();var t=e.currentTarget.getAttribute("data-app");(0,D.deauthorizeOAuthApp)(t,function(){var e=s.state.authorizedApps.filter(function(e){return e.id!==t});s.setState({authorizedApps:e,serverError:null})},function(e){s.setState({serverError:e.message})})},s.createMfaSection=function(){var t=void 0;if("mfa"===s.props.activeSection){var a=void 0,n=void 0;if(s.props.user.mfa_active){var i=void 0,r=void 0;"true"===e.window.mm_config.EnforceMultifactorAuthentication?(i=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.requiredHelp",defaultMessage:"Multi-factor authentication is required on this server. Resetting is only recommended when you need to switch code generation to a new mobile device. You will be required to set it up again immediately."}),r=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.reset",defaultMessage:"Reset MFA on your account"})):(i=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.removeHelp",defaultMessage:"Removing multi-factor authentication means you will no longer require a phone-based passcode to sign-in to your account."}),r=k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.remove",defaultMessage:"Remove MFA from your account"})),a=k.default.createElement("div",{key:"mfaQrCode"},k.default.createElement("a",{className:"btn btn-primary",href:"#",onClick:s.removeMfa},r),k.default.createElement("br",null)),n=k.default.createElement("span",null,i)}else a=k.default.createElement("div",{key:"mfaQrCode"},k.default.createElement("a",{className:"btn btn-primary",href:"#",onClick:s.setupMfa},k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.add",defaultMessage:"Add MFA to your account"})),k.default.createElement("br",null)),n=k.default.createElement("span",null,k.default.createElement(T.FormattedMessage,{id:"user.settings.mfa.addHelp",defaultMessage:"Adding multi-factor authentication will make your account more secure by requiring a code from your mobile phone each time you sign in."}));var o=[];return o.push(k.default.createElement("div",{key:"mfaSetting",className:"padding-top"},a)),t=function(e){this.props.updateSection(""),this.setState({serverError:null}),e.preventDefault()}.bind(s),k.default.createElement(J.default,{title:H.localizeMessage("user.settings.mfa.title","Multi-factor Authentication"),inputs:o,extraInfo:n,submit:void 0,server_error:s.state.serverError,updateSection:t,width:"medium"})}var l=void 0;return l=s.props.user.mfa_active?H.localizeMessage("user.settings.security.active","Active"):H.localizeMessage("user.settings.security.inactive","Inactive"),t=function(){this.props.updateSection("mfa")}.bind(s),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.mfa.title","Multi-factor Authentication"),describe:l,updateSection:t})},s.createPasswordSection=function(){var e=void 0;if("password"===s.props.activeSection){var t=[],a=void 0;return""===s.props.user.auth_service?(a=s.submitPassword,t.push(k.default.createElement("div",{key:"currentPasswordUpdateForm",className:"form-group"},k.default.createElement("label",{className:"col-sm-5 control-label"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.currentPassword",defaultMessage:"Current Password"})),k.default.createElement("div",{className:"col-sm-7"},k.default.createElement("input",{id:"currentPassword",className:"form-control",type:"password",onChange:s.updateCurrentPassword,value:s.state.currentPassword})))),t.push(k.default.createElement("div",{key:"newPasswordUpdateForm",className:"form-group"},k.default.createElement("label",{className:"col-sm-5 control-label"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.newPassword",defaultMessage:"New Password"})),k.default.createElement("div",{className:"col-sm-7"},k.default.createElement("input",{id:"newPassword",className:"form-control",type:"password",onChange:s.updateNewPassword,value:s.state.newPassword})))),t.push(k.default.createElement("div",{key:"retypeNewPasswordUpdateForm",className:"form-group"},k.default.createElement("label",{className:"col-sm-5 control-label"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.retypePassword",defaultMessage:"Retype New Password"})),k.default.createElement("div",{className:"col-sm-7"},k.default.createElement("input",{id:"confirmPassword",className:"form-control",type:"password",onChange:s.updateConfirmPassword,value:s.state.confirmPassword}))))):s.props.user.auth_service===F.default.GITLAB_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordGitlabCantUpdate",defaultMessage:"Login occurs through GitLab. Password cannot be updated."})))):s.props.user.auth_service===F.default.LDAP_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordLdapCantUpdate",defaultMessage:"Login occurs through AD/LDAP. Password cannot be updated."})))):s.props.user.auth_service===F.default.SAML_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordSamlCantUpdate",defaultMessage:"This field is handled through your login provider. If you want to change it, you need to do so through your login provider."})))):s.props.user.auth_service===F.default.GOOGLE_SERVICE?t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordGoogleCantUpdate",defaultMessage:"Login occurs through Google Apps. Password cannot be updated."})))):s.props.user.auth_service===F.default.OFFICE365_SERVICE&&t.push(k.default.createElement("div",{key:"oauthEmailInfo",className:"form-group"},k.default.createElement("div",{className:"setting-list__hint col-sm-12"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.passwordOffice365CantUpdate",defaultMessage:"Login occurs through Office 365. Password cannot be updated."})))),e=function(e){this.props.updateSection(""),this.setState({currentPassword:"",newPassword:"",confirmPassword:"",serverError:null,passwordError:null}),e.preventDefault()}.bind(s),k.default.createElement(J.default,{title:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.password",defaultMessage:"Password"}),inputs:t,submit:a,saving:s.state.savingPassword,server_error:s.state.serverError,client_error:s.state.passwordError,updateSection:e})}var n=void 0;if(""===s.props.user.auth_service){var i=new Date(s.props.user.last_password_update),r=!A.default.getBool(F.default.Preferences.CATEGORY_DISPLAY_SETTINGS,F.default.Preferences.USE_MILITARY_TIME,!1);n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.lastUpdated",defaultMessage:"Last updated {date} at {time}",values:{date:k.default.createElement(T.FormattedDate,{value:i,day:"2-digit",month:"short",year:"numeric"}),time:k.default.createElement(T.FormattedTime,{value:i,hour12:r,hour:"2-digit",minute:"2-digit"})}})}else s.props.user.auth_service===F.default.GITLAB_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginGitlab",defaultMessage:"Login done through GitLab"}):s.props.user.auth_service===F.default.LDAP_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginLdap",defaultMessage:"Login done through AD/LDAP"}):s.props.user.auth_service===F.default.SAML_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginSaml",defaultMessage:"Login done through SAML"}):s.props.user.auth_service===F.default.GOOGLE_SERVICE?n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginGoogle",defaultMessage:"Login done through Google Apps"}):s.props.user.auth_service===F.default.OFFICE365_SERVICE&&(n=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.loginOffice365",defaultMessage:"Login done through Office 365"}));return e=function(){this.props.updateSection("password")}.bind(s),k.default.createElement(Q.default,{title:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.password",defaultMessage:"Password"}),describe:n,updateSection:e})},s.createSignInSection=function(){var t=void 0,a=s.props.user;if("signin"===s.props.activeSection){var n=void 0,i=void 0,r=void 0,o=void 0,l=void 0,d=void 0;if(""===a.auth_service)"true"===e.window.mm_config.EnableSignUpWithGitLab&&(i=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.GITLAB_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchGitlab",defaultMessage:"Switch to using GitLab SSO"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableSignUpWithGoogle&&(r=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.GOOGLE_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchGoogle",defaultMessage:"Switch to using Google SSO"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableSignUpWithOffice365&&(o=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.OFFICE365_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchOffice365",defaultMessage:"Switch to using Office 365 SSO"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableLdap&&(l=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_ldap?email="+encodeURIComponent(a.email)},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchLdap",defaultMessage:"Switch to using AD/LDAP"})),k.default.createElement("br",null))),"true"===e.window.mm_config.EnableSaml&&(d=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:"/claim/email_to_oauth?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service+"&new_type="+F.default.SAML_SERVICE},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchSaml",defaultMessage:"Switch to using SAML SSO"})),k.default.createElement("br",null)));else if("true"===e.window.mm_config.EnableSignUpWithEmail){var u=void 0;u=a.auth_service===F.default.LDAP_SERVICE?"/claim/ldap_to_email?email="+encodeURIComponent(a.email):"/claim/oauth_to_email?email="+encodeURIComponent(a.email)+"&old_type="+a.auth_service,n=k.default.createElement("div",{className:"padding-bottom x2"},k.default.createElement(N.Link,{className:"btn btn-primary",to:u},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.switchEmail",defaultMessage:"Switch to using email and password"})),k.default.createElement("br",null))}var c=[];c.push(k.default.createElement("div",{key:"userSignInOption"},n,i,r,o,l,d)),t=function(e){this.props.updateSection(""),this.setState({serverError:null}),e.preventDefault()}.bind(s);var f=k.default.createElement("span",null,k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oneSignin",defaultMessage:"You may only have one sign-in method at a time. Switching sign-in method will send an email notifying you if the change was successful."}));return k.default.createElement(J.default,{title:H.localizeMessage("user.settings.security.method","Sign-in Method"),extraInfo:f,inputs:c,server_error:s.state.serverError,updateSection:t})}t=function(){this.props.updateSection("signin")}.bind(s);var m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.emailPwd",defaultMessage:"Email and Password"});return s.props.user.auth_service===F.default.GITLAB_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.gitlab",defaultMessage:"GitLab"}):s.props.user.auth_service===F.default.GOOGLE_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.google",defaultMessage:"Google"}):s.props.user.auth_service===F.default.OFFICE365_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.office365",defaultMessage:"Office 365"}):s.props.user.auth_service===F.default.LDAP_SERVICE?m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.ldap",defaultMessage:"AD/LDAP"}):s.props.user.auth_service===F.default.SAML_SERVICE&&(m=k.default.createElement(T.FormattedMessage,{id:"user.settings.security.saml",defaultMessage:"SAML"})),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.security.method","Sign-in Method"),describe:m,updateSection:t})},s.createOAuthAppsSection=function(){var e=void 0;if("apps"===s.props.activeSection){var t=void 0;t=s.state.authorizedApps&&s.state.authorizedApps.length>0?s.state.authorizedApps.map(function(e){var t=k.default.createElement("a",{href:e.homepage,target:"_blank",rel:"noopener noreferrer"},e.homepage);return k.default.createElement("div",{key:e.id,className:"padding-bottom x2 authorized-app"},k.default.createElement("div",{className:"col-sm-10"},k.default.createElement("div",{className:"authorized-app__name"},e.name,k.default.createElement("span",{className:"authorized-app__url"}," -"," ",t)),k.default.createElement("div",{className:"authorized-app__description"},e.description),k.default.createElement("div",{className:"authorized-app__deauthorize"},k.default.createElement("a",{href:"#","data-app":e.id,onClick:s.deauthorizeApp},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.deauthorize",defaultMessage:"Deauthorize"})))),k.default.createElement("div",{className:"col-sm-2 pull-right"},k.default.createElement("img",{alt:e.name,src:e.icon_url||G.default})),k.default.createElement("br",null))}):k.default.createElement("div",{className:"padding-bottom x2 authorized-app"},k.default.createElement("div",{className:"setting-list__hint"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.noApps",defaultMessage:"No OAuth 2.0 Applications are authorized."})));var a=[],n=void 0,i=void 0;Array.isArray(t)&&(n="authorized-apps__wrapper",i=k.default.createElement("div",{className:"authorized-apps__help"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oauthAppsHelp",defaultMessage:"Applications act on your behalf to access your data based on the permissions you grant them."}))),a.push(k.default.createElement("div",{className:n,key:"authorizedApps"},t)),e=function(e){this.props.updateSection(""),this.setState({serverError:null}),e.preventDefault()}.bind(s);var r=k.default.createElement("div",null,k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oauthApps",defaultMessage:"OAuth 2.0 Applications"}),i);return k.default.createElement(J.default,{title:r,inputs:a,server_error:s.state.serverError,updateSection:e,width:"full",cancelButtonText:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.close",defaultMessage:"Close"})})}return e=function(){this.props.updateSection("apps")}.bind(s),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.security.oauthApps","OAuth 2.0 Applications"),describe:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.oauthAppsDescription",defaultMessage:"Click 'Edit' to manage your OAuth 2.0 Applications"}),updateSection:e})},s.startCreatingToken=function(){s.setState({tokenCreationState:ee})},s.stopCreatingToken=function(){s.setState({tokenCreationState:ae})},s.handleCreateToken=(0,u.default)(l.default.mark(function e(){var t,a,i,r,o;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(s.handleCancelConfirm(),""!==(t=s.refs.newtokendescription?s.refs.newtokendescription.value:"")){e.next=5;break}return s.setState({tokenError:H.localizeMessage("user.settings.tokens.nameRequired","Please enter a description.")}),e.abrupt("return");case 5:return s.setState({tokenError:""}),a=s.props.user?s.props.user.id:"",e.next=9,s.props.actions.createUserAccessToken(a,t);case 9:i=e.sent,r=i.data,o=i.error,r?s.setState({tokenCreationState:te,newToken:r}):o&&s.setState({serverError:o.message});case 13:case"end":return e.stop()}},e,n)})),s.handleCancelConfirm=function(){s.setState({showConfirmModal:!1,confirmTitle:null,confirmMessage:null,confirmButton:null,confirmComplete:null})},s.confirmCreateToken=function(){if(I.isSystemAdmin(s.props.user.roles))return void s.setState({showConfirmModal:!0,confirmTitle:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmCreateTitle",defaultMessage:"Create System Admin Personal Access Token"}),confirmMessage:k.default.createElement("div",{className:"alert alert-danger"},k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.confirmCreateMessage",defaultMessage:"You are generating a personal access token with System Admin permissions. Are you sure want to create this token?"})),confirmButton:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmCreateButton",defaultMessage:"Yes, Create"}),confirmComplete:function(){s.handleCreateToken(),(0,L.trackEvent)("settings","system_admin_create_user_access_token")}});s.handleCreateToken()},s.saveTokenKeyPress=function(e){e.which===F.default.KeyCodes.ENTER&&s.confirmCreateToken()},s.confirmRevokeToken=function(e){var t=s.props.userAccessTokens[e];s.setState({showConfirmModal:!0,confirmTitle:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmDeleteTitle",defaultMessage:"Delete Token?"}),confirmMessage:k.default.createElement("div",{className:"alert alert-danger"},k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.confirmDeleteMessage",defaultMessage:"Any integrations using this token will no longer be able to access the Mattermost API. You cannot undo this action. <br /><br />Are you sure want to delete the {description} token?",values:{description:t.description}})),confirmButton:k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.confirmDeleteButton",defaultMessage:"Yes, Delete"}),confirmComplete:function(){s.revokeToken(e),(0,L.trackEvent)("settings","revoke_user_access_token")}})},s.revokeToken=function(){var e=(0,u.default)(l.default.mark(function e(t){var a,i;return l.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.props.actions.revokeUserAccessToken(t);case 2:a=e.sent,i=a.error,i&&s.setState({serverError:i.message}),s.handleCancelConfirm();case 6:case"end":return e.stop()}},e,n)}));return function(t){return e.apply(this,arguments)}}(),s.createTokensSection=function(){var e=void 0,t="";if("tokens"===s.props.activeSection){var a=[];(0,r.default)(s.props.userAccessTokens).forEach(function(e){s.state.newToken&&s.state.newToken.id===e.id||a.push(k.default.createElement("div",{key:e.id,className:"setting-box__item"},k.default.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.tokenDesc",defaultMessage:"Token Description: "}),e.description),k.default.createElement("div",{className:"setting-box__token-id whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.tokenId",defaultMessage:"Token ID: "}),e.id),k.default.createElement("div",null,k.default.createElement("a",{name:e.id,href:"#",onClick:function(t){t.preventDefault(),s.confirmRevokeToken(e.id)}},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.delete",defaultMessage:"Delete"}))),k.default.createElement("hr",{className:"margin-bottom margin-top x2"})))});var n=void 0;0===a.length&&(n=k.default.createElement(T.FormattedMessage,{key:"notokens",id:"user.settings.tokens.userAccessTokensNone",defaultMessage:"No personal access tokens."}));var i=void 0;i=(0,x.isMobile)()?k.default.createElement("span",null,k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.description_mobile",defaultMessage:'<a href="https://about.mattermost.com/default-user-access-tokens" target="_blank">Personal access tokens</a> function similar to session tokens and can be used by integrations to <a href="https://about.mattermost.com/default-api-authentication" target="_blank">authenticate against the REST API</a>. Create new tokens on your desktop.'})):k.default.createElement("span",null,k.default.createElement(T.FormattedHTMLMessage,{id:"user.settings.tokens.description",defaultMessage:'<a href="https://about.mattermost.com/default-user-access-tokens" target="_blank">Personal access tokens</a> function similar to session tokens and can be used by integrations to <a href="https://about.mattermost.com/default-api-authentication" target="_blank">authenticate against the REST API</a>.'}));var o=void 0;s.state.tokenCreationState===ee?o=k.default.createElement("div",{className:"padding-left x2"},k.default.createElement("div",{className:"row"},k.default.createElement("label",{className:"col-sm-auto control-label padding-right x2"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "})),k.default.createElement("div",{className:"col-sm-5"},k.default.createElement("input",{ref:"newtokendescription",className:"form-control",type:"text",maxLength:64,onKeyPress:s.saveTokenKeyPress}))),k.default.createElement("div",null,k.default.createElement("div",{className:"padding-top x2"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.nameHelp",defaultMessage:"Enter a description for your token to remember what it does."})),k.default.createElement("div",null,k.default.createElement("label",{id:"clientError",className:"has-error margin-top margin-bottom"},s.state.tokenError)),k.default.createElement("button",{className:"btn btn-primary",onClick:s.confirmCreateToken},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.save",defaultMessage:"Save"})),k.default.createElement("button",{className:"btn btn-default",onClick:s.stopCreatingToken},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.cancel",defaultMessage:"Cancel"})))):s.state.tokenCreationState===te?(0===a.length&&(t=" hidden"),o=k.default.createElement("div",{className:"alert alert-warning"},k.default.createElement("i",{className:"fa fa-warning margin-right"}),k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.copy",defaultMessage:"Please copy the access token below. You won't be able to see it again!"}),k.default.createElement("br",null),k.default.createElement("br",null),k.default.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.name",defaultMessage:"Token Description: "}),s.state.newToken.description),k.default.createElement("div",{className:"whitespace--nowrap overflow--ellipsis"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.id",defaultMessage:"Token ID: "}),s.state.newToken.id),k.default.createElement("strong",{className:"word-break--all"},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.token",defaultMessage:"Access Token: "}),s.state.newToken.token))):o=k.default.createElement("a",{className:"btn btn-primary",href:"#",onClick:s.startCreatingToken},k.default.createElement(T.FormattedMessage,{id:"user.settings.tokens.create",defaultMessage:"Create New Token"}));var l=[];return l.push(k.default.createElement("div",{key:"tokensSetting",className:"padding-top"},k.default.createElement("div",{key:"tokenList"},k.default.createElement("div",{className:"alert alert-transparent"+t},a,n),o))),e=function(e){this.props.updateSection(""),this.setState({newToken:null,tokenCreationState:ae,serverError:null,tokenError:""}),e.preventDefault()}.bind(s),k.default.createElement(J.default,{title:H.localizeMessage("user.settings.tokens.title","Personal Access Tokens"),inputs:l,extraInfo:i,infoPosition:"top",server_error:s.state.serverError,updateSection:e,width:"full",cancelButtonText:k.default.createElement(T.FormattedMessage,{id:"user.settings.security.close",defaultMessage:"Close"})})}var d=H.localizeMessage("user.settings.tokens.clickToEdit","Click 'Edit' to manage your personal access tokens");return e=function(){this.props.updateSection("tokens")}.bind(s),k.default.createElement(Q.default,{title:H.localizeMessage("user.settings.tokens.title","Personal Access Tokens"),describe:d,updateSection:e})},s.state=s.getDefaultState(),s}return(0,_.default)(a,t),(0,E.default)(a,[{key:"getDefaultState",value:function(){return{currentPassword:"",newPassword:"",confirmPassword:"",passwordError:"",serverError:"",tokenError:"",showConfirmModal:!1,authService:this.props.user.auth_service,savingPassword:!1}}},{key:"componentDidMount",value:function(){var t=this;if("true"===e.mm_config.EnableOAuthServiceProvider&&(0,D.getAuthorizedApps)(function(e){t.setState({authorizedApps:e,serverError:null})},function(e){t.setState({serverError:e.message})}),this.props.canUseAccessTokens){this.props.actions.clearUserAccessTokens();var a=this.props.user?this.props.user.id:"";this.props.actions.getUserAccessTokensForUser(a,0,200)}}},{key:"render",value:function(){var t=this.props.user,a=window.mm_config,n=this.createPasswordSection(),s=0;s="true"===a.EnableSignUpWithGitLab?s+1:s,s="true"===a.EnableSignUpWithGoogle?s+1:s,s="true"===a.EnableLdap?s+1:s,s="true"===a.EnableSaml?s+1:s;var i=void 0;("true"===a.EnableSignUpWithEmail||""===t.auth_service)&&s>0&&(i=this.createSignInSection());var r=void 0;"true"!==a.EnableMultifactorAuthentication||"true"!==e.window.mm_license.IsLicensed||""!==t.auth_service&&t.auth_service!==F.default.LDAP_SERVICE||(r=this.createMfaSection());var o=void 0;"true"===a.EnableOAuthServiceProvider&&(o=this.createOAuthAppsSection());var l=void 0;return this.props.canUseAccessTokens&&(l=this.createTokensSection()),k.default.createElement("div",null,k.default.createElement("div",{className:"modal-header"},k.default.createElement("button",{type:"button",className:"close","data-dismiss":"modal","aria-label":H.localizeMessage("user.settings.security.close","Close"),onClick:this.props.closeModal},k.default.createElement("span",{"aria-hidden":"true"},"Ã—")),k.default.createElement("h4",{className:"modal-title",ref:"title"},k.default.createElement("div",{className:"modal-back"},k.default.createElement("i",{className:"fa fa-angle-left",onClick:this.props.collapseModal})),k.default.createElement(T.FormattedMessage,{id:"user.settings.security.title",defaultMessage:"Security Settings"}))),k.default.createElement("div",{className:"user-settings"},k.default.createElement("h3",{className:"tab-header"},k.default.createElement(T.FormattedMessage,{id:"user.settings.security.title",defaultMessage:"Security Settings"})),k.default.createElement("div",{className:"divider-dark first"}),n,k.default.createElement("div",{className:"divider-light"}),r,k.default.createElement("div",{className:"divider-light"}),o,k.default.createElement("div",{className:"divider-light"}),l,k.default.createElement("div",{className:"divider-light"}),i,k.default.createElement("div",{className:"divider-dark"}),k.default.createElement("br",null),k.default.createElement($.default,{className:"security-links color--link",dialogType:V.default},k.default.createElement("i",{className:"fa fa-clock-o"}),k.default.createElement(T.FormattedMessage,{id:"user.settings.security.viewHistory",defaultMessage:"View Access History"})),k.default.createElement($.default,{className:"security-links color--link margin-top",dialogType:q.default},k.default.createElement("i",{className:"fa fa-clock-o"}),k.default.createElement(T.FormattedMessage,{id:"user.settings.security.logoutActiveSessions",defaultMessage:"View and Logout of Active Sessions"}))),k.default.createElement(Y.default,{title:this.state.confirmTitle,message:this.state.confirmMessage,confirmButtonText:this.state.confirmButton,show:this.state.showConfirmModal,onConfirm:this.state.confirmComplete||function(){},onCancel:this.handleCancelConfirm}))}}]),a}(k.default.Component);ne.propTypes={user:C.default.object,activeSection:C.default.string,updateSection:C.default.func,updateTab:C.default.func,closeModal:C.default.func.isRequired,collapseModal:C.default.func.isRequired,setEnforceFocus:C.default.func.isRequired,userAccessTokens:C.default.object,canUseAccessTokens:C.default.bool,actions:C.default.shape({getMe:C.default.func.isRequired,getUserAccessTokensForUser:C.default.func.isRequired,createUserAccessToken:C.default.func.isRequired,revokeUserAccessToken:C.default.func.isRequired,clearUserAccessTokens:C.default.func.isRequired}).isRequired},t.default=ne,ne.defaultProps={user:{},activeSection:""}}).call(t,a(22))},2462:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function i(e){return{actions:(0,d.bindActionCreators)({getUserAudits:u.getUserAudits},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(61),c=a(2463),f=n(c);t.default=(0,l.connect)(s,i)(f.default)},2463:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(40),S=a(17),_=a(25),M=n(_),C=a(16),w=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(C),k=a(2099),T=n(k),N=a(236),P=n(N),I=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));a.onAuditChange=a.onAuditChange.bind(a),a.onShow=a.onShow.bind(a),a.onHide=a.onHide.bind(a);var n=a.getStateFromStoresForAudits();return n.moreInfo=[],n.show=!0,a.state=n,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"getStateFromStoresForAudits",value:function(){return{audits:M.default.getAudits()}}},{key:"onShow",value:function(){this.props.actions.getUserAudits(M.default.getCurrentId(),0,200),w.isMobile()||(0,p.default)(".modal-body").perfectScrollbar()}},{key:"onHide",value:function(){this.setState({show:!1})}},{key:"componentDidMount",value:function(){M.default.addAuditsChangeListener(this.onAuditChange),this.onShow()}},{key:"componentWillUnmount",value:function(){M.default.removeAuditsChangeListener(this.onAuditChange)}},{key:"onAuditChange",value:function(){var e=this.getStateFromStoresForAudits();w.areObjectsEqual(e.audits,this.state.audits)||this.setState(e)}},{key:"render",value:function(){var e=void 0;return e=0===this.state.audits.length?b.default.createElement(P.default,null):b.default.createElement(T.default,{audits:this.state.audits,showIp:!0,showSession:!0}),b.default.createElement(y.Modal,{dialogClassName:"modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large"},b.default.createElement(y.Modal.Header,{closeButton:!0},b.default.createElement(y.Modal.Title,null,b.default.createElement(S.FormattedMessage,{id:"access_history.title",defaultMessage:"Access History"}))),b.default.createElement(y.Modal.Body,{ref:"modalBody"},e))}}]),t}(b.default.Component);I.propTypes={onHide:v.default.func.isRequired,actions:v.default.shape({getUserAudits:v.default.func.isRequired}).isRequired},t.default=I},2464:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e,t){return(0,o.default)({},t)}function i(e){return{actions:(0,d.bindActionCreators)({getSessions:u.getSessions,revokeSession:u.revokeSession},e)}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(19),o=n(r),l=a(31),d=a(20),u=a(61),c=a(2465),f=n(c);t.default=(0,l.connect)(s,i)(f.default)},2465:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(2),v=n(g),E=a(1),b=n(E),y=a(40),S=a(17),_=a(26),M=a(25),C=n(M),w=a(16),k=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(w),T=a(236),N=n(T),P=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));a.isMobileSession=function(e){return e.device_id&&(e.device_id.includes("apple")||e.device_id.includes("android"))},a.mobileSessionInfo=function(e){var t=void 0,a=void 0,n=void 0;return e.device_id.includes("apple")?(n="fa fa-apple",t="activity_log_modal.iphoneNativeClassicApp",a="iPhone Native Classic App",e.device_id.includes(_.General.PUSH_NOTIFY_APPLE_REACT_NATIVE)&&(t="activity_log_modal.iphoneNativeApp",a="iPhone Native App")):e.device_id.includes("android")&&(n="fa fa-android",t="activity_log_modal.androidNativeClassicApp",a="Android Native Classic App",e.device_id.includes(_.General.PUSH_NOTIFY_ANDROID_REACT_NATIVE)&&(t="activity_log_modal.androidNativeApp",a="Android Native App")),{devicePicture:n,devicePlatform:b.default.createElement(S.FormattedMessage,{id:t,defaultMessage:a})}},a.submitRevoke=a.submitRevoke.bind(a),a.onListenerChange=a.onListenerChange.bind(a),a.handleMoreInfo=a.handleMoreInfo.bind(a),a.onHide=a.onHide.bind(a),a.onShow=a.onShow.bind(a);var n=a.getStateFromStores();return n.moreInfo=[],n.show=!0,a.state=n,a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"getStateFromStores",value:function(){return{sessions:C.default.getSessions(),clientError:null}}},{key:"submitRevoke",value:function(e,t){var a=this;t.preventDefault();var n=(0,p.default)(t.target).closest(".modal-content");n.addClass("animation--highlight"),setTimeout(function(){n.removeClass("animation--highlight")},1500),this.props.actions.revokeSession(C.default.getCurrentId(),e).then(function(){a.props.actions.getSessions(C.default.getCurrentId())})}},{key:"onShow",value:function(){this.props.actions.getSessions(C.default.getCurrentId()),k.isMobile()||(0,p.default)(".modal-body").perfectScrollbar()}},{key:"onHide",value:function(){this.setState({show:!1})}},{key:"componentDidMount",value:function(){C.default.addSessionsChangeListener(this.onListenerChange),this.onShow()}},{key:"componentWillUnmount",value:function(){C.default.removeSessionsChangeListener(this.onListenerChange)}},{key:"onListenerChange",value:function(){var e=this.getStateFromStores();k.areObjectsEqual(e.sessions,this.state.sessions)||this.setState(e)}},{key:"handleMoreInfo",value:function(e){var t=this.state.moreInfo;t[e]=!0,this.setState({moreInfo:t})}},{key:"render",value:function(){for(var e=[],t=0;t<this.state.sessions.length;t++){var a=this.state.sessions[t],n=new Date(a.last_activity_at),s=new Date(a.create_at),i=a.props.platform,r="";if("UserAccessToken"!==a.props.type){if("Windows"===a.props.platform)r="fa fa-windows";else if(this.isMobileSession(a)){var o=this.mobileSessionInfo(a);r=o.devicePicture,i=o.devicePlatform}else"Macintosh"===a.props.platform||"iPhone"===a.props.platform?r="fa fa-apple":"Linux"===a.props.platform?a.props.os.indexOf("Android")>=0?(i=b.default.createElement(S.FormattedMessage,{id:"activity_log_modal.android",defaultMessage:"Android"}),r="fa fa-android"):r="fa fa-linux":-1!==a.props.os.indexOf("Linux")&&(r="fa fa-linux");-1!==a.props.browser.indexOf("Desktop App")&&(i=b.default.createElement(S.FormattedMessage,{id:"activity_log_modal.desktop",defaultMessage:"Native Desktop App"}));var l=void 0;l=this.state.moreInfo[t]?b.default.createElement("div",null,b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.firstTime",defaultMessage:"First time active: {date}, {time}",values:{date:b.default.createElement(S.FormattedDate,{value:s,day:"2-digit",month:"long",year:"numeric"}),time:b.default.createElement(S.FormattedTime,{value:s,hour:"2-digit",minute:"2-digit"})}})),b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.os",defaultMessage:"OS: {os}",values:{os:a.props.os}})),b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.browser",defaultMessage:"Browser: {browser}",values:{browser:a.props.browser}})),b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.sessionId",defaultMessage:"Session ID: {id}",values:{id:a.id}}))):b.default.createElement("a",{className:"theme",href:"#",onClick:this.handleMoreInfo.bind(this,t)},b.default.createElement(S.FormattedMessage,{id:"activity_log.moreInfo",defaultMessage:"More info"})),e[t]=b.default.createElement("div",{key:"activityLogEntryKey"+t,className:"activity-log__table"},b.default.createElement("div",{className:"activity-log__report"},b.default.createElement("div",{className:"report__platform"},b.default.createElement("i",{className:r}),i),b.default.createElement("div",{className:"report__info"},b.default.createElement("div",null,b.default.createElement(S.FormattedMessage,{id:"activity_log.lastActivity",defaultMessage:"Last activity: {date}, {time}",values:{date:b.default.createElement(S.FormattedDate,{value:n,day:"2-digit",month:"long",year:"numeric"}),time:b.default.createElement(S.FormattedTime,{value:n,hour:"2-digit",minute:"2-digit"})}})),l)),b.default.createElement("div",{className:"activity-log__action"},b.default.createElement("button",{onClick:this.submitRevoke.bind(this,a.id),className:"btn btn-primary"},b.default.createElement(S.FormattedMessage,{id:"activity_log.logout",defaultMessage:"Logout"}))))}}var d=void 0;return d=this.state.sessions.loading?b.default.createElement(N.default,null):b.default.createElement("form",{role:"form"},e),b.default.createElement(y.Modal,{dialogClassName:"modal--scroll",show:this.state.show,onHide:this.onHide,onExited:this.props.onHide,bsSize:"large"},b.default.createElement(y.Modal.Header,{closeButton:!0},b.default.createElement(y.Modal.Title,null,b.default.createElement(S.FormattedMessage,{id:"activity_log.activeSessions",defaultMessage:"Active Sessions"}))),b.default.createElement(y.Modal.Body,{ref:"modalBody"},b.default.createElement("p",{className:"session-help-text"},b.default.createElement(S.FormattedMessage,{id:"activity_log.sessionsDescription",defaultMessage:"Sessions are created when you log in to a new browser on a device. Sessions let you use Mattermost without having to log in again for a time period specified by the System Admin. If you want to log out sooner, use the 'Logout' button below to end a session."})),d))}}]),t}(b.default.Component);P.propTypes={onHide:v.default.func.isRequired,actions:v.default.shape({getSessions:v.default.func.isRequired,revokeSession:v.default.func.isRequired}).isRequired},t.default=P},2466:function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(0),g=s(p),v=a(1),E=s(v),b=a(17),y=a(56),S=n(y),_=a(315),M=n(_),C=a(25),w=s(C),k=a(436),T=s(k),N=a(443),P=s(N),I=a(9),L=a(16),D=n(L),R=a(2198),A=s(R),O=I.Constants.PRE_RELEASE_FEATURES,F=function(e){function t(){(0,l.default)(this,t);var e=(0,f.default)(this,(t.__proto__||(0,r.default)(t)).call(this));return e.mounted=!1,e.closeNotification=e.closeNotification.bind(e),e.onIncomingCall=e.onIncomingCall.bind(e),e.onCancelCall=e.onCancelCall.bind(e),e.onRhs=e.onRhs.bind(e),e.handleClose=e.handleClose.bind(e),e.handleAnswer=e.handleAnswer.bind(e),e.handleTimeout=e.handleTimeout.bind(e),e.stopRinging=e.stopRinging.bind(e),e.closeRightHandSide=e.closeRightHandSide.bind(e),e.state={userCalling:null,rhsOpened:!1},e}return(0,h.default)(t,e),(0,u.default)(t,[{key:"componentDidMount",value:function(){T.default.addNotifyListener(this.onIncomingCall),T.default.addChangedListener(this.onCancelCall),T.default.addRhsChangedListener(this.onRhs),this.mounted=!0}},{key:"componentWillUnmount",value:function(){T.default.removeNotifyListener(this.onIncomingCall),T.default.removeChangedListener(this.onCancelCall),T.default.removeRhsChangedListener(this.onRhs),this.refs.ring&&this.refs.ring.removeListener("ended",this.handleTimeout),this.mounted=!1}},{key:"componentDidUpdate",value:function(){this.state.userCalling&&this.refs.ring.addEventListener("ended",this.handleTimeout)}},{key:"closeNotification",value:function(){this.setState({userCalling:null})}},{key:"stopRinging",value:function(){this.refs.ring&&(this.refs.ring.pause(),this.refs.ring.currentTime=0),this.setState({userCalling:null})}},{key:"closeRightHandSide",value:function(e){e.preventDefault(),S.emitCloseRightHandSide(),setTimeout(function(){(0,g.default)(".app__body .inner-wrap").addClass("move--left")},0)}},{key:"onIncomingCall",value:function(e){if(this.mounted){var t=e.from_user_id,a=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia;D.isFeatureEnabled(O.WEBRTC_PREVIEW)?T.default.isBusy()?(P.default.sendMessage("webrtc",{action:I.WebrtcActionTypes.BUSY,from_user_id:w.default.getCurrentId(),to_user_id:t}),this.stopRinging()):a?(T.default.setVideoCallWith(t),this.setState({userCalling:w.default.getProfile(t)})):(P.default.sendMessage("webrtc",{action:I.WebrtcActionTypes.UNSUPPORTED,from_user_id:w.default.getCurrentId(),to_user_id:t}),this.stopRinging()):(P.default.sendMessage("webrtc",{action:I.WebrtcActionTypes.DISABLED,from_user_id:w.default.getCurrentId(),to_user_id:t}),this.stopRinging())}}},{key:"onCancelCall",value:function(e){e&&e.action!==I.WebrtcActionTypes.CANCEL||e&&e.action===I.WebrtcActionTypes.CANCEL&&this.state.userCalling&&e.from_user_id!==this.state.userCalling.id||(T.default.setVideoCallWith(null),this.closeNotification())}},{key:"onRhs",value:function(e){this.setState({rhsOpened:e})}},{key:"handleTimeout",value:function(){P.default.sendMessage("webrtc",{action:I.WebrtcActionTypes.NO_ANSWER,from_user_id:w.default.getCurrentId(),to_user_id:this.state.userCalling.id}),this.onCancelCall()}},{key:"handleAnswer",value:function(e){e&&e.preventDefault();var t=this.state.userCalling;if(t){var a=t.id,n=w.default.getCurrentId(),s={action:I.WebrtcActionTypes.ANSWER,from_user_id:n,to_user_id:a};S.emitCloseRightHandSide(),M.initWebrtc(a,!1),P.default.sendMessage("webrtc",s),setTimeout(function(){s.from_user_id=a,s.to_user_id=n,M.handle(s)},0),this.closeNotification()}}},{key:"handleClose",value:function(e){e&&e.preventDefault(),this.state.userCalling&&P.default.sendMessage("webrtc",{action:I.WebrtcActionTypes.DECLINE,from_user_id:w.default.getCurrentId(),to_user_id:this.state.userCalling.id}),this.onCancelCall()}},{key:"render",value:function(){var e=this.state.userCalling;if(e){var t=D.displayUsername(e.id),a=D.imageURLForUser(e),n=E.default.createElement("img",{className:"user-popover__image",src:a,height:"128",width:"128",key:"user-popover-image"}),s=E.default.createElement("svg",{className:"webrtc-icons__pickup",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:this.handleAnswer},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.answer",defaultMessage:"Answer"}))),E.default.createElement("path",{transform:"translate(-10,-10)",fill:"#fff",d:"M29.854,37.627c1.723,1.904 3.679,3.468 5.793,4.684l3.683,-3.334c0.469,-0.424 1.119,-0.517 1.669,-0.302c1.628,0.63 3.331,1.021 5.056,1.174c0.401,0.026 0.795,0.199 1.09,0.525c0.295,0.326 0.433,0.741 0.407,1.153l-0.279,5.593c-0.02,0.418 -0.199,0.817 -0.525,1.112c-0.326,0.296 -0.741,0.434 -1.159,0.413c-6.704,-0.504 -13.238,-3.491 -18.108,-8.87c-4.869,-5.38 -7.192,-12.179 -7.028,-18.899c0.015,-0.413 0.199,-0.817 0.526,-1.113c0.326,-0.295 0.74,-0.433 1.153,-0.407l5.593,0.279c0.407,0.02 0.812,0.193 1.107,0.519c0.29,0.32 0.428,0.735 0.413,1.137c-0.018,1.732 0.202,3.464 0.667,5.147c0.159,0.569 0.003,1.207 -0.466,1.631l-3.683,3.334c1.005,2.219 2.368,4.32 4.091,6.224Z"})),i=E.default.createElement("svg",{className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:this.handleClose},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.decline",defaultMessage:"Decline"}))),E.default.createElement("path",{transform:"scale(0.7), translate(11,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})),r=E.default.createElement("div",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.incoming_call",defaultMessage:"{username} is calling you.",values:{username:t}}),E.default.createElement("div",{className:"webrtc-buttons webrtc-icons active",style:{marginTop:"5px"}},s,i));return E.default.createElement("div",{className:"webrtc-notification"},E.default.createElement("audio",{ref:"ring",src:A.default,autoPlay:!0}),E.default.createElement("div",null,n),r)}return this.state.rhsOpened&&T.default.isBusy()?E.default.createElement("div",{className:"webrtc__notification--rhs",onClick:this.closeRightHandSide},E.default.createElement("i",{className:"fa fa-phone"}),E.default.createElement(b.FormattedMessage,{id:"webrtc.notification.returnToCall",defaultMessage:"Return to ongoing call with {username}",values:{username:D.displayUsername(T.default.getVideoCallWith())}})):E.default.createElement("div",null)}}]),t}(E.default.Component);t.default=F},2467:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(6),i=n(s),r=a(4),o=n(r),l=a(5),d=n(l),u=a(7),c=n(u),f=a(8),m=n(f),h=a(0),p=n(h),g=a(1),v=n(g),E=a(25),b=n(E),y=a(436),S=n(y),_=a(16),M=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}(_),C=a(2468),w=n(C),k=function(e){function t(e){(0,o.default)(this,t);var a=(0,c.default)(this,(t.__proto__||(0,i.default)(t)).call(this,e));return a.plScrolledToBottom=!0,a.onShrink=a.onShrink.bind(a),a.toggleSize=a.toggleSize.bind(a),a.onInitializeVideoCall=a.onInitializeVideoCall.bind(a),a.doStrangeThings=a.doStrangeThings.bind(a),a.state={expanded:!1,currentUser:b.default.getCurrentUser(),videoCallVisible:!1,isCaller:!1,videoCallWithUserId:null},a}return(0,m.default)(t,e),(0,d.default)(t,[{key:"componentDidMount",value:function(){S.default.addInitListener(this.onInitializeVideoCall),this.doStrangeThings()}},{key:"componentWillUnmount",value:function(){S.default.removeInitListener(this.onInitializeVideoCall)}},{key:"shouldComponentUpdate",value:function(e,t){return!M.areObjectsEqual(t,this.state)}},{key:"doStrangeThings",value:function(){return(0,p.default)(".app__body .inner-wrap").removeClass("move--right"),(0,p.default)(".app__body .inner-wrap").addClass("webrtc--show move--left"),(0,p.default)(".app__body .sidebar--left").removeClass("move--right"),(0,p.default)(".multi-teams .team-sidebar").removeClass("move--right"),(0,p.default)(".app__body .webrtc").addClass("webrtc--show"),this.state.videoCallVisible?null:((0,p.default)(".app__body .inner-wrap").removeClass("webrtc--show move--left move--right"),(0,p.default)(".app__body .webrtc").removeClass("webrtc--show"),v.default.createElement("div",null))}},{key:"componentDidUpdate",value:function(){this.doStrangeThings()}},{key:"onShrink",value:function(){this.setState({expanded:!1})}},{key:"toggleSize",value:function(e){e&&e.preventDefault(),this.setState(function(e){return{expanded:!e.expanded}})}},{key:"onInitializeVideoCall",value:function(e,t){var a=this.state.expanded;null===e&&(a=!1),this.setState({videoCallVisible:null!==e,isCaller:t,videoCallWithUserId:e,expanded:a}),null!==e&&this.forceUpdate()}},{key:"render",value:function(){var e=null,t="";return this.state.expanded&&(t="sidebar--right--expanded"),this.state.videoCallVisible&&(e=v.default.createElement(w.default,{currentUser:this.state.currentUser,userId:this.state.videoCallWithUserId,isCaller:this.state.isCaller,expanded:this.state.expanded,toggleSize:this.toggleSize})),v.default.createElement("div",{className:"sidebar--right webrtc "+t,id:"sidebar-webrtc"},v.default.createElement("div",{onClick:this.onShrink,className:"sidebar--right__bg"}),v.default.createElement("div",{className:"sidebar-right-container"},e))}}]),t}(v.default.Component);t.default=k},2468:function(e,t,a){"use strict";(function(e){function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t}function s(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(6),r=s(i),o=a(4),l=s(o),d=a(5),u=s(d),c=a(7),f=s(c),m=a(8),h=s(m),p=a(2),g=s(p),v=a(1),E=s(v),b=a(17),y=a(2469),S=s(y),_=a(237),M=a(315),C=n(M),w=a(32),k=s(w),T=a(25),N=s(T),P=a(436),I=s(P),L=a(443),D=s(L),R=a(9),A=a(16),O=n(A),F=a(2198),x=s(F),U=a(236),H=s(U),j=a(753),G=s(j),B=a(2481),V=s(B),z=function(t){function a(e){(0,l.default)(this,a);var t=(0,f.default)(this,(a.__proto__||(0,r.default)(a)).call(this,e));t.mounted=!1,t.localMedia=null,t.session=null,t.videocall=null,t.handleResize=t.handleResize.bind(t),t.handleClose=t.handleClose.bind(t),t.close=t.close.bind(t),t.clearError=t.clearError.bind(t),t.getLocalMedia=t.getLocalMedia.bind(t),t.stopMediaStream=t.stopMediaStream.bind(t),t.previewVideo=t.previewVideo.bind(t),t.stopRinging=t.stopRinging.bind(t),t.handleMakeOffer=t.handleMakeOffer.bind(t),t.handleCancelOffer=t.handleCancelOffer.bind(t),t.handleWebrtcEvent=t.handleWebrtcEvent.bind(t),t.handleVideoCallEvent=t.handleVideoCallEvent.bind(t),t.handleRemoteStream=t.handleRemoteStream.bind(t),t.onStatusChange=t.onStatusChange.bind(t),t.onCallDeclined=t.onCallDeclined.bind(t),t.onUnsupported=t.onUnsupported.bind(t),t.onNoAnswer=t.onNoAnswer.bind(t),t.onBusy=t.onBusy.bind(t),t.onDisabled=t.onDisabled.bind(t),t.onFailed=t.onFailed.bind(t),t.onCancelled=t.onCancelled.bind(t),t.onConnectCall=t.onConnectCall.bind(t),t.onSessionCreated=t.onSessionCreated.bind(t),t.onSessionError=t.onSessionError.bind(t),t.doCall=t.doCall.bind(t),t.doAnswer=t.doAnswer.bind(t),t.doHangup=t.doHangup.bind(t),t.doCleanup=t.doCleanup.bind(t),t.renderButtons=t.renderButtons.bind(t),t.onToggleVideo=t.onToggleVideo.bind(t),t.onToggleAudio=t.onToggleAudio.bind(t),t.onToggleRemoteMute=t.onToggleRemoteMute.bind(t),t.toggleIcons=t.toggleIcons.bind(t);var n=N.default.getCurrentUser(),s=N.default.getProfile(e.userId),i=O.imageURLForUser(s);return t.state={windowWidth:O.windowWidth(),windowHeight:O.windowHeight(),channelId:k.default.getCurrentId(),currentUser:n,currentUserImage:O.imageURLForUser(n),remoteUserImage:i,localMediaLoaded:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,isCalling:!1,isAnswering:!1,callInProgress:!1,error:null,errorType:"",ended:null},t}return(0,h.default)(a,t),(0,u.default)(a,[{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize),I.default.addChangedListener(this.handleWebrtcEvent),N.default.addStatusesChangeListener(this.onStatusChange),this.mounted=!0,this.previewVideo(),this.props.isCaller&&this.handleMakeOffer()}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize),I.default.removeChangedListener(this.handleWebrtcEvent),N.default.removeStatusesChangeListener(this.onStatusChange),this.mounted=!1,this.close()}},{key:"componentWillReceiveProps",value:function(e){if(e.currentUser!==this.props.currentUser||e.userId!==this.props.userId||e.isCaller!==this.props.isCaller){var t=N.default.getProfile(e.userId),a=O.imageURLForUser(t);this.setState({error:null,remoteUserImage:a})}e.isCaller&&e.expanded===this.props.expanded&&(this.startCall=!0)}},{key:"componentDidUpdate",value:function(){this.props.isCaller&&this.startCall&&(this.startCall=!1,this.handleMakeOffer())}},{key:"handleResize",value:function(){this.setState({windowWidth:O.windowWidth(),windowHeight:O.windowHeight()})}},{key:"clearError",value:function(){var e=this;setTimeout(function(){e.setState({error:null,ended:null,errorType:""})},R.Constants.WEBRTC_CLEAR_ERROR_DELAY)}},{key:"getLocalMedia",value:function(e,t,a){var n=e||{audio:!0,video:!0};navigator.mediaDevices.getUserMedia(n).then(function(e){t&&(t.srcObject=e),a&&"function"==typeof a&&a(null,e)}).catch(function(e){a(e)})}},{key:"stopMediaStream",value:function(e){e.getTracks().forEach(function(e){e.stop()})}},{key:"previewVideo",value:function(){var e=this;this.mounted&&(this.localMedia?(this.setState({localMediaLoaded:!0,error:null}),this.localMedia.enabled=!0):this.getLocalMedia({audio:!0,video:{minAspectRatio:1.777,maxAspectRatio:1.778,width:640,height:360}},this.refs["local-video"],function(t,a){if(t)return void e.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.mediaError",defaultMessage:"Unable to access Camera and Microphone"})});e.localMedia=a,e.setState({localMediaLoaded:!0})}))}},{key:"stopRinging",value:function(){this.refs.ring&&(this.refs.ring.pause(),this.refs.ring.currentTime=0)}},{key:"handleMakeOffer",value:function(){if(N.default.getStatus(this.props.userId)===R.UserStatuses.OFFLINE)this.onStatusChange();else{var e=E.default.createElement(b.FormattedMessage,{id:"calling_screen",defaultMessage:"Calling"});this.setState({isCalling:!0,isAnswering:!1,callInProgress:!1,error:null,ended:null,connectingMsg:e}),I.default.setVideoCallWith(this.props.userId);var t=this.state.currentUser;D.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.NOTIFY,from_user_id:t.id,to_user_id:this.props.userId})}}},{key:"handleCancelOffer",value:function(){this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:null,ended:null});var e=this.state.currentUser;D.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.CANCEL,from_user_id:e.id,to_user_id:this.props.userId}),this.doCleanup()}},{key:"handleWebrtcEvent",value:function(e){switch(e.action){case R.WebrtcActionTypes.DECLINE:this.onCallDeclined(),this.clearError();break;case R.WebrtcActionTypes.UNSUPPORTED:this.onUnsupported(),this.clearError();break;case R.WebrtcActionTypes.BUSY:this.onBusy(),this.clearError();break;case R.WebrtcActionTypes.NO_ANSWER:this.onNoAnswer(),this.clearError();break;case R.WebrtcActionTypes.FAILED:this.onFailed(),this.clearError();break;case R.WebrtcActionTypes.ANSWER:this.onConnectCall();break;case R.WebrtcActionTypes.CANCEL:this.onCancelled(),this.clearError();break;case R.WebrtcActionTypes.MUTED:this.onToggleRemoteMute(e);break;case R.WebrtcActionTypes.IN_PROGRESS:this.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.inProgress",defaultMessage:"You have a call in progress. Please hang up first."}),errorType:" warning"}),this.clearError();break;case R.WebrtcActionTypes.DISABLED:this.onDisabled(),this.clearError()}}},{key:"handleVideoCallEvent",value:function(e,t){var a=e.result;if(a){switch(a.event){case"registered":this.state.isCalling&&this.doCall();break;case"incomingcall":this.doAnswer(t);break;case"accepted":this.stopRinging(),t&&this.videocall.handleRemoteJsep({jsep:t});break;case"hangup":this.doHangup(!1)}}else{var n=e.error_code;477!==n&&476!==n?this.doHangup(!0):this.state.isCalling&&this.doCall()}}},{key:"handleRemoteStream",value:function(e){this.refs["main-video"].srcObject=e;var t=!1,a=!1,n=e.getVideoTracks(),s=e.getAudioTracks();n&&0!==n.length&&!n[0].muted&&n[0].enabled||(t=!0),s&&0!==s.length&&!s[0].muted&&s[0].enabled||(a=!0),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!0,isMuted:!1,isPaused:!1,error:null,ended:null,isRemotePaused:t,isRemoteMuted:a}),this.toggleIcons()}},{key:"handleClose",value:function(e){e.preventDefault(),this.state.callInProgress?this.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.inProgress",defaultMessage:"You have a call in progress. Please hang up first."}),errorType:" warning"}):this.state.isCalling?(this.handleCancelOffer(),this.close()):this.close()}},{key:"close",value:function(){this.doCleanup(),this.session&&(this.session.destroy(),this.session=null),this.localMedia&&(this.stopMediaStream(this.localMedia),this.localMedia=null),C.initWebrtc(null,!1)}},{key:"onStatusChange",value:function(){var e=N.default.getStatus(this.props.userId);if(e===R.UserStatuses.OFFLINE){var t=E.default.createElement(b.FormattedMessage,{id:"webrtc.offline",defaultMessage:"{username} is offline",values:{username:O.displayUsername(this.props.userId)}});this.state.isCalling||this.state.isAnswering?this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:t}):this.setState({error:t})}else e!==R.UserStatuses.OFFLINE&&this.state.error&&this.setState({error:null,ended:null})}},{key:"onCallDeclined",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.declined",defaultMessage:"Your call has been declined by {username}",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onUnsupported",value:function(){this.mounted&&(this.stopRinging(),this.setState({error:E.default.createElement(b.FormattedMessage,{id:"webrtc.unsupported",defaultMessage:"Call to {username} not successful. Their client does not support video calls.",values:{username:O.displayUsername(this.props.userId)}}),callInProgress:!1,isCalling:!1,isAnswering:!1})),this.doCleanup()}},{key:"onNoAnswer",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.noAnswer",defaultMessage:"{username} is not answering the call",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onBusy",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.busy",defaultMessage:"{username} is busy",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onDisabled",value:function(){var e=null;this.state.isCalling&&(e=E.default.createElement(b.FormattedMessage,{id:"webrtc.disabled",defaultMessage:"{username} has WebRTC disabled, and cannot receive calls. To enable the feature, they must go to Account Settings > Advanced > Preview pre-release features and turn on WebRTC.",values:{username:O.displayUsername(this.props.userId)}})),this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:e}),this.doCleanup()}},{key:"onFailed",value:function(){(0,_.trackEvent)("api","api_users_webrtc_failed"),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,error:E.default.createElement(b.FormattedMessage,{id:"webrtc.failed",defaultMessage:"There was a problem connecting the video call"})}),this.stopRinging(),this.doCleanup()}},{key:"onCancelled",value:function(){this.mounted&&this.state.isAnswering&&(this.stopRinging(),this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,error:E.default.createElement(b.FormattedMessage,{id:"webrtc.cancelled",defaultMessage:"{username} cancelled the call",values:{username:O.displayUsername(this.props.userId)}})})),this.doCleanup()}},{key:"onConnectCall",value:function(){var t=this;C.webrtcToken(function(a){var n=E.default.createElement(b.FormattedMessage,{id:"connecting_screen",defaultMessage:"Connecting"});if(t.setState({isAnswering:!t.state.isCalling,connectingMsg:n}),t.session)t.onSessionCreated();else{var s=[];a.stun_uri&&s.push({urls:a.stun_uri.split(" ")}),a.turn_uri&&s.push({urls:a.turn_uri.split(" "),username:a.turn_username,credential:a.turn_password}),S.default.init({debug:"true"===e.mm_config.EnableDeveloper}),t.session=new S.default({server:a.gateway_url,iceServers:s,token:a.token,success:t.onSessionCreated,error:t.onSessionError})}},function(){t.onSessionError()})}},{key:"onSessionCreated",value:function(){var e=this;this.videocall?this.doCall():this.session.attach({plugin:"janus.plugin.videocall",success:function(t){e.videocall=t,e.videocall.send({message:{request:"register",username:e.state.currentUser.id}})},error:this.onSessionError,onmessage:this.handleVideoCallEvent,onremotestream:this.handleRemoteStream})}},{key:"onSessionError",value:function(){var e=this.state.currentUser;D.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.FAILED,from_user_id:e.id,to_user_id:this.props.userId}),this.onFailed()}},{key:"doCall",value:function(){var e=this;setTimeout(function(){e.videocall.createOffer({stream:e.localMedia,success:function(t){var a={request:"call",username:e.props.userId};e.videocall.send({message:a,jsep:t})},error:function(){e.doHangup(!0)}})},R.Constants.WEBRTC_TIME_DELAY)}},{key:"doAnswer",value:function(e){var t=this;(0,_.trackEvent)("api","api_users_webrtc_start"),this.videocall.createAnswer({jsep:e,stream:this.localMedia,success:function(e){var a={request:"accept"};t.videocall.send({message:a,jsep:e})},error:function(){t.doHangup(!0)}})}},{key:"doHangup",value:function(e,t){return(0,_.trackEvent)("api","api_users_webrtc_end"),this.videocall&&this.state.callInProgress&&(this.videocall.send({message:{request:"hangup"}}),this.videocall.hangup(),this.toggleIcons(),this.localMedia&&(this.localMedia.getVideoTracks()[0].enabled=!0,this.localMedia.getAudioTracks()[0].enabled=!0)),e?(this.onSessionError(),this.doCleanup()):(I.default.setVideoCallWith(null),I.default.emitRhsChanged(!1),t?this.close():(this.setState({isCalling:!1,isAnswering:!1,callInProgress:!1,isPaused:!1,isMuted:!1,isRemotePaused:!1,isRemoteMuted:!1,error:null,ended:E.default.createElement(b.FormattedMessage,{id:"webrtc.callEnded",defaultMessage:"Call with {username} ended.",values:{username:O.displayUsername(this.props.userId)}})}),this.clearError(),this.doCleanup()))}},{key:"doCleanup",value:function(){I.default.setVideoCallWith(null),this.videocall&&(this.videocall.detach(),this.videocall=null)}},{key:"onToggleVideo",value:function(){var e=!this.state.isPaused;e?this.videocall.unmuteVideo():this.videocall.muteVideo();var t=this.state.currentUser;D.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.MUTED,from_user_id:t.id,to_user_id:this.props.userId,type:"video",mute:e}),this.setState({isPaused:e,error:null,ended:null})}},{key:"onToggleAudio",value:function(){var e=!this.state.isMuted;e?this.videocall.unmuteAudio():this.videocall.muteAudio();var t=this.state.currentUser;D.default.sendMessage("webrtc",{action:R.WebrtcActionTypes.MUTED,from_user_id:t.id,to_user_id:this.props.userId,type:"audio",mute:e}),this.setState({isMuted:e,error:null,ended:null})}},{key:"onToggleRemoteMute",value:function(e){"video"===e.type?this.setState({isRemotePaused:e.mute}):this.setState({isRemoteMuted:e.mute,error:null,ended:null})}},{key:"toggleIcons",value:function(){var e=this.refs.icons;e&&(e.classList.toggle("hidden"),e.classList.toggle("active"))}},{key:"renderButtons",value:function(){var e=this,t=void 0;if(this.state.isCalling)t=E.default.createElement("svg",{id:"cancel",className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.handleCancelOffer()}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.cancel",defaultMessage:"Cancel Call"}))),E.default.createElement("path",{transform:"scale(0.8), translate(6,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"}));else if(!this.state.callInProgress&&this.state.localMediaLoaded)t=E.default.createElement("svg",{id:"call",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.handleMakeOffer()},disabled:"offline"===N.default.getStatus(this.props.userId)},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.call",defaultMessage:"Call"}))),E.default.createElement("path",{transform:"translate(-10,-10)",fill:"#fff",d:"M29.854,37.627c1.723,1.904 3.679,3.468 5.793,4.684l3.683,-3.334c0.469,-0.424 1.119,-0.517 1.669,-0.302c1.628,0.63 3.331,1.021 5.056,1.174c0.401,0.026 0.795,0.199 1.09,0.525c0.295,0.326 0.433,0.741 0.407,1.153l-0.279,5.593c-0.02,0.418 -0.199,0.817 -0.525,1.112c-0.326,0.296 -0.741,0.434 -1.159,0.413c-6.704,-0.504 -13.238,-3.491 -18.108,-8.87c-4.869,-5.38 -7.192,-12.179 -7.028,-18.899c0.015,-0.413 0.199,-0.817 0.526,-1.113c0.326,-0.295 0.74,-0.433 1.153,-0.407l5.593,0.279c0.407,0.02 0.812,0.193 1.107,0.519c0.29,0.32 0.428,0.735 0.413,1.137c-0.018,1.732 0.202,3.464 0.667,5.147c0.159,0.569 0.003,1.207 -0.466,1.631l-3.683,3.334c1.005,2.219 2.368,4.32 4.091,6.224Z"}));else if(this.state.callInProgress){var a="off",n="on",s="off",i="on",r=E.default.createElement(b.FormattedMessage,{id:"webrtc.mute_audio",defaultMessage:"Mute"}),o=E.default.createElement(b.FormattedMessage,{id:"webrtc.pause_video",defaultMessage:"Turn off Video"});this.state.isMuted&&(a="on",n="off",r=E.default.createElement(b.FormattedMessage,{id:"webrtc.unmute_audio",defaultMessage:"Unmute"})),this.state.isPaused&&(s="on",i="off",o=E.default.createElement(b.FormattedMessage,{id:"webrtc.unpause_video",defaultMessage:"Turn on Video"})),t=E.default.createElement("div",{ref:"icons",className:"webrtc-icons hidden"},E.default.createElement("svg",{id:"mute-audio",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.onToggleAudio()}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,r)),E.default.createElement("path",{className:a,transform:"scale(0.6), translate(17,18)",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),E.default.createElement("path",{className:n,transform:"scale(0.6), translate(17,18)",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"})),E.default.createElement("svg",{id:"mute-video",className:"webrtc-icons__call",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.onToggleVideo()}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,o)),E.default.createElement("path",{className:s,transform:"scale(0.6), translate(17,16)",d:"M40 8H15.64l8 8H28v4.36l1.13 1.13L36 16v12.36l7.97 7.97L44 36V12c0-2.21-1.79-4-4-4zM4.55 2L2 4.55l4.01 4.01C4.81 9.24 4 10.52 4 12v24c0 2.21 1.79 4 4 4h29.45l4 4L44 41.46 4.55 2zM12 16h1.45L28 30.55V32H12V16z",fill:"white"}),E.default.createElement("path",{className:i,transform:"scale(0.6), translate(17,16)",d:"M40 8H8c-2.21 0-4 1.79-4 4v24c0 2.21 1.79 4 4 4h32c2.21 0 4-1.79 4-4V12c0-2.21-1.79-4-4-4zm-4 24l-8-6.4V32H12V16h16v6.4l8-6.4v16z",fill:"white"})),E.default.createElement("svg",{id:"hangup",className:"webrtc-icons__cancel",xmlns:"http://www.w3.org/2000/svg",width:"48",height:"48",viewBox:"-10 -10 68 68",onClick:function(){return e.doHangup(!1,!0)}},E.default.createElement("circle",{cx:"24",cy:"24",r:"34"},E.default.createElement("title",null,E.default.createElement(b.FormattedMessage,{id:"webrtc.hangup",defaultMessage:"Hang up"}))),E.default.createElement("path",{transform:"scale(0.7), translate(11,10)",d:"M24 18c-3.21 0-6.3.5-9.2 1.44v6.21c0 .79-.46 1.47-1.12 1.8-1.95.98-3.74 2.23-5.33 3.7-.36.35-.85.57-1.4.57-.55 0-1.05-.22-1.41-.59L.59 26.18c-.37-.37-.59-.87-.59-1.42 0-.55.22-1.05.59-1.42C6.68 17.55 14.93 14 24 14s17.32 3.55 23.41 9.34c.37.36.59.87.59 1.42 0 .55-.22 1.05-.59 1.41l-4.95 4.95c-.36.36-.86.59-1.41.59-.54 0-1.04-.22-1.4-.57-1.59-1.47-3.38-2.72-5.33-3.7-.66-.33-1.12-1.01-1.12-1.8v-6.21C30.3 18.5 27.21 18 24 18z",fill:"white"})))}return t}},{key:"render",value:function(){var e=N.default.getCurrentId(),t=E.default.createElement("img",{src:this.state.remoteUserImage}),a=void 0,n="",s="hidden",i=void 0,r=void 0,o="webrtc__local-image hidden",l="webrtc__remote-image";this.state.error?i=E.default.createElement("div",{className:"webrtc__error"},E.default.createElement("div",{className:"form-group has-error"},E.default.createElement("label",{className:"control-label"+this.state.errorType},this.state.error))):this.state.ended&&(i=E.default.createElement("div",{className:"webrtc__error"},E.default.createElement("div",{className:"form-group"},E.default.createElement("label",{className:"control-label"},this.state.ended)))),this.state.isRemoteMuted&&(r=E.default.createElement("div",{className:"webrtc__remote-mute"},E.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"60",height:"60",viewBox:"-10 -10 68 68"},E.default.createElement("path",{className:"off",transform:"scale(0.6), translate(17,18)",d:"M38 22h-3.4c0 1.49-.31 2.87-.87 4.1l2.46 2.46C37.33 26.61 38 24.38 38 22zm-8.03.33c0-.11.03-.22.03-.33V10c0-3.32-2.69-6-6-6s-6 2.68-6 6v.37l11.97 11.96zM8.55 6L6 8.55l12.02 12.02v1.44c0 3.31 2.67 6 5.98 6 .45 0 .88-.06 1.3-.15l3.32 3.32c-1.43.66-3 1.03-4.62 1.03-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c1.81-.27 3.53-.9 5.08-1.81L39.45 42 42 39.46 8.55 6z",fill:"white"}),E.default.createElement("path",{className:"on",transform:"scale(0.6), translate(17,18)",d:"M24 28c3.31 0 5.98-2.69 5.98-6L30 10c0-3.32-2.68-6-6-6-3.31 0-6 2.68-6 6v12c0 3.31 2.69 6 6 6zm10.6-6c0 6-5.07 10.2-10.6 10.2-5.52 0-10.6-4.2-10.6-10.2H10c0 6.83 5.44 12.47 12 13.44V42h4v-6.56c6.56-.97 12-6.61 12-13.44h-3.4z",fill:"white"}))));var d=void 0;null!=e&&(d=E.default.createElement(G.default,null));var u=this.renderButtons(),c=this.state.isCalling,f=void 0,m=void 0;return(c||this.state.isAnswering)&&(c&&(m=E.default.createElement("audio",{ref:"ring",src:x.default,autoPlay:!0})),f=E.default.createElement("div",{className:"connecting"},E.default.createElement(H.default,{position:"absolute",message:this.state.connectingMsg}),m)),this.state.callInProgress&&(this.state.isPaused&&(n="hidden",o="webrtc__local-image",a=E.default.createElement("img",{src:this.state.currentUserImage})),this.state.isRemotePaused?(s="hidden",l="webrtc__remote-image"):(s="",l="webrtc__remote-image hidden")),E.default.createElement("div",{className:"post-right__container"},E.default.createElement("div",{className:"search-bar__container channel-header alt"},d),E.default.createElement("div",{className:"sidebar-right__body"},E.default.createElement(V.default,{username:O.displayUsername(this.props.userId),onClose:this.handleClose,toggleSize:this.props.toggleSize}),E.default.createElement("div",{className:"post-right__scroll"},E.default.createElement("div",{id:"videos"},r,E.default.createElement("div",{id:"main-video",className:s,autoPlay:!0},E.default.createElement("video",{ref:"main-video",autoPlay:!0})),E.default.createElement("div",{id:"local-video",className:n},E.default.createElement("video",{ref:"local-video",autoPlay:!0,muted:!0})),E.default.createElement("div",{className:l},t),E.default.createElement("div",{className:o},a)),i,f,E.default.createElement("div",{className:"webrtc-buttons"},u))))}}]),a}(E.default.Component);t.default=z,z.propTypes={currentUser:g.default.object,userId:g.default.string.isRequired,isCaller:g.default.bool.isRequired,expanded:g.default.bool.isRequired,toggleSize:g.default.func}}).call(t,a(22))},2469:function(e,t,a){function n(e){function t(e){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",a="",n=0;n<e;n++){var s=Math.floor(Math.random()*t.length);a+=t.substring(s,s+1)}return a}function a(){if(null!=X){if(n.debug("Long poll..."),!J)return void n.warn("Is the gateway down? (connected=false)");var t=B+"/"+X+"?rid="+(new Date).getTime();void 0!==W&&null!==W&&(t=t+"&maxev="+W),null!==Y&&void 0!==Y&&(t=t+"&token="+Y),null!==K&&void 0!==K&&(t=t+"&apisecret="+K),n.ajax({type:"GET",url:t,cache:!1,timeout:6e4,success:r,error:function(t,s,i){if(n.error(s+": "+i),++$>3)return J=!1,void e.error("Lost connection to the gateway (is it down?)");a()},dataType:"json"})}}function r(e){if($=0,F||void 0===X||null===X||setTimeout(a,200),F||!Array.isArray(e)){if("keepalive"===e.janus)return void n.vdebug("Got a keepalive on session "+X);if("ack"!==e.janus)if("success"!==e.janus){if("webrtcup"===e.janus){n.debug("Got a webrtcup event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var s=Q[t];return void 0===s||null===s?void n.warn("This handle is not attached to this session"):void s.webrtcState(!0)}if("hangup"===e.janus){n.debug("Got a hangup event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var s=Q[t];if(void 0===s||null===s)return void n.warn("This handle is not attached to this session");s.webrtcState(!1),s.hangup()}else if("detached"===e.janus){n.debug("Got a detached event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var s=Q[t];if(void 0===s||null===s)return;s.ondetached(),s.detach()}else if("media"===e.janus){n.debug("Got a media event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var s=Q[t];if(void 0===s||null===s)return void n.warn("This handle is not attached to this session");s.mediaState(e.type,e.receiving)}else if("slowlink"===e.janus){n.debug("Got a slowlink event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var s=Q[t];if(void 0===s||null===s)return void n.warn("This handle is not attached to this session");s.slowLink(e.uplink,e.nacks)}else{if("error"===e.janus){n.error("Ooops: "+e.error.code+" "+e.error.reason),n.debug(e);var i=e.transaction;if(null!==i&&void 0!==i){var o=ee[i];null!==o&&void 0!==o&&o(e),delete ee[i]}return}if("event"===e.janus){n.debug("Got a plugin event on session "+X),n.debug(e);var t=e.sender;if(void 0===t||null===t)return void n.warn("Missing sender...");var l=e.plugindata;if(void 0===l||null===l)return void n.warn("Missing plugindata...");n.debug("  -- Event is coming from "+t+" ("+l.plugin+")");var d=l.data;n.debug(d);var s=Q[t];if(void 0===s||null===s)return void n.warn("This handle is not attached to this session");var u=e.jsep;void 0!==u&&null!==u&&(n.debug("Handling SDP as well..."),n.debug(u));var c=s.onmessage;null!==c&&void 0!==c?(n.debug("Notifying application..."),c(d,u)):n.debug("No provided notification callback")}else n.warn("Unkown message/event  '"+e.janus+"' on session "+X),n.debug(e)}}else{n.debug("Got a success on session "+X),n.debug(e);var i=e.transaction;if(null!==i&&void 0!==i){var o=ee[i];null!==o&&void 0!==o&&o(e),delete ee[i]}}else{n.debug("Got an ack on session "+X),n.debug(e);var i=e.transaction;if(null!==i&&void 0!==i){var o=ee[i];null!==o&&void 0!==o&&o(e),delete ee[i]}}}else for(var f=0;f<e.length;f++)r(e[f])}function o(){if(null!==B&&F&&J){H=setTimeout(o,3e4);var e={janus:"keepalive",session_id:X,transaction:t(12)};null!==Y&&void 0!==Y&&(e.token=Y),null!==K&&void 0!==K&&(e.apisecret=K),x.send(JSON.stringify(e))}}function l(s){var i=t(12),d={janus:"create",transaction:i};if(null!==Y&&void 0!==Y&&(d.token=Y),null!==K&&void 0!==K&&(d.apisecret=K),null===B&&Array.isArray(j)&&(B=j[G],0===B.indexOf("ws")?(F=!0,n.log("Server #"+(G+1)+": trying WebSockets to contact Janus ("+B+")")):(F=!1,n.log("Server #"+(G+1)+": trying REST API to contact Janus ("+B+")"))),F){x=new WebSocket(B,"janus-protocol"),U={error:function(){if(n.error("Error connecting to the Janus WebSockets server... "+B),Array.isArray(j))return++G==j.length?void s.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(B=null,void setTimeout(function(){l(s)},200));s.error("Error connecting to the Janus WebSockets server: Is the gateway down?")},open:function(){ee[i]=function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void s.error(e.error.reason);H=setTimeout(o,3e4),J=!0,X=e.data.id,n.log("Created session: "+X),n.sessions[X]=Z,s.success()},x.send(JSON.stringify(d))},message:function(e){r(JSON.parse(e.data))},close:function(){null!==B&&J&&(J=!1,e.error("Lost connection to the gateway (is it down?)"))}};for(var u in U)x.addEventListener(u,U[u])}else n.ajax({type:"POST",url:B,cache:!1,contentType:"application/json",data:JSON.stringify(d),success:function(e){if(n.debug(e),"success"!==e.janus)return n.error("Ooops: "+e.error.code+" "+e.error.reason),void s.error(e.error.reason);J=!0,X=e.data.id,n.log("Created session: "+X),n.sessions[X]=Z,a(),s.success()},error:function(e,t,a){if(n.error(t+": "+a),Array.isArray(j))return++G==j.length?void s.error("Error connecting to any of the provided Janus servers: Is the gateway down?"):(B=null,void setTimeout(function(){l(s)},200));""===a?s.error(t+": Is the gateway down?"):s.error(t+": "+a)},dataType:"json"})}function d(a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop;var s=!0;if(void 0!==a.asyncRequest&&null!==a.asyncRequest&&(s=!0===a.asyncRequest),n.log("Destroying session "+X+" (async="+s+")"),!J)return n.warn("Is the gateway down? (connected=false)"),void a.success();if(void 0===X||null===X)return n.warn("No session to destroy"),a.success(),void e.destroyed();delete n.sessions[X];for(var i in Q){var r=Q[i];n.log("Destroying handle "+r.id+" ("+r.plugin+")"),p(r.id,{asyncRequest:s})}var o={janus:"destroy",transaction:t(12)};if(null!==Y&&void 0!==Y&&(o.token=Y),null!==K&&void 0!==K&&(o.apisecret=K),F){o.session_id=X;var l=function(){for(var e in U)x.removeEventListener(e,U[e]);x.removeEventListener("message",d),x.removeEventListener("error",u),H&&clearTimeout(H)},d=function(t){var n=JSON.parse(t.data);n.session_id==o.session_id&&n.transaction==o.transaction&&(l(),a.success(),e.destroyed())},u=function(t){l(),a.error("Failed to destroy the gateway: Is the gateway down?"),e.destroyed()};return x.addEventListener("message",d),x.addEventListener("error",u),void x.send(JSON.stringify(o))}n.ajax({type:"POST",url:B+"/"+X,async:s,cache:!1,contentType:"application/json",data:JSON.stringify(o),success:function(t){n.log("Destroyed session:"),n.debug(t),X=null,J=!1,"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),a.success(),e.destroyed()},error:function(t,s,i){n.error(s+": "+i),X=null,J=!1,a.success(),e.destroyed()},dataType:"json"})}function u(e){if(e=e||{},e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:n.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:n.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:n.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:n.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:n.noop,e.onlocalstream="function"==typeof e.onlocalstream?e.onlocalstream:n.noop,e.onremotestream="function"==typeof e.onremotestream?e.onremotestream:n.noop,e.ondata="function"==typeof e.ondata?e.ondata:n.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:n.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:n.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:n.noop,!J)return n.warn("Is the gateway down? (connected=false)"),void e.error("Is the gateway down? (connected=false)");var a=e.plugin;if(void 0===a||null===a)return n.error("Invalid plugin"),void e.error("Invalid plugin");var s=t(12),i={janus:"attach",plugin:a,transaction:s};if(null!==Y&&void 0!==Y&&(i.token=Y),null!==K&&void 0!==K&&(i.apisecret=K),F)return ee[s]=function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var s=t.data.id;n.log("Created handle: "+s);var i={session:Z,plugin:a,id:s,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return s},getPlugin:function(){return a},getVolume:function(){return _(s)},isAudioMuted:function(){return M(s,!1)},muteAudio:function(){return C(s,!1,!0)},unmuteAudio:function(){return C(s,!1,!1)},isVideoMuted:function(){return M(s,!0)},muteVideo:function(){return C(s,!0,!0)},unmuteVideo:function(){return C(s,!0,!1)},getBitrate:function(){return w(s)},send:function(e){c(s,e)},data:function(e){m(s,e)},dtmf:function(e){h(s,e)},consentDialog:e.consentDialog,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){v(s,e)},createAnswer:function(e){v(s,e)},handleRemoteJsep:function(e){E(s,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){T(s,!0===e)},detach:function(e){p(s,e)}};Q[s]=i,e.success(i)},i.session_id=X,void x.send(JSON.stringify(i));n.ajax({type:"POST",url:B+"/"+X,cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(t){if(n.debug(t),"success"!==t.janus)return n.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var s=t.data.id;n.log("Created handle: "+s);var i={session:Z,plugin:a,id:s,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,remoteStream:null,mySdp:null,pc:null,dataChannel:null,dtmfSender:null,trickle:!0,iceDone:!1,sdpSent:!1,volume:{value:null,timer:null},bitrate:{value:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,timer:null}},getId:function(){return s},getPlugin:function(){return a},getVolume:function(){return _(s)},isAudioMuted:function(){return M(s,!1)},muteAudio:function(){return C(s,!1,!0)},unmuteAudio:function(){return C(s,!1,!1)},isVideoMuted:function(){return M(s,!0)},muteVideo:function(){return C(s,!0,!0)},unmuteVideo:function(){return C(s,!0,!1)},getBitrate:function(){return w(s)},send:function(e){c(s,e)},data:function(e){m(s,e)},dtmf:function(e){h(s,e)},consentDialog:e.consentDialog,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){v(s,e)},createAnswer:function(e){v(s,e)},handleRemoteJsep:function(e){E(s,e)},onlocalstream:e.onlocalstream,onremotestream:e.onremotestream,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){T(s,!0===e)},detach:function(e){p(s,e)}};Q[s]=i,e.success(i)},error:function(e,t,a){n.error(t+": "+a)},dataType:"json"})}function c(e,a){if(a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop,!J)return n.warn("Is the gateway down? (connected=false)"),void a.error("Is the gateway down? (connected=false)");var s=a.message,i=a.jsep,r=t(12),o={janus:"message",body:s,transaction:r};if(null!==Y&&void 0!==Y&&(o.token=Y),null!==K&&void 0!==K&&(o.apisecret=K),null!==i&&void 0!==i&&(o.jsep=i),n.debug("Sending message to plugin (handle="+e+"):"),n.debug(o),F)return o.session_id=X,o.handle_id=e,ee[r]=function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(void 0===t||null===t)return n.warn("Request succeeded, but missing plugindata..."),void a.success();n.log("Synchronous transaction successful ("+t.plugin+")");var s=t.data;return n.debug(s),void a.success(s)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),a.error("Unknown error")));a.success()},void x.send(JSON.stringify(o));n.ajax({type:"POST",url:B+"/"+X+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(o),success:function(e){if(n.debug("Message sent!"),n.debug(e),"success"===e.janus){var t=e.plugindata;if(void 0===t||null===t)return n.warn("Request succeeded, but missing plugindata..."),void a.success();n.log("Synchronous transaction successful ("+t.plugin+")");var s=t.data;return n.debug(s),void a.success(s)}if("ack"!==e.janus)return void(void 0!==e.error&&null!==e.error?(n.error("Ooops: "+e.error.code+" "+e.error.reason),a.error(e.error.code+" "+e.error.reason)):(n.error("Unknown error"),a.error("Unknown error")));a.success()},error:function(e,t,s){n.error(t+": "+s),a.error(t+": "+s)},dataType:"json"})}function f(e,a){if(!J)return void n.warn("Is the gateway down? (connected=false)");var s={janus:"trickle",candidate:a,transaction:t(12)};if(null!==Y&&void 0!==Y&&(s.token=Y),null!==K&&void 0!==K&&(s.apisecret=K),n.vdebug("Sending trickle candidate (handle="+e+"):"),n.vdebug(s),F)return s.session_id=X,s.handle_id=e,void x.send(JSON.stringify(s));n.ajax({type:"POST",url:B+"/"+X+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(s),success:function(e){if(n.vdebug("Candidate sent!"),n.vdebug(e),"ack"!==e.janus)return void n.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t,a){n.error(t+": "+a)},dataType:"json"})}function m(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var s=a.webrtcStuff,i=t.text;if(null===i||void 0===i)return n.warn("Invalid text"),void t.error("Invalid text");n.log("Sending string on data channel: "+i),s.dataChannel.send(i),t.success()}function h(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var s=a.webrtcStuff;if(null===s.dtmfSender||void 0===s.dtmfSender){if(void 0!==s.myStream&&null!==s.myStream){var i=s.myStream.getAudioTracks();if(null!==i&&void 0!==i&&i.length>0){var r=i[0];s.dtmfSender=s.pc.createDTMFSender(r),n.log("Created DTMF Sender"),s.dtmfSender.ontonechange=function(e){n.debug("Sent DTMF tone: "+e.tone)}}}if(null===s.dtmfSender||void 0===s.dtmfSender)return n.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var o=t.dtmf;if(null===o||void 0===o)return n.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var l=o.tones;if(null===l||void 0===l)return n.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var d=o.duration;null!==d&&void 0!==d||(d=500);var u=o.gap;null!==u&&void 0!==u||(u=50),n.debug("Sending DTMF string "+l+" (duration "+d+"ms, gap "+u+"ms)"),s.dtmfSender.insertDTMF(l,d,u)}function p(e,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var s=!0;if(void 0!==a.asyncRequest&&null!==a.asyncRequest&&(s=!0===a.asyncRequest),n.log("Destroying handle "+e+" (sync="+s+")"),T(e),!J)return n.warn("Is the gateway down? (connected=false)"),void a.error("Is the gateway down? (connected=false)");var i={janus:"detach",transaction:t(12)};if(null!==Y&&void 0!==Y&&(i.token=Y),null!==K&&void 0!==K&&(i.apisecret=K),F)return i.session_id=X,i.handle_id=e,x.send(JSON.stringify(i)),delete Q[e],void a.success();n.ajax({type:"POST",url:B+"/"+X+"/"+e,async:s,cache:!1,contentType:"application/json",data:JSON.stringify(i),success:function(t){n.log("Destroyed handle:"),n.debug(t),"success"!==t.janus&&n.error("Ooops: "+t.error.code+" "+t.error.reason),delete Q[e],a.success()},error:function(t,s,i){n.error(s+": "+i),delete Q[e],a.success()},dataType:"json"})}function g(e,t,a,s,r){var o=Q[e];if(null===o||void 0===o||null===o.webrtcStuff||void 0===o.webrtcStuff)return n.warn("Invalid handle"),void s.error("Invalid handle");var l=o.webrtcStuff;n.debug("streamsDone:",r),l.myStream=r;var d={iceServers:V,iceTransportPolicy:z},u={optional:[{DtlsSrtpKeyAgreement:!0}]};if(!0===q&&u.optional.push({googIPv6:!0}),"edge"===i.browserDetails.browser&&(d.bundlePolicy="max-bundle"),n.log("Creating PeerConnection"),n.debug(u),l.pc=new RTCPeerConnection(d,u),n.debug(l.pc),l.pc.getStats&&(l.volume.value=0,l.bitrate.value="0 kbits/sec"),n.log("Preparing local SDP and gathering candidates (trickle="+l.trickle+")"),l.pc.onicecandidate=function(t){if(null==t.candidate||"edge"===i.browserDetails.browser&&t.candidate.candidate.indexOf("endOfCandidates")>0)n.log("End of candidates."),l.iceDone=!0,!0===l.trickle?f(e,{completed:!0}):S(e,s);else{var a={candidate:t.candidate.candidate,sdpMid:t.candidate.sdpMid,sdpMLineIndex:t.candidate.sdpMLineIndex};!0===l.trickle&&f(e,a)}},null!==r&&void 0!==r&&(n.log("Adding local stream"),l.pc.addStream(r),o.onlocalstream(r)),l.pc.onaddstream=function(e){n.log("Handling Remote Stream"),n.debug(e),l.remoteStream=e,o.onremotestream(e.stream)},A(a)){n.log("Creating data channel");var c=function(e){n.log("Received message on data channel: "+e.data),o.ondata(e.data)},m=function(){var e=null!==l.dataChannel?l.dataChannel.readyState:"null";n.log("State change on data channel: "+e),"open"===e&&o.ondataopen()},h=function(e){n.error("Got error on data channel:",e)};l.dataChannel=l.pc.createDataChannel("JanusDataChannel",{ordered:!1}),l.dataChannel.onmessage=c,l.dataChannel.onopen=m,l.dataChannel.onclose=m,l.dataChannel.onerror=h}null===t||void 0===t?b(e,a,s):("edge"===i.browserDetails.browser&&(t.sdp+="a=end-of-candidates\r\n"),l.pc.setRemoteDescription(new RTCSessionDescription(t),function(){n.log("Remote description accepted!"),y(e,a,s)},s.error))}function v(e,t){function a(a,n){l.consentDialog(!1),a?t.error({code:a.code,name:a.name,message:a.message}):g(e,r,o,t,n)}function s(e,t){n.log("Adding media constraint (screen capture)"),n.debug(e),navigator.mediaDevices.getUserMedia(e).then(function(e){t(null,e)}).catch(function(e){l.consentDialog(!1),t(e)})}t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:k;var r=t.jsep,o=t.media,l=Q[e];if(null===l||void 0===l||null===l.webrtcStuff||void 0===l.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var d=l.webrtcStuff;if(void 0!==d.pc&&null!==d.pc)return n.log("Updating existing media session"),void(null===r||void 0===r?b(e,o,t):("edge"===i.browserDetails.browser&&(r.sdp+="a=end-of-candidates\r\n"),d.pc.setRemoteDescription(new RTCSessionDescription(r),function(){n.log("Remote description accepted!"),y(e,o,t)},t.error)));if(null!==t.stream&&void 0!==t.stream){var u=t.stream;return n.log("MediaStream provided by the application"),n.debug(u),d.streamExternal=!0,void g(e,r,o,t,u)}if(d.trickle=O(t.trickle),N(o)||L(o)){var c={mandatory:{},optional:[]};l.consentDialog(!0);var f=N(o);!0===f&&void 0!=o&&null!=o&&"object"==typeof o.audio&&(f=o.audio);var m=L(o);if(!0===m&&void 0!=o&&null!=o)if(o.video&&"screen"!=o.video&&"window"!=o.video){var h=0,p=0,v=0;if("lowres"===o.video)p=240,v=240,h=320;else if("lowres-16:9"===o.video)p=180,v=180,h=320;else if("hires"===o.video||"hires-16:9"===o.video){if(p=720,v=720,h=1280,navigator.mozGetUserMedia){var E=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);E<38&&(n.warn(o.video+" unsupported, falling back to stdres (old Firefox)"),p=480,v=480,h=640)}}else"stdres"===o.video?(p=480,v=480,h=640):"stdres-16:9"===o.video?(p=360,v=360,h=640):(n.log("Default video setting ("+o.video+") is stdres 4:3"),p=480,v=480,h=640);if(n.log("Adding media constraint "+o.video),navigator.mozGetUserMedia){var E=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);m=E<38?{require:["height","width"],height:{max:v,min:p},width:{max:h,min:h}}:{height:{ideal:p},width:{ideal:h}}}else m={mandatory:{maxHeight:v,minHeight:p,maxWidth:h,minWidth:h},optional:[]};"object"==typeof o.video&&(m=o.video),n.debug(m)}else if("screen"===o.video||"window"===o.video){if("https:"!==window.location.protocol)return n.warn("Screen sharing only works on HTTPS, try the https:// version of this page"),l.consentDialog(!1),void t.error("Screen sharing only works on HTTPS, try the https:// version of this page");var S={};if("chrome"===i.browserDetails.browser){var _=i.browserDetails.version,M=33;if(window.navigator.userAgent.match("Linux")&&(M=35),_>=26&&_<=M)c={video:{mandatory:{googLeakyBucket:!0,maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3,chromeMediaSource:"screen"}},audio:N(o)},s(c,a);else{var C=window.setTimeout(function(){return T=new Error("NavigatorUserMediaError"),T.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',l.consentDialog(!1),t.error(T)},1e3);S[C]=[a,null],window.postMessage({type:"janusGetScreen",id:C},"*")}}else if(window.navigator.userAgent.match("Firefox")){var w=parseInt(window.navigator.userAgent.match(/Firefox\/(.*)/)[1],10);if(!(w>=33)){var T=new Error("NavigatorUserMediaError");return T.name="Your version of Firefox does not support screen sharing, please install Firefox 33 (or more recent versions)",l.consentDialog(!1),void t.error(T)}c={video:{mozMediaSource:o.video,mediaSource:o.video},audio:N(o)},s(c,function(e,t){if(a(e,t),!e)var n=t.currentTime,s=window.setInterval(function(){t||window.clearInterval(s),t.currentTime==n&&(window.clearInterval(s),t.onended&&t.onended()),n=t.currentTime},500)})}return void window.addEventListener("message",function(e){if(e.origin==window.location.origin)if("janusGotScreen"==e.data.type&&S[e.data.id]){var a=S[e.data.id],n=a[0];if(delete S[e.data.id],""===e.data.sourceId){var i=new Error("NavigatorUserMediaError");i.name="You cancelled the request for permission, giving up...",l.consentDialog(!1),t.error(i)}else c={audio:N(o),video:{mandatory:{chromeMediaSource:"desktop",maxWidth:window.screen.width,maxHeight:window.screen.height,maxFrameRate:3},optional:[{googLeakyBucket:!0},{googTemporalLayeredScreencast:!0}]}},c.video.mandatory.chromeMediaSourceId=e.data.sourceId,s(c,n)}else"janusGetScreenPending"==e.data.type&&window.clearTimeout(e.data.id)})}null!==o&&void 0!==o&&"screen"===o.video||navigator.mediaDevices.enumerateDevices().then(function(a){var n=a.some(function(e){return"audioinput"===e.kind}),s=a.some(function(e){return"videoinput"===e.kind}),i=N(o),d=L(o),u=P(o),c=D(o);if(i||d||u||c){var h=!!i&&n,p=!!d&&s;if(!h&&!p)return l.consentDialog(!1),t.error("No capture device found"),!1;if(!h&&u)return l.consentDialog(!1),t.error("Audio capture is required, but no capture device found"),!1;if(!p&&c)return l.consentDialog(!1),t.error("Video capture is required, but no capture device found"),!1}navigator.mediaDevices.getUserMedia({audio:!!n&&f,video:!!s&&m}).then(function(a){l.consentDialog(!1),g(e,r,o,t,a)}).catch(function(e){l.consentDialog(!1),t.error({code:e.code,name:e.name,message:e.message})})}).catch(function(e){l.consentDialog(!1),t.error("enumerateDevices error",e)})}else g(e,r,o,t)}function E(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:k;var a=t.jsep,s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),void t.error("Invalid handle");var r=s.webrtcStuff;if(void 0!==a&&null!==a){if(null===r.pc)return n.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");"edge"===i.browserDetails.browser&&(a.sdp+="a=end-of-candidates\r\n"),r.pc.setRemoteDescription(new RTCSessionDescription(a),function(){n.log("Remote description accepted!"),t.success()},t.error)}else t.error("Invalid JSEP")}function b(e,t,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var r=s.webrtcStuff;n.log("Creating offer (iceDone="+r.iceDone+")");var o=null;o="firefox"==i.browserDetails.browser||"edge"==i.browserDetails.browser?{offerToReceiveAudio:I(t),offerToReceiveVideo:R(t)}:{mandatory:{OfferToReceiveAudio:I(t),OfferToReceiveVideo:R(t)}},n.debug(o),r.pc.createOffer(function(e){if(n.debug(e),null!==r.mySdp&&void 0!==r.mySdp||(n.log("Setting local description"),r.mySdp=e.sdp,r.pc.setLocalDescription(e)),!r.iceDone&&!r.trickle)return void n.log("Waiting for all candidates...");if(r.sdpSent)return void n.log("Offer already sent, not sending it again");n.log("Offer ready"),n.debug(a),r.sdpSent=!0;var t={type:e.type,sdp:e.sdp};a.success(t)},a.error,o)}function y(e,t,a){a=a||{},a.success="function"==typeof a.success?a.success:n.noop,a.error="function"==typeof a.error?a.error:n.noop;var s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),void a.error("Invalid handle");var r=s.webrtcStuff;n.log("Creating answer (iceDone="+r.iceDone+")");var o=null;o="firefox"==i.browserDetails.browser||"edge"==i.browserDetails.browser?{offerToReceiveAudio:I(t),offerToReceiveVideo:R(t)}:{mandatory:{OfferToReceiveAudio:I(t),OfferToReceiveVideo:R(t)}},n.debug(o),r.pc.createAnswer(function(e){if(n.debug(e),null!==r.mySdp&&void 0!==r.mySdp||(n.log("Setting local description"),r.mySdp=e.sdp,r.pc.setLocalDescription(e)),!r.iceDone&&!r.trickle)return void n.log("Waiting for all candidates...");if(r.sdpSent)return void n.log("Answer already sent, not sending it again");r.sdpSent=!0;var t={type:e.type,sdp:e.sdp};a.success(t)},a.error,o)}function S(e,t){t=t||{},t.success="function"==typeof t.success?t.success:n.noop,t.error="function"==typeof t.error?t.error:n.noop;var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return void n.warn("Invalid handle, not sending anything");var s=a.webrtcStuff;return n.log("Sending offer/answer SDP..."),null===s.mySdp||void 0===s.mySdp?void n.warn("Local SDP instance is invalid, not sending anything..."):(s.mySdp={type:s.pc.localDescription.type,sdp:s.pc.localDescription.sdp},s.sdpSent?void n.log("Offer/Answer SDP already sent, not sending it again"):(!1===s.trickle&&(s.mySdp.trickle=!1),n.debug(t),s.sdpSent=!0,void t.success(s.mySdp)))}function _(e){var t=Q[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return n.warn("Invalid handle"),0;var a=t.webrtcStuff;return a.pc.getStats&&"chrome"==i.browserDetails.browser?null===a.remoteStream||void 0===a.remoteStream?(n.warn("Remote stream unavailable"),0):null===a.volume.timer||void 0===a.volume.timer?(n.log("Starting volume monitor"),a.volume.timer=setInterval(function(){a.pc.getStats(function(e){for(var t=e.result(),n=0;n<t.length;n++){var s=t[n];"ssrc"==s.type&&s.stat("audioOutputLevel")&&(a.volume.value=s.stat("audioOutputLevel"))}})},200),0):a.volume.value:(n.log("Getting the remote volume unsupported by browser"),0)}function M(e,t){var a=Q[e];if(null===a||void 0===a||null===a.webrtcStuff||void 0===a.webrtcStuff)return n.warn("Invalid handle"),!0;var s=a.webrtcStuff;return null===s.pc||void 0===s.pc?(n.warn("Invalid PeerConnection"),!0):void 0===s.myStream||null===s.myStream?(n.warn("Invalid local MediaStream"),!0):t?null===s.myStream.getVideoTracks()||void 0===s.myStream.getVideoTracks()||0===s.myStream.getVideoTracks().length?(n.warn("No video track"),!0):!s.myStream.getVideoTracks()[0].enabled:null===s.myStream.getAudioTracks()||void 0===s.myStream.getAudioTracks()||0===s.myStream.getAudioTracks().length?(n.warn("No audio track"),!0):!s.myStream.getAudioTracks()[0].enabled}function C(e,t,a){var s=Q[e];if(null===s||void 0===s||null===s.webrtcStuff||void 0===s.webrtcStuff)return n.warn("Invalid handle"),!1;var i=s.webrtcStuff;return null===i.pc||void 0===i.pc?(n.warn("Invalid PeerConnection"),!1):void 0===i.myStream||null===i.myStream?(n.warn("Invalid local MediaStream"),!1):t?null===i.myStream.getVideoTracks()||void 0===i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length?(n.warn("No video track"),!1):(i.myStream.getVideoTracks()[0].enabled=a,!0):null===i.myStream.getAudioTracks()||void 0===i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length?(n.warn("No audio track"),!1):(i.myStream.getAudioTracks()[0].enabled=a,!0)}function w(e){var t=Q[e];if(null===t||void 0===t||null===t.webrtcStuff||void 0===t.webrtcStuff)return n.warn("Invalid handle"),"Invalid handle";var a=t.webrtcStuff;if(null===a.pc||void 0===a.pc)return"Invalid PeerConnection";if(a.pc.getStats&&"chrome"==i.browserDetails.browser)return null===a.remoteStream||void 0===a.remoteStream?(n.warn("Remote stream unavailable"),"Remote stream unavailable"):null===a.bitrate.timer||void 0===a.bitrate.timer?(n.log("Starting bitrate timer (Chrome)"),a.bitrate.timer=setInterval(function(){a.pc.getStats(function(e){for(var t=e.result(),n=0;n<t.length;n++){var s=t[n];if("ssrc"==s.type&&s.stat("googFrameHeightReceived"))if(a.bitrate.bsnow=s.stat("bytesReceived"),a.bitrate.tsnow=s.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var i=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/(a.bitrate.tsnow-a.bitrate.tsbefore));a.bitrate.value=i+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}}})},1e3),"0 kbits/sec"):a.bitrate.value;if(a.pc.getStats&&"firefox"==i.browserDetails.browser){if(null===a.remoteStream||void 0===a.remoteStream||null===a.remoteStream.stream||void 0===a.remoteStream.stream)return n.warn("Remote stream unavailable"),"Remote stream unavailable";var s=a.remoteStream.stream.getVideoTracks();return null===s||void 0===s||s.length<1?(n.warn("No video track"),"No video track"):null===a.bitrate.timer||void 0===a.bitrate.timer?(n.log("Starting bitrate timer (Firefox)"),a.bitrate.timer=setInterval(function(){var e=function(e){if(null===e||void 0===e||null==e.inbound_rtp_video_1||null==e.inbound_rtp_video_1)return void(a.bitrate.value="Missing inbound_rtp_video_1");if(a.bitrate.bsnow=e.inbound_rtp_video_1.bytesReceived,a.bitrate.tsnow=e.inbound_rtp_video_1.timestamp,null===a.bitrate.bsbefore||null===a.bitrate.tsbefore)a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow;else{var t=Math.round(8*(a.bitrate.bsnow-a.bitrate.bsbefore)/(a.bitrate.tsnow-a.bitrate.tsbefore));a.bitrate.value=t+" kbits/sec",a.bitrate.bsbefore=a.bitrate.bsnow,a.bitrate.tsbefore=a.bitrate.tsnow}};a.pc.getStats(s[0],function(t){e(t)},e)},1e3),"0 kbits/sec"):a.bitrate.value}return n.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function k(e){n.error("WebRTC error:",e)}function T(e,a){n.log("Cleaning WebRTC stuff");var i=Q[e];if(null!==i&&void 0!==i){var r=i.webrtcStuff;if(null!==r&&void 0!==r){if(!0===a){var o={janus:"hangup",transaction:t(12)};null!==Y&&void 0!==Y&&(o.token=Y),null!==K&&void 0!==K&&(o.apisecret=K),n.debug("Sending hangup request (handle="+e+"):"),n.debug(o),F?(o.session_id=X,o.handle_id=e,x.send(JSON.stringify(o))):s.ajax({type:"POST",url:B+"/"+X+"/"+e,cache:!1,contentType:"application/json",data:JSON.stringify(o),dataType:"json"})}r.remoteStream=null,r.volume.timer&&clearInterval(r.volume.timer),r.volume.value=null,r.bitrate.timer&&clearInterval(r.bitrate.timer),r.bitrate.timer=null,r.bitrate.bsnow=null,r.bitrate.bsbefore=null,r.bitrate.tsnow=null,r.bitrate.tsbefore=null,r.bitrate.value=null;try{r.streamExternal||null===r.myStream||void 0===r.myStream||(n.log("Stopping local stream"),r.myStream.stop())}catch(e){}try{if(!r.streamExternal&&null!==r.myStream&&void 0!==r.myStream){n.log("Stopping local stream tracks");var l=r.myStream.getTracks();for(var d in l){var u=l[d];n.log(u),null!==u&&void 0!==u&&u.stop()}}}catch(e){}r.streamExternal=!1,r.myStream=null;try{r.pc.close()}catch(e){}r.pc=null,r.mySdp=null,r.iceDone=!1,r.sdpSent=!1,r.dataChannel=null,r.dtmfSender=null}i.oncleanup()}}function N(e){return n.debug("isAudioSendEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioSend||null===e.audioSend||!0===e.audioSend)}function P(e){return n.debug("isAudioSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.audio&&!1!==e.audioSend&&(void 0!==e.failIfNoAudio&&null!==e.failIfNoAudio&&!0===e.failIfNoAudio))}function I(e){return n.debug("isAudioRecvEnabled:",e),void 0===e||null===e||!1!==e.audio&&(void 0===e.audioRecv||null===e.audioRecv||!0===e.audioRecv)}function L(e){return n.debug("isVideoSendEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoSend||null===e.videoSend||!0===e.videoSend)}function D(e){return n.debug("isVideoSendRequired:",e),void 0!==e&&null!==e&&(!1!==e.video&&!1!==e.videoSend&&(void 0!==e.failIfNoVideo&&null!==e.failIfNoVideo&&!0===e.failIfNoVideo))}function R(e){return n.debug("isVideoRecvEnabled:",e),void 0===e||null===e||!1!==e.video&&(void 0===e.videoRecv||null===e.videoRecv||!0===e.videoRecv)}function A(e){return n.debug("isDataEnabled:",e),"edge"==i.browserDetails.browser?(n.warn("Edge doesn't support data channels yet"),!1):void 0!==e&&null!==e&&!0===e.data}function O(e){return n.debug("isTrickleEnabled:",e),void 0===e||null===e||!0===e}if(void 0===n.initDone)return e.error("Library not initialized"),{};if(!n.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(n.log("Library initialized: "+n.initDone),e=e||{},e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:n.noop,null===e.server||void 0===e.server)return e.error("Invalid gateway url"),{};var F=!1,x=null,U={},H=null,j=null,G=0,B=e.server;Array.isArray(B)?(n.log("Multiple servers provided ("+B.length+"), will use the first that works"),B=null,j=e.server,n.debug(j)):0===B.indexOf("ws")?(F=!0,n.log("Using WebSockets to contact Janus: "+B)):(F=!1,n.log("Using REST API to contact Janus: "+B));var V=e.iceServers;void 0!==V&&null!==V&&0!==V.length||(V=[{urls:"stun:stun.l.google.com:19302"}],n.log("using ice",V));var z=e.iceTransportPolicy,q=e.ipv6;void 0!==q&&null!==q||(q=!1);var W=null;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(W=e.max_poll_events),W<1&&(W=1);var Y=null;void 0!==e.token&&null!==e.token&&(Y=e.token);var K=null;void 0!==e.apisecret&&null!==e.apisecret&&(K=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var J=!1,X=null,Q={},Z=this,$=0,ee={};l(e),this.getServer=function(){return B},this.isConnected=function(){return J},this.getSessionId=function(){return X},this.destroy=function(e){d(e)},this.attach=function(e){u(e)}}var s=a(0),i=(a(0),a(2470));n.sessions={},n.extensionId="hapfgfdkleiggjjpfpenajgdnfckjpaj",n.isExtensionEnabled=function(){if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||null!==document.getElementById("janus-extension-installed")}return!0},n.noop=function(){},n.init=function(e){function t(e,t){try{if(i)return n.debug(e+" already loaded, skipping"),void t()}catch(e){}var a=document.getElementsByTagName("head").item(0),s=document.createElement("script");s.type="text/javascript",s.src=e,s.onload=function(){n.log("Library "+e+" loaded"),t()},a.appendChild(s)}if(e=e||{},e.callback="function"==typeof e.callback?e.callback:n.noop,!0===n.initDone)e.callback();else{if("undefined"!=typeof console&&void 0!==console.log||(console={log:function(){}}),n.trace=n.noop,n.debug=n.noop,n.vdebug=n.noop,n.log=n.noop,n.warn=n.noop,n.error=n.noop,!0===e.debug||"all"===e.debug)n.trace=console.trace.bind(console),n.debug=console.debug.bind(console),n.vdebug=console.debug.bind(console),n.log=console.log.bind(console),n.warn=console.warn.bind(console),n.error=console.error.bind(console);else if(Array.isArray(e.debug))for(var a in e.debug){var s=e.debug[a];switch(s){case"trace":n.trace=console.trace.bind(console);break;case"debug":n.debug=console.debug.bind(console);break;case"vdebug":n.vdebug=console.debug.bind(console);break;case"log":n.log=console.log.bind(console);break;case"warn":n.warn=console.warn.bind(console);break;case"error":n.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+s+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}n.log("Initializing library"),n.listDevices=function(e){e="function"==typeof e?e:n.noop,navigator.mediaDevices?navigator.mediaDevices.getUserMedia({audio:!0,video:!0}).then(function(t){navigator.mediaDevices.enumerateDevices().then(function(a){n.debug(a),e(a);try{t.stop()}catch(e){}try{var s=t.getTracks();for(var i in s){var r=s[i];null!==r&&void 0!==r&&r.stop()}}catch(e){}})}).catch(function(t){n.error(t),e([])}):(n.warn("navigator.mediaDevices unavailable"),e([]))},n.attachMediaStream=function(e,t){if("chrome"===i.browserDetails.browser){i.browserDetails.version>=43?e.srcObject=t:void 0!==e.src?e.src=URL.createObjectURL(t):n.error("Error attaching stream to element")}else e.srcObject=t},n.reattachMediaStream=function(e,t){if("chrome"===i.browserDetails.browser){i.browserDetails.version>=43?e.srcObject=t.srcObject:void 0!==e.src&&(e.src=t.src)}else e.srcObject=t.srcObject},n.ajax=function(e){if(null!==e&&void 0!==e){if(e.success="function"==typeof e.success?e.success:n.noop,e.error="function"==typeof e.error?e.error:n.noop,null===e.url||void 0===e.url)return n.error("Missing url",e.url),void e.error(null,-1,"Missing url");e.async=null===e.async||void 0===e.async||!0===e.async,n.log(e);var t=new XMLHttpRequest;t.open(e.type,e.url,e.async),null!==e.contentType&&void 0!==e.contentType&&t.setRequestHeader("Content-type",e.contentType),e.async&&(t.onreadystatechange=function(){if(4==t.readyState)return 200!==t.status?(0===t.status&&(t.status="error"),void e.error(t,t.status,"")):void e.success(JSON.parse(t.responseText))});try{if(t.send(e.data),!e.async){if(200!==t.status)return 0===t.status&&(t.status="error"),void e.error(t,t.status,"");e.success(JSON.parse(t.responseText))}}catch(a){e.error(t,"error","")}}};var r=window.onbeforeunload;window.onbeforeunload=function(){n.log("Closing window");for(var e in n.sessions)null!==n.sessions[e]&&void 0!==n.sessions[e]&&n.sessions[e].destroyOnUnload&&(n.log("Destroying session "+e),n.sessions[e].destroy({asyncRequest:!1}));r&&"function"==typeof r&&r()},n.initDone=!0,function(a){function n(){s++,s<a.length?t(a[s],n):e.callback()}a&&Array.isArray(a)&&0!=a.length||e.callback();var s=0;t(a[s],n)}(["adapter.js"])}},n.isWebrtcSupported=function(){return void 0!==window.RTCPeerConnection&&null!==window.RTCPeerConnection&&void 0!==navigator.getUserMedia&&null!==navigator.getUserMedia},e.exports=n},2470:function(e,t,a){(function(t){var n=(a(0),a(0),a(2471));e.exports=n({window:t.window})}).call(t,a(22))},2471:function(e,t,a){var n=(a(0),a(0),a(2167));e.exports=function(e,t){var s=e&&e.window,i={shimChrome:!0,shimFirefox:!0,shimEdge:!0,shimSafari:!0};for(var r in t)hasOwnProperty.call(t,r)&&(i[r]=t[r]);var o=n.log,l=n.detectBrowser(s),d={browserDetails:l,extractVersion:n.extractVersion,disableLog:n.disableLog,disableWarnings:n.disableWarnings},u=a(2472)||null,c=a(2474)||null,f=a(2477)||null,m=a(2479)||null,h=a(2480)||null;switch(l.browser){case"chrome":if(!u||!u.shimPeerConnection||!i.shimChrome)return o("Chrome shim is not included in this adapter release."),d;o("adapter.js shimming chrome."),d.browserShim=u,h.shimCreateObjectURL(s),u.shimGetUserMedia(s),u.shimMediaStream(s),u.shimSourceObject(s),u.shimPeerConnection(s),u.shimOnTrack(s),u.shimAddTrackRemoveTrack(s),u.shimGetSendersWithDtmf(s),h.shimRTCIceCandidate(s);break;case"firefox":if(!f||!f.shimPeerConnection||!i.shimFirefox)return o("Firefox shim is not included in this adapter release."),d;o("adapter.js shimming firefox."),d.browserShim=f,h.shimCreateObjectURL(s),f.shimGetUserMedia(s),f.shimSourceObject(s),f.shimPeerConnection(s),f.shimOnTrack(s),h.shimRTCIceCandidate(s);break;case"edge":if(!c||!c.shimPeerConnection||!i.shimEdge)return o("MS edge shim is not included in this adapter release."),d;o("adapter.js shimming edge."),d.browserShim=c,h.shimCreateObjectURL(s),c.shimGetUserMedia(s),c.shimPeerConnection(s),c.shimReplaceTrack(s);break;case"safari":if(!m||!i.shimSafari)return o("Safari shim is not included in this adapter release."),d;o("adapter.js shimming safari."),d.browserShim=m,h.shimCreateObjectURL(s),m.shimRTCIceServerUrls(s),m.shimCallbacksAPI(s),m.shimLocalStreamsAPI(s),m.shimRemoteStreamsAPI(s),m.shimTrackEventTransceiver(s),m.shimGetUserMedia(s),h.shimRTCIceCandidate(s);break;default:o("Unsupported browser!")}return d}},2472:function(e,t,a){var n=(a(0),a(0),a(2167)),s=n.log,i={shimMediaStream:function(e){e.MediaStream=e.MediaStream||e.webkitMediaStream},shimOnTrack:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=e)}});var t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){var a=this;return a._ontrackpoly||(a._ontrackpoly=function(t){t.stream.addEventListener("addtrack",function(n){var s;s=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(e){return e.track&&e.track.id===n.track.id}):{track:n.track};var i=new Event("track");i.track=n.track,i.receiver=s,i.transceiver={receiver:s},i.streams=[t.stream],a.dispatchEvent(i)}),t.stream.getTracks().forEach(function(n){var s;s=e.RTCPeerConnection.prototype.getReceivers?a.getReceivers().find(function(e){return e.track&&e.track.id===n.id}):{track:n};var i=new Event("track");i.track=n,i.receiver=s,i.transceiver={receiver:s},i.streams=[t.stream],a.dispatchEvent(i)})},a.addEventListener("addstream",a._ontrackpoly)),t.apply(a,arguments)}}},shimGetSendersWithDtmf:function(e){if("object"==typeof e&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){var t=function(e,t){return{track:t,get dtmf(){return void 0===this._dtmf&&("audio"===t.kind?this._dtmf=e.createDTMFSender(t):this._dtmf=null),this._dtmf},_pc:e}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};var a=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(e,n){var s=this,i=a.apply(s,arguments);return i||(i=t(s,e),s._senders.push(i)),i};var n=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;n.apply(t,arguments);var a=t._senders.indexOf(e);-1!==a&&t._senders.splice(a,1)}}var s=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(e){var a=this;a._senders=a._senders||[],s.apply(a,[e]),e.getTracks().forEach(function(e){a._senders.push(t(a,e))})};var i=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._senders=t._senders||[],i.apply(t,[t._streams[e.id]||e]),e.getTracks().forEach(function(e){var a=t._senders.find(function(t){return t.track===e});a&&t._senders.splice(t._senders.indexOf(a),1)})}}else if("object"==typeof e&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){var r=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){var e=this,t=r.apply(e,[]);return t.forEach(function(t){t._pc=e}),t},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}},shimSourceObject:function(e){var t=e&&e.URL;"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this._srcObject},set:function(e){var a=this;if(this._srcObject=e,this.src&&t.revokeObjectURL(this.src),!e)return void(this.src="");this.src=t.createObjectURL(e),e.addEventListener("addtrack",function(){a.src&&t.revokeObjectURL(a.src),a.src=t.createObjectURL(e)}),e.addEventListener("removetrack",function(){a.src&&t.revokeObjectURL(a.src),a.src=t.createObjectURL(e)})}}))},shimAddTrackRemoveTrack:function(e){function t(e,t){var a=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],s=e._streams[n.id];a=a.replace(new RegExp(s.id,"g"),n.id)}),new RTCSessionDescription({type:t.type,sdp:a})}function a(e,t){var a=t.sdp;return Object.keys(e._reverseStreams||[]).forEach(function(t){var n=e._reverseStreams[t],s=e._streams[n.id];a=a.replace(new RegExp(n.id,"g"),s.id)}),new RTCSessionDescription({type:t.type,sdp:a})}var s=n.detectBrowser(e);if(!(e.RTCPeerConnection.prototype.addTrack&&s.version>=62)){var i=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){var e=this,t=i.apply(this);return e._reverseStreams=e._reverseStreams||{},t.map(function(t){return e._reverseStreams[t.id]})};var r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(t){var a=this;if(a._streams=a._streams||{},a._reverseStreams=a._reverseStreams||{},t.getTracks().forEach(function(e){if(a.getSenders().find(function(t){return t.track===e}))throw new DOMException("Track already exists.","InvalidAccessError")}),!a._reverseStreams[t.id]){var n=new e.MediaStream(t.getTracks());a._streams[t.id]=n,a._reverseStreams[n.id]=t,t=n}r.apply(a,[t])};var o=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(e){var t=this;t._streams=t._streams||{},t._reverseStreams=t._reverseStreams||{},o.apply(t,[t._streams[e.id]||e]),delete t._reverseStreams[t._streams[e.id]?t._streams[e.id].id:e.id],delete t._streams[e.id]},e.RTCPeerConnection.prototype.addTrack=function(t,a){var n=this;if("closed"===n.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");var s=[].slice.call(arguments,1);if(1!==s.length||!s[0].getTracks().find(function(e){return e===t}))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(n.getSenders().find(function(e){return e.track===t}))throw new DOMException("Track already exists.","InvalidAccessError");n._streams=n._streams||{},n._reverseStreams=n._reverseStreams||{};var i=n._streams[a.id];if(i)i.addTrack(t),Promise.resolve().then(function(){n.dispatchEvent(new Event("negotiationneeded"))});else{var r=new e.MediaStream([t]);n._streams[a.id]=r,n._reverseStreams[r.id]=a,n.addStream(r)}return n.getSenders().find(function(e){return e.track===t})},["createOffer","createAnswer"].forEach(function(a){var n=e.RTCPeerConnection.prototype[a];e.RTCPeerConnection.prototype[a]=function(){var e=this,a=arguments;return arguments.length&&"function"==typeof arguments[0]?n.apply(e,[function(n){var s=t(e,n);a[0].apply(null,[s])},function(e){a[1]&&a[1].apply(null,e)},arguments[2]]):n.apply(e,arguments).then(function(a){return t(e,a)})}});var l=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){var e=this;return arguments.length&&arguments[0].type?(arguments[0]=a(e,arguments[0]),l.apply(e,arguments)):l.apply(e,arguments)};var d=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get:function(){var e=this,a=d.get.apply(this);return""===a.type?a:t(e,a)}}),e.RTCPeerConnection.prototype.removeTrack=function(e){var t=this;if("closed"===t.signalingState)throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!e._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(e._pc!==t)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");t._streams=t._streams||{};var a;Object.keys(t._streams).forEach(function(n){t._streams[n].getTracks().find(function(t){return e.track===t})&&(a=t._streams[n])}),a&&(1===a.getTracks().length?t.removeStream(a):a.removeTrack(e.track),t.dispatchEvent(new Event("negotiationneeded")))}}},shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCPeerConnection){var a=e.RTCPeerConnection;e.RTCPeerConnection=function(e,t){if(e&&e.iceServers){for(var s=[],i=0;i<e.iceServers.length;i++){var r=e.iceServers[i];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,s.push(r)):s.push(e.iceServers[i])}e.iceServers=s}return new a(e,t)},e.RTCPeerConnection.prototype=a.prototype,Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return a.generateCertificate}})}else e.RTCPeerConnection=function(t,a){return s("PeerConnection"),t&&t.iceTransportPolicy&&(t.iceTransports=t.iceTransportPolicy),new e.webkitRTCPeerConnection(t,a)},e.RTCPeerConnection.prototype=e.webkitRTCPeerConnection.prototype,e.webkitRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.webkitRTCPeerConnection.generateCertificate}});var i=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,t,a){var n=this,s=arguments;if(arguments.length>0&&"function"==typeof e)return i.apply(this,arguments);if(0===i.length&&(0===arguments.length||"function"!=typeof arguments[0]))return i.apply(this,[]);var r=function(e){var t={};return e.result().forEach(function(e){var a={id:e.id,timestamp:e.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};e.names().forEach(function(t){a[t]=e.stat(t)}),t[a.id]=a}),t},o=function(e){return new Map(Object.keys(e).map(function(t){return[t,e[t]]}))};if(arguments.length>=2){var l=function(e){s[1](o(r(e)))};return i.apply(this,[l,arguments[0]])}return new Promise(function(e,t){i.apply(n,[function(t){e(o(r(t)))},t])}).then(t,a)},t.version<51&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=arguments,t=this,n=new Promise(function(n,s){a.apply(t,[e[0],n,s])});return e.length<2?n:n.then(function(){e[1].apply(null,[])},function(t){e.length>=3&&e[2].apply(null,[t])})}}),t.version<52&&["createOffer","createAnswer"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){var e=this;if(arguments.length<1||1===arguments.length&&"object"==typeof arguments[0]){var t=1===arguments.length?arguments[0]:void 0;return new Promise(function(n,s){a.apply(e,[n,s,t])})}return a.apply(this,arguments)}}),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}});var r=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?r.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())}}};e.exports={shimMediaStream:i.shimMediaStream,shimOnTrack:i.shimOnTrack,shimAddTrackRemoveTrack:i.shimAddTrackRemoveTrack,shimGetSendersWithDtmf:i.shimGetSendersWithDtmf,shimSourceObject:i.shimSourceObject,shimPeerConnection:i.shimPeerConnection,shimGetUserMedia:a(2473)}},2473:function(e,t,a){var n=(a(0),a(0),a(2167)),s=n.log;e.exports=function(e){var t=n.detectBrowser(e),a=e&&e.navigator,i=function(e){if("object"!=typeof e||e.mandatory||e.optional)return e;var t={};return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var n="object"==typeof e[a]?e[a]:{ideal:e[a]};void 0!==n.exact&&"number"==typeof n.exact&&(n.min=n.max=n.exact);var s=function(e,t){return e?e+t.charAt(0).toUpperCase()+t.slice(1):"deviceId"===t?"sourceId":t};if(void 0!==n.ideal){t.optional=t.optional||[];var i={};"number"==typeof n.ideal?(i[s("min",a)]=n.ideal,t.optional.push(i),i={},i[s("max",a)]=n.ideal,t.optional.push(i)):(i[s("",a)]=n.ideal,t.optional.push(i))}void 0!==n.exact&&"number"!=typeof n.exact?(t.mandatory=t.mandatory||{},t.mandatory[s("",a)]=n.exact):["min","max"].forEach(function(e){void 0!==n[e]&&(t.mandatory=t.mandatory||{},t.mandatory[s(e,a)]=n[e])})}}),e.advanced&&(t.optional=(t.optional||[]).concat(e.advanced)),t},r=function(e,n){if((e=JSON.parse(JSON.stringify(e)))&&"object"==typeof e.audio){var r=function(e,t,a){t in e&&!(a in e)&&(e[a]=e[t],delete e[t])};e=JSON.parse(JSON.stringify(e)),r(e.audio,"autoGainControl","googAutoGainControl"),r(e.audio,"noiseSuppression","googNoiseSuppression"),e.audio=i(e.audio)}if(e&&"object"==typeof e.video){var o=e.video.facingMode;o=o&&("object"==typeof o?o:{ideal:o});var l=t.version<61;if(o&&("user"===o.exact||"environment"===o.exact||"user"===o.ideal||"environment"===o.ideal)&&(!a.mediaDevices.getSupportedConstraints||!a.mediaDevices.getSupportedConstraints().facingMode||l)){delete e.video.facingMode;var d;if("environment"===o.exact||"environment"===o.ideal?d=["back","rear"]:"user"!==o.exact&&"user"!==o.ideal||(d=["front"]),d)return a.mediaDevices.enumerateDevices().then(function(t){t=t.filter(function(e){return"videoinput"===e.kind});var a=t.find(function(e){return d.some(function(t){return-1!==e.label.toLowerCase().indexOf(t)})});return!a&&t.length&&-1!==d.indexOf("back")&&(a=t[t.length-1]),a&&(e.video.deviceId=o.exact?{exact:a.deviceId}:{ideal:a.deviceId}),e.video=i(e.video),s("chrome: "+JSON.stringify(e)),n(e)})}e.video=i(e.video)}return s("chrome: "+JSON.stringify(e)),n(e)},o=function(e){return{name:{PermissionDeniedError:"NotAllowedError",InvalidStateError:"NotReadableError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotReadableError",MediaDeviceKillSwitchOn:"NotReadableError"}[e.name]||e.name,message:e.message,constraint:e.constraintName,toString:function(){return this.name+(this.message&&": ")+this.message}}},l=function(e,t,n){r(e,function(e){a.webkitGetUserMedia(e,t,function(e){n&&n(o(e))})})};a.getUserMedia=l;var d=function(e){return new Promise(function(t,n){a.getUserMedia(e,t,n)})};if(a.mediaDevices||(a.mediaDevices={getUserMedia:d,enumerateDevices:function(){return new Promise(function(t){var a={audio:"audioinput",video:"videoinput"};return e.MediaStreamTrack.getSources(function(e){t(e.map(function(e){return{label:e.label,kind:a[e.kind],deviceId:e.id,groupId:""}}))})})},getSupportedConstraints:function(){return{deviceId:!0,echoCancellation:!0,facingMode:!0,frameRate:!0,height:!0,width:!0}}}),a.mediaDevices.getUserMedia){var u=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return r(e,function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("","NotFoundError");return t},function(e){return Promise.reject(o(e))})})}}else a.mediaDevices.getUserMedia=function(e){return d(e)};void 0===a.mediaDevices.addEventListener&&(a.mediaDevices.addEventListener=function(){s("Dummy mediaDevices.addEventListener called.")}),void 0===a.mediaDevices.removeEventListener&&(a.mediaDevices.removeEventListener=function(){s("Dummy mediaDevices.removeEventListener called.")})}},2474:function(e,t,a){var n=(a(0),a(0),a(2167)),s=a(2475);e.exports={shimGetUserMedia:a(2476),shimPeerConnection:function(e){var t=n.detectBrowser(e);if(e.RTCIceGatherer&&(e.RTCIceCandidate||(e.RTCIceCandidate=function(e){return e}),e.RTCSessionDescription||(e.RTCSessionDescription=function(e){return e}),t.version<15025)){var a=Object.getOwnPropertyDescriptor(e.MediaStreamTrack.prototype,"enabled");Object.defineProperty(e.MediaStreamTrack.prototype,"enabled",{set:function(e){a.set.call(this,e);var t=new Event("enabled");t.enabled=e,this.dispatchEvent(t)}})}!e.RTCRtpSender||"dtmf"in e.RTCRtpSender.prototype||Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get:function(){return void 0===this._dtmf&&("audio"===this.track.kind?this._dtmf=new e.RTCDtmfSender(this):"video"===this.track.kind&&(this._dtmf=null)),this._dtmf}}),e.RTCPeerConnection=s(e,t.version)},shimReplaceTrack:function(e){!e.RTCRtpSender||"replaceTrack"in e.RTCRtpSender.prototype||(e.RTCRtpSender.prototype.replaceTrack=e.RTCRtpSender.prototype.setTrack)}}},2475:function(e,t,a){function n(e,t,a,n,s){var i=l.writeRtpDescription(e.kind,t);if(i+=l.writeIceParameters(e.iceGatherer.getLocalParameters()),i+=l.writeDtlsParameters(e.dtlsTransport.getLocalParameters(),"offer"===a?"actpass":s||"active"),i+="a=mid:"+e.mid+"\r\n",e.direction?i+="a="+e.direction+"\r\n":e.rtpSender&&e.rtpReceiver?i+="a=sendrecv\r\n":e.rtpSender?i+="a=sendonly\r\n":e.rtpReceiver?i+="a=recvonly\r\n":i+="a=inactive\r\n",e.rtpSender){var r="msid:"+n.id+" "+e.rtpSender.track.id+"\r\n";i+="a="+r,i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" "+r,e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" "+r,i+="a=ssrc-group:FID "+e.sendEncodingParameters[0].ssrc+" "+e.sendEncodingParameters[0].rtx.ssrc+"\r\n")}return i+="a=ssrc:"+e.sendEncodingParameters[0].ssrc+" cname:"+l.localCName+"\r\n",e.rtpSender&&e.sendEncodingParameters[0].rtx&&(i+="a=ssrc:"+e.sendEncodingParameters[0].rtx.ssrc+" cname:"+l.localCName+"\r\n"),i}function s(e,t){var a=!1;return e=JSON.parse(JSON.stringify(e)),e.filter(function(e){if(e&&(e.urls||e.url)){var n=e.urls||e.url;e.url&&!e.urls&&console.warn("RTCIceServer.url is deprecated! Use urls instead.");var s="string"==typeof n;return s&&(n=[n]),n=n.filter(function(e){return 0!==e.indexOf("turn:")||-1===e.indexOf("transport=udp")||-1!==e.indexOf("turn:[")||a?0===e.indexOf("stun:")&&t>=14393&&-1===e.indexOf("?transport=udp"):(a=!0,!0)}),delete e.url,e.urls=s?n[0]:n,!!n.length}return!1})}function i(e,t){var a={codecs:[],headerExtensions:[],fecMechanisms:[]},n=function(e,t){e=parseInt(e,10);for(var a=0;a<t.length;a++)if(t[a].payloadType===e||t[a].preferredPayloadType===e)return t[a]},s=function(e,t,a,s){var i=n(e.parameters.apt,a),r=n(t.parameters.apt,s);return i&&r&&i.name.toLowerCase()===r.name.toLowerCase()};return e.codecs.forEach(function(n){for(var i=0;i<t.codecs.length;i++){var r=t.codecs[i];if(n.name.toLowerCase()===r.name.toLowerCase()&&n.clockRate===r.clockRate){if("rtx"===n.name.toLowerCase()&&n.parameters&&r.parameters.apt&&!s(n,r,e.codecs,t.codecs))continue;r=JSON.parse(JSON.stringify(r)),r.numChannels=Math.min(n.numChannels,r.numChannels),a.codecs.push(r),r.rtcpFeedback=r.rtcpFeedback.filter(function(e){for(var t=0;t<n.rtcpFeedback.length;t++)if(n.rtcpFeedback[t].type===e.type&&n.rtcpFeedback[t].parameter===e.parameter)return!0;return!1});break}}}),e.headerExtensions.forEach(function(e){for(var n=0;n<t.headerExtensions.length;n++){var s=t.headerExtensions[n];if(e.uri===s.uri){a.headerExtensions.push(s);break}}}),a}function r(e,t,a){return-1!=={offer:{setLocalDescription:["stable","have-local-offer"],setRemoteDescription:["stable","have-remote-offer"]},answer:{setLocalDescription:["have-remote-offer","have-local-pranswer"],setRemoteDescription:["have-local-offer","have-remote-pranswer"]}}[t][e].indexOf(a)}function o(e,t){var a=e.getRemoteCandidates().find(function(e){return t.foundation===e.foundation&&t.ip===e.ip&&t.port===e.port&&t.priority===e.priority&&t.protocol===e.protocol&&t.type===e.type});return a||e.addRemoteCandidate(t),!a}var l=(a(0),a(0),a(2199));e.exports=function(e,t){var a=function(a){var n=this,i=document.createDocumentFragment();if(["addEventListener","removeEventListener","dispatchEvent"].forEach(function(e){n[e]=i[e].bind(i)}),this.onicecandidate=null,this.onaddstream=null,this.ontrack=null,this.onremovestream=null,this.onsignalingstatechange=null,this.oniceconnectionstatechange=null,this.onicegatheringstatechange=null,this.onnegotiationneeded=null,this.ondatachannel=null,this.canTrickleIceCandidates=null,this.needNegotiation=!1,this.localStreams=[],this.remoteStreams=[],this.localDescription=null,this.remoteDescription=null,this.signalingState="stable",this.iceConnectionState="new",this.iceGatheringState="new",a=JSON.parse(JSON.stringify(a||{})),this.usingBundle="max-bundle"===a.bundlePolicy,"negotiate"===a.rtcpMuxPolicy){var r=new Error("rtcpMuxPolicy 'negotiate' is not supported");throw r.name="NotSupportedError",r}switch(a.rtcpMuxPolicy||(a.rtcpMuxPolicy="require"),a.iceTransportPolicy){case"all":case"relay":break;default:a.iceTransportPolicy="all"}switch(a.bundlePolicy){case"balanced":case"max-compat":case"max-bundle":break;default:a.bundlePolicy="balanced"}if(a.iceServers=s(a.iceServers||[],t),this._iceGatherers=[],a.iceCandidatePoolSize)for(var o=a.iceCandidatePoolSize;o>0;o--)this._iceGatherers=new e.RTCIceGatherer({iceServers:a.iceServers,gatherPolicy:a.iceTransportPolicy});else a.iceCandidatePoolSize=0;this._config=a,this.transceivers=[],this._sdpSessionId=l.generateSessionId(),this._sdpSessionVersion=0,this._dtlsRole=void 0};return a.prototype._emitGatheringStateChange=function(){var e=new Event("icegatheringstatechange");this.dispatchEvent(e),"function"==typeof this.onicegatheringstatechange&&this.onicegatheringstatechange(e)},a.prototype.getConfiguration=function(){return this._config},a.prototype.getLocalStreams=function(){return this.localStreams},a.prototype.getRemoteStreams=function(){return this.remoteStreams},a.prototype._createTransceiver=function(e){var t=this.transceivers.length>0,a={track:null,iceGatherer:null,iceTransport:null,dtlsTransport:null,localCapabilities:null,remoteCapabilities:null,rtpSender:null,rtpReceiver:null,kind:e,mid:null,sendEncodingParameters:null,recvEncodingParameters:null,stream:null,wantReceive:!0};if(this.usingBundle&&t)a.iceTransport=this.transceivers[0].iceTransport,a.dtlsTransport=this.transceivers[0].dtlsTransport;else{var n=this._createIceAndDtlsTransports();a.iceTransport=n.iceTransport,a.dtlsTransport=n.dtlsTransport}return this.transceivers.push(a),a},a.prototype.addTrack=function(t,a){for(var n,s=0;s<this.transceivers.length;s++)this.transceivers[s].track||this.transceivers[s].kind!==t.kind||(n=this.transceivers[s]);return n||(n=this._createTransceiver(t.kind)),this._maybeFireNegotiationNeeded(),-1===this.localStreams.indexOf(a)&&this.localStreams.push(a),n.track=t,n.stream=a,n.rtpSender=new e.RTCRtpSender(t,n.dtlsTransport),n.rtpSender},a.prototype.addStream=function(e){var a=this;if(t>=15025)e.getTracks().forEach(function(t){a.addTrack(t,e)});else{var n=e.clone();e.getTracks().forEach(function(e,t){var a=n.getTracks()[t];e.addEventListener("enabled",function(e){a.enabled=e.enabled})}),n.getTracks().forEach(function(e){a.addTrack(e,n)})}},a.prototype.removeStream=function(e){var t=this.localStreams.indexOf(e);t>-1&&(this.localStreams.splice(t,1),this._maybeFireNegotiationNeeded())},a.prototype.getSenders=function(){return this.transceivers.filter(function(e){return!!e.rtpSender}).map(function(e){return e.rtpSender})},a.prototype.getReceivers=function(){return this.transceivers.filter(function(e){return!!e.rtpReceiver}).map(function(e){return e.rtpReceiver})},a.prototype._createIceGatherer=function(t,a){var n=this;if(a&&t>0)return this.transceivers[0].iceGatherer;if(this._iceGatherers.length)return this._iceGatherers.shift();var s=new e.RTCIceGatherer({iceServers:this._config.iceServers,gatherPolicy:this._config.iceTransportPolicy});return Object.defineProperty(s,"state",{value:"new",writable:!0}),this.transceivers[t].candidates=[],this.transceivers[t].bufferCandidates=function(e){var a=!e.candidate||0===Object.keys(e.candidate).length;s.state=a?"completed":"gathering",null!==n.transceivers[t].candidates&&n.transceivers[t].candidates.push(e.candidate)},s.addEventListener("localcandidate",this.transceivers[t].bufferCandidates),s},a.prototype._gather=function(t,a){var n=this,s=this.transceivers[a].iceGatherer;if(!s.onlocalcandidate){var i=this.transceivers[a].candidates;this.transceivers[a].candidates=null,s.removeEventListener("localcandidate",this.transceivers[a].bufferCandidates),s.onlocalcandidate=function(e){if(!(n.usingBundle&&a>0)){var i=new Event("icecandidate");i.candidate={sdpMid:t,sdpMLineIndex:a};var r=e.candidate,o=!r||0===Object.keys(r).length;o?"new"!==s.state&&"gathering"!==s.state||(s.state="completed"):("new"===s.state&&(s.state="gathering"),r.component=1,i.candidate.candidate=l.writeCandidate(r));var d=l.splitSections(n.localDescription.sdp);d[i.candidate.sdpMLineIndex+1]+=o?"a=end-of-candidates\r\n":"a="+i.candidate.candidate+"\r\n",n.localDescription.sdp=d.join("");var u=n.transceivers.every(function(e){return e.iceGatherer&&"completed"===e.iceGatherer.state});"gathering"!==n.iceGatheringState&&(n.iceGatheringState="gathering",n._emitGatheringStateChange()),o||(n.dispatchEvent(i),"function"==typeof n.onicecandidate&&n.onicecandidate(i)),u&&(n.dispatchEvent(new Event("icecandidate")),"function"==typeof n.onicecandidate&&n.onicecandidate(new Event("icecandidate")),n.iceGatheringState="complete",n._emitGatheringStateChange())}},e.setTimeout(function(){i.forEach(function(e){var t=new Event("RTCIceGatherEvent");t.candidate=e,s.onlocalcandidate(t)})},0)}},a.prototype._createIceAndDtlsTransports=function(){var t=this,a=new e.RTCIceTransport(null);a.onicestatechange=function(){t._updateConnectionState()};var n=new e.RTCDtlsTransport(a);return n.ondtlsstatechange=function(){t._updateConnectionState()},n.onerror=function(){Object.defineProperty(n,"state",{value:"failed",writable:!0}),t._updateConnectionState()},{iceTransport:a,dtlsTransport:n}},a.prototype._disposeIceAndDtlsTransports=function(e){var t=this.transceivers[e].iceGatherer;t&&(delete t.onlocalcandidate,delete this.transceivers[e].iceGatherer);var a=this.transceivers[e].iceTransport;a&&(delete a.onicestatechange,delete this.transceivers[e].iceTransport);var n=this.transceivers[e].dtlsTransport;n&&(delete n.ondtlsstatechange,delete n.onerror,delete this.transceivers[e].dtlsTransport)},a.prototype._transceive=function(e,a,n){var s=i(e.localCapabilities,e.remoteCapabilities);a&&e.rtpSender&&(s.encodings=e.sendEncodingParameters,s.rtcp={cname:l.localCName,compound:e.rtcpParameters.compound},e.recvEncodingParameters.length&&(s.rtcp.ssrc=e.recvEncodingParameters[0].ssrc),e.rtpSender.send(s)),n&&e.rtpReceiver&&s.codecs.length>0&&("video"===e.kind&&e.recvEncodingParameters&&t<15019&&e.recvEncodingParameters.forEach(function(e){delete e.rtx}),s.encodings=e.recvEncodingParameters,s.rtcp={cname:e.rtcpParameters.cname,compound:e.rtcpParameters.compound},e.sendEncodingParameters.length&&(s.rtcp.ssrc=e.sendEncodingParameters[0].ssrc),e.rtpReceiver.receive(s))},a.prototype.setLocalDescription=function(e){var t=this,a=arguments;if(!r("setLocalDescription",e.type,this.signalingState))return new Promise(function(n,s){var i=new Error("Can not set local "+e.type+" in state "+t.signalingState);i.name="InvalidStateError",a.length>2&&"function"==typeof a[2]&&a[2].apply(null,[i]),s(i)});var n,s;if("offer"===e.type)n=l.splitSections(e.sdp),s=n.shift(),n.forEach(function(e,a){var n=l.parseRtpParameters(e);t.transceivers[a].localCapabilities=n}),this.transceivers.forEach(function(e,a){t._gather(e.mid,a)});else if("answer"===e.type){n=l.splitSections(t.remoteDescription.sdp),s=n.shift();var o=l.matchPrefix(s,"a=ice-lite").length>0;n.forEach(function(e,a){var n=t.transceivers[a],r=n.iceGatherer,d=n.iceTransport,u=n.dtlsTransport,c=n.localCapabilities,f=n.remoteCapabilities;if(!(l.isRejected(e)&&1===!l.matchPrefix(e,"a=bundle-only").length||n.isDatachannel)){var m=l.getIceParameters(e,s),h=l.getDtlsParameters(e,s);o&&(h.role="server"),t.usingBundle&&0!==a||(t._gather(n.mid,a),"new"===d.state&&d.start(r,m,o?"controlling":"controlled"),"new"===u.state&&u.start(h));var p=i(c,f);t._transceive(n,p.codecs.length>0,!1)}})}switch(this.localDescription={type:e.type,sdp:e.sdp},e.type){case"offer":this._updateSignalingState("have-local-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+e.type+'"')}var d=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1];return new Promise(function(e){d&&d.apply(null),e()})},a.prototype.setRemoteDescription=function(a){var n=this,s=arguments;if(!r("setRemoteDescription",a.type,this.signalingState))return new Promise(function(e,t){var i=new Error("Can not set remote "+a.type+" in state "+n.signalingState);i.name="InvalidStateError",s.length>2&&"function"==typeof s[2]&&s[2].apply(null,[i]),t(i)});var i={};this.remoteStreams.forEach(function(e){i[e.id]=e});var d=[],u=l.splitSections(a.sdp),c=u.shift(),f=l.matchPrefix(c,"a=ice-lite").length>0,m=l.matchPrefix(c,"a=group:BUNDLE ").length>0;this.usingBundle=m;var h=l.matchPrefix(c,"a=ice-options:")[0];switch(this.canTrickleIceCandidates=!!h&&h.substr(14).split(" ").indexOf("trickle")>=0,u.forEach(function(s,r){var u=l.splitLines(s),h=l.getKind(s),p=l.isRejected(s)&&1===!l.matchPrefix(s,"a=bundle-only").length,g=u[0].substr(2).split(" ")[2],v=l.getDirection(s,c),E=l.parseMsid(s),b=l.getMid(s)||l.generateIdentifier();if("application"===h&&"DTLS/SCTP"===g)return void(n.transceivers[r]={mid:b,isDatachannel:!0});var y,S,_,M,C,w,k,T,N,P,I,L=l.parseRtpParameters(s);p||(P=l.getIceParameters(s,c),I=l.getDtlsParameters(s,c),I.role="client"),k=l.parseRtpEncodingParameters(s);var D=l.parseRtcpParameters(s),R=l.matchPrefix(s,"a=end-of-candidates",c).length>0,A=l.matchPrefix(s,"a=candidate:").map(function(e){return l.parseCandidate(e)}).filter(function(e){return 1===e.component});if(("offer"===a.type||"answer"===a.type)&&!p&&m&&r>0&&n.transceivers[r]&&(n._disposeIceAndDtlsTransports(r),n.transceivers[r].iceGatherer=n.transceivers[0].iceGatherer,n.transceivers[r].iceTransport=n.transceivers[0].iceTransport,n.transceivers[r].dtlsTransport=n.transceivers[0].dtlsTransport,n.transceivers[r].rtpSender&&n.transceivers[r].rtpSender.setTransport(n.transceivers[0].dtlsTransport),n.transceivers[r].rtpReceiver&&n.transceivers[r].rtpReceiver.setTransport(n.transceivers[0].dtlsTransport)),"offer"!==a.type||p)"answer"!==a.type||p||(y=n.transceivers[r],S=y.iceGatherer,_=y.iceTransport,M=y.dtlsTransport,C=y.rtpReceiver,w=y.sendEncodingParameters,T=y.localCapabilities,n.transceivers[r].recvEncodingParameters=k,n.transceivers[r].remoteCapabilities=L,n.transceivers[r].rtcpParameters=D,A.length&&"new"===_.state&&(!f&&!R||m&&0!==r?A.forEach(function(e){o(y.iceTransport,e)}):_.setRemoteCandidates(A)),m&&0!==r||("new"===_.state&&_.start(S,P,"controlling"),"new"===M.state&&M.start(I)),n._transceive(y,"sendrecv"===v||"recvonly"===v,"sendrecv"===v||"sendonly"===v),!C||"sendrecv"!==v&&"sendonly"!==v?delete y.rtpReceiver:(N=C.track,E?(i[E.stream]||(i[E.stream]=new e.MediaStream),i[E.stream].addTrack(N),d.push([N,C,i[E.stream]])):(i.default||(i.default=new e.MediaStream),i.default.addTrack(N),d.push([N,C,i.default]))));else{y=n.transceivers[r]||n._createTransceiver(h),y.mid=b,y.iceGatherer||(y.iceGatherer=n._createIceGatherer(r,m)),A.length&&"new"===y.iceTransport.state&&(!R||m&&0!==r?A.forEach(function(e){o(y.iceTransport,e)}):y.iceTransport.setRemoteCandidates(A)),T=e.RTCRtpReceiver.getCapabilities(h),t<15019&&(T.codecs=T.codecs.filter(function(e){return"rtx"!==e.name})),w=y.sendEncodingParameters||[{ssrc:1001*(2*r+2)}];var O=!1;if(("sendrecv"===v||"sendonly"===v)&&(O=!y.rtpReceiver,C=y.rtpReceiver||new e.RTCRtpReceiver(y.dtlsTransport,h),O)){var F;N=C.track,E?(i[E.stream]||(i[E.stream]=new e.MediaStream,Object.defineProperty(i[E.stream],"id",{get:function(){return E.stream}})),Object.defineProperty(N,"id",{get:function(){return E.track}}),F=i[E.stream]):(i.default||(i.default=new e.MediaStream),F=i.default),F.addTrack(N),d.push([N,C,F])}y.localCapabilities=T,y.remoteCapabilities=L,y.rtpReceiver=C,y.rtcpParameters=D,y.sendEncodingParameters=w,y.recvEncodingParameters=k,n._transceive(n.transceivers[r],!1,O)}}),void 0===this._dtlsRole&&(this._dtlsRole="offer"===a.type?"active":"passive"),this.remoteDescription={type:a.type,sdp:a.sdp},a.type){case"offer":this._updateSignalingState("have-remote-offer");break;case"answer":this._updateSignalingState("stable");break;default:throw new TypeError('unsupported type "'+a.type+'"')}return Object.keys(i).forEach(function(t){var a=i[t];if(a.getTracks().length){if(-1===n.remoteStreams.indexOf(a)){n.remoteStreams.push(a);var s=new Event("addstream");s.stream=a,e.setTimeout(function(){n.dispatchEvent(s),"function"==typeof n.onaddstream&&n.onaddstream(s)})}d.forEach(function(t){var s=t[0],i=t[1];if(a.id===t[2].id){var r=new Event("track");r.track=s,r.receiver=i,r.transceiver={receiver:i},r.streams=[a],e.setTimeout(function(){n.dispatchEvent(r),"function"==typeof n.ontrack&&n.ontrack(r)})}})}}),e.setTimeout(function(){n&&n.transceivers&&n.transceivers.forEach(function(e){e.iceTransport&&"new"===e.iceTransport.state&&e.iceTransport.getRemoteCandidates().length>0&&(console.warn("Timeout for addRemoteCandidate. Consider sending an end-of-candidates notification"),e.iceTransport.addRemoteCandidate({}))})},4e3),new Promise(function(e){s.length>1&&"function"==typeof s[1]&&s[1].apply(null),e()})},a.prototype.close=function(){this.transceivers.forEach(function(e){e.iceTransport&&e.iceTransport.stop(),e.dtlsTransport&&e.dtlsTransport.stop(),e.rtpSender&&e.rtpSender.stop(),e.rtpReceiver&&e.rtpReceiver.stop()}),this._updateSignalingState("closed")},a.prototype._updateSignalingState=function(e){this.signalingState=e;var t=new Event("signalingstatechange");this.dispatchEvent(t),"function"==typeof this.onsignalingstatechange&&this.onsignalingstatechange(t)},a.prototype._maybeFireNegotiationNeeded=function(){var t=this;"stable"===this.signalingState&&!0!==this.needNegotiation&&(this.needNegotiation=!0,e.setTimeout(function(){if(!1!==t.needNegotiation){t.needNegotiation=!1;var e=new Event("negotiationneeded");t.dispatchEvent(e),"function"==typeof t.onnegotiationneeded&&t.onnegotiationneeded(e)}},0))},a.prototype._updateConnectionState=function(){var e,t={new:0,closed:0,connecting:0,checking:0,connected:0,completed:0,disconnected:0,failed:0};if(this.transceivers.forEach(function(e){t[e.iceTransport.state]++,t[e.dtlsTransport.state]++}),t.connected+=t.completed,e="new",t.failed>0?e="failed":t.connecting>0||t.checking>0?e="connecting":t.disconnected>0?e="disconnected":t.new>0?e="new":(t.connected>0||t.completed>0)&&(e="connected"),e!==this.iceConnectionState){this.iceConnectionState=e;var a=new Event("iceconnectionstatechange");this.dispatchEvent(a),"function"==typeof this.oniceconnectionstatechange&&this.oniceconnectionstatechange(a)}},a.prototype.createOffer=function(){var a,s=this,i=arguments;1===arguments.length&&"function"!=typeof arguments[0]?a=arguments[0]:3===arguments.length&&(a=arguments[2]);var r=this.transceivers.filter(function(e){return"audio"===e.kind}).length,o=this.transceivers.filter(function(e){return"video"===e.kind}).length;if(a){if(a.mandatory||a.optional)throw new TypeError("Legacy mandatory/optional constraints not supported.");void 0!==a.offerToReceiveAudio&&(r=!0===a.offerToReceiveAudio?1:!1===a.offerToReceiveAudio?0:a.offerToReceiveAudio),void 0!==a.offerToReceiveVideo&&(o=!0===a.offerToReceiveVideo?1:!1===a.offerToReceiveVideo?0:a.offerToReceiveVideo)}for(this.transceivers.forEach(function(e){"audio"===e.kind?--r<0&&(e.wantReceive=!1):"video"===e.kind&&--o<0&&(e.wantReceive=!1)});r>0||o>0;)r>0&&(this._createTransceiver("audio"),r--),o>0&&(this._createTransceiver("video"),o--);var d=l.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.transceivers.forEach(function(a,n){var i=a.track,r=a.kind,o=l.generateIdentifier();a.mid=o,a.iceGatherer||(a.iceGatherer=s._createIceGatherer(n,s.usingBundle));var d=e.RTCRtpSender.getCapabilities(r);t<15019&&(d.codecs=d.codecs.filter(function(e){return"rtx"!==e.name})),d.codecs.forEach(function(e){"H264"===e.name&&void 0===e.parameters["level-asymmetry-allowed"]&&(e.parameters["level-asymmetry-allowed"]="1")});var u=a.sendEncodingParameters||[{ssrc:1001*(2*n+1)}];i&&t>=15019&&"video"===r&&!u[0].rtx&&(u[0].rtx={ssrc:u[0].ssrc+1}),a.wantReceive&&(a.rtpReceiver=new e.RTCRtpReceiver(a.dtlsTransport,r)),a.localCapabilities=d,a.sendEncodingParameters=u}),"max-compat"!==this._config.bundlePolicy&&(d+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n"),d+="a=ice-options:trickle\r\n",this.transceivers.forEach(function(e,t){d+=n(e,e.localCapabilities,"offer",e.stream,s._dtlsRole),d+="a=rtcp-rsize\r\n",!e.iceGatherer||"new"===s.iceGatheringState||0!==t&&s.usingBundle||(e.iceGatherer.getLocalCandidates().forEach(function(e){e.component=1,d+="a="+l.writeCandidate(e)+"\r\n"}),"completed"===e.iceGatherer.state&&(d+="a=end-of-candidates\r\n"))});var u=new e.RTCSessionDescription({type:"offer",sdp:d});return new Promise(function(e){if(i.length>0&&"function"==typeof i[0])return i[0].apply(null,[u]),void e();e(u)})},a.prototype.createAnswer=function(){var a=this,s=arguments,r=l.writeSessionBoilerplate(this._sdpSessionId,this._sdpSessionVersion++);this.usingBundle&&(r+="a=group:BUNDLE "+this.transceivers.map(function(e){return e.mid}).join(" ")+"\r\n");var o=l.splitSections(this.remoteDescription.sdp).length-1;this.transceivers.forEach(function(e,s){if(!(s+1>o)){if(e.isDatachannel)return void(r+="m=application 0 DTLS/SCTP 5000\r\nc=IN IP4 0.0.0.0\r\na=mid:"+e.mid+"\r\n");if(e.stream){var l;"audio"===e.kind?l=e.stream.getAudioTracks()[0]:"video"===e.kind&&(l=e.stream.getVideoTracks()[0]),l&&t>=15019&&"video"===e.kind&&!e.sendEncodingParameters[0].rtx&&(e.sendEncodingParameters[0].rtx={ssrc:e.sendEncodingParameters[0].ssrc+1})}var d=i(e.localCapabilities,e.remoteCapabilities);!d.codecs.filter(function(e){return"rtx"===e.name.toLowerCase()}).length&&e.sendEncodingParameters[0].rtx&&delete e.sendEncodingParameters[0].rtx,r+=n(e,d,"answer",e.stream,a._dtlsRole),e.rtcpParameters&&e.rtcpParameters.reducedSize&&(r+="a=rtcp-rsize\r\n")}});var d=new e.RTCSessionDescription({type:"answer",sdp:r});return new Promise(function(e){if(s.length>0&&"function"==typeof s[0])return s[0].apply(null,[d]),void e();e(d)})},a.prototype.addIceCandidate=function(e){var t,a;if(e&&""!==e.candidate){if(void 0===e.sdpMLineIndex&&!e.sdpMid)throw new TypeError("sdpMLineIndex or sdpMid required");if(this.remoteDescription){var n=e.sdpMLineIndex;if(e.sdpMid)for(var s=0;s<this.transceivers.length;s++)if(this.transceivers[s].mid===e.sdpMid){n=s;break}var i=this.transceivers[n];if(i){if(i.isDatachannel)return Promise.resolve();var r=Object.keys(e.candidate).length>0?l.parseCandidate(e.candidate):{};if("tcp"===r.protocol&&(0===r.port||9===r.port))return Promise.resolve();if(r.component&&1!==r.component)return Promise.resolve();if((0===n||n>0&&i.iceTransport!==this.transceivers[0].iceTransport)&&(o(i.iceTransport,r)||(t=new Error("Can not add ICE candidate"),t.name="OperationError")),!t){var d=e.candidate.trim();0===d.indexOf("a=")&&(d=d.substr(2)),a=l.splitSections(this.remoteDescription.sdp),a[n+1]+="a="+(r.type?d:"end-of-candidates")+"\r\n",this.remoteDescription.sdp=a.join("")}}else t=new Error("Can not add ICE candidate"),t.name="OperationError"}else t=new Error("Can not add ICE candidate without a remote description"),t.name="InvalidStateError"}else for(var u=0;u<this.transceivers.length&&(this.transceivers[u].isDatachannel||(this.transceivers[u].iceTransport.addRemoteCandidate({}),a=l.splitSections(this.remoteDescription.sdp),a[u+1]+="a=end-of-candidates\r\n",this.remoteDescription.sdp=a.join(""),!this.usingBundle));u++);var c=arguments;return new Promise(function(e,a){t?(c.length>2&&"function"==typeof c[2]&&c[2].apply(null,[t]),a(t)):(c.length>1&&"function"==typeof c[1]&&c[1].apply(null),e())})},a.prototype.getStats=function(){var e=[];this.transceivers.forEach(function(t){["rtpSender","rtpReceiver","iceGatherer","iceTransport","dtlsTransport"].forEach(function(a){t[a]&&e.push(t[a].getStats())})});var t=arguments.length>1&&"function"==typeof arguments[1]&&arguments[1],a=function(e){return{inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[e.type]||e.type};return new Promise(function(n){var s=new Map;Promise.all(e).then(function(e){e.forEach(function(e){Object.keys(e).forEach(function(t){e[t].type=a(e[t]),s.set(t,e[t])})}),t&&t.apply(null,s),n(s)})})},a}},2476:function(e,t,a){a(0),a(0);e.exports=function(e){var t=e&&e.navigator,a=function(e){return{name:{PermissionDeniedError:"NotAllowedError"}[e.name]||e.name,message:e.message,constraint:e.constraint,toString:function(){return this.name}}},n=t.mediaDevices.getUserMedia.bind(t.mediaDevices);t.mediaDevices.getUserMedia=function(e){return n(e).catch(function(e){return Promise.reject(a(e))})}}},2477:function(e,t,a){var n=(a(0),a(0),a(2167)),s={shimOnTrack:function(e){"object"!=typeof e||!e.RTCPeerConnection||"ontrack"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get:function(){return this._ontrack},set:function(e){this._ontrack&&(this.removeEventListener("track",this._ontrack),this.removeEventListener("addstream",this._ontrackpoly)),this.addEventListener("track",this._ontrack=e),this.addEventListener("addstream",this._ontrackpoly=function(e){e.stream.getTracks().forEach(function(t){var a=new Event("track");a.track=t,a.receiver={track:t},a.transceiver={receiver:a.receiver},a.streams=[e.stream],this.dispatchEvent(a)}.bind(this))}.bind(this))}}),"object"==typeof e&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})},shimSourceObject:function(e){"object"==typeof e&&(!e.HTMLMediaElement||"srcObject"in e.HTMLMediaElement.prototype||Object.defineProperty(e.HTMLMediaElement.prototype,"srcObject",{get:function(){return this.mozSrcObject},set:function(e){this.mozSrcObject=e}}))},shimPeerConnection:function(e){var t=n.detectBrowser(e);if("object"==typeof e&&(e.RTCPeerConnection||e.mozRTCPeerConnection)){e.RTCPeerConnection||(e.RTCPeerConnection=function(a,n){if(t.version<38&&a&&a.iceServers){for(var s=[],i=0;i<a.iceServers.length;i++){var r=a.iceServers[i];if(r.hasOwnProperty("urls"))for(var o=0;o<r.urls.length;o++){var l={url:r.urls[o]};0===r.urls[o].indexOf("turn")&&(l.username=r.username,l.credential=r.credential),s.push(l)}else s.push(a.iceServers[i])}a.iceServers=s}return new e.mozRTCPeerConnection(a,n)},e.RTCPeerConnection.prototype=e.mozRTCPeerConnection.prototype,e.mozRTCPeerConnection.generateCertificate&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return e.mozRTCPeerConnection.generateCertificate}}),e.RTCSessionDescription=e.mozRTCSessionDescription,e.RTCIceCandidate=e.mozRTCIceCandidate),["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(t){var a=e.RTCPeerConnection.prototype[t];e.RTCPeerConnection.prototype[t]=function(){return arguments[0]=new("addIceCandidate"===t?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}});var a=e.RTCPeerConnection.prototype.addIceCandidate;e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?a.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),Promise.resolve())};var s=function(e){var t=new Map;return Object.keys(e).forEach(function(a){t.set(a,e[a]),t[a]=e[a]}),t},i={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(e,a,n){return r.apply(this,[e||null]).then(function(e){if(t.version<48&&(e=s(e)),t.version<53&&!a)try{e.forEach(function(e){e.type=i[e.type]||e.type})}catch(t){if("TypeError"!==t.name)throw t;e.forEach(function(t,a){e.set(a,Object.assign({},t,{type:i[t.type]||t.type}))})}return e}).then(a,n)}}}};e.exports={shimOnTrack:s.shimOnTrack,shimSourceObject:s.shimSourceObject,shimPeerConnection:s.shimPeerConnection,shimGetUserMedia:a(2478)}},2478:function(e,t,a){var n=(a(0),a(0),a(2167)),s=n.log;e.exports=function(e){var t=n.detectBrowser(e),a=e&&e.navigator,i=e&&e.MediaStreamTrack,r=function(e){return{name:{InternalError:"NotReadableError",NotSupportedError:"TypeError",PermissionDeniedError:"NotAllowedError",SecurityError:"NotAllowedError"}[e.name]||e.name,message:{"The operation is insecure.":"The request is not allowed by the user agent or the platform in the current context."}[e.message]||e.message,constraint:e.constraint,toString:function(){return this.name+(this.message&&": ")+this.message}}},o=function(e,n,i){var o=function(e){if("object"!=typeof e||e.require)return e;var t=[];return Object.keys(e).forEach(function(a){if("require"!==a&&"advanced"!==a&&"mediaSource"!==a){var n=e[a]="object"==typeof e[a]?e[a]:{ideal:e[a]};if(void 0===n.min&&void 0===n.max&&void 0===n.exact||t.push(a),void 0!==n.exact&&("number"==typeof n.exact?n.min=n.max=n.exact:e[a]=n.exact,delete n.exact),void 0!==n.ideal){e.advanced=e.advanced||[];var s={};"number"==typeof n.ideal?s[a]={min:n.ideal,max:n.ideal}:s[a]=n.ideal,e.advanced.push(s),delete n.ideal,Object.keys(n).length||delete e[a]}}}),t.length&&(e.require=t),e};return e=JSON.parse(JSON.stringify(e)),t.version<38&&(s("spec: "+JSON.stringify(e)),e.audio&&(e.audio=o(e.audio)),e.video&&(e.video=o(e.video)),s("ff37: "+JSON.stringify(e))),a.mozGetUserMedia(e,n,function(e){i(r(e))})},l=function(e){return new Promise(function(t,a){o(e,t,a)})};if(a.mediaDevices||(a.mediaDevices={getUserMedia:l,addEventListener:function(){},removeEventListener:function(){}}),a.mediaDevices.enumerateDevices=a.mediaDevices.enumerateDevices||function(){return new Promise(function(e){e([{kind:"audioinput",deviceId:"default",label:"",groupId:""},{kind:"videoinput",deviceId:"default",label:"",groupId:""}])})},t.version<41){var d=a.mediaDevices.enumerateDevices.bind(a.mediaDevices);a.mediaDevices.enumerateDevices=function(){return d().then(void 0,function(e){if("NotFoundError"===e.name)return[];throw e})}}if(t.version<49){var u=a.mediaDevices.getUserMedia.bind(a.mediaDevices);a.mediaDevices.getUserMedia=function(e){return u(e).then(function(t){if(e.audio&&!t.getAudioTracks().length||e.video&&!t.getVideoTracks().length)throw t.getTracks().forEach(function(e){e.stop()}),new DOMException("The object can not be found here.","NotFoundError");return t},function(e){return Promise.reject(r(e))})}}if(!(t.version>55&&"autoGainControl"in a.mediaDevices.getSupportedConstraints())){var c=function(e,t,a){t in e&&!(a in e)&&(e[a]=e[t],delete e[t])},f=a.mediaDevices.getUserMedia.bind(a.mediaDevices);if(a.mediaDevices.getUserMedia=function(e){return"object"==typeof e&&"object"==typeof e.audio&&(e=JSON.parse(JSON.stringify(e)),c(e.audio,"autoGainControl","mozAutoGainControl"),c(e.audio,"noiseSuppression","mozNoiseSuppression")),f(e)},i&&i.prototype.getSettings){var m=i.prototype.getSettings;i.prototype.getSettings=function(){var e=m.apply(this,arguments);return c(e,"mozAutoGainControl","autoGainControl"),c(e,"mozNoiseSuppression","noiseSuppression"),e}}if(i&&i.prototype.applyConstraints){var h=i.prototype.applyConstraints;i.prototype.applyConstraints=function(e){return"audio"===this.kind&&"object"==typeof e&&(e=JSON.parse(JSON.stringify(e)),c(e,"autoGainControl","mozAutoGainControl"),c(e,"noiseSuppression","mozNoiseSuppression")),h.apply(this,[e])}}}a.getUserMedia=function(e,s,i){if(t.version<44)return o(e,s,i);n.deprecated("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),a.mediaDevices.getUserMedia(e).then(s,i)}}},2479:function(e,t,a){var n=(a(0),a(0),a(2167)),s={shimLocalStreamsAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),"getStreamById"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getStreamById=function(e){var t=null;return this._localStreams&&this._localStreams.forEach(function(a){a.id===e&&(t=a)}),this._remoteStreams&&this._remoteStreams.forEach(function(a){a.id===e&&(t=a)}),t}),!("addStream"in e.RTCPeerConnection.prototype)){var t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(e){this._localStreams||(this._localStreams=[]),-1===this._localStreams.indexOf(e)&&this._localStreams.push(e);var a=this;e.getTracks().forEach(function(n){t.call(a,n,e)})},e.RTCPeerConnection.prototype.addTrack=function(e,a){a&&(this._localStreams?-1===this._localStreams.indexOf(a)&&this._localStreams.push(a):this._localStreams=[a]),t.call(this,e,a)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(e){this._localStreams||(this._localStreams=[]);var t=this._localStreams.indexOf(e);if(-1!==t){this._localStreams.splice(t,1);var a=this,n=e.getTracks();this.getSenders().forEach(function(e){-1!==n.indexOf(e.track)&&a.removeTrack(e)})}})}},shimRemoteStreamsAPI:function(e){"object"==typeof e&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),"onaddstream"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get:function(){return this._onaddstream},set:function(e){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=e),this.addEventListener("track",this._onaddstreampoly=function(e){var t=e.streams[0];if(this._remoteStreams||(this._remoteStreams=[]),!(this._remoteStreams.indexOf(t)>=0)){this._remoteStreams.push(t);var a=new Event("addstream");a.stream=e.streams[0],this.dispatchEvent(a)}}.bind(this))}}))},shimCallbacksAPI:function(e){if("object"==typeof e&&e.RTCPeerConnection){var t=e.RTCPeerConnection.prototype,a=t.createOffer,n=t.createAnswer,s=t.setLocalDescription,i=t.setRemoteDescription,r=t.addIceCandidate;t.createOffer=function(e,t){var n=arguments.length>=2?arguments[2]:arguments[0],s=a.apply(this,[n]);return t?(s.then(e,t),Promise.resolve()):s},t.createAnswer=function(e,t){var a=arguments.length>=2?arguments[2]:arguments[0],s=n.apply(this,[a]);return t?(s.then(e,t),Promise.resolve()):s};var o=function(e,t,a){var n=s.apply(this,[e]);return a?(n.then(t,a),Promise.resolve()):n};t.setLocalDescription=o,o=function(e,t,a){var n=i.apply(this,[e]);return a?(n.then(t,a),Promise.resolve()):n},t.setRemoteDescription=o,o=function(e,t,a){var n=r.apply(this,[e]);return a?(n.then(t,a),Promise.resolve()):n},t.addIceCandidate=o}},shimGetUserMedia:function(e){var t=e&&e.navigator;t.getUserMedia||(t.webkitGetUserMedia?t.getUserMedia=t.webkitGetUserMedia.bind(t):t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=function(e,a,n){t.mediaDevices.getUserMedia(e).then(a,n)}.bind(t)))},shimRTCIceServerUrls:function(e){var t=e.RTCPeerConnection;e.RTCPeerConnection=function(e,a){if(e&&e.iceServers){for(var s=[],i=0;i<e.iceServers.length;i++){var r=e.iceServers[i];!r.hasOwnProperty("urls")&&r.hasOwnProperty("url")?(n.deprecated("RTCIceServer.url","RTCIceServer.urls"),r=JSON.parse(JSON.stringify(r)),r.urls=r.url,delete r.url,s.push(r)):s.push(e.iceServers[i])}e.iceServers=s}return new t(e,a)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in e.RTCPeerConnection&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:function(){return t.generateCertificate}})},shimTrackEventTransceiver:function(e){"object"==typeof e&&e.RTCPeerConnection&&"receiver"in e.RTCTrackEvent.prototype&&!e.RTCTransceiver&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get:function(){return{receiver:this.receiver}}})}};e.exports={shimCallbacksAPI:s.shimCallbacksAPI,shimLocalStreamsAPI:s.shimLocalStreamsAPI,shimRemoteStreamsAPI:s.shimRemoteStreamsAPI,shimGetUserMedia:s.shimGetUserMedia,shimRTCIceServerUrls:s.shimRTCIceServerUrls,shimTrackEventTransceiver:s.shimTrackEventTransceiver}},2480:function(e,t,a){function n(e,t,a){if(e.RTCPeerConnection){var n=e.RTCPeerConnection.prototype,s=n.addEventListener;n.addEventListener=function(e,n){if(e!==t)return s.apply(this,arguments);var i=function(e){n(a(e))};return this._eventMap=this._eventMap||{},this._eventMap[n]=i,s.apply(this,[e,i])};var i=n.removeEventListener;n.removeEventListener=function(e,a){if(e!==t||!this._eventMap||!this._eventMap[a])return i.apply(this,arguments);var n=this._eventMap[a];return delete this._eventMap[a],i.apply(this,[e,n])},Object.defineProperty(n,"on"+t,{get:function(){return this["_on"+t]},set:function(e){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),e&&this.addEventListener(t,this["_on"+t]=e)}})}}var s=(a(0),a(0),a(2199)),i=a(2167);e.exports={shimRTCIceCandidate:function(e){if(!(e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)){var t=e.RTCIceCandidate;e.RTCIceCandidate=function(e){"object"==typeof e&&e.candidate&&0===e.candidate.indexOf("a=")&&(e=JSON.parse(JSON.stringify(e)),e.candidate=e.candidate.substr(2));var a=new t(e),n=s.parseCandidate(e.candidate),i=Object.assign(a,n);return i.toJSON=function(){return{candidate:i.candidate,sdpMid:i.sdpMid,sdpMLineIndex:i.sdpMLineIndex,usernameFragment:i.usernameFragment}},i},n(e,"icecandidate",function(t){return t.candidate&&Object.defineProperty(t,"candidate",{value:new e.RTCIceCandidate(t.candidate),writable:"false"}),t})}},shimCreateObjectURL:function(e){var t=e&&e.URL;if("object"==typeof e&&e.HTMLMediaElement&&"srcObject"in e.HTMLMediaElement.prototype&&t.createObjectURL&&t.revokeObjectURL){var a=t.createObjectURL.bind(t),n=t.revokeObjectURL.bind(t),s=new Map,r=0;t.createObjectURL=function(e){if("getTracks"in e){var t="polyblob:"+ ++r;return s.set(t,e),i.deprecated("URL.createObjectURL(stream)","elem.srcObject = stream"),t}return a(e)},t.revokeObjectURL=function(e){n(e),s.delete(e)};var o=Object.getOwnPropertyDescriptor(e.HTMLMediaElement.prototype,"src");Object.defineProperty(e.HTMLMediaElement.prototype,"src",{get:function(){return o.get.apply(this)},set:function(e){return this.srcObject=s.get(e)||null,o.set.apply(this,[e])}});var l=e.HTMLMediaElement.prototype.setAttribute;e.HTMLMediaElement.prototype.setAttribute=function(){return 2===arguments.length&&"src"===(""+arguments[0]).toLowerCase()&&(this.srcObject=s.get(arguments[1])||null),l.apply(this,arguments)}}}}},2481:function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function s(e){var t=l.default.createElement(u.FormattedMessage,{id:"webrtc.header",defaultMessage:"Call with {username}",values:{username:e.username}}),a=l.default.createElement(d.Tooltip,{id:"closeSidebarTooltip"},l.default.createElement(u.FormattedMessage,{id:"rhs_header.closeTooltip",defaultMessage:"Close Sidebar"})),n=l.default.createElement(d.Tooltip,{id:"expandSidebarTooltip"},l.default.createElement(u.FormattedMessage,{id:"rhs_header.expandTooltip",defaultMessage:"Expand Sidebar"})),s=l.default.createElement(d.Tooltip,{id:"shrinkSidebarTooltip"},l.default.createElement(u.FormattedMessage,{id:"rhs_header.expandTooltip",defaultMessage:"Shrink Sidebar"}));return l.default.createElement("div",{className:"sidebar--right__header"},l.default.createElement("span",{className:"sidebar--right__title"},t),l.default.createElement("div",{className:"pull-right"},l.default.createElement("button",{type:"button",className:"sidebar--right__expand","aria-label":"Expand",onClick:e.toggleSize},l.default.createElement(d.OverlayTrigger,{trigger:["hover","focus"],delayShow:f.default.OVERLAY_TIME_DELAY,placement:"top",overlay:n},l.default.createElement("i",{className:"fa fa-expand"})),l.default.createElement(d.OverlayTrigger,{trigger:["hover","focus"],delayShow:f.default.OVERLAY_TIME_DELAY,placement:"top",overlay:s},l.default.createElement("i",{className:"fa fa-compress"}))),l.default.createElement("button",{type:"button",className:"sidebar--right__close","aria-label":"Close",title:"Close",onClick:e.onClose},l.default.createElement(d.OverlayTrigger,{delayShow:f.default.OVERLAY_TIME_DELAY,placement:"top",overlay:a},l.default.createElement("i",{className:"fa fa-sign-out"})))))}Object.defineProperty(t,"__esModule",{value:!0}),t.default=s;var i=a(2),r=n(i),o=a(1),l=n(o),d=a(40),u=a(17),c=a(9),f=n(c);s.propTypes={username:r.default.string.isRequired,onClose:r.default.func.isRequired,toggleSize:r.default.func}}});
//# sourceMappingURL=7.2b6bfa5f0d3f681ea629.js.map